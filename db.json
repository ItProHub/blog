{"meta":{"version":1,"warehouse":"4.0.2"},"models":{"Asset":[{"_id":"source/images/hello-bg.png","path":"images/hello-bg.png","modified":0,"renderable":0},{"_id":"themes/archer/source/assets/algolia_logo.svg","path":"assets/algolia_logo.svg","modified":0,"renderable":1},{"_id":"themes/archer/source/assets/beian.png","path":"assets/beian.png","modified":0,"renderable":1},{"_id":"themes/archer/source/assets/example_qr.png","path":"assets/example_qr.png","modified":0,"renderable":1},{"_id":"themes/archer/source/assets/favicon.ico","path":"assets/favicon.ico","modified":0,"renderable":1},{"_id":"themes/archer/source/assets/favicon_bak.ico","path":"assets/favicon_bak.ico","modified":0,"renderable":1},{"_id":"themes/archer/source/assets/loading.svg","path":"assets/loading.svg","modified":0,"renderable":1},{"_id":"themes/archer/source/assets/wechat_qr.jpg","path":"assets/wechat_qr.jpg","modified":0,"renderable":1},{"_id":"themes/archer/source/avatar/Misaka.jpg","path":"avatar/Misaka.jpg","modified":0,"renderable":1},{"_id":"themes/archer/source/css/dark.css","path":"css/dark.css","modified":0,"renderable":1},{"_id":"themes/archer/source/css/dark.css.map","path":"css/dark.css.map","modified":0,"renderable":1},{"_id":"themes/archer/source/css/mobile.css","path":"css/mobile.css","modified":0,"renderable":1},{"_id":"themes/archer/source/css/mobile.css.map","path":"css/mobile.css.map","modified":0,"renderable":1},{"_id":"themes/archer/source/css/style.css.map","path":"css/style.css.map","modified":0,"renderable":1},{"_id":"themes/archer/source/font/Source Sans Pro.woff","path":"font/Source Sans Pro.woff","modified":0,"renderable":1},{"_id":"themes/archer/source/css/style.css","path":"css/style.css","modified":0,"renderable":1},{"_id":"themes/archer/source/font/Source Sans Pro.woff2","path":"font/Source Sans Pro.woff2","modified":0,"renderable":1},{"_id":"themes/archer/source/font/Oswald-Regular.ttf","path":"font/Oswald-Regular.ttf","modified":0,"renderable":1},{"_id":"themes/archer/source/font/SourceCodePro-Regular.ttf.woff","path":"font/SourceCodePro-Regular.ttf.woff","modified":0,"renderable":1},{"_id":"themes/archer/source/font/SourceCodePro-Regular.ttf.woff2","path":"font/SourceCodePro-Regular.ttf.woff2","modified":0,"renderable":1},{"_id":"themes/archer/source/intro/404-bg.jpg","path":"intro/404-bg.jpg","modified":0,"renderable":1},{"_id":"themes/archer/source/intro/about-bg.jpg","path":"intro/about-bg.jpg","modified":0,"renderable":1},{"_id":"themes/archer/source/intro/index-bg.jpg","path":"intro/index-bg.jpg","modified":0,"renderable":1},{"_id":"themes/archer/source/intro/post-bg.jpg","path":"intro/post-bg.jpg","modified":0,"renderable":1},{"_id":"themes/archer/source/lib/jquery.min.js","path":"lib/jquery.min.js","modified":0,"renderable":1},{"_id":"themes/archer/source/lib/webfontloader.min.js","path":"lib/webfontloader.min.js","modified":0,"renderable":1},{"_id":"themes/archer/source/scripts/customFontLoader.js","path":"scripts/customFontLoader.js","modified":0,"renderable":1},{"_id":"themes/archer/source/scripts/customFontLoader.js.map","path":"scripts/customFontLoader.js.map","modified":0,"renderable":1},{"_id":"themes/archer/source/scripts/dark.js","path":"scripts/dark.js","modified":0,"renderable":1},{"_id":"themes/archer/source/scripts/dark.js.map","path":"scripts/dark.js.map","modified":0,"renderable":1},{"_id":"themes/archer/source/scripts/main.js","path":"scripts/main.js","modified":0,"renderable":1},{"_id":"themes/archer/source/scripts/main.js.LICENSE.txt","path":"scripts/main.js.LICENSE.txt","modified":0,"renderable":1},{"_id":"themes/archer/source/scripts/search.js","path":"scripts/search.js","modified":0,"renderable":1},{"_id":"themes/archer/source/scripts/main.js.map","path":"scripts/main.js.map","modified":0,"renderable":1},{"_id":"themes/archer/source/scripts/search.js.LICENSE.txt","path":"scripts/search.js.LICENSE.txt","modified":0,"renderable":1},{"_id":"themes/archer/source/scripts/search.js.map","path":"scripts/search.js.map","modified":0,"renderable":1},{"_id":"themes/archer/source/scripts/share.js","path":"scripts/share.js","modified":0,"renderable":1},{"_id":"themes/archer/source/scripts/share.js.map","path":"scripts/share.js.map","modified":0,"renderable":1},{"_id":"themes/archer/source/avatar/Jason.jpg","path":"avatar/Jason.jpg","modified":0,"renderable":1},{"_id":"source/images/http/http-request.png","path":"images/http/http-request.png","modified":0,"renderable":0},{"_id":"source/images/http/request-methods.png","path":"images/http/request-methods.png","modified":0,"renderable":0},{"_id":"source/images/http/TCP-connection-1.png","path":"images/http/TCP-connection-1.png","modified":0,"renderable":0},{"_id":"source/images/http/curl-header.png","path":"images/http/curl-header.png","modified":0,"renderable":0},{"_id":"source/images/http/handshake-1.png","path":"images/http/handshake-1.png","modified":0,"renderable":0},{"_id":"source/images/http/perisitent-connection.png","path":"images/http/perisitent-connection.png","modified":0,"renderable":0},{"_id":"source/images/http/auto-disconnect.png","path":"images/http/auto-disconnect.png","modified":0,"renderable":0},{"_id":"source/images/http/auto-disconnect2.png","path":"images/http/auto-disconnect2.png","modified":0,"renderable":0},{"_id":"source/images/http/handshake-2.png","path":"images/http/handshake-2.png","modified":0,"renderable":0},{"_id":"source/images/http/http-keep-alive-header.png","path":"images/http/http-keep-alive-header.png","modified":0,"renderable":0},{"_id":"source/images/internal-loss/depressed.jpg","path":"images/internal-loss/depressed.jpg","modified":0,"renderable":0},{"_id":"source/images/http/timeout-auto-disconnect.png","path":"images/http/timeout-auto-disconnect.png","modified":0,"renderable":0},{"_id":"source/images/internal-loss/20231109_sy_01.jpg","path":"images/internal-loss/20231109_sy_01.jpg","modified":0,"renderable":0},{"_id":"source/images/internal-loss/996.jpg","path":"images/internal-loss/996.jpg","modified":0,"renderable":0},{"_id":"source/images/garnet/client.png","path":"images/garnet/client.png","modified":0,"renderable":0},{"_id":"source/images/garnet/compatible.png","path":"images/garnet/compatible.png","modified":0,"renderable":0},{"_id":"source/images/garnet/compare1.png","path":"images/garnet/compare1.png","modified":0,"renderable":0},{"_id":"source/images/garnet/log.png","path":"images/garnet/log.png","modified":0,"renderable":0},{"_id":"source/images/garnet/1.png","path":"images/garnet/1.png","modified":0,"renderable":0},{"_id":"source/images/garnet/connect.png","path":"images/garnet/connect.png","modified":0,"renderable":0},{"_id":"source/images/garnet/custom-command.png","path":"images/garnet/custom-command.png","modified":0,"renderable":0},{"_id":"source/images/https/bg.jpg","path":"images/https/bg.jpg","modified":0,"renderable":0},{"_id":"source/images/https/expire.png","path":"images/https/expire.png","modified":0,"renderable":0},{"_id":"source/images/garnet/running.png","path":"images/garnet/running.png","modified":0,"renderable":0},{"_id":"source/images/https/ca.png","path":"images/https/ca.png","modified":0,"renderable":0},{"_id":"source/images/https/ca2.png","path":"images/https/ca2.png","modified":0,"renderable":0},{"_id":"source/images/https/client-hello.png","path":"images/https/client-hello.png","modified":0,"renderable":0},{"_id":"source/images/https/encrypted.png","path":"images/https/encrypted.png","modified":0,"renderable":0},{"_id":"source/images/https/security.png","path":"images/https/security.png","modified":0,"renderable":0},{"_id":"source/images/https/negotiated-cipher-suite.png","path":"images/https/negotiated-cipher-suite.png","modified":0,"renderable":0},{"_id":"source/images/https/cipher-suites.png","path":"images/https/cipher-suites.png","modified":0,"renderable":0},{"_id":"source/images/https/handshake.png","path":"images/https/handshake.png","modified":0,"renderable":0},{"_id":"source/images/redis-interview/recruitment.png","path":"images/redis-interview/recruitment.png","modified":0,"renderable":0},{"_id":"source/images/dump/bg.png","path":"images/dump/bg.png","modified":0,"renderable":0},{"_id":"source/images/dump/crash.jpeg","path":"images/dump/crash.jpeg","modified":0,"renderable":0},{"_id":"source/images/redis-interview/bg.png","path":"images/redis-interview/bg.png","modified":0,"renderable":0},{"_id":"source/images/redis-interview/cache-avalanche.png","path":"images/redis-interview/cache-avalanche.png","modified":0,"renderable":0},{"_id":"source/images/redis-interview/cache-breakdown.png","path":"images/redis-interview/cache-breakdown.png","modified":0,"renderable":0},{"_id":"source/images/redis-interview/memory.png","path":"images/redis-interview/memory.png","modified":0,"renderable":0},{"_id":"source/images/redis-interview/cache-penetration.png","path":"images/redis-interview/cache-penetration.png","modified":0,"renderable":0},{"_id":"source/images/dump/windbg_2.png","path":"images/dump/windbg_2.png","modified":1,"renderable":0},{"_id":"source/images/dump/windbg_4.png","path":"images/dump/windbg_4.png","modified":1,"renderable":0},{"_id":"source/images/dump/windbg_1.png","path":"images/dump/windbg_1.png","modified":1,"renderable":0},{"_id":"source/images/dump/windbg_3.png","path":"images/dump/windbg_3.png","modified":1,"renderable":0}],"Cache":[{"_id":"source/_posts/hello-world-bak.md1","hash":"1e16dbc0dbf8b18e83f47dbbdffd0d1f27cfe955","modified":1710398484836},{"_id":"themes/archer/layout/_partial/comment/custom.ejs","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1688482306000},{"_id":"themes/archer/.eslintignore","hash":"304e696987e3f31cd0a7a13a835d58d8bda3aa6c","modified":1688482306000},{"_id":"themes/archer/.gitattributes","hash":"82c1a621642d5b620275ae1ed59845c3f7015a64","modified":1688482306000},{"_id":"themes/archer/.babelrc","hash":"078678843ebb6992f0cc44304faa6f1cb082bd4a","modified":1688482306000},{"_id":"themes/archer/.gitignore","hash":"9a5e5d0a05fc5bee9bf00a0c5cefc712b4bf0904","modified":1688482306000},{"_id":"themes/archer/.eslintrc.json","hash":"352a07b94efa124a5658b502bf973683be09fd00","modified":1688482306000},{"_id":"themes/archer/.editorconfig","hash":"3a7f38d9586f73ed1c46cfbc9839b3465ec57d7c","modified":1688482306000},{"_id":"themes/archer/.prettierignore","hash":"29648a30c14f6df709eb6610f506c82825910cc8","modified":1688482306000},{"_id":"source/_posts/hello-world.md","hash":"3c422ea24b75465e6ea2a80c268251ca0a03e042","modified":1714100836002},{"_id":"themes/archer/LICENSE","hash":"0da0c361bf299375739c6b668a44af0f5faf37bb","modified":1688482306000},{"_id":"themes/archer/CHANGELOG.md","hash":"6fbf3e5e8ed6ae6fb68fd74bfd2b53d99db4b1fd","modified":1688482306000},{"_id":"themes/archer/.prettierrc.js","hash":"bae1d8dab7bf8b68207386f366e092778940540c","modified":1688482306000},{"_id":"themes/archer/package.json","hash":"81af75826e854ac80f6337dc4f1ce4b51f066b0b","modified":1688482306000},{"_id":"themes/archer/_config.yml","hash":"0dd04e79b90209217c5bdff1e8160f2976b30312","modified":1710819811209},{"_id":"themes/archer/webpack.dev.js","hash":"7c740341894bd584f72145512a58703bb134ea60","modified":1688482306000},{"_id":"themes/archer/README.md","hash":"63eb0f874bc056d407ee343f853adee9a5765434","modified":1688482306000},{"_id":"themes/archer/webpack.prod.js","hash":"a34abc06d6cd8fa4e267069468726322a3656e2b","modified":1688482306000},{"_id":"themes/archer/gulpfile.js","hash":"ee1ad57aa5113a084091fd86fca2c34e1b9e4b95","modified":1688482306000},{"_id":"themes/archer/dev/archer.sh","hash":"4065c4e55462d5ecf016464adea0d1db967ef4b4","modified":1688482306000},{"_id":"themes/archer/webpack.config.js","hash":"e090744d8e7a0d0906d1d6b8192eb906092d1e9b","modified":1688482306000},{"_id":"themes/archer/docs/README-en.md","hash":"f5e40c5803071bd6dafc94070c6939aa0c02d061","modified":1688482306000},{"_id":"themes/archer/docs/develop-guide-en.md","hash":"c62510d3d14b38126b5a86ff30416cb71abc1d9a","modified":1688482306000},{"_id":"themes/archer/docs/develop-guide-zh.md","hash":"451b304c1a5d081313f0532a4f5665f0855d4cfd","modified":1688482306000},{"_id":"themes/archer/languages/default.yml","hash":"e937791c5080868c3abe20bab4cf266a342b5922","modified":1688482306000},{"_id":"themes/archer/languages/en.yml","hash":"5a1a85fed95dab4f01671714ee8cc5420936c05f","modified":1688482306000},{"_id":"themes/archer/layout/404.ejs","hash":"9137c0b1153ca8cd32e60a38fd79b7e4b91c8bf4","modified":1688482306000},{"_id":"themes/archer/layout/about.ejs","hash":"748786bebad03b1ef79c551f26522fa2bee1b9dd","modified":1688482306000},{"_id":"themes/archer/layout/site-meta.ejs","hash":"562e446a742fde07e0880343d5693bf8cb0dec23","modified":1688482306000},{"_id":"themes/archer/layout/index.ejs","hash":"093f8dbe875cad94b9618f181d1b5621d8874b19","modified":1688482306000},{"_id":"themes/archer/.github/ISSUE_TEMPLATE/-----feature-request-.md","hash":"edb6b06041660beb656fd5e4062d5a21577cbb3a","modified":1688482306000},{"_id":"themes/archer/.github/ISSUE_TEMPLATE/-----------bug--help-wanted-or-bug-report-.md","hash":"55e843652d99fae32534a7630e698d2394020baf","modified":1688482306000},{"_id":"themes/archer/.github/ISSUE_TEMPLATE/-----other-issue-.md","hash":"05f24b2df012808f6410f1ef2230d4fd1a5d6cf5","modified":1688482306000},{"_id":"themes/archer/.github/workflows/deploy-demo-page.yml","hash":"91c065ee0ec29f7bb10263fefa6f3072bc493a38","modified":1688482306000},{"_id":"themes/archer/layout/_partial/algolia.ejs","hash":"c7bf50dd6e60fd8e8dfbeab9960172359af7307e","modified":1688482306000},{"_id":"themes/archer/layout/layout.ejs","hash":"1bee90a75c1f4b04c90421419dd68acdec15b998","modified":1688482306000},{"_id":"themes/archer/layout/_partial/base-footer-fixed.ejs","hash":"e4dbde6594c0c2d1c5de71ddf968be0879ceddb7","modified":1688482306000},{"_id":"themes/archer/layout/post.ejs","hash":"d421aba0ab93e2b7a22d060da4c56441bf97cdb9","modified":1688482306000},{"_id":"themes/archer/layout/_partial/base-background-image.ejs","hash":"18365516cd8819de853716f0d47a72a60a5edc46","modified":1688482306000},{"_id":"themes/archer/layout/_partial/base-footer.ejs","hash":"236e6550d94519d44292e6b14e30ea8234050025","modified":1711684219591},{"_id":"themes/archer/layout/_partial/base-header.ejs","hash":"57d1ae0fd6f9f1ab52a64c44a8ae17ee71de22ef","modified":1688482306000},{"_id":"themes/archer/layout/_partial/base-head.ejs","hash":"687c08823e7ce43e6ebb44f2fb4b75549abfed29","modified":1688482306000},{"_id":"themes/archer/layout/_partial/base-social.ejs","hash":"0190f06c2f0345cec00eba2074bbfd1b56a7fdc9","modified":1688482306000},{"_id":"themes/archer/layout/_partial/base-title-tags.ejs","hash":"1d5a95782ffc382fdb6b1239b3b97db125984fa0","modified":1688482306000},{"_id":"themes/archer/layout/_partial/base-preload-polyfill.ejs","hash":"d046322674052b0667775dca0886f14e0d812897","modified":1688482306000},{"_id":"themes/archer/layout/_partial/custom-font.ejs","hash":"bc6bfda53f8856e1473263a44fd861e96cc00719","modified":1688482306000},{"_id":"themes/archer/source/assets/beian.png","hash":"a99df13e8eb11db86edebf6e5ac246eb59f4b3c4","modified":1688482306000},{"_id":"themes/archer/source/assets/algolia_logo.svg","hash":"90035272fa31a3f65b3c0e2cb8a633876ef457dc","modified":1688482306000},{"_id":"themes/archer/source/assets/example_qr.png","hash":"cce20432c34875f4d9c6df927ede0fc0f00bb194","modified":1688482306000},{"_id":"themes/archer/layout/_partial/base-profile.ejs","hash":"f63032391dd75905b6663628a9ca231fa0283350","modified":1688482306000},{"_id":"themes/archer/source/assets/favicon_bak.ico","hash":"8b200c575d273d41a179c102442e191414e74eae","modified":1688482306000},{"_id":"themes/archer/source/assets/loading.svg","hash":"45be17d07697d604d8981890eb21e308530c7a38","modified":1688482306000},{"_id":"themes/archer/source/avatar/Misaka.jpg","hash":"74a0372523f98dfbba992bf80642e160d04dc9b1","modified":1688482306000},{"_id":"themes/archer/layout/_partial/intro-height.ejs","hash":"7b8b078b1c1e5b216e46b32a0cab67330c92c734","modified":1688482306000},{"_id":"themes/archer/source/css/dark.css","hash":"4db211216f16a5e66d4d499158f4005a1bbb39f5","modified":1688482306000},{"_id":"themes/archer/source/assets/wechat_qr.jpg","hash":"20763d666624facc585e34645018deadb343b4b5","modified":1705482083315},{"_id":"themes/archer/source/css/dark.css.map","hash":"f49556935deae49df3158c2eb2265464129ef978","modified":1688482306000},{"_id":"themes/archer/source/css/mobile.css.map","hash":"c9f9dade45b119ae2eb7a93be0160baef4d494f8","modified":1688482306000},{"_id":"themes/archer/source/css/mobile.css","hash":"acb0dfcce26ec93f59c6ec4936006abbe8daefee","modified":1688482306000},{"_id":"themes/archer/source/font/Source Sans Pro.woff","hash":"a6722c9b6439b7a020a9be3d3178970757a9265c","modified":1688482306000},{"_id":"themes/archer/source/font/Source Sans Pro.woff2","hash":"da65f527a8da65d5eb6721626d28cfdb46ab104a","modified":1688482306000},{"_id":"themes/archer/source/css/style.css","hash":"f08b1ec3a5fe1bf936401a238d55e0487296b42c","modified":1688482306000},{"_id":"themes/archer/source/scripts/customFontLoader.js.map","hash":"702a44b0b1b450263592bfb1199c8d36ea9834a2","modified":1688482306000},{"_id":"themes/archer/source/lib/webfontloader.min.js","hash":"4c69aeb4e4f355912503d1c460e8e7aa6ea6963e","modified":1688482306000},{"_id":"themes/archer/source/scripts/dark.js.map","hash":"feb9e1905c4b313b839c1c3b69ad61c05f265a9a","modified":1688482306000},{"_id":"themes/archer/source/scripts/dark.js","hash":"28ba818b2ab8a9454a52fe2710b5a8a81a195e4d","modified":1688482306000},{"_id":"themes/archer/source/scripts/customFontLoader.js","hash":"7c2f03fbd2b8340b77b1b02778a34e5ac10b560c","modified":1688482306000},{"_id":"themes/archer/source/scripts/main.js.LICENSE.txt","hash":"959bfc660011bc6a0800fe9e7974080f64c062aa","modified":1688482306000},{"_id":"themes/archer/source/scripts/search.js.LICENSE.txt","hash":"2c9b607ded909550f2ed2d0f2e7271781d9f78d9","modified":1688482306000},{"_id":"themes/archer/src/js/browser.js","hash":"c56e0094a04d6f20564f8f0da1496cb7631d4dc2","modified":1688482306000},{"_id":"themes/archer/source/scripts/share.js","hash":"2210dd8dacea4f1ca11c0047dfafd0a170abd953","modified":1688482306000},{"_id":"themes/archer/src/js/customFontLoader.js","hash":"98bb3a1c0f69bc2675bfa6579df2dde38ba6fded","modified":1688482306000},{"_id":"themes/archer/src/js/fancybox.js","hash":"6dfc8015d6000c76806424876f5472f39e5485af","modified":1688482306000},{"_id":"themes/archer/src/js/dark.js","hash":"2cd243df8593b18a1a293f483d2db18503c53547","modified":1688482306000},{"_id":"themes/archer/src/js/fontawsome.js","hash":"43e852899ee1bc22495253428a2ff3bdedf89882","modified":1688482306000},{"_id":"themes/archer/src/js/init.js","hash":"dee0a1c959bd4dc3953428b1b2137f42bc659b32","modified":1688482306000},{"_id":"themes/archer/src/js/initSidebar.js","hash":"c9c030a451ed394934c1858c7d55ec5a7b588305","modified":1688482306000},{"_id":"themes/archer/src/js/main.js","hash":"658565fbf20adc5b9b237a53c973d0685ce60202","modified":1688482306000},{"_id":"themes/archer/src/js/mobile.js","hash":"4ae6837e18b729f85b5097867fc742ba2d1edf25","modified":1688482306000},{"_id":"themes/archer/src/js/sidebar.js","hash":"2518f2b0b7947530851e6c73245dddc96a618a08","modified":1688482306000},{"_id":"themes/archer/src/js/share.js","hash":"c2e6a3d8d6883cde0c67484daca5e742ebb8e0d1","modified":1688482306000},{"_id":"themes/archer/src/js/scroll.js","hash":"3017b329329888b287ad233831138428475749be","modified":1688482306000},{"_id":"themes/archer/src/js/toc.js","hash":"96a7e07d1976eb29a77799ac2b7abb47907f4b45","modified":1688482306000},{"_id":"themes/archer/src/js/tag.js","hash":"395db7eb2d09e2df6eefcf3f4c7da5cd809a6221","modified":1688482306000},{"_id":"themes/archer/src/js/util.js","hash":"e49b30f6ba82d5183d005fc0192d2d673969586b","modified":1688482306000},{"_id":"themes/archer/src/scss/_common.scss","hash":"e80acb4f0049d24260f0a32a301f985ae7e166b8","modified":1688482306000},{"_id":"themes/archer/src/js/search.js","hash":"0bf92b51fef092989f4fe16fb7ef7724d11e9f58","modified":1688482306000},{"_id":"themes/archer/src/scss/_normalize.scss","hash":"a2dbeb38ad08bb8975856d75954cc697bf8e5ff7","modified":1688482306000},{"_id":"themes/archer/src/scss/dark.scss","hash":"739af46f0ef8c0c89c3e78ec577e844678f737b5","modified":1688482306000},{"_id":"themes/archer/src/scss/_mixin.scss","hash":"78da2632e7150baa0fd1f6d04fc59ca5e304903d","modified":1688482306000},{"_id":"themes/archer/src/scss/_variables.scss","hash":"01e5cab2b5fc686c52145d65229f17db13a3cc54","modified":1688482306000},{"_id":"themes/archer/src/scss/mobile.scss","hash":"2b542af943a8502aae26362dd2af1fbcf68eac1c","modified":1688482306000},{"_id":"themes/archer/src/scss/style.scss","hash":"b10b9a44efaa293b7ac220e66c963dca04ad4bc7","modified":1688482306000},{"_id":"themes/archer/layout/_partial/comment/gitment.ejs","hash":"eda79ada5171ed44e4f3ae4d8a345ad2c7adb2df","modified":1688482306000},{"_id":"themes/archer/source/avatar/Jason.jpg","hash":"0eae332ea91f9e04b54f35d2ed1b17b5b37aee64","modified":1710397722571},{"_id":"themes/archer/layout/_partial/comment/disqus.ejs","hash":"0f0612ce9ca5c3dc349153a87fdc9dba5f93c52c","modified":1688482306000},{"_id":"themes/archer/layout/_partial/comment/gitalk.ejs","hash":"840279fd3e21dc1cdb1932fe4d9a3be5f670e764","modified":1688482306000},{"_id":"themes/archer/layout/_partial/comment/changyan.ejs","hash":"cc02b3cf9586135d2d7f822c7ad97d81fdf6d4e5","modified":1688482306000},{"_id":"themes/archer/layout/_partial/comment/utteranc.ejs","hash":"f4ec58c74e6870b8c22032ad3a3c1ee33e5ec41d","modified":1688482306000},{"_id":"themes/archer/layout/_partial/comment/livere.ejs","hash":"d65d9372fca4b316b94ae511f8ccfb0b92d7b065","modified":1688482306000},{"_id":"themes/archer/layout/_partial/comment/valine.ejs","hash":"24cd7b9e28ceb4b2083ddccce26517de64b35119","modified":1688482306000},{"_id":"themes/archer/layout/_partial/critical-css/critical-style.ejs","hash":"e67a7a2f6bcbfd97e95577446872e217e0c48e80","modified":1688482306000},{"_id":"themes/archer/layout/_partial/comment/youyan.ejs","hash":"2f4ef49a74a8d63310af60ecda6d765b8c386ff4","modified":1688482306000},{"_id":"themes/archer/layout/_partial/comment/waline.ejs","hash":"c2208d6f05490bbf1b35cdf1519a39933212c33e","modified":1688482306000},{"_id":"themes/archer/layout/_partial/math/mathjax.ejs","hash":"84c40a07765e95213045e9b9f7a8c9aaa9c69161","modified":1688482306000},{"_id":"themes/archer/layout/_partial/sidebar/base-sidebar.ejs","hash":"bdf08beebbe454da9d4c55b35efd317d5f222be5","modified":1688482306000},{"_id":"themes/archer/layout/_partial/sidebar/sidebar-categories.ejs","hash":"02f407d9f9968d228a6a47f2a283b8cf41836a1a","modified":1688482306000},{"_id":"themes/archer/layout/_partial/sidebar/sidebar-tags.ejs","hash":"469455994771da166ddecb4839efa9ef28f2775d","modified":1688482306000},{"_id":"themes/archer/layout/_partial/script/font-loader.ejs","hash":"0473335774025d185dcbaf641496b25a8f33f7af","modified":1688482306000},{"_id":"themes/archer/src/scss/_dark/_common-dark.scss","hash":"fc03470312c57a39bc131a1e86cdd3ea2ddb164a","modified":1688482306000},{"_id":"themes/archer/src/scss/_partial/_404.scss","hash":"9e5cb20871e5bf1af4cf50694a73bd7c9fe64685","modified":1688482306000},{"_id":"themes/archer/src/scss/_partial/_algolia.scss","hash":"fd7716d8559a9f58f7caef576c553ca7ba1a85e1","modified":1688482306000},{"_id":"themes/archer/src/scss/_partial/_index-page.scss","hash":"91dc2a0c1ca8d25b1f27d91fa1c81ceb5ff8c3bc","modified":1688482306000},{"_id":"themes/archer/src/scss/_dark/_partial/_algolia-dark.scss","hash":"e9ea52ca5410c6a6eb53d2a6de1419d3db97d8ca","modified":1688482306000},{"_id":"themes/archer/src/scss/_partial/_post-page.scss","hash":"7583c8c2004e333c5b94e4b868ac778357e0d21e","modified":1688482306000},{"_id":"themes/archer/src/scss/_dark/_partial/_index-page-dark.scss","hash":"4c1406e82b2d4503e027443f64f0984fe0942e1d","modified":1688482306000},{"_id":"themes/archer/src/scss/_dark/_partial/_post-page-dark.scss","hash":"d61059785c72c626990f5b473dc3570cb52c0d73","modified":1688482306000},{"_id":"themes/archer/src/scss/_mobile/_partial/_index-page-mobile.scss","hash":"2d166bb6f234b8773a9ea12457b10e94902a32f1","modified":1688482306000},{"_id":"themes/archer/layout/_partial/sidebar/sidebar-archives.ejs","hash":"6360da867c23b8daa5e34e62c5c5552e2974e360","modified":1688482306000},{"_id":"themes/archer/src/scss/_partial/_comment/_gitalk.scss","hash":"341bb251987f30221936e36b44374b2b5ce0d218","modified":1688482306000},{"_id":"themes/archer/src/scss/_partial/_partial/_footer.scss","hash":"4aafefa6834c8a8583c1cdace620a31306676a57","modified":1688482306000},{"_id":"themes/archer/src/scss/_partial/_partial/_header.scss","hash":"ce683553806293fea0466f363b18de0ee341dd4e","modified":1688482306000},{"_id":"themes/archer/src/scss/_partial/_partial/_footer-fixed.scss","hash":"1eb918f6c16054ef2b53b9eea60c751ad89bbd55","modified":1688482306000},{"_id":"themes/archer/src/scss/_partial/_partial/_intro.scss","hash":"4567b9081f063e5fb388b0671f3bc322bdc9acfa","modified":1688482306000},{"_id":"themes/archer/src/scss/_partial/_partial/_profile.scss","hash":"4771add895f8a47917ae2d0d34b92cb327329bf1","modified":1688482306000},{"_id":"themes/archer/src/scss/_partial/_partial/_paginator.scss","hash":"67c2e697a5fbb3b8006cf358ea45eb7f75b496f8","modified":1688482306000},{"_id":"themes/archer/src/scss/_partial/_partial/_scrollbar.scss","hash":"424c08f4acc3f643567f138ffea7d8337791d2c4","modified":1688482306000},{"_id":"themes/archer/src/scss/_partial/_post/_code.scss","hash":"504f9fdb723c7b287d958211189d25919ac592f6","modified":1688482306000},{"_id":"themes/archer/src/scss/_partial/_post/_writing-enhance.scss","hash":"4cb495c64d144b2bcf225f2b87641017bd652e66","modified":1688482306000},{"_id":"themes/archer/src/scss/_partial/_sidebar/_sidebar-archive.scss","hash":"a7374f46ca31bf8ebf5bafea909100921d0c52a4","modified":1688482306000},{"_id":"themes/archer/src/scss/_partial/_sidebar/_sidebar-tags.scss","hash":"93cc82cb56663e83e90fbd6fe31ffdd38e694f3b","modified":1688482306000},{"_id":"themes/archer/src/scss/_partial/_sidebar/_sidebar.scss","hash":"b2870a9cdaea9b9c8426d406d6859a8f3f1a995f","modified":1688482306000},{"_id":"themes/archer/src/scss/_dark/_partial/_comment/_gitalk-dark.scss","hash":"57accaee4bb5b502d5d3e94c7981ac6996804cf0","modified":1688482306000},{"_id":"themes/archer/src/scss/_dark/_partial/_partial/_footer-fixed-dark.scss","hash":"f4e3eb7aa19c1061b5d9df4f6a7745902e5843f2","modified":1688482306000},{"_id":"themes/archer/src/scss/_dark/_partial/_partial/_footer-dark.scss","hash":"d074a8fef75ba626dd3448cc42290a8c722fd182","modified":1688482306000},{"_id":"themes/archer/src/scss/_dark/_partial/_partial/_profile-dark.scss","hash":"c0fe68f6e9c196157adc71fea0d97f6f70f0a31b","modified":1688482306000},{"_id":"themes/archer/src/scss/_dark/_partial/_partial/_header-dark.scss","hash":"ed815d959a37cccdf9137ace91c68bea8ca922c2","modified":1688482306000},{"_id":"themes/archer/src/scss/_dark/_partial/_post/_code-dark.scss","hash":"9ded8203699f816558fd1493a3ce7cf3d38818e9","modified":1688482306000},{"_id":"themes/archer/src/scss/_dark/_partial/_sidebar/_sidebar-archive-dark.scss","hash":"79b7548214339807ff713f0c7454a227d24d6d0d","modified":1688482306000},{"_id":"themes/archer/src/scss/_dark/_partial/_sidebar/_sidebar-dark.scss","hash":"8e77738f83a425eebb00513ee98e487fe71fdc22","modified":1688482306000},{"_id":"themes/archer/src/scss/_dark/_partial/_sidebar/_sidebar-tags-dark.scss","hash":"6621db2ff1182e3cd14286af4b8f3d8c5bd14e2a","modified":1688482306000},{"_id":"themes/archer/src/scss/_mobile/_partial/_sidebar/_sidebar-tags-mobile.scss","hash":"b5c62234defe693b4cfa65bda188d71c937eeaf9","modified":1688482306000},{"_id":"themes/archer/source/assets/favicon.ico","hash":"c136618e070daf370da961ac730973293a088b9e","modified":1710382119333},{"_id":"themes/archer/source/font/Oswald-Regular.ttf","hash":"965d729546a43a8490ad4cf33c25ac475682100c","modified":1688482306000},{"_id":"themes/archer/source/css/style.css.map","hash":"dbe8f8c1fccf8bd9d28ecf3874036a2281319aa0","modified":1688482306000},{"_id":"themes/archer/source/font/SourceCodePro-Regular.ttf.woff","hash":"12eef75e1ad3eca9dae42b65505010ce4464a315","modified":1688482306000},{"_id":"themes/archer/src/scss/_mobile/_partial/_post/_writing-enhance-mobile.scss","hash":"9e714c1cdc61a4ebd5510667e87e879d0b14de67","modified":1688482306000},{"_id":"themes/archer/source/lib/jquery.min.js","hash":"ad886e472b3557f3dc7dfa2bc43468ab8d1cef5b","modified":1688482306000},{"_id":"themes/archer/source/intro/404-bg.jpg","hash":"3afb5bb26f4ff0bd0e0a28df955c8aa7d746d3c5","modified":1688482306000},{"_id":"themes/archer/source/font/SourceCodePro-Regular.ttf.woff2","hash":"f5991289ec17884cb641da0646d278d36702a190","modified":1688482306000},{"_id":"themes/archer/source/intro/post-bg.jpg","hash":"525fafb2238c27754d8fa751f143ff1de9b8482d","modified":1688482306000},{"_id":"themes/archer/source/intro/about-bg.jpg","hash":"ab388276822417cc4e703312c14e20280ec783b3","modified":1688482306000},{"_id":"themes/archer/source/scripts/search.js","hash":"ac8e9d130ea410832a421d661898abee63bd8e67","modified":1688482306000},{"_id":"themes/archer/source/intro/index-bg.jpg","hash":"96b52e177b8bc53e64ec6ee1e10b2b6a4e13083b","modified":1688482306000},{"_id":"themes/archer/source/scripts/share.js.map","hash":"1e018aa465800a066480e33c848f380880af6743","modified":1688482306000},{"_id":"themes/archer/package-lock.json","hash":"400ab1cc2a2f1380a5e9ab69abe3a5b93f923d8d","modified":1688482306000},{"_id":"themes/archer/source/scripts/main.js","hash":"11fd75dddcbef7157fbfb8717b3463a80fda1fb3","modified":1688482306000},{"_id":"themes/archer/source/scripts/main.js.map","hash":"79d928070b7e5333ca241c5563ab4fe9cab31b74","modified":1688482306000},{"_id":"source/images/hello-bg.png","hash":"f70f2a6805ceb4ab1175e391c03923b7264bc431","modified":1705386424945},{"_id":"themes/archer/source/scripts/search.js.map","hash":"bd469588b3bee82b3cf72b72d447c854f4d76875","modified":1688482306000},{"_id":"themes/archer/docs/snap.png","hash":"0b2a8bf016f6eed576abfdcdb7dcf8de51c12562","modified":1688482306000},{"_id":"public/index.html","hash":"f025dd61ff56e7eebc3475a3c9d7f434c3909600","modified":1713255953227},{"_id":"public/2024/03/13/hello-world/index.html","hash":"4bf0b296c696bab720be5dcec3e6b959ce39cb6d","modified":1713255953227},{"_id":"public/archives/index.html","hash":"11ad5b8b9080e766721066453dbc969fce5154e3","modified":1713255953227},{"_id":"public/archives/2024/index.html","hash":"61a561d1066a58c3b3640c451d4e830ce36bb500","modified":1713255953227},{"_id":"public/archives/2024/03/index.html","hash":"d36a33e3caa67d60e085245ce530e16fd1525c2f","modified":1713255953227},{"_id":"public/assets/algolia_logo.svg","hash":"90035272fa31a3f65b3c0e2cb8a633876ef457dc","modified":1713255953227},{"_id":"public/assets/example_qr.png","hash":"cce20432c34875f4d9c6df927ede0fc0f00bb194","modified":1713255953227},{"_id":"public/assets/loading.svg","hash":"45be17d07697d604d8981890eb21e308530c7a38","modified":1713255953227},{"_id":"public/assets/favicon_bak.ico","hash":"8b200c575d273d41a179c102442e191414e74eae","modified":1713255953227},{"_id":"public/assets/beian.png","hash":"a99df13e8eb11db86edebf6e5ac246eb59f4b3c4","modified":1713255953227},{"_id":"public/assets/wechat_qr.jpg","hash":"20763d666624facc585e34645018deadb343b4b5","modified":1713255953227},{"_id":"public/avatar/Misaka.jpg","hash":"74a0372523f98dfbba992bf80642e160d04dc9b1","modified":1713255953227},{"_id":"public/css/dark.css.map","hash":"f49556935deae49df3158c2eb2265464129ef978","modified":1713255953227},{"_id":"public/css/mobile.css.map","hash":"c9f9dade45b119ae2eb7a93be0160baef4d494f8","modified":1713255953227},{"_id":"public/font/Source Sans Pro.woff","hash":"a6722c9b6439b7a020a9be3d3178970757a9265c","modified":1713255953227},{"_id":"public/font/Source Sans Pro.woff2","hash":"da65f527a8da65d5eb6721626d28cfdb46ab104a","modified":1713255953227},{"_id":"public/scripts/customFontLoader.js.map","hash":"702a44b0b1b450263592bfb1199c8d36ea9834a2","modified":1713255953227},{"_id":"public/scripts/dark.js.map","hash":"feb9e1905c4b313b839c1c3b69ad61c05f265a9a","modified":1713255953227},{"_id":"public/scripts/main.js.LICENSE.txt","hash":"959bfc660011bc6a0800fe9e7974080f64c062aa","modified":1713255953227},{"_id":"public/scripts/search.js.LICENSE.txt","hash":"2c9b607ded909550f2ed2d0f2e7271781d9f78d9","modified":1713255953227},{"_id":"public/avatar/Jason.jpg","hash":"0eae332ea91f9e04b54f35d2ed1b17b5b37aee64","modified":1713255953227},{"_id":"public/assets/favicon.ico","hash":"c136618e070daf370da961ac730973293a088b9e","modified":1713255953227},{"_id":"public/css/style.css.map","hash":"dbe8f8c1fccf8bd9d28ecf3874036a2281319aa0","modified":1713255953227},{"_id":"public/font/Oswald-Regular.ttf","hash":"965d729546a43a8490ad4cf33c25ac475682100c","modified":1713255953227},{"_id":"public/font/SourceCodePro-Regular.ttf.woff","hash":"12eef75e1ad3eca9dae42b65505010ce4464a315","modified":1713255953227},{"_id":"public/intro/404-bg.jpg","hash":"3afb5bb26f4ff0bd0e0a28df955c8aa7d746d3c5","modified":1713255953227},{"_id":"public/font/SourceCodePro-Regular.ttf.woff2","hash":"f5991289ec17884cb641da0646d278d36702a190","modified":1713255953227},{"_id":"public/css/dark.css","hash":"4db211216f16a5e66d4d499158f4005a1bbb39f5","modified":1713255953227},{"_id":"public/css/mobile.css","hash":"acb0dfcce26ec93f59c6ec4936006abbe8daefee","modified":1713255953227},{"_id":"public/lib/webfontloader.min.js","hash":"4c69aeb4e4f355912503d1c460e8e7aa6ea6963e","modified":1713255953227},{"_id":"public/scripts/customFontLoader.js","hash":"7c2f03fbd2b8340b77b1b02778a34e5ac10b560c","modified":1713255953227},{"_id":"public/scripts/dark.js","hash":"28ba818b2ab8a9454a52fe2710b5a8a81a195e4d","modified":1713255953227},{"_id":"public/intro/post-bg.jpg","hash":"525fafb2238c27754d8fa751f143ff1de9b8482d","modified":1713255953227},{"_id":"public/scripts/share.js.map","hash":"1e018aa465800a066480e33c848f380880af6743","modified":1713255953227},{"_id":"public/scripts/share.js","hash":"2210dd8dacea4f1ca11c0047dfafd0a170abd953","modified":1713255953227},{"_id":"public/css/style.css","hash":"f08b1ec3a5fe1bf936401a238d55e0487296b42c","modified":1713255953227},{"_id":"public/intro/index-bg.jpg","hash":"96b52e177b8bc53e64ec6ee1e10b2b6a4e13083b","modified":1713255953227},{"_id":"public/intro/about-bg.jpg","hash":"ab388276822417cc4e703312c14e20280ec783b3","modified":1713255953227},{"_id":"public/lib/jquery.min.js","hash":"ad886e472b3557f3dc7dfa2bc43468ab8d1cef5b","modified":1713255953227},{"_id":"public/images/hello-bg.png","hash":"f70f2a6805ceb4ab1175e391c03923b7264bc431","modified":1713255953227},{"_id":"public/scripts/search.js.map","hash":"bd469588b3bee82b3cf72b72d447c854f4d76875","modified":1713255953227},{"_id":"public/scripts/search.js","hash":"ac8e9d130ea410832a421d661898abee63bd8e67","modified":1713255953227},{"_id":"public/scripts/main.js.map","hash":"79d928070b7e5333ca241c5563ab4fe9cab31b74","modified":1713255953227},{"_id":"public/scripts/main.js","hash":"11fd75dddcbef7157fbfb8717b3463a80fda1fb3","modified":1713255953227},{"_id":"source/_posts/http.md","hash":"e538858062edce06c26c8060d05f61b3e6fe772b","modified":1714100804259},{"_id":"source/images/http-request.png","hash":"eed1c7354200ef63062c4290552839cea43c5c07","modified":1710907639923},{"_id":"source/images/http/http-request.png","hash":"4d29675c37a4cc0df885db03cff820aa3f98080c","modified":1710926387387},{"_id":"source/images/http/request-methods.png","hash":"5914a2642fc3c771aaddbb5a4db79d020c75ba27","modified":1710917201189},{"_id":"source/images/http/handshake-1.png","hash":"698f25b0696249dbbadbf1b71ea5e3e48b57348e","modified":1711100170452},{"_id":"source/images/http/curl-header.png","hash":"e5c4a20f54045759a1a29f7f35a344d45ee51ecb","modified":1711013282028},{"_id":"source/images/http/TCP-connection-1.png","hash":"588cade2c5e791bee0f282a6290889ba15c3a039","modified":1711091658444},{"_id":"source/images/http/perisitent-connection.png","hash":"0e16961aaa4851908823dccfa904d3f4f6989c08","modified":1711092222874},{"_id":"source/_posts/organization-internal-loss.md","hash":"b157730ebdda6cfd58233ff8ec9d9bfed27d37b1","modified":1714100795957},{"_id":"source/images/http/http-keep-alive-header.png","hash":"d2b1f6ccc2903ffbd4308627c2562b42c80a2cb7","modified":1711435826469},{"_id":"source/images/http/handshake-2.png","hash":"f50dd3fab7ff21a20cd91622aefb077b7ec74b89","modified":1711353457535},{"_id":"source/images/http/timeout-auto-disconnect.png","hash":"87f74686dc596abb5be91260a40dcf38ed3d0d17","modified":1711433208748},{"_id":"source/images/http/auto-disconnect.png","hash":"6eb07b19f5350b86e32c41503abdef786d1cc8a3","modified":1711368567428},{"_id":"source/images/internal-loss/depressed.jpg","hash":"8ff19e979ef211030d79fc29eca3bef0ed42f9e9","modified":1711678444570},{"_id":"source/images/http/auto-disconnect2.png","hash":"d96b55fe2a3d138263e29ec9ba3a171b78eaf003","modified":1711356920847},{"_id":"source/_posts/garnet.md","hash":"9fa10e3a47f78d4b6f8465f3e49e33da56758f21","modified":1714100842478},{"_id":"source/images/internal-loss/996.jpg","hash":"d712414d1167ea1a5790683d549a3dbf56cc3c8c","modified":1711684344049},{"_id":"source/images/internal-loss/20231109_sy_01.jpg","hash":"f637ac12cf901b7e557077687482f7232bbc2a72","modified":1711685199687},{"_id":"source/_posts/https.md","hash":"00df307cec478b57c6b9ab848f2b3d2ef578098a","modified":1714100800272},{"_id":"source/images/garnet/compatible.png","hash":"1714c1d5f1c6fd0421b4594015595976b5fd4ee4","modified":1712567994543},{"_id":"source/images/garnet/compare1.png","hash":"ed8a21697688433ffe376d2a4ccaa7ec53c667ff","modified":1712648062046},{"_id":"source/images/garnet/client.png","hash":"4889111b6b22a0f07ed3e80b70ee4e1e99c8045e","modified":1712652420303},{"_id":"source/images/https/expire.png","hash":"801009fef98fa9d46a677f153f097e6476c139e2","modified":1712824416637},{"_id":"source/images/garnet/connect.png","hash":"82d4fc4511b032c7c797018845ca40d83ac7aa9d","modified":1712650225409},{"_id":"source/images/garnet/custom-command.png","hash":"bea263307a51c77205885ace2c3060272e444339","modified":1712736760989},{"_id":"source/images/garnet/1.png","hash":"0d8a64004413ec34a334cce4925372781b3c88b0","modified":1712566365601},{"_id":"source/images/garnet/log.png","hash":"0c32a044823dd2b85353c2816c9109c9df0626b4","modified":1712721260633},{"_id":"source/images/garnet/running.png","hash":"3253e7a14adf9509baead2613151f614a0012ab5","modified":1712567881514},{"_id":"source/images/https/bg.jpg","hash":"9424b491fdae5f8c91344596469c3980217e2206","modified":1712821936174},{"_id":"source/images/https/ca.png","hash":"a3f65f3b7f108a2e18c61d13c3024d761586a9ca","modified":1712826407187},{"_id":"source/images/https/encrypted.png","hash":"51f01f7c79cbb8e5ace366b423a46c677483d4f3","modified":1712827358003},{"_id":"source/images/https/client-hello.png","hash":"65039f3b5656ce343d9c36842642aedef464f9d1","modified":1712827328350},{"_id":"source/images/https/ca2.png","hash":"e71ae267fc6a9eda8943e4881e2f408b0a84055f","modified":1712827074795},{"_id":"source/images/https/security.png","hash":"e040846f476100e1ac38f67dec1fc9735978fc9f","modified":1713148972216},{"_id":"source/images/https/handshake.png","hash":"9d2b92013eb6b78a0f3b84855a383b29962da2ba","modified":1713152131440},{"_id":"source/images/https/negotiated-cipher-suite.png","hash":"32d7a6f6ad24e6c5755d2ba2626e0ba71520fd50","modified":1713149675775},{"_id":"source/images/https/cipher-suites.png","hash":"e9faeff8e36d3efd82a5a0800c85a8e23d6ebf56","modified":1713149632927},{"_id":"public/2024/04/11/https/index.html","hash":"2362c2a6c75b4e53e8b103cbd0b2835a053c196d","modified":1713255953227},{"_id":"public/2024/04/07/garnet/index.html","hash":"7cff3ee5ac31859ab0e80195973947cb53b47b7f","modified":1713255953227},{"_id":"public/2024/03/28/organization-internal-loss/index.html","hash":"0f5834ba9bf426bc3eaa541aad3e766ab0999293","modified":1713255953227},{"_id":"public/2024/03/19/http/index.html","hash":"a4dbd8c74d50450f71d405b53817e86e364bd775","modified":1713255953227},{"_id":"public/archives/2024/04/index.html","hash":"568ad7f062ee32b31612d64d952b5b0bb9d75d5e","modified":1713255953227},{"_id":"public/tags/http-httpåè®®-Connection/index.html","hash":"d3497d1a24185c46cbedbaf85f299faa6b8a3bbc","modified":1713255953227},{"_id":"public/tags/ç»„ç»‡-å†…è€—/index.html","hash":"d61eae406afac4c434fce25687e14d64f23503d2","modified":1713255953227},{"_id":"public/tags/Garnet-ç¼“å­˜-å¾®è½¯/index.html","hash":"c4ced32b5309e68eb92157930783b0c1be407091","modified":1713255953227},{"_id":"public/tags/https-http-ssl-tls/index.html","hash":"919e587f1e97e883ec79744b4e764b6dd551bd7f","modified":1713255953227},{"_id":"public/images/http/http-request.png","hash":"4d29675c37a4cc0df885db03cff820aa3f98080c","modified":1713255953227},{"_id":"public/images/http/TCP-connection-1.png","hash":"588cade2c5e791bee0f282a6290889ba15c3a039","modified":1713255953227},{"_id":"public/images/http/handshake-1.png","hash":"698f25b0696249dbbadbf1b71ea5e3e48b57348e","modified":1713255953227},{"_id":"public/images/http/curl-header.png","hash":"e5c4a20f54045759a1a29f7f35a344d45ee51ecb","modified":1713255953227},{"_id":"public/images/http/perisitent-connection.png","hash":"0e16961aaa4851908823dccfa904d3f4f6989c08","modified":1713255953227},{"_id":"public/images/internal-loss/depressed.jpg","hash":"8ff19e979ef211030d79fc29eca3bef0ed42f9e9","modified":1713255953227},{"_id":"public/images/http/http-keep-alive-header.png","hash":"d2b1f6ccc2903ffbd4308627c2562b42c80a2cb7","modified":1713255953227},{"_id":"public/images/garnet/client.png","hash":"4889111b6b22a0f07ed3e80b70ee4e1e99c8045e","modified":1713255953227},{"_id":"public/images/garnet/compatible.png","hash":"1714c1d5f1c6fd0421b4594015595976b5fd4ee4","modified":1713255953227},{"_id":"public/images/garnet/compare1.png","hash":"ed8a21697688433ffe376d2a4ccaa7ec53c667ff","modified":1713255953227},{"_id":"public/images/garnet/connect.png","hash":"82d4fc4511b032c7c797018845ca40d83ac7aa9d","modified":1713255953227},{"_id":"public/images/garnet/custom-command.png","hash":"bea263307a51c77205885ace2c3060272e444339","modified":1713255953227},{"_id":"public/images/https/bg.jpg","hash":"9424b491fdae5f8c91344596469c3980217e2206","modified":1713255953227},{"_id":"public/images/https/expire.png","hash":"801009fef98fa9d46a677f153f097e6476c139e2","modified":1713255953227},{"_id":"public/images/garnet/running.png","hash":"3253e7a14adf9509baead2613151f614a0012ab5","modified":1713255953227},{"_id":"public/images/https/ca.png","hash":"a3f65f3b7f108a2e18c61d13c3024d761586a9ca","modified":1713255953227},{"_id":"public/images/https/security.png","hash":"e040846f476100e1ac38f67dec1fc9735978fc9f","modified":1713255953227},{"_id":"public/images/https/handshake.png","hash":"9d2b92013eb6b78a0f3b84855a383b29962da2ba","modified":1713255953227},{"_id":"public/images/http/auto-disconnect.png","hash":"6eb07b19f5350b86e32c41503abdef786d1cc8a3","modified":1713255953227},{"_id":"public/images/http/timeout-auto-disconnect.png","hash":"87f74686dc596abb5be91260a40dcf38ed3d0d17","modified":1713255953227},{"_id":"public/images/internal-loss/20231109_sy_01.jpg","hash":"f637ac12cf901b7e557077687482f7232bbc2a72","modified":1713255953227},{"_id":"public/images/http/handshake-2.png","hash":"f50dd3fab7ff21a20cd91622aefb077b7ec74b89","modified":1713255953227},{"_id":"public/images/garnet/log.png","hash":"0c32a044823dd2b85353c2816c9109c9df0626b4","modified":1713255953227},{"_id":"public/images/garnet/1.png","hash":"0d8a64004413ec34a334cce4925372781b3c88b0","modified":1713255953227},{"_id":"public/images/internal-loss/996.jpg","hash":"d712414d1167ea1a5790683d549a3dbf56cc3c8c","modified":1713255953227},{"_id":"public/images/http/auto-disconnect2.png","hash":"d96b55fe2a3d138263e29ec9ba3a171b78eaf003","modified":1713255953227},{"_id":"public/images/https/encrypted.png","hash":"51f01f7c79cbb8e5ace366b423a46c677483d4f3","modified":1713255953227},{"_id":"public/images/https/negotiated-cipher-suite.png","hash":"32d7a6f6ad24e6c5755d2ba2626e0ba71520fd50","modified":1713255953227},{"_id":"public/images/https/cipher-suites.png","hash":"e9faeff8e36d3efd82a5a0800c85a8e23d6ebf56","modified":1713255953227},{"_id":"public/images/http/request-methods.png","hash":"5914a2642fc3c771aaddbb5a4db79d020c75ba27","modified":1713255953227},{"_id":"public/images/https/client-hello.png","hash":"65039f3b5656ce343d9c36842642aedef464f9d1","modified":1713255953227},{"_id":"public/images/https/ca2.png","hash":"e71ae267fc6a9eda8943e4881e2f408b0a84055f","modified":1713255953227},{"_id":"source/_posts/redis-interview.md","hash":"f83cab69b0f20b5d7300c5e68729006e9be6d913","modified":1713425000574},{"_id":"source/images/redis-interview/recruitment.png","hash":"9da7eff910bfb50b7f11618614003b6153e71d98","modified":1713425715760},{"_id":"source/_posts/redis-interview-1.md","hash":"951b57d41f67b3f9287684d1808c63e0ab08023d","modified":1714102286087},{"_id":"source/_posts/dump.md","hash":"2a13fc339e7c2514ebbb5c9d4a4a4a18167b84c5","modified":1715069186636},{"_id":"source/images/dump/crash.jpeg","hash":"e25f4327f9073e01e8b1a3e13c209ca732880e15","modified":1714290837084},{"_id":"source/images/redis-interview/memory.png","hash":"37fadd91ec8573c6c30ec5fd32562f2c3d22d5a9","modified":1714031983730},{"_id":"source/images/dump/bg.png","hash":"32c7ad31ef1117233e7691e74198041f62870e63","modified":1714290251488},{"_id":"source/images/redis-interview/cache-avalanche.png","hash":"8bcdb1787aa12c08febeb8c2324cf7fa9c6d3c02","modified":1714100497420},{"_id":"source/images/redis-interview/bg.png","hash":"e5be0650aa2343b4a62218b58ebae10c4f4b9ba6","modified":1714101428369},{"_id":"source/images/redis-interview/cache-breakdown.png","hash":"de31f8ba0958f9428c1148746206f8351fa1bf18","modified":1714100525728},{"_id":"source/images/redis-interview/cache-penetration.png","hash":"17f21e18052f40f20189a31c4bfbf749a1dedcbc","modified":1714100540904},{"_id":"source/images/dump/windbg_3.png","hash":"47fa0c7ac253a9a44eef9bc6d5dce90d96445ba2","modified":1715068901454},{"_id":"source/images/dump/windbg_2.png","hash":"e55722d89679167f37e0b851a53e27ae989663f8","modified":1714439116512},{"_id":"source/images/dump/windbg_4.png","hash":"5618b95c756aab451803e23e9c0f77b5fa94e6b4","modified":1715069009388},{"_id":"source/images/dump/windbg_1.png","hash":"fec01b96435a46269b0a241c8feb13764458b0e9","modified":1714438955774}],"Category":[],"Data":[],"Page":[],"Post":[{"title":"æ¬¢è¿æ¥åˆ° ITProHubï¼","_content":"![background](/images/hello-bg.png)\n# ğŸŒ æ¬¢è¿æ¥åˆ° ITProHubï¼\n\n## ğŸš€ ä½ çš„ä¿¡æ¯æŠ€æœ¯ä¸“ä¸šä¸­å¿ƒ ğŸš€\n\nåœ¨ ITProHubï¼Œæˆ‘ä»¬è‡´åŠ›äºæˆä¸ºä¿¡æ¯æŠ€æœ¯é¢†åŸŸçš„ä¸­å¿ƒæ¢çº½ï¼Œä¸ºä¸“ä¸šäººå£«ã€å­¦ä¹ è€…å’ŒæŠ€æœ¯çˆ±å¥½è€…æä¾›ä¸°å¯Œçš„èµ„æºã€æŠ€èƒ½åŸ¹è®­å’Œç¤¾åŒºäº¤æµå¹³å°ã€‚\n\n### ğŸ” ITPro: ä¸“ä¸šçš„ä¿¡æ¯æŠ€æœ¯æ”¯æŒ\n\næ— è®ºä½ æ˜¯æ­£åœ¨å¯»æ‰¾ITèŒä¸šå‘å±•çš„é“è·¯ï¼Œè¿˜æ˜¯æƒ³æå‡ä½ çš„ä¸“ä¸šæŠ€èƒ½ï¼ŒITProHubéƒ½ä¸ºä½ æä¾›äº†å…¨é¢çš„èµ„æºå’ŒæŒ‡å¯¼ã€‚æˆ‘ä»¬å…³æ³¨è¡Œä¸šè¶‹åŠ¿ï¼Œåˆ†äº«æœ€æ–°çš„æŠ€æœ¯çŸ¥è¯†ï¼ŒåŠ©ä½ æˆä¸ºæ›´ä¸“ä¸šçš„ITä»ä¸šè€…ã€‚\n\n### ğŸ’¼ Hub: ä¸­å¿ƒåŒ–çš„èµ„æºå’Œç¤¾åŒº\n\nITProHubæ˜¯ä¸€ä¸ªæ±‡èšå„ç§ITèµ„æºçš„ä¸­å¿ƒï¼ŒåŒ…æ‹¬èŒä¸šæŒ‡å¯¼ã€æŠ€æœ¯æ–‡ç« ã€åŸ¹è®­è¯¾ç¨‹ç­‰ã€‚åœ¨æˆ‘ä»¬çš„ç¤¾åŒºä¸­ï¼Œä½ å¯ä»¥ä¸å…¶ä»–ITä¸“ä¸šäººå£«å»ºç«‹è”ç³»ï¼Œåˆ†äº«ç»éªŒï¼Œå…±åŒæˆé•¿ã€‚\n\n#### âœ¨ æˆ‘ä»¬çš„ç‰¹è‰²æœåŠ¡å’Œå†…å®¹åŒ…æ‹¬ï¼š\n\nğŸ“ ä¸“ä¸šçš„ITæŠ€èƒ½åŸ¹è®­è¯¾ç¨‹\n\nğŸ“° è¡Œä¸šè¶‹åŠ¿å’ŒæŠ€æœ¯æ–‡ç« åˆ†äº«\n\nğŸš€ èŒä¸šå‘å±•æŒ‡å¯¼å’Œæ‹›è˜ä¿¡æ¯\n\nğŸ’¬ ä¸ä¸“ä¸šäººå£«äº’åŠ¨çš„ç¤¾äº¤å¹³å°\n\nğŸ‘¥ åŠ å…¥æˆ‘ä»¬çš„ç¤¾åŒºï¼Œä½ å°†è·å¾—ï¼š\n\nä¸åŒè¡Œä¸“ä¸šäººå£«çš„äº’åŠ¨å’Œäº¤æµæœºä¼š\n\nè·å–å®ç”¨çš„èŒä¸šå‘å±•å»ºè®®å’ŒæŠ€æœ¯æ”¯æŒ\n\nå‚ä¸ä¸°å¯Œå¤šå½©çš„çº¿ä¸Šå’Œçº¿ä¸‹æ´»åŠ¨\n\næ— è®ºä½ æ˜¯åˆšåˆšè¸å…¥ITé¢†åŸŸï¼Œè¿˜æ˜¯å¯»æ±‚æ›´é«˜çº§åˆ«çš„æŠ€æœ¯æŒ‘æˆ˜ï¼ŒITProHubéƒ½æ˜¯ä½ ä¿¡æ¯æŠ€æœ¯ä¹‹æ—…çš„ç†æƒ³ä¼´ä¾£ã€‚\n\n\n## ğŸŒ æ¢ç´¢æ— é™å¯èƒ½ï¼ŒåŠ å…¥ ITProHub ï¼ğŸŒ\n\nå…¬ä¼—å·å°†ä¸å®šæœŸæ›´æ–°ï¼Œæ¬¢è¿è®¢é˜…ï¼\n\n#ITProHub #ä¿¡æ¯æŠ€æœ¯ #ä¸“ä¸šå‘å±• #ç¤¾åŒºäº¤æµ\n\n\n\næ›´å¤šä¸€æ‰‹è®¯æ¯ï¼Œå¯å…³æ³¨å…¬ä¼—å·ï¼š[ITProHub](https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg)\n\n![ITProHub](https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg)","source":"_posts/hello-world.md","raw":"---\ntitle: æ¬¢è¿æ¥åˆ° ITProHubï¼\n---\n![background](/images/hello-bg.png)\n# ğŸŒ æ¬¢è¿æ¥åˆ° ITProHubï¼\n\n## ğŸš€ ä½ çš„ä¿¡æ¯æŠ€æœ¯ä¸“ä¸šä¸­å¿ƒ ğŸš€\n\nåœ¨ ITProHubï¼Œæˆ‘ä»¬è‡´åŠ›äºæˆä¸ºä¿¡æ¯æŠ€æœ¯é¢†åŸŸçš„ä¸­å¿ƒæ¢çº½ï¼Œä¸ºä¸“ä¸šäººå£«ã€å­¦ä¹ è€…å’ŒæŠ€æœ¯çˆ±å¥½è€…æä¾›ä¸°å¯Œçš„èµ„æºã€æŠ€èƒ½åŸ¹è®­å’Œç¤¾åŒºäº¤æµå¹³å°ã€‚\n\n### ğŸ” ITPro: ä¸“ä¸šçš„ä¿¡æ¯æŠ€æœ¯æ”¯æŒ\n\næ— è®ºä½ æ˜¯æ­£åœ¨å¯»æ‰¾ITèŒä¸šå‘å±•çš„é“è·¯ï¼Œè¿˜æ˜¯æƒ³æå‡ä½ çš„ä¸“ä¸šæŠ€èƒ½ï¼ŒITProHubéƒ½ä¸ºä½ æä¾›äº†å…¨é¢çš„èµ„æºå’ŒæŒ‡å¯¼ã€‚æˆ‘ä»¬å…³æ³¨è¡Œä¸šè¶‹åŠ¿ï¼Œåˆ†äº«æœ€æ–°çš„æŠ€æœ¯çŸ¥è¯†ï¼ŒåŠ©ä½ æˆä¸ºæ›´ä¸“ä¸šçš„ITä»ä¸šè€…ã€‚\n\n### ğŸ’¼ Hub: ä¸­å¿ƒåŒ–çš„èµ„æºå’Œç¤¾åŒº\n\nITProHubæ˜¯ä¸€ä¸ªæ±‡èšå„ç§ITèµ„æºçš„ä¸­å¿ƒï¼ŒåŒ…æ‹¬èŒä¸šæŒ‡å¯¼ã€æŠ€æœ¯æ–‡ç« ã€åŸ¹è®­è¯¾ç¨‹ç­‰ã€‚åœ¨æˆ‘ä»¬çš„ç¤¾åŒºä¸­ï¼Œä½ å¯ä»¥ä¸å…¶ä»–ITä¸“ä¸šäººå£«å»ºç«‹è”ç³»ï¼Œåˆ†äº«ç»éªŒï¼Œå…±åŒæˆé•¿ã€‚\n\n#### âœ¨ æˆ‘ä»¬çš„ç‰¹è‰²æœåŠ¡å’Œå†…å®¹åŒ…æ‹¬ï¼š\n\nğŸ“ ä¸“ä¸šçš„ITæŠ€èƒ½åŸ¹è®­è¯¾ç¨‹\n\nğŸ“° è¡Œä¸šè¶‹åŠ¿å’ŒæŠ€æœ¯æ–‡ç« åˆ†äº«\n\nğŸš€ èŒä¸šå‘å±•æŒ‡å¯¼å’Œæ‹›è˜ä¿¡æ¯\n\nğŸ’¬ ä¸ä¸“ä¸šäººå£«äº’åŠ¨çš„ç¤¾äº¤å¹³å°\n\nğŸ‘¥ åŠ å…¥æˆ‘ä»¬çš„ç¤¾åŒºï¼Œä½ å°†è·å¾—ï¼š\n\nä¸åŒè¡Œä¸“ä¸šäººå£«çš„äº’åŠ¨å’Œäº¤æµæœºä¼š\n\nè·å–å®ç”¨çš„èŒä¸šå‘å±•å»ºè®®å’ŒæŠ€æœ¯æ”¯æŒ\n\nå‚ä¸ä¸°å¯Œå¤šå½©çš„çº¿ä¸Šå’Œçº¿ä¸‹æ´»åŠ¨\n\næ— è®ºä½ æ˜¯åˆšåˆšè¸å…¥ITé¢†åŸŸï¼Œè¿˜æ˜¯å¯»æ±‚æ›´é«˜çº§åˆ«çš„æŠ€æœ¯æŒ‘æˆ˜ï¼ŒITProHubéƒ½æ˜¯ä½ ä¿¡æ¯æŠ€æœ¯ä¹‹æ—…çš„ç†æƒ³ä¼´ä¾£ã€‚\n\n\n## ğŸŒ æ¢ç´¢æ— é™å¯èƒ½ï¼ŒåŠ å…¥ ITProHub ï¼ğŸŒ\n\nå…¬ä¼—å·å°†ä¸å®šæœŸæ›´æ–°ï¼Œæ¬¢è¿è®¢é˜…ï¼\n\n#ITProHub #ä¿¡æ¯æŠ€æœ¯ #ä¸“ä¸šå‘å±• #ç¤¾åŒºäº¤æµ\n\n\n\næ›´å¤šä¸€æ‰‹è®¯æ¯ï¼Œå¯å…³æ³¨å…¬ä¼—å·ï¼š[ITProHub](https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg)\n\n![ITProHub](https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg)","slug":"hello-world","published":1,"date":"2024-03-13T07:54:13.172Z","updated":"2024-04-26T03:07:16.002Z","_id":"cltwq4btx0000f4p1f3yha908","comments":1,"layout":"post","photos":[],"link":"","content":"<p><img src=\"/images/hello-bg.png\" alt=\"background\"></p>\n<h1 id=\"ğŸŒ-æ¬¢è¿æ¥åˆ°-ITProHubï¼\"><a href=\"#ğŸŒ-æ¬¢è¿æ¥åˆ°-ITProHubï¼\" class=\"headerlink\" title=\"ğŸŒ æ¬¢è¿æ¥åˆ° ITProHubï¼\"></a>ğŸŒ æ¬¢è¿æ¥åˆ° ITProHubï¼</h1><h2 id=\"ğŸš€-ä½ çš„ä¿¡æ¯æŠ€æœ¯ä¸“ä¸šä¸­å¿ƒ-ğŸš€\"><a href=\"#ğŸš€-ä½ çš„ä¿¡æ¯æŠ€æœ¯ä¸“ä¸šä¸­å¿ƒ-ğŸš€\" class=\"headerlink\" title=\"ğŸš€ ä½ çš„ä¿¡æ¯æŠ€æœ¯ä¸“ä¸šä¸­å¿ƒ ğŸš€\"></a>ğŸš€ ä½ çš„ä¿¡æ¯æŠ€æœ¯ä¸“ä¸šä¸­å¿ƒ ğŸš€</h2><p>åœ¨ ITProHubï¼Œæˆ‘ä»¬è‡´åŠ›äºæˆä¸ºä¿¡æ¯æŠ€æœ¯é¢†åŸŸçš„ä¸­å¿ƒæ¢çº½ï¼Œä¸ºä¸“ä¸šäººå£«ã€å­¦ä¹ è€…å’ŒæŠ€æœ¯çˆ±å¥½è€…æä¾›ä¸°å¯Œçš„èµ„æºã€æŠ€èƒ½åŸ¹è®­å’Œç¤¾åŒºäº¤æµå¹³å°ã€‚</p>\n<h3 id=\"ğŸ”-ITPro-ä¸“ä¸šçš„ä¿¡æ¯æŠ€æœ¯æ”¯æŒ\"><a href=\"#ğŸ”-ITPro-ä¸“ä¸šçš„ä¿¡æ¯æŠ€æœ¯æ”¯æŒ\" class=\"headerlink\" title=\"ğŸ” ITPro: ä¸“ä¸šçš„ä¿¡æ¯æŠ€æœ¯æ”¯æŒ\"></a>ğŸ” ITPro: ä¸“ä¸šçš„ä¿¡æ¯æŠ€æœ¯æ”¯æŒ</h3><p>æ— è®ºä½ æ˜¯æ­£åœ¨å¯»æ‰¾ITèŒä¸šå‘å±•çš„é“è·¯ï¼Œè¿˜æ˜¯æƒ³æå‡ä½ çš„ä¸“ä¸šæŠ€èƒ½ï¼ŒITProHubéƒ½ä¸ºä½ æä¾›äº†å…¨é¢çš„èµ„æºå’ŒæŒ‡å¯¼ã€‚æˆ‘ä»¬å…³æ³¨è¡Œä¸šè¶‹åŠ¿ï¼Œåˆ†äº«æœ€æ–°çš„æŠ€æœ¯çŸ¥è¯†ï¼ŒåŠ©ä½ æˆä¸ºæ›´ä¸“ä¸šçš„ITä»ä¸šè€…ã€‚</p>\n<h3 id=\"ğŸ’¼-Hub-ä¸­å¿ƒåŒ–çš„èµ„æºå’Œç¤¾åŒº\"><a href=\"#ğŸ’¼-Hub-ä¸­å¿ƒåŒ–çš„èµ„æºå’Œç¤¾åŒº\" class=\"headerlink\" title=\"ğŸ’¼ Hub: ä¸­å¿ƒåŒ–çš„èµ„æºå’Œç¤¾åŒº\"></a>ğŸ’¼ Hub: ä¸­å¿ƒåŒ–çš„èµ„æºå’Œç¤¾åŒº</h3><p>ITProHubæ˜¯ä¸€ä¸ªæ±‡èšå„ç§ITèµ„æºçš„ä¸­å¿ƒï¼ŒåŒ…æ‹¬èŒä¸šæŒ‡å¯¼ã€æŠ€æœ¯æ–‡ç« ã€åŸ¹è®­è¯¾ç¨‹ç­‰ã€‚åœ¨æˆ‘ä»¬çš„ç¤¾åŒºä¸­ï¼Œä½ å¯ä»¥ä¸å…¶ä»–ITä¸“ä¸šäººå£«å»ºç«‹è”ç³»ï¼Œåˆ†äº«ç»éªŒï¼Œå…±åŒæˆé•¿ã€‚</p>\n<h4 id=\"âœ¨-æˆ‘ä»¬çš„ç‰¹è‰²æœåŠ¡å’Œå†…å®¹åŒ…æ‹¬ï¼š\"><a href=\"#âœ¨-æˆ‘ä»¬çš„ç‰¹è‰²æœåŠ¡å’Œå†…å®¹åŒ…æ‹¬ï¼š\" class=\"headerlink\" title=\"âœ¨ æˆ‘ä»¬çš„ç‰¹è‰²æœåŠ¡å’Œå†…å®¹åŒ…æ‹¬ï¼š\"></a>âœ¨ æˆ‘ä»¬çš„ç‰¹è‰²æœåŠ¡å’Œå†…å®¹åŒ…æ‹¬ï¼š</h4><p>ğŸ“ ä¸“ä¸šçš„ITæŠ€èƒ½åŸ¹è®­è¯¾ç¨‹</p>\n<p>ğŸ“° è¡Œä¸šè¶‹åŠ¿å’ŒæŠ€æœ¯æ–‡ç« åˆ†äº«</p>\n<p>ğŸš€ èŒä¸šå‘å±•æŒ‡å¯¼å’Œæ‹›è˜ä¿¡æ¯</p>\n<p>ğŸ’¬ ä¸ä¸“ä¸šäººå£«äº’åŠ¨çš„ç¤¾äº¤å¹³å°</p>\n<p>ğŸ‘¥ åŠ å…¥æˆ‘ä»¬çš„ç¤¾åŒºï¼Œä½ å°†è·å¾—ï¼š</p>\n<p>ä¸åŒè¡Œä¸“ä¸šäººå£«çš„äº’åŠ¨å’Œäº¤æµæœºä¼š</p>\n<p>è·å–å®ç”¨çš„èŒä¸šå‘å±•å»ºè®®å’ŒæŠ€æœ¯æ”¯æŒ</p>\n<p>å‚ä¸ä¸°å¯Œå¤šå½©çš„çº¿ä¸Šå’Œçº¿ä¸‹æ´»åŠ¨</p>\n<p>æ— è®ºä½ æ˜¯åˆšåˆšè¸å…¥ITé¢†åŸŸï¼Œè¿˜æ˜¯å¯»æ±‚æ›´é«˜çº§åˆ«çš„æŠ€æœ¯æŒ‘æˆ˜ï¼ŒITProHubéƒ½æ˜¯ä½ ä¿¡æ¯æŠ€æœ¯ä¹‹æ—…çš„ç†æƒ³ä¼´ä¾£ã€‚</p>\n<h2 id=\"ğŸŒ-æ¢ç´¢æ— é™å¯èƒ½ï¼ŒåŠ å…¥-ITProHub-ï¼ğŸŒ\"><a href=\"#ğŸŒ-æ¢ç´¢æ— é™å¯èƒ½ï¼ŒåŠ å…¥-ITProHub-ï¼ğŸŒ\" class=\"headerlink\" title=\"ğŸŒ æ¢ç´¢æ— é™å¯èƒ½ï¼ŒåŠ å…¥ ITProHub ï¼ğŸŒ\"></a>ğŸŒ æ¢ç´¢æ— é™å¯èƒ½ï¼ŒåŠ å…¥ ITProHub ï¼ğŸŒ</h2><p>å…¬ä¼—å·å°†ä¸å®šæœŸæ›´æ–°ï¼Œæ¬¢è¿è®¢é˜…ï¼</p>\n<p>#ITProHub #ä¿¡æ¯æŠ€æœ¯ #ä¸“ä¸šå‘å±• #ç¤¾åŒºäº¤æµ</p>\n<p>æ›´å¤šä¸€æ‰‹è®¯æ¯ï¼Œå¯å…³æ³¨å…¬ä¼—å·ï¼š<a href=\"https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg\">ITProHub</a></p>\n<p><img src=\"https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg\" alt=\"ITProHub\"></p>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"/images/hello-bg.png\" alt=\"background\"></p>\n<h1 id=\"ğŸŒ-æ¬¢è¿æ¥åˆ°-ITProHubï¼\"><a href=\"#ğŸŒ-æ¬¢è¿æ¥åˆ°-ITProHubï¼\" class=\"headerlink\" title=\"ğŸŒ æ¬¢è¿æ¥åˆ° ITProHubï¼\"></a>ğŸŒ æ¬¢è¿æ¥åˆ° ITProHubï¼</h1><h2 id=\"ğŸš€-ä½ çš„ä¿¡æ¯æŠ€æœ¯ä¸“ä¸šä¸­å¿ƒ-ğŸš€\"><a href=\"#ğŸš€-ä½ çš„ä¿¡æ¯æŠ€æœ¯ä¸“ä¸šä¸­å¿ƒ-ğŸš€\" class=\"headerlink\" title=\"ğŸš€ ä½ çš„ä¿¡æ¯æŠ€æœ¯ä¸“ä¸šä¸­å¿ƒ ğŸš€\"></a>ğŸš€ ä½ çš„ä¿¡æ¯æŠ€æœ¯ä¸“ä¸šä¸­å¿ƒ ğŸš€</h2><p>åœ¨ ITProHubï¼Œæˆ‘ä»¬è‡´åŠ›äºæˆä¸ºä¿¡æ¯æŠ€æœ¯é¢†åŸŸçš„ä¸­å¿ƒæ¢çº½ï¼Œä¸ºä¸“ä¸šäººå£«ã€å­¦ä¹ è€…å’ŒæŠ€æœ¯çˆ±å¥½è€…æä¾›ä¸°å¯Œçš„èµ„æºã€æŠ€èƒ½åŸ¹è®­å’Œç¤¾åŒºäº¤æµå¹³å°ã€‚</p>\n<h3 id=\"ğŸ”-ITPro-ä¸“ä¸šçš„ä¿¡æ¯æŠ€æœ¯æ”¯æŒ\"><a href=\"#ğŸ”-ITPro-ä¸“ä¸šçš„ä¿¡æ¯æŠ€æœ¯æ”¯æŒ\" class=\"headerlink\" title=\"ğŸ” ITPro: ä¸“ä¸šçš„ä¿¡æ¯æŠ€æœ¯æ”¯æŒ\"></a>ğŸ” ITPro: ä¸“ä¸šçš„ä¿¡æ¯æŠ€æœ¯æ”¯æŒ</h3><p>æ— è®ºä½ æ˜¯æ­£åœ¨å¯»æ‰¾ITèŒä¸šå‘å±•çš„é“è·¯ï¼Œè¿˜æ˜¯æƒ³æå‡ä½ çš„ä¸“ä¸šæŠ€èƒ½ï¼ŒITProHubéƒ½ä¸ºä½ æä¾›äº†å…¨é¢çš„èµ„æºå’ŒæŒ‡å¯¼ã€‚æˆ‘ä»¬å…³æ³¨è¡Œä¸šè¶‹åŠ¿ï¼Œåˆ†äº«æœ€æ–°çš„æŠ€æœ¯çŸ¥è¯†ï¼ŒåŠ©ä½ æˆä¸ºæ›´ä¸“ä¸šçš„ITä»ä¸šè€…ã€‚</p>\n<h3 id=\"ğŸ’¼-Hub-ä¸­å¿ƒåŒ–çš„èµ„æºå’Œç¤¾åŒº\"><a href=\"#ğŸ’¼-Hub-ä¸­å¿ƒåŒ–çš„èµ„æºå’Œç¤¾åŒº\" class=\"headerlink\" title=\"ğŸ’¼ Hub: ä¸­å¿ƒåŒ–çš„èµ„æºå’Œç¤¾åŒº\"></a>ğŸ’¼ Hub: ä¸­å¿ƒåŒ–çš„èµ„æºå’Œç¤¾åŒº</h3><p>ITProHubæ˜¯ä¸€ä¸ªæ±‡èšå„ç§ITèµ„æºçš„ä¸­å¿ƒï¼ŒåŒ…æ‹¬èŒä¸šæŒ‡å¯¼ã€æŠ€æœ¯æ–‡ç« ã€åŸ¹è®­è¯¾ç¨‹ç­‰ã€‚åœ¨æˆ‘ä»¬çš„ç¤¾åŒºä¸­ï¼Œä½ å¯ä»¥ä¸å…¶ä»–ITä¸“ä¸šäººå£«å»ºç«‹è”ç³»ï¼Œåˆ†äº«ç»éªŒï¼Œå…±åŒæˆé•¿ã€‚</p>\n<h4 id=\"âœ¨-æˆ‘ä»¬çš„ç‰¹è‰²æœåŠ¡å’Œå†…å®¹åŒ…æ‹¬ï¼š\"><a href=\"#âœ¨-æˆ‘ä»¬çš„ç‰¹è‰²æœåŠ¡å’Œå†…å®¹åŒ…æ‹¬ï¼š\" class=\"headerlink\" title=\"âœ¨ æˆ‘ä»¬çš„ç‰¹è‰²æœåŠ¡å’Œå†…å®¹åŒ…æ‹¬ï¼š\"></a>âœ¨ æˆ‘ä»¬çš„ç‰¹è‰²æœåŠ¡å’Œå†…å®¹åŒ…æ‹¬ï¼š</h4><p>ğŸ“ ä¸“ä¸šçš„ITæŠ€èƒ½åŸ¹è®­è¯¾ç¨‹</p>\n<p>ğŸ“° è¡Œä¸šè¶‹åŠ¿å’ŒæŠ€æœ¯æ–‡ç« åˆ†äº«</p>\n<p>ğŸš€ èŒä¸šå‘å±•æŒ‡å¯¼å’Œæ‹›è˜ä¿¡æ¯</p>\n<p>ğŸ’¬ ä¸ä¸“ä¸šäººå£«äº’åŠ¨çš„ç¤¾äº¤å¹³å°</p>\n<p>ğŸ‘¥ åŠ å…¥æˆ‘ä»¬çš„ç¤¾åŒºï¼Œä½ å°†è·å¾—ï¼š</p>\n<p>ä¸åŒè¡Œä¸“ä¸šäººå£«çš„äº’åŠ¨å’Œäº¤æµæœºä¼š</p>\n<p>è·å–å®ç”¨çš„èŒä¸šå‘å±•å»ºè®®å’ŒæŠ€æœ¯æ”¯æŒ</p>\n<p>å‚ä¸ä¸°å¯Œå¤šå½©çš„çº¿ä¸Šå’Œçº¿ä¸‹æ´»åŠ¨</p>\n<p>æ— è®ºä½ æ˜¯åˆšåˆšè¸å…¥ITé¢†åŸŸï¼Œè¿˜æ˜¯å¯»æ±‚æ›´é«˜çº§åˆ«çš„æŠ€æœ¯æŒ‘æˆ˜ï¼ŒITProHubéƒ½æ˜¯ä½ ä¿¡æ¯æŠ€æœ¯ä¹‹æ—…çš„ç†æƒ³ä¼´ä¾£ã€‚</p>\n<h2 id=\"ğŸŒ-æ¢ç´¢æ— é™å¯èƒ½ï¼ŒåŠ å…¥-ITProHub-ï¼ğŸŒ\"><a href=\"#ğŸŒ-æ¢ç´¢æ— é™å¯èƒ½ï¼ŒåŠ å…¥-ITProHub-ï¼ğŸŒ\" class=\"headerlink\" title=\"ğŸŒ æ¢ç´¢æ— é™å¯èƒ½ï¼ŒåŠ å…¥ ITProHub ï¼ğŸŒ\"></a>ğŸŒ æ¢ç´¢æ— é™å¯èƒ½ï¼ŒåŠ å…¥ ITProHub ï¼ğŸŒ</h2><p>å…¬ä¼—å·å°†ä¸å®šæœŸæ›´æ–°ï¼Œæ¬¢è¿è®¢é˜…ï¼</p>\n<p>#ITProHub #ä¿¡æ¯æŠ€æœ¯ #ä¸“ä¸šå‘å±• #ç¤¾åŒºäº¤æµ</p>\n<p>æ›´å¤šä¸€æ‰‹è®¯æ¯ï¼Œå¯å…³æ³¨å…¬ä¼—å·ï¼š<a href=\"https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg\">ITProHub</a></p>\n<p><img src=\"https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg\" alt=\"ITProHub\"></p>\n"},{"title":"æ·±å…¥ç†è§£ HTTP Connection å¤´","date":"2024-03-19T08:11:52.000Z","_content":"HTTP Connection å¤´æ˜¯ HTTP åè®®ä¸­çš„ä¸€ä¸ªé‡è¦å¤´éƒ¨å­—æ®µï¼Œå®ƒç”¨äºæ§åˆ¶å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥è¡Œä¸ºã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ HTTP Connection å¤´éƒ¨çš„ä½œç”¨ã€ç”¨æ³•ï¼Œå¹¶ç»“åˆå®é™…å¼€å‘æ¡ˆä¾‹å±•ç¤ºå…¶åœ¨åº”ç”¨ç¨‹åºå¼€å‘ä¸­çš„åº”ç”¨ã€‚\n\nåœ¨å¼€å§‹æœ¬æ–‡çš„é˜…è¯»ä¹‹å‰ï¼Œé»˜è®¤å±å¹•å‰çš„è€é“å·²ç»å¯¹HTTPæœ‰äº†åŸºç¡€çš„è®¤è¯†ã€‚å¦‚æœä¸æ˜¯ï¼Œè¯·ç§»æ­¥å­¦ä¹ [è¶…æ–‡æœ¬ä¼ è¾“åè®®](https://zh.wikipedia.org/wiki/%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE#)\n\n\n## ä½œç”¨ä¸è¯­æ³•\nHTTP Connectionå¤´æ˜¯é€šç”¨ç±»å‹æ ‡å¤´ï¼Œå…è®¸å‘é€æ–¹æˆ–å®¢æˆ·ç«¯æŒ‡å®šè¯¥ç‰¹å®šè¿æ¥æ‰€éœ€çš„é€‰é¡¹ã€‚Connection å¸®åŠ©ä½¿ç”¨å•ä¸ª TCP è¿æ¥å‘é€æˆ–æ¥æ”¶å¤šä¸ª HTTP è¯·æ±‚/å“åº”ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ä¸ªè¯·æ±‚/å“åº”æ‰“å¼€ä¸€ä¸ªæ–°è¿æ¥ã€‚å®ƒè¿˜æ§åˆ¶å½“å‰äº‹åŠ¡å®Œæˆåç½‘ç»œæ˜¯å¦ä¿æŒæ‰“å¼€æˆ–å…³é—­çŠ¶æ€ã€‚\n\n### è¯­æ³•\n```http request\nConnection: keep-alive\nConnection: close\n```\n\nHTTP Connectionå¤´æ¥å—ä¸Šé¢æåˆ°çš„ä¸¤ä¸ªæŒ‡ä»¤ï¼Œå¹¶å¦‚ä¸‹æ‰€è¿°ï¼š\n\n+ keep-aliveè¯¥æŒ‡ä»¤è¡¨æ˜å®¢æˆ·ç«¯åœ¨å‘é€å“åº”æ¶ˆæ¯åå¸Œæœ›ä¿æŒè¿æ¥æ‰“å¼€æˆ–æ´»åŠ¨ã€‚åœ¨ HTTP 1.1 ç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨æŒä¹…è¿æ¥ï¼Œè¯¥è¿æ¥åœ¨äº‹åŠ¡åä¸ä¼šè‡ªåŠ¨å…³é—­ã€‚ä½†HTTP 1.0ä¸ä¼šå°†è¿æ¥è§†ä¸ºæŒä¹…è¿æ¥ï¼Œå› æ­¤å¦‚æœè¦ä¿æŒè¿æ¥å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œåˆ™éœ€è¦åŒ…å«ä¸€ä¸ªä¿æŒæ´»åŠ¨è¿æ¥æ ‡å¤´ã€‚\n+ closeè¿™ä¸ªå…³é—­è¿æ¥æŒ‡ä»¤è¡¨æ˜å®¢æˆ·ç«¯åœ¨å‘é€å“åº”æ¶ˆæ¯åæƒ³è¦å…³é—­è¿æ¥ã€‚åœ¨ HTTP 1.0 ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹è¿æ¥ä¼šå…³é—­ã€‚ä½†åœ¨ HTTP 1.1 ä¸­ï¼Œå¦‚æœæ‚¨å¸Œæœ›å…³é—­è¿æ¥ï¼Œåˆ™éœ€è¦å°†å…¶åŒ…å«åœ¨æ ‡å¤´ä¸­ã€‚\n\nHttp1.1 ä»¥åï¼ŒKeep-Aliveå·²ç»é»˜è®¤æ”¯æŒå¹¶å¼€å¯ã€‚å®¢æˆ·ç«¯ï¼ˆåŒ…æ‹¬ä½†ä¸é™äºæµè§ˆå™¨ï¼‰å‘é€è¯·æ±‚æ—¶ä¼šåœ¨ Header ä¸­å¢åŠ ä¸€ä¸ªè¯·æ±‚å¤´Connection: Keep-Aliveï¼Œå½“æœåŠ¡å™¨æ”¶åˆ°é™„å¸¦æœ‰Connection: Keep-Aliveçš„è¯·æ±‚æ—¶ï¼Œä¹Ÿä¼šåœ¨å“åº”å¤´ä¸­æ·»åŠ  Keep-Aliveã€‚è¿™æ ·ä¸€æ¥ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ HTTP è¿æ¥å°±ä¼šè¢«ä¿æŒï¼Œä¸ä¼šæ–­å¼€ï¼ˆæ–­å¼€æ–¹å¼ä¸‹é¢ä»‹ç»ï¼‰ï¼Œå½“å®¢æˆ·ç«¯å‘é€å¦å¤–ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œå°±å¯ä»¥å¤ç”¨å·²å»ºç«‹çš„è¿æ¥ã€‚\n\n_ä¿æŒè¿æ¥å’Œä¸ä¿æŒè¿æ¥åŒºåˆ«å¯ä»¥å‚è€ƒä¸‹é¢çš„å›¾_\n![handshake](/images/http/perisitent-connection.png)\n\n\n## Keep-Aliveçš„ä¼˜ç¼ºç‚¹\nkeep-alive è¿™ä¹ˆå®Œç¾ä¹ˆï¼Ÿ\n### ä¼˜ç‚¹ï¼š\n\n1. å‡å°‘è¿æ¥å»ºç«‹å’Œæ–­å¼€çš„å¼€é”€ï¼š ä½¿ç”¨é•¿è¿æ¥å¯ä»¥é¿å…åœ¨æ¯æ¬¡è¯·æ±‚æ—¶éƒ½é‡æ–°å»ºç«‹è¿æ¥ï¼Œä»è€Œå‡å°‘äº†è¿æ¥å»ºç«‹å’Œæ–­å¼€çš„æ—¶é—´å’Œå¼€é”€ã€‚\n2. å‡å°‘ç½‘ç»œå»¶è¿Ÿï¼š ç”±äºè¿æ¥å·²ç»å»ºç«‹ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œä¸éœ€è¦ç­‰å¾…è¿æ¥çš„å»ºç«‹è¿‡ç¨‹ï¼Œä»è€Œå‡å°‘äº†ç½‘ç»œå»¶è¿Ÿï¼Œæé«˜äº†æ•°æ®ä¼ è¾“æ•ˆç‡ã€‚\n3. æé«˜æ€§èƒ½ï¼š é•¿è¿æ¥å¯ä»¥å®ç°è¿æ¥çš„å¤ç”¨ï¼Œå¤šä¸ªè¯·æ±‚å¯ä»¥å…±äº«åŒä¸€ä¸ªè¿æ¥ï¼Œä»è€Œå‡å°‘äº†æœåŠ¡å™¨çš„è´Ÿæ‹…ï¼Œæé«˜äº†ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½ã€‚\n\n### ç¼ºç‚¹ï¼š\n1. èµ„æºå ç”¨ï¼š é•¿è¿æ¥ä¼šå ç”¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„èµ„æºï¼Œå°¤å…¶æ˜¯åœ¨è¿æ¥ç©ºé—²æ—¶ï¼Œä¼šæŒç»­å ç”¨èµ„æºï¼Œå¯èƒ½å¯¼è‡´èµ„æºæµªè´¹ã€‚\n2. å¯èƒ½é€ æˆèµ„æºä¸è¶³ï¼š å¦‚æœé•¿æ—¶é—´ä¿æŒå¤§é‡çš„é•¿è¿æ¥ï¼Œå¯èƒ½ä¼šè€—å°½æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„èµ„æºï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ç”šè‡³å´©æºƒã€‚\n\n## æ€ä¹ˆæ–­å¼€è¿æ¥\n### é€šè¿‡ Keep-Alive Timeout æ ‡è¯†\nkeep-aliveä¸ä¼šæ°¸ä¹…ä¿æŒè¿æ¥ï¼Œå®ƒæœ‰ä¸€ä¸ªä¿æŒæ—¶é—´ï¼Œå¯ä»¥åœ¨ä¸åŒçš„æœåŠ¡å™¨è½¯ä»¶ï¼ˆå¦‚Apacheï¼‰ä¸­è®¾å®šè¿™ä¸ªæ—¶é—´ã€‚å®ç°é•¿è¿æ¥éœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æ”¯æŒé•¿è¿æ¥ã€‚\nKeep-Aliveï¼šå¦‚æœæµè§ˆå™¨è¯·æ±‚ä¿æŒè¿æ¥ï¼Œåˆ™è¯¥å¤´éƒ¨è¡¨æ˜å¸Œæœ› WEB æœåŠ¡å™¨ä¿æŒè¿æ¥å¤šé•¿æ—¶é—´ï¼ˆç§’ï¼‰ã€‚ä¾‹å¦‚ï¼š\n```http request\nKeep-Alive:timeout=5\n```\n<font color=\"#dd0000\">æ³¨æ„ï¼šMozilla å’Œ Konquor æµè§ˆå™¨èƒ½è¯†åˆ« â€œKeep-Aliveï¼šTimeout=Timeâ€ æŠ¥å¤´å­—æ®µï¼Œè€Œ MSIE åœ¨å¤§çº¦ 60 ç§’å†…è‡ªè¡Œå…³é—­ä¿æ´»è¿æ¥ã€‚</font>\n\n### é€šè¿‡ Connection close æ ‡è¯†\né€šåœ¨ Response Header ä¸­å¢åŠ Connection closeæ ‡è¯†ï¼Œæ¥ä¸»åŠ¨å‘Šè¯‰å‘é€ç«¯ï¼Œè¿æ¥å·²ç»æ–­å¼€äº†ï¼Œä¸èƒ½å†å¤ç”¨äº†ï¼›å®¢æˆ·ç«¯æ¥æ”¶åˆ°æ­¤æ ‡ç¤ºåï¼Œä¼šé”€æ¯è¿æ¥ï¼Œå†æ¬¡è¯·æ±‚æ—¶ä¼šé‡æ–°å»ºç«‹è¿æ¥ã€‚\n\næ³¨æ„ï¼šé…ç½® close é…ç½®åï¼Œå¹¶ä¸æ˜¯è¯´æ¯æ¬¡éƒ½æ–°å»ºè¿æ¥ï¼Œè€Œæ˜¯çº¦å®šæ­¤è¿æ¥å¯ä»¥ç”¨å‡ æ¬¡ï¼Œè¾¾åˆ°è¿™ä¸ªæœ€å¤§æ¬¡æ•°æ—¶ï¼Œæ¥æ”¶ç«¯å°±ä¼šè¿”å› close æ ‡è¯†\n\n\n## åŠ¨æ‰‹è¯•ä¸€è¯•\nä¸ºäº†æ›´å¥½çš„ç†è§£keep-aliveæ˜¯æ€ä¹ˆç©çš„ï¼Œæˆ‘å†™äº†ä¸€ä¸ªç®€å•çš„ä¾‹å­\n\n+ ä¸»åŠ¨æ–­å¼€è¿æ¥\n```\n[HttpGet]\n[ActionTitle(Name = \"å…³é—­è¿æ¥\")]\n[Route(\"close.svc\")]\npublic void Close()\n{\n    Response.Headers.Connection = \"close\";\n    return;\n}\n```\n![ä¸»åŠ¨æ–­å¼€è¿æ¥](/images/http/handshake-2.png)\né¦–å…ˆï¼Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡è°ƒç”¨startæ¥å£æ‰“å¼€è¿æ¥ï¼Œå¯ä»¥çœ‹åˆ°å¼€å§‹çš„ä¸‰æ¬¡æ¡æ‰‹ã€‚åç»­æˆ‘ä»¬å†æ¬¡å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œç”±äºè¿æ¥è¿˜æ²¡æœ‰æ–­å¼€ï¼Œæ‰€ä»¥å°±ä¸å†æœ‰ä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹ã€‚\n\nç„¶åï¼Œæˆ‘ä»¬åˆä¸»åŠ¨è°ƒç”¨äº†closeè¿™ä¸ªæ¥å£ï¼Œè¿™ä¸ªæ¥å£è¿”å›çš„å¤´éƒ¨ä¿¡æ¯ä¸­æºå¸¦äº†â€œconnection: closeâ€ï¼Œå‘Šè¯‰æµè§ˆå™¨è¦å…³é—­è¿æ¥ã€‚å› æ­¤åœ¨æ­¤ä¹‹åæˆ‘ä»¬ç«‹é©¬å°±çœ‹åˆ°äº†4æ¬¡æŒ¥æ‰‹ã€‚\n\n+ è¶…æ—¶æ–­å¼€è¿æ¥(Mozilla)\n```C#\n[HttpGet]\n[ActionTitle(Name = \"å¼€å¯è¿æ¥\")]\n[Route(\"start.svc\")]\npublic void Start()\n{\n    Response.Headers.KeepAlive = \"timeout=10, max=3\";\n    return;\n}\n```\n  ![ä¸»åŠ¨æ–­å¼€è¿æ¥](/images/http/timeout-auto-disconnect.png)\nåœ¨æœåŠ¡ç«¯è®¾ç½®10sè¶…æ—¶ã€‚ç¬¬ä¸€æ¬¡ä¸»åŠ¨æ‰“å¼€è¿æ¥ï¼Œä¹‹åæˆ‘ä»¬ä¸å†è¿›è¡Œè¯·æ±‚ï¼Œ10sä¹‹åè¿æ¥è‡ªåŠ¨æ–­å¼€ã€‚\n\n\n+ è¢«åŠ¨æ–­å¼€è¿æ¥\n![ä¸»åŠ¨æ–­å¼€è¿æ¥](/images/http/auto-disconnect.png)\nä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡ä¸»åŠ¨æ‰“å¼€è¿æ¥ã€‚ä¹‹åæˆ‘ä»¬ä¸å†è¿›è¡Œè¯·æ±‚ï¼Œä¸€æ®µæ—¶é—´ä¹‹åè¿æ¥è‡ªåŠ¨æ–­å¼€ã€‚\n\n**åˆ†æä¸Šå›¾æµç¨‹**\n+ é¦–å…ˆï¼š10.21.21.6ï¼ˆæœ¬æœºipï¼‰ç‡å…ˆå‘æœåŠ¡ç«¯ å‘èµ·äº† Keep-Alive æŠ¥æ–‡\n+ æœåŠ¡ç«¯ä¼šè¿›è¡Œ Keep-Alive ACK\n+ è§„å¾‹æ˜¯ å®¢æˆ·ç«¯ä¸€ç›´åœ¨å‘é€ Keep-Alive ï¼ŒæœåŠ¡ç«¯å‘¢ï¼Œä¸€ç›´åœ¨ Keep-Alive ACKï¼Œä¸” Seq å’Œ Ack ä¸€ç›´æ²¡æœ‰å˜\n+ å¤§æ¦‚è¿‡äº† 5min æœåŠ¡ç«¯ç‡å…ˆå‘èµ· FIN ACK è¿›å…¥ è¿›å…¥æŒ¥æ‰‹ æ–­å¼€è¿æ¥é˜¶æ®µ\n\n**çŒœæƒ³**\n+ å®¢æˆ·ç«¯ TCP åœ¨æ²¡æœ‰æ•°æ®æµé€šæ—¶æœ‰è‡ªå·±çš„æ¢æ´»æœºåˆ¶ï¼Œç”±å®¢æˆ·ç«¯ä¸ŠæŠ¥ Keep-Alive æŠ¥æ–‡ï¼ŒæœåŠ¡ç«¯ ACK ï¼ŒåŒæ–¹ç¡®è®¤å½¼æ­¤æ´»ç€ã€‚\n+ æ¢æ´»æœ‰æ—¶é—´é™åˆ¶ï¼Œè¶…è¿‡é™å®šæ—¶é—´ï¼Œå¦‚æœä¸€ç›´æ²¡æœ‰æ•°æ®äº¤æ¢ï¼Œå³ä½¿æ¢æ´»å¿ƒè·³æ­£å¸¸ï¼Œä¹Ÿä¼šè¿›è¡ŒæŒ¥æ‰‹æ–­è¿ï¼Œé‡Šæ”¾èµ„æºã€‚\n\n## TCP  Keep-Alive æœºåˆ¶\n> + TCP Keep-Alive å¹¶ä¸æ˜¯ TCP æ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯ç”±åè®®æ ˆå®ç°è€…è¿›è¡Œæ‹“å±•å®ç°ï¼Œä¸»æµæ“ä½œç³»ç»Ÿ Linuxã€Windowsã€MacOS éƒ½è¿›è¡Œäº†å¯¹åº”çš„å®ç°ã€‚ \n> + TCP Keep-Alive æŠ¥æ–‡æ˜¯ç”±æ“ä½œç³»ç»Ÿæˆ–ç½‘ç»œåº“å®ç°çš„ï¼Œè€Œä¸æ˜¯ç”±ç‰¹å®šçš„åº”ç”¨ç¨‹åºï¼ˆå¦‚æµè§ˆå™¨æˆ–HTTPå®¢æˆ·ç«¯åº“ï¼‰ç›´æ¥å‘é€çš„ã€‚å®ƒæ˜¯ä¸€ç§ç½‘ç»œå±‚çš„åŠŸèƒ½ï¼Œç”¨äºç»´æŒä¸¤ä¸ªç½‘ç»œè®¾å¤‡ä¹‹é—´çš„è¿æ¥çŠ¶æ€ã€‚è¿™ä¸ªæœºåˆ¶åœ¨TCPåè®®ä¸­å®šä¹‰ï¼Œå…è®¸ä¸€æ–¹åœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°æ•°æ®æ—¶å‘é€æ¢æµ‹åŒ…ï¼Œä»¥ç¡®è®¤è¿æ¥çš„å¦ä¸€ç«¯æ˜¯å¦ä»ç„¶å¯è¾¾ã€‚ \n> + åœ¨Windowsæ“ä½œç³»ç»Ÿä¸­ï¼Œè¿™é€šå¸¸é€šè¿‡å‘é€TCP Keep-Aliveæ¢æµ‹åŒ…æ¥å®ç°ï¼Œè¿™äº›æ¢æµ‹åŒ…æ˜¯ç”±æ“ä½œç³»ç»Ÿçš„ç½‘ç»œå †æ ˆè‡ªåŠ¨å‘é€çš„ã€‚\n\nä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½å‘é€TCP Keep-AliveæŠ¥æ–‡çš„å®ä½“ï¼š\n1. æ“ä½œç³»ç»Ÿç½‘ç»œå †æ ˆï¼šå¤§å¤šæ•°ç°ä»£æ“ä½œç³»ç»Ÿéƒ½ä¼šå®ç°TCP Keep-AliveåŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œåœ¨Windowsä¸­ï¼Œå¯ä»¥é€šè¿‡æ³¨å†Œè¡¨è®¾ç½®æˆ–ä½¿ç”¨netshå‘½ä»¤æ¥é…ç½®TCP Keep-Aliveå‚æ•°ã€‚\n2. ç½‘ç»œåº“ï¼šæŸäº›ç¼–ç¨‹è¯­è¨€çš„ç½‘ç»œåº“å¯èƒ½å®ç°äº†è‡ªå·±çš„Keep-Aliveé€»è¾‘ã€‚ä¾‹å¦‚ï¼ŒJavaçš„HttpURLConnectionæˆ–C#çš„HttpClientå¯èƒ½ä¼šåœ¨åº•å±‚TCPè¿æ¥ä¸Šå¯ç”¨Keep-Aliveã€‚\n3. æµè§ˆå™¨ï¼šè™½ç„¶æµè§ˆå™¨å¯èƒ½ä¸ä¼šåœ¨æ²¡æœ‰HTTPè¯·æ±‚çš„æƒ…å†µä¸‹å‘é€Keep-AliveæŠ¥æ–‡ï¼Œä½†å®ƒä»¬å¯èƒ½ä¼šå®šæœŸå‘é€HTTP/1.1åè®®ä¸­çš„Keep-Aliveå¤´éƒ¨ï¼Œè¿™æ˜¯ä¸€ç§åº”ç”¨å±‚çš„æœºåˆ¶ï¼Œç”¨äºç»´æŒHTTPè¿æ¥çš„æ´»è·ƒçŠ¶æ€ã€‚\n4. å…¶ä»–ç½‘ç»œåº”ç”¨ç¨‹åºï¼šä»»ä½•ä½¿ç”¨TCPè¿æ¥çš„åº”ç”¨ç¨‹åºéƒ½å¯èƒ½å®ç°è‡ªå·±çš„Keep-Aliveé€»è¾‘ï¼Œä»¥ç¡®ä¿è¿æ¥çš„æŒç»­æ€§ã€‚\n\n## ç»“è¯­\nHTTP Connection å¤´æ˜¯ HTTP åè®®ä¸­éå¸¸é‡è¦çš„å¤´éƒ¨å­—æ®µä¹‹ä¸€ï¼Œå®ƒæ§åˆ¶ç€å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥è¡Œä¸ºï¼Œç›´æ¥å½±å“ç€é€šä¿¡çš„æ•ˆç‡å’Œæ€§èƒ½ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œåˆç†ä½¿ç”¨ HTTP Connection å¤´å¯ä»¥æœ‰æ•ˆåœ°ç®¡ç†ç½‘ç»œèµ„æºï¼Œæé«˜é€šä¿¡çš„æ•ˆç‡ã€‚å¸Œæœ›æœ¬æ–‡èƒ½å¤Ÿå¸®åŠ©è¯»è€…æ›´æ·±å…¥åœ°ç†è§£ HTTP Connection å¤´çš„ä½œç”¨å’Œç”¨æ³•ï¼Œå¹¶åœ¨å®é™…å¼€å‘ä¸­åŠ ä»¥åº”ç”¨ã€‚\n\n\næ›´å¤šä¸€æ‰‹è®¯æ¯ï¼Œå¯å…³æ³¨å…¬ä¼—å·ï¼š[ITProHub](https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg)\n\n![ITProHub](https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg)","source":"_posts/http.md","raw":"---\ntitle: æ·±å…¥ç†è§£ HTTP Connection å¤´\ndate: 2024-03-19 16:11:52\ntags: http httpåè®® Connection\n---\nHTTP Connection å¤´æ˜¯ HTTP åè®®ä¸­çš„ä¸€ä¸ªé‡è¦å¤´éƒ¨å­—æ®µï¼Œå®ƒç”¨äºæ§åˆ¶å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥è¡Œä¸ºã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ HTTP Connection å¤´éƒ¨çš„ä½œç”¨ã€ç”¨æ³•ï¼Œå¹¶ç»“åˆå®é™…å¼€å‘æ¡ˆä¾‹å±•ç¤ºå…¶åœ¨åº”ç”¨ç¨‹åºå¼€å‘ä¸­çš„åº”ç”¨ã€‚\n\nåœ¨å¼€å§‹æœ¬æ–‡çš„é˜…è¯»ä¹‹å‰ï¼Œé»˜è®¤å±å¹•å‰çš„è€é“å·²ç»å¯¹HTTPæœ‰äº†åŸºç¡€çš„è®¤è¯†ã€‚å¦‚æœä¸æ˜¯ï¼Œè¯·ç§»æ­¥å­¦ä¹ [è¶…æ–‡æœ¬ä¼ è¾“åè®®](https://zh.wikipedia.org/wiki/%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE#)\n\n\n## ä½œç”¨ä¸è¯­æ³•\nHTTP Connectionå¤´æ˜¯é€šç”¨ç±»å‹æ ‡å¤´ï¼Œå…è®¸å‘é€æ–¹æˆ–å®¢æˆ·ç«¯æŒ‡å®šè¯¥ç‰¹å®šè¿æ¥æ‰€éœ€çš„é€‰é¡¹ã€‚Connection å¸®åŠ©ä½¿ç”¨å•ä¸ª TCP è¿æ¥å‘é€æˆ–æ¥æ”¶å¤šä¸ª HTTP è¯·æ±‚/å“åº”ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ä¸ªè¯·æ±‚/å“åº”æ‰“å¼€ä¸€ä¸ªæ–°è¿æ¥ã€‚å®ƒè¿˜æ§åˆ¶å½“å‰äº‹åŠ¡å®Œæˆåç½‘ç»œæ˜¯å¦ä¿æŒæ‰“å¼€æˆ–å…³é—­çŠ¶æ€ã€‚\n\n### è¯­æ³•\n```http request\nConnection: keep-alive\nConnection: close\n```\n\nHTTP Connectionå¤´æ¥å—ä¸Šé¢æåˆ°çš„ä¸¤ä¸ªæŒ‡ä»¤ï¼Œå¹¶å¦‚ä¸‹æ‰€è¿°ï¼š\n\n+ keep-aliveè¯¥æŒ‡ä»¤è¡¨æ˜å®¢æˆ·ç«¯åœ¨å‘é€å“åº”æ¶ˆæ¯åå¸Œæœ›ä¿æŒè¿æ¥æ‰“å¼€æˆ–æ´»åŠ¨ã€‚åœ¨ HTTP 1.1 ç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨æŒä¹…è¿æ¥ï¼Œè¯¥è¿æ¥åœ¨äº‹åŠ¡åä¸ä¼šè‡ªåŠ¨å…³é—­ã€‚ä½†HTTP 1.0ä¸ä¼šå°†è¿æ¥è§†ä¸ºæŒä¹…è¿æ¥ï¼Œå› æ­¤å¦‚æœè¦ä¿æŒè¿æ¥å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œåˆ™éœ€è¦åŒ…å«ä¸€ä¸ªä¿æŒæ´»åŠ¨è¿æ¥æ ‡å¤´ã€‚\n+ closeè¿™ä¸ªå…³é—­è¿æ¥æŒ‡ä»¤è¡¨æ˜å®¢æˆ·ç«¯åœ¨å‘é€å“åº”æ¶ˆæ¯åæƒ³è¦å…³é—­è¿æ¥ã€‚åœ¨ HTTP 1.0 ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹è¿æ¥ä¼šå…³é—­ã€‚ä½†åœ¨ HTTP 1.1 ä¸­ï¼Œå¦‚æœæ‚¨å¸Œæœ›å…³é—­è¿æ¥ï¼Œåˆ™éœ€è¦å°†å…¶åŒ…å«åœ¨æ ‡å¤´ä¸­ã€‚\n\nHttp1.1 ä»¥åï¼ŒKeep-Aliveå·²ç»é»˜è®¤æ”¯æŒå¹¶å¼€å¯ã€‚å®¢æˆ·ç«¯ï¼ˆåŒ…æ‹¬ä½†ä¸é™äºæµè§ˆå™¨ï¼‰å‘é€è¯·æ±‚æ—¶ä¼šåœ¨ Header ä¸­å¢åŠ ä¸€ä¸ªè¯·æ±‚å¤´Connection: Keep-Aliveï¼Œå½“æœåŠ¡å™¨æ”¶åˆ°é™„å¸¦æœ‰Connection: Keep-Aliveçš„è¯·æ±‚æ—¶ï¼Œä¹Ÿä¼šåœ¨å“åº”å¤´ä¸­æ·»åŠ  Keep-Aliveã€‚è¿™æ ·ä¸€æ¥ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ HTTP è¿æ¥å°±ä¼šè¢«ä¿æŒï¼Œä¸ä¼šæ–­å¼€ï¼ˆæ–­å¼€æ–¹å¼ä¸‹é¢ä»‹ç»ï¼‰ï¼Œå½“å®¢æˆ·ç«¯å‘é€å¦å¤–ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œå°±å¯ä»¥å¤ç”¨å·²å»ºç«‹çš„è¿æ¥ã€‚\n\n_ä¿æŒè¿æ¥å’Œä¸ä¿æŒè¿æ¥åŒºåˆ«å¯ä»¥å‚è€ƒä¸‹é¢çš„å›¾_\n![handshake](/images/http/perisitent-connection.png)\n\n\n## Keep-Aliveçš„ä¼˜ç¼ºç‚¹\nkeep-alive è¿™ä¹ˆå®Œç¾ä¹ˆï¼Ÿ\n### ä¼˜ç‚¹ï¼š\n\n1. å‡å°‘è¿æ¥å»ºç«‹å’Œæ–­å¼€çš„å¼€é”€ï¼š ä½¿ç”¨é•¿è¿æ¥å¯ä»¥é¿å…åœ¨æ¯æ¬¡è¯·æ±‚æ—¶éƒ½é‡æ–°å»ºç«‹è¿æ¥ï¼Œä»è€Œå‡å°‘äº†è¿æ¥å»ºç«‹å’Œæ–­å¼€çš„æ—¶é—´å’Œå¼€é”€ã€‚\n2. å‡å°‘ç½‘ç»œå»¶è¿Ÿï¼š ç”±äºè¿æ¥å·²ç»å»ºç«‹ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œä¸éœ€è¦ç­‰å¾…è¿æ¥çš„å»ºç«‹è¿‡ç¨‹ï¼Œä»è€Œå‡å°‘äº†ç½‘ç»œå»¶è¿Ÿï¼Œæé«˜äº†æ•°æ®ä¼ è¾“æ•ˆç‡ã€‚\n3. æé«˜æ€§èƒ½ï¼š é•¿è¿æ¥å¯ä»¥å®ç°è¿æ¥çš„å¤ç”¨ï¼Œå¤šä¸ªè¯·æ±‚å¯ä»¥å…±äº«åŒä¸€ä¸ªè¿æ¥ï¼Œä»è€Œå‡å°‘äº†æœåŠ¡å™¨çš„è´Ÿæ‹…ï¼Œæé«˜äº†ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½ã€‚\n\n### ç¼ºç‚¹ï¼š\n1. èµ„æºå ç”¨ï¼š é•¿è¿æ¥ä¼šå ç”¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„èµ„æºï¼Œå°¤å…¶æ˜¯åœ¨è¿æ¥ç©ºé—²æ—¶ï¼Œä¼šæŒç»­å ç”¨èµ„æºï¼Œå¯èƒ½å¯¼è‡´èµ„æºæµªè´¹ã€‚\n2. å¯èƒ½é€ æˆèµ„æºä¸è¶³ï¼š å¦‚æœé•¿æ—¶é—´ä¿æŒå¤§é‡çš„é•¿è¿æ¥ï¼Œå¯èƒ½ä¼šè€—å°½æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„èµ„æºï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ç”šè‡³å´©æºƒã€‚\n\n## æ€ä¹ˆæ–­å¼€è¿æ¥\n### é€šè¿‡ Keep-Alive Timeout æ ‡è¯†\nkeep-aliveä¸ä¼šæ°¸ä¹…ä¿æŒè¿æ¥ï¼Œå®ƒæœ‰ä¸€ä¸ªä¿æŒæ—¶é—´ï¼Œå¯ä»¥åœ¨ä¸åŒçš„æœåŠ¡å™¨è½¯ä»¶ï¼ˆå¦‚Apacheï¼‰ä¸­è®¾å®šè¿™ä¸ªæ—¶é—´ã€‚å®ç°é•¿è¿æ¥éœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æ”¯æŒé•¿è¿æ¥ã€‚\nKeep-Aliveï¼šå¦‚æœæµè§ˆå™¨è¯·æ±‚ä¿æŒè¿æ¥ï¼Œåˆ™è¯¥å¤´éƒ¨è¡¨æ˜å¸Œæœ› WEB æœåŠ¡å™¨ä¿æŒè¿æ¥å¤šé•¿æ—¶é—´ï¼ˆç§’ï¼‰ã€‚ä¾‹å¦‚ï¼š\n```http request\nKeep-Alive:timeout=5\n```\n<font color=\"#dd0000\">æ³¨æ„ï¼šMozilla å’Œ Konquor æµè§ˆå™¨èƒ½è¯†åˆ« â€œKeep-Aliveï¼šTimeout=Timeâ€ æŠ¥å¤´å­—æ®µï¼Œè€Œ MSIE åœ¨å¤§çº¦ 60 ç§’å†…è‡ªè¡Œå…³é—­ä¿æ´»è¿æ¥ã€‚</font>\n\n### é€šè¿‡ Connection close æ ‡è¯†\né€šåœ¨ Response Header ä¸­å¢åŠ Connection closeæ ‡è¯†ï¼Œæ¥ä¸»åŠ¨å‘Šè¯‰å‘é€ç«¯ï¼Œè¿æ¥å·²ç»æ–­å¼€äº†ï¼Œä¸èƒ½å†å¤ç”¨äº†ï¼›å®¢æˆ·ç«¯æ¥æ”¶åˆ°æ­¤æ ‡ç¤ºåï¼Œä¼šé”€æ¯è¿æ¥ï¼Œå†æ¬¡è¯·æ±‚æ—¶ä¼šé‡æ–°å»ºç«‹è¿æ¥ã€‚\n\næ³¨æ„ï¼šé…ç½® close é…ç½®åï¼Œå¹¶ä¸æ˜¯è¯´æ¯æ¬¡éƒ½æ–°å»ºè¿æ¥ï¼Œè€Œæ˜¯çº¦å®šæ­¤è¿æ¥å¯ä»¥ç”¨å‡ æ¬¡ï¼Œè¾¾åˆ°è¿™ä¸ªæœ€å¤§æ¬¡æ•°æ—¶ï¼Œæ¥æ”¶ç«¯å°±ä¼šè¿”å› close æ ‡è¯†\n\n\n## åŠ¨æ‰‹è¯•ä¸€è¯•\nä¸ºäº†æ›´å¥½çš„ç†è§£keep-aliveæ˜¯æ€ä¹ˆç©çš„ï¼Œæˆ‘å†™äº†ä¸€ä¸ªç®€å•çš„ä¾‹å­\n\n+ ä¸»åŠ¨æ–­å¼€è¿æ¥\n```\n[HttpGet]\n[ActionTitle(Name = \"å…³é—­è¿æ¥\")]\n[Route(\"close.svc\")]\npublic void Close()\n{\n    Response.Headers.Connection = \"close\";\n    return;\n}\n```\n![ä¸»åŠ¨æ–­å¼€è¿æ¥](/images/http/handshake-2.png)\né¦–å…ˆï¼Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡è°ƒç”¨startæ¥å£æ‰“å¼€è¿æ¥ï¼Œå¯ä»¥çœ‹åˆ°å¼€å§‹çš„ä¸‰æ¬¡æ¡æ‰‹ã€‚åç»­æˆ‘ä»¬å†æ¬¡å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œç”±äºè¿æ¥è¿˜æ²¡æœ‰æ–­å¼€ï¼Œæ‰€ä»¥å°±ä¸å†æœ‰ä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹ã€‚\n\nç„¶åï¼Œæˆ‘ä»¬åˆä¸»åŠ¨è°ƒç”¨äº†closeè¿™ä¸ªæ¥å£ï¼Œè¿™ä¸ªæ¥å£è¿”å›çš„å¤´éƒ¨ä¿¡æ¯ä¸­æºå¸¦äº†â€œconnection: closeâ€ï¼Œå‘Šè¯‰æµè§ˆå™¨è¦å…³é—­è¿æ¥ã€‚å› æ­¤åœ¨æ­¤ä¹‹åæˆ‘ä»¬ç«‹é©¬å°±çœ‹åˆ°äº†4æ¬¡æŒ¥æ‰‹ã€‚\n\n+ è¶…æ—¶æ–­å¼€è¿æ¥(Mozilla)\n```C#\n[HttpGet]\n[ActionTitle(Name = \"å¼€å¯è¿æ¥\")]\n[Route(\"start.svc\")]\npublic void Start()\n{\n    Response.Headers.KeepAlive = \"timeout=10, max=3\";\n    return;\n}\n```\n  ![ä¸»åŠ¨æ–­å¼€è¿æ¥](/images/http/timeout-auto-disconnect.png)\nåœ¨æœåŠ¡ç«¯è®¾ç½®10sè¶…æ—¶ã€‚ç¬¬ä¸€æ¬¡ä¸»åŠ¨æ‰“å¼€è¿æ¥ï¼Œä¹‹åæˆ‘ä»¬ä¸å†è¿›è¡Œè¯·æ±‚ï¼Œ10sä¹‹åè¿æ¥è‡ªåŠ¨æ–­å¼€ã€‚\n\n\n+ è¢«åŠ¨æ–­å¼€è¿æ¥\n![ä¸»åŠ¨æ–­å¼€è¿æ¥](/images/http/auto-disconnect.png)\nä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡ä¸»åŠ¨æ‰“å¼€è¿æ¥ã€‚ä¹‹åæˆ‘ä»¬ä¸å†è¿›è¡Œè¯·æ±‚ï¼Œä¸€æ®µæ—¶é—´ä¹‹åè¿æ¥è‡ªåŠ¨æ–­å¼€ã€‚\n\n**åˆ†æä¸Šå›¾æµç¨‹**\n+ é¦–å…ˆï¼š10.21.21.6ï¼ˆæœ¬æœºipï¼‰ç‡å…ˆå‘æœåŠ¡ç«¯ å‘èµ·äº† Keep-Alive æŠ¥æ–‡\n+ æœåŠ¡ç«¯ä¼šè¿›è¡Œ Keep-Alive ACK\n+ è§„å¾‹æ˜¯ å®¢æˆ·ç«¯ä¸€ç›´åœ¨å‘é€ Keep-Alive ï¼ŒæœåŠ¡ç«¯å‘¢ï¼Œä¸€ç›´åœ¨ Keep-Alive ACKï¼Œä¸” Seq å’Œ Ack ä¸€ç›´æ²¡æœ‰å˜\n+ å¤§æ¦‚è¿‡äº† 5min æœåŠ¡ç«¯ç‡å…ˆå‘èµ· FIN ACK è¿›å…¥ è¿›å…¥æŒ¥æ‰‹ æ–­å¼€è¿æ¥é˜¶æ®µ\n\n**çŒœæƒ³**\n+ å®¢æˆ·ç«¯ TCP åœ¨æ²¡æœ‰æ•°æ®æµé€šæ—¶æœ‰è‡ªå·±çš„æ¢æ´»æœºåˆ¶ï¼Œç”±å®¢æˆ·ç«¯ä¸ŠæŠ¥ Keep-Alive æŠ¥æ–‡ï¼ŒæœåŠ¡ç«¯ ACK ï¼ŒåŒæ–¹ç¡®è®¤å½¼æ­¤æ´»ç€ã€‚\n+ æ¢æ´»æœ‰æ—¶é—´é™åˆ¶ï¼Œè¶…è¿‡é™å®šæ—¶é—´ï¼Œå¦‚æœä¸€ç›´æ²¡æœ‰æ•°æ®äº¤æ¢ï¼Œå³ä½¿æ¢æ´»å¿ƒè·³æ­£å¸¸ï¼Œä¹Ÿä¼šè¿›è¡ŒæŒ¥æ‰‹æ–­è¿ï¼Œé‡Šæ”¾èµ„æºã€‚\n\n## TCP  Keep-Alive æœºåˆ¶\n> + TCP Keep-Alive å¹¶ä¸æ˜¯ TCP æ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯ç”±åè®®æ ˆå®ç°è€…è¿›è¡Œæ‹“å±•å®ç°ï¼Œä¸»æµæ“ä½œç³»ç»Ÿ Linuxã€Windowsã€MacOS éƒ½è¿›è¡Œäº†å¯¹åº”çš„å®ç°ã€‚ \n> + TCP Keep-Alive æŠ¥æ–‡æ˜¯ç”±æ“ä½œç³»ç»Ÿæˆ–ç½‘ç»œåº“å®ç°çš„ï¼Œè€Œä¸æ˜¯ç”±ç‰¹å®šçš„åº”ç”¨ç¨‹åºï¼ˆå¦‚æµè§ˆå™¨æˆ–HTTPå®¢æˆ·ç«¯åº“ï¼‰ç›´æ¥å‘é€çš„ã€‚å®ƒæ˜¯ä¸€ç§ç½‘ç»œå±‚çš„åŠŸèƒ½ï¼Œç”¨äºç»´æŒä¸¤ä¸ªç½‘ç»œè®¾å¤‡ä¹‹é—´çš„è¿æ¥çŠ¶æ€ã€‚è¿™ä¸ªæœºåˆ¶åœ¨TCPåè®®ä¸­å®šä¹‰ï¼Œå…è®¸ä¸€æ–¹åœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°æ•°æ®æ—¶å‘é€æ¢æµ‹åŒ…ï¼Œä»¥ç¡®è®¤è¿æ¥çš„å¦ä¸€ç«¯æ˜¯å¦ä»ç„¶å¯è¾¾ã€‚ \n> + åœ¨Windowsæ“ä½œç³»ç»Ÿä¸­ï¼Œè¿™é€šå¸¸é€šè¿‡å‘é€TCP Keep-Aliveæ¢æµ‹åŒ…æ¥å®ç°ï¼Œè¿™äº›æ¢æµ‹åŒ…æ˜¯ç”±æ“ä½œç³»ç»Ÿçš„ç½‘ç»œå †æ ˆè‡ªåŠ¨å‘é€çš„ã€‚\n\nä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½å‘é€TCP Keep-AliveæŠ¥æ–‡çš„å®ä½“ï¼š\n1. æ“ä½œç³»ç»Ÿç½‘ç»œå †æ ˆï¼šå¤§å¤šæ•°ç°ä»£æ“ä½œç³»ç»Ÿéƒ½ä¼šå®ç°TCP Keep-AliveåŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œåœ¨Windowsä¸­ï¼Œå¯ä»¥é€šè¿‡æ³¨å†Œè¡¨è®¾ç½®æˆ–ä½¿ç”¨netshå‘½ä»¤æ¥é…ç½®TCP Keep-Aliveå‚æ•°ã€‚\n2. ç½‘ç»œåº“ï¼šæŸäº›ç¼–ç¨‹è¯­è¨€çš„ç½‘ç»œåº“å¯èƒ½å®ç°äº†è‡ªå·±çš„Keep-Aliveé€»è¾‘ã€‚ä¾‹å¦‚ï¼ŒJavaçš„HttpURLConnectionæˆ–C#çš„HttpClientå¯èƒ½ä¼šåœ¨åº•å±‚TCPè¿æ¥ä¸Šå¯ç”¨Keep-Aliveã€‚\n3. æµè§ˆå™¨ï¼šè™½ç„¶æµè§ˆå™¨å¯èƒ½ä¸ä¼šåœ¨æ²¡æœ‰HTTPè¯·æ±‚çš„æƒ…å†µä¸‹å‘é€Keep-AliveæŠ¥æ–‡ï¼Œä½†å®ƒä»¬å¯èƒ½ä¼šå®šæœŸå‘é€HTTP/1.1åè®®ä¸­çš„Keep-Aliveå¤´éƒ¨ï¼Œè¿™æ˜¯ä¸€ç§åº”ç”¨å±‚çš„æœºåˆ¶ï¼Œç”¨äºç»´æŒHTTPè¿æ¥çš„æ´»è·ƒçŠ¶æ€ã€‚\n4. å…¶ä»–ç½‘ç»œåº”ç”¨ç¨‹åºï¼šä»»ä½•ä½¿ç”¨TCPè¿æ¥çš„åº”ç”¨ç¨‹åºéƒ½å¯èƒ½å®ç°è‡ªå·±çš„Keep-Aliveé€»è¾‘ï¼Œä»¥ç¡®ä¿è¿æ¥çš„æŒç»­æ€§ã€‚\n\n## ç»“è¯­\nHTTP Connection å¤´æ˜¯ HTTP åè®®ä¸­éå¸¸é‡è¦çš„å¤´éƒ¨å­—æ®µä¹‹ä¸€ï¼Œå®ƒæ§åˆ¶ç€å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥è¡Œä¸ºï¼Œç›´æ¥å½±å“ç€é€šä¿¡çš„æ•ˆç‡å’Œæ€§èƒ½ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œåˆç†ä½¿ç”¨ HTTP Connection å¤´å¯ä»¥æœ‰æ•ˆåœ°ç®¡ç†ç½‘ç»œèµ„æºï¼Œæé«˜é€šä¿¡çš„æ•ˆç‡ã€‚å¸Œæœ›æœ¬æ–‡èƒ½å¤Ÿå¸®åŠ©è¯»è€…æ›´æ·±å…¥åœ°ç†è§£ HTTP Connection å¤´çš„ä½œç”¨å’Œç”¨æ³•ï¼Œå¹¶åœ¨å®é™…å¼€å‘ä¸­åŠ ä»¥åº”ç”¨ã€‚\n\n\næ›´å¤šä¸€æ‰‹è®¯æ¯ï¼Œå¯å…³æ³¨å…¬ä¼—å·ï¼š[ITProHub](https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg)\n\n![ITProHub](https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg)","slug":"http","published":1,"updated":"2024-04-26T03:06:44.259Z","_id":"cltzedeaa0000d0p1ajbjc7gt","comments":1,"layout":"post","photos":[],"link":"","content":"<p>HTTP Connection å¤´æ˜¯ HTTP åè®®ä¸­çš„ä¸€ä¸ªé‡è¦å¤´éƒ¨å­—æ®µï¼Œå®ƒç”¨äºæ§åˆ¶å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥è¡Œä¸ºã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ HTTP Connection å¤´éƒ¨çš„ä½œç”¨ã€ç”¨æ³•ï¼Œå¹¶ç»“åˆå®é™…å¼€å‘æ¡ˆä¾‹å±•ç¤ºå…¶åœ¨åº”ç”¨ç¨‹åºå¼€å‘ä¸­çš„åº”ç”¨ã€‚</p>\n<p>åœ¨å¼€å§‹æœ¬æ–‡çš„é˜…è¯»ä¹‹å‰ï¼Œé»˜è®¤å±å¹•å‰çš„è€é“å·²ç»å¯¹HTTPæœ‰äº†åŸºç¡€çš„è®¤è¯†ã€‚å¦‚æœä¸æ˜¯ï¼Œè¯·ç§»æ­¥å­¦ä¹ <a href=\"https://zh.wikipedia.org/wiki/%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE#\">è¶…æ–‡æœ¬ä¼ è¾“åè®®</a></p>\n<h2 id=\"ä½œç”¨ä¸è¯­æ³•\"><a href=\"#ä½œç”¨ä¸è¯­æ³•\" class=\"headerlink\" title=\"ä½œç”¨ä¸è¯­æ³•\"></a>ä½œç”¨ä¸è¯­æ³•</h2><p>HTTP Connectionå¤´æ˜¯é€šç”¨ç±»å‹æ ‡å¤´ï¼Œå…è®¸å‘é€æ–¹æˆ–å®¢æˆ·ç«¯æŒ‡å®šè¯¥ç‰¹å®šè¿æ¥æ‰€éœ€çš„é€‰é¡¹ã€‚Connection å¸®åŠ©ä½¿ç”¨å•ä¸ª TCP è¿æ¥å‘é€æˆ–æ¥æ”¶å¤šä¸ª HTTP è¯·æ±‚&#x2F;å“åº”ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ä¸ªè¯·æ±‚&#x2F;å“åº”æ‰“å¼€ä¸€ä¸ªæ–°è¿æ¥ã€‚å®ƒè¿˜æ§åˆ¶å½“å‰äº‹åŠ¡å®Œæˆåç½‘ç»œæ˜¯å¦ä¿æŒæ‰“å¼€æˆ–å…³é—­çŠ¶æ€ã€‚</p>\n<h3 id=\"è¯­æ³•\"><a href=\"#è¯­æ³•\" class=\"headerlink\" title=\"è¯­æ³•\"></a>è¯­æ³•</h3><figure class=\"highlight http\"><figcaption><span>request</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">Connection</span><span class=\"punctuation\">: </span>keep-alive</span><br><span class=\"line\"><span class=\"attribute\">Connection</span><span class=\"punctuation\">: </span>close</span><br></pre></td></tr></table></figure>\n\n<p>HTTP Connectionå¤´æ¥å—ä¸Šé¢æåˆ°çš„ä¸¤ä¸ªæŒ‡ä»¤ï¼Œå¹¶å¦‚ä¸‹æ‰€è¿°ï¼š</p>\n<ul>\n<li>keep-aliveè¯¥æŒ‡ä»¤è¡¨æ˜å®¢æˆ·ç«¯åœ¨å‘é€å“åº”æ¶ˆæ¯åå¸Œæœ›ä¿æŒè¿æ¥æ‰“å¼€æˆ–æ´»åŠ¨ã€‚åœ¨ HTTP 1.1 ç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨æŒä¹…è¿æ¥ï¼Œè¯¥è¿æ¥åœ¨äº‹åŠ¡åä¸ä¼šè‡ªåŠ¨å…³é—­ã€‚ä½†HTTP 1.0ä¸ä¼šå°†è¿æ¥è§†ä¸ºæŒä¹…è¿æ¥ï¼Œå› æ­¤å¦‚æœè¦ä¿æŒè¿æ¥å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œåˆ™éœ€è¦åŒ…å«ä¸€ä¸ªä¿æŒæ´»åŠ¨è¿æ¥æ ‡å¤´ã€‚</li>\n<li>closeè¿™ä¸ªå…³é—­è¿æ¥æŒ‡ä»¤è¡¨æ˜å®¢æˆ·ç«¯åœ¨å‘é€å“åº”æ¶ˆæ¯åæƒ³è¦å…³é—­è¿æ¥ã€‚åœ¨ HTTP 1.0 ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹è¿æ¥ä¼šå…³é—­ã€‚ä½†åœ¨ HTTP 1.1 ä¸­ï¼Œå¦‚æœæ‚¨å¸Œæœ›å…³é—­è¿æ¥ï¼Œåˆ™éœ€è¦å°†å…¶åŒ…å«åœ¨æ ‡å¤´ä¸­ã€‚</li>\n</ul>\n<p>Http1.1 ä»¥åï¼ŒKeep-Aliveå·²ç»é»˜è®¤æ”¯æŒå¹¶å¼€å¯ã€‚å®¢æˆ·ç«¯ï¼ˆåŒ…æ‹¬ä½†ä¸é™äºæµè§ˆå™¨ï¼‰å‘é€è¯·æ±‚æ—¶ä¼šåœ¨ Header ä¸­å¢åŠ ä¸€ä¸ªè¯·æ±‚å¤´Connection: Keep-Aliveï¼Œå½“æœåŠ¡å™¨æ”¶åˆ°é™„å¸¦æœ‰Connection: Keep-Aliveçš„è¯·æ±‚æ—¶ï¼Œä¹Ÿä¼šåœ¨å“åº”å¤´ä¸­æ·»åŠ  Keep-Aliveã€‚è¿™æ ·ä¸€æ¥ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ HTTP è¿æ¥å°±ä¼šè¢«ä¿æŒï¼Œä¸ä¼šæ–­å¼€ï¼ˆæ–­å¼€æ–¹å¼ä¸‹é¢ä»‹ç»ï¼‰ï¼Œå½“å®¢æˆ·ç«¯å‘é€å¦å¤–ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œå°±å¯ä»¥å¤ç”¨å·²å»ºç«‹çš„è¿æ¥ã€‚</p>\n<p><em>ä¿æŒè¿æ¥å’Œä¸ä¿æŒè¿æ¥åŒºåˆ«å¯ä»¥å‚è€ƒä¸‹é¢çš„å›¾</em><br><img src=\"/images/http/perisitent-connection.png\" alt=\"handshake\"></p>\n<h2 id=\"Keep-Aliveçš„ä¼˜ç¼ºç‚¹\"><a href=\"#Keep-Aliveçš„ä¼˜ç¼ºç‚¹\" class=\"headerlink\" title=\"Keep-Aliveçš„ä¼˜ç¼ºç‚¹\"></a>Keep-Aliveçš„ä¼˜ç¼ºç‚¹</h2><p>keep-alive è¿™ä¹ˆå®Œç¾ä¹ˆï¼Ÿ</p>\n<h3 id=\"ä¼˜ç‚¹ï¼š\"><a href=\"#ä¼˜ç‚¹ï¼š\" class=\"headerlink\" title=\"ä¼˜ç‚¹ï¼š\"></a>ä¼˜ç‚¹ï¼š</h3><ol>\n<li>å‡å°‘è¿æ¥å»ºç«‹å’Œæ–­å¼€çš„å¼€é”€ï¼š ä½¿ç”¨é•¿è¿æ¥å¯ä»¥é¿å…åœ¨æ¯æ¬¡è¯·æ±‚æ—¶éƒ½é‡æ–°å»ºç«‹è¿æ¥ï¼Œä»è€Œå‡å°‘äº†è¿æ¥å»ºç«‹å’Œæ–­å¼€çš„æ—¶é—´å’Œå¼€é”€ã€‚</li>\n<li>å‡å°‘ç½‘ç»œå»¶è¿Ÿï¼š ç”±äºè¿æ¥å·²ç»å»ºç«‹ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œä¸éœ€è¦ç­‰å¾…è¿æ¥çš„å»ºç«‹è¿‡ç¨‹ï¼Œä»è€Œå‡å°‘äº†ç½‘ç»œå»¶è¿Ÿï¼Œæé«˜äº†æ•°æ®ä¼ è¾“æ•ˆç‡ã€‚</li>\n<li>æé«˜æ€§èƒ½ï¼š é•¿è¿æ¥å¯ä»¥å®ç°è¿æ¥çš„å¤ç”¨ï¼Œå¤šä¸ªè¯·æ±‚å¯ä»¥å…±äº«åŒä¸€ä¸ªè¿æ¥ï¼Œä»è€Œå‡å°‘äº†æœåŠ¡å™¨çš„è´Ÿæ‹…ï¼Œæé«˜äº†ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½ã€‚</li>\n</ol>\n<h3 id=\"ç¼ºç‚¹ï¼š\"><a href=\"#ç¼ºç‚¹ï¼š\" class=\"headerlink\" title=\"ç¼ºç‚¹ï¼š\"></a>ç¼ºç‚¹ï¼š</h3><ol>\n<li>èµ„æºå ç”¨ï¼š é•¿è¿æ¥ä¼šå ç”¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„èµ„æºï¼Œå°¤å…¶æ˜¯åœ¨è¿æ¥ç©ºé—²æ—¶ï¼Œä¼šæŒç»­å ç”¨èµ„æºï¼Œå¯èƒ½å¯¼è‡´èµ„æºæµªè´¹ã€‚</li>\n<li>å¯èƒ½é€ æˆèµ„æºä¸è¶³ï¼š å¦‚æœé•¿æ—¶é—´ä¿æŒå¤§é‡çš„é•¿è¿æ¥ï¼Œå¯èƒ½ä¼šè€—å°½æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„èµ„æºï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ç”šè‡³å´©æºƒã€‚</li>\n</ol>\n<h2 id=\"æ€ä¹ˆæ–­å¼€è¿æ¥\"><a href=\"#æ€ä¹ˆæ–­å¼€è¿æ¥\" class=\"headerlink\" title=\"æ€ä¹ˆæ–­å¼€è¿æ¥\"></a>æ€ä¹ˆæ–­å¼€è¿æ¥</h2><h3 id=\"é€šè¿‡-Keep-Alive-Timeout-æ ‡è¯†\"><a href=\"#é€šè¿‡-Keep-Alive-Timeout-æ ‡è¯†\" class=\"headerlink\" title=\"é€šè¿‡ Keep-Alive Timeout æ ‡è¯†\"></a>é€šè¿‡ Keep-Alive Timeout æ ‡è¯†</h3><p>keep-aliveä¸ä¼šæ°¸ä¹…ä¿æŒè¿æ¥ï¼Œå®ƒæœ‰ä¸€ä¸ªä¿æŒæ—¶é—´ï¼Œå¯ä»¥åœ¨ä¸åŒçš„æœåŠ¡å™¨è½¯ä»¶ï¼ˆå¦‚Apacheï¼‰ä¸­è®¾å®šè¿™ä¸ªæ—¶é—´ã€‚å®ç°é•¿è¿æ¥éœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æ”¯æŒé•¿è¿æ¥ã€‚<br>Keep-Aliveï¼šå¦‚æœæµè§ˆå™¨è¯·æ±‚ä¿æŒè¿æ¥ï¼Œåˆ™è¯¥å¤´éƒ¨è¡¨æ˜å¸Œæœ› WEB æœåŠ¡å™¨ä¿æŒè¿æ¥å¤šé•¿æ—¶é—´ï¼ˆç§’ï¼‰ã€‚ä¾‹å¦‚ï¼š</p>\n<figure class=\"highlight http\"><figcaption><span>request</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Keep-Alive:timeout=5</span><br></pre></td></tr></table></figure>\n<p><font color=\"#dd0000\">æ³¨æ„ï¼šMozilla å’Œ Konquor æµè§ˆå™¨èƒ½è¯†åˆ« â€œKeep-Aliveï¼šTimeout&#x3D;Timeâ€ æŠ¥å¤´å­—æ®µï¼Œè€Œ MSIE åœ¨å¤§çº¦ 60 ç§’å†…è‡ªè¡Œå…³é—­ä¿æ´»è¿æ¥ã€‚</font></p>\n<h3 id=\"é€šè¿‡-Connection-close-æ ‡è¯†\"><a href=\"#é€šè¿‡-Connection-close-æ ‡è¯†\" class=\"headerlink\" title=\"é€šè¿‡ Connection close æ ‡è¯†\"></a>é€šè¿‡ Connection close æ ‡è¯†</h3><p>é€šåœ¨ Response Header ä¸­å¢åŠ Connection closeæ ‡è¯†ï¼Œæ¥ä¸»åŠ¨å‘Šè¯‰å‘é€ç«¯ï¼Œè¿æ¥å·²ç»æ–­å¼€äº†ï¼Œä¸èƒ½å†å¤ç”¨äº†ï¼›å®¢æˆ·ç«¯æ¥æ”¶åˆ°æ­¤æ ‡ç¤ºåï¼Œä¼šé”€æ¯è¿æ¥ï¼Œå†æ¬¡è¯·æ±‚æ—¶ä¼šé‡æ–°å»ºç«‹è¿æ¥ã€‚</p>\n<p>æ³¨æ„ï¼šé…ç½® close é…ç½®åï¼Œå¹¶ä¸æ˜¯è¯´æ¯æ¬¡éƒ½æ–°å»ºè¿æ¥ï¼Œè€Œæ˜¯çº¦å®šæ­¤è¿æ¥å¯ä»¥ç”¨å‡ æ¬¡ï¼Œè¾¾åˆ°è¿™ä¸ªæœ€å¤§æ¬¡æ•°æ—¶ï¼Œæ¥æ”¶ç«¯å°±ä¼šè¿”å› close æ ‡è¯†</p>\n<h2 id=\"åŠ¨æ‰‹è¯•ä¸€è¯•\"><a href=\"#åŠ¨æ‰‹è¯•ä¸€è¯•\" class=\"headerlink\" title=\"åŠ¨æ‰‹è¯•ä¸€è¯•\"></a>åŠ¨æ‰‹è¯•ä¸€è¯•</h2><p>ä¸ºäº†æ›´å¥½çš„ç†è§£keep-aliveæ˜¯æ€ä¹ˆç©çš„ï¼Œæˆ‘å†™äº†ä¸€ä¸ªç®€å•çš„ä¾‹å­</p>\n<ul>\n<li>ä¸»åŠ¨æ–­å¼€è¿æ¥<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[HttpGet]</span><br><span class=\"line\">[ActionTitle(Name = &quot;å…³é—­è¿æ¥&quot;)]</span><br><span class=\"line\">[Route(&quot;close.svc&quot;)]</span><br><span class=\"line\">public void Close()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    Response.Headers.Connection = &quot;close&quot;;</span><br><span class=\"line\">    return;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<img src=\"/images/http/handshake-2.png\" alt=\"ä¸»åŠ¨æ–­å¼€è¿æ¥\"><br>é¦–å…ˆï¼Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡è°ƒç”¨startæ¥å£æ‰“å¼€è¿æ¥ï¼Œå¯ä»¥çœ‹åˆ°å¼€å§‹çš„ä¸‰æ¬¡æ¡æ‰‹ã€‚åç»­æˆ‘ä»¬å†æ¬¡å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œç”±äºè¿æ¥è¿˜æ²¡æœ‰æ–­å¼€ï¼Œæ‰€ä»¥å°±ä¸å†æœ‰ä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹ã€‚</li>\n</ul>\n<p>ç„¶åï¼Œæˆ‘ä»¬åˆä¸»åŠ¨è°ƒç”¨äº†closeè¿™ä¸ªæ¥å£ï¼Œè¿™ä¸ªæ¥å£è¿”å›çš„å¤´éƒ¨ä¿¡æ¯ä¸­æºå¸¦äº†â€œconnection: closeâ€ï¼Œå‘Šè¯‰æµè§ˆå™¨è¦å…³é—­è¿æ¥ã€‚å› æ­¤åœ¨æ­¤ä¹‹åæˆ‘ä»¬ç«‹é©¬å°±çœ‹åˆ°äº†4æ¬¡æŒ¥æ‰‹ã€‚</p>\n<ul>\n<li><p>è¶…æ—¶æ–­å¼€è¿æ¥(Mozilla)</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"meta\">HttpGet</span>]</span><br><span class=\"line\">[<span class=\"meta\">ActionTitle(Name = <span class=\"string\">&quot;å¼€å¯è¿æ¥&quot;</span>)</span>]</span><br><span class=\"line\">[<span class=\"meta\">Route(<span class=\"string\">&quot;start.svc&quot;</span>)</span>]</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Start</span>()</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    Response.Headers.KeepAlive = <span class=\"string\">&quot;timeout=10, max=3&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/images/http/timeout-auto-disconnect.png\" alt=\"ä¸»åŠ¨æ–­å¼€è¿æ¥\"><br>åœ¨æœåŠ¡ç«¯è®¾ç½®10sè¶…æ—¶ã€‚ç¬¬ä¸€æ¬¡ä¸»åŠ¨æ‰“å¼€è¿æ¥ï¼Œä¹‹åæˆ‘ä»¬ä¸å†è¿›è¡Œè¯·æ±‚ï¼Œ10sä¹‹åè¿æ¥è‡ªåŠ¨æ–­å¼€ã€‚</p>\n</li>\n<li><p>è¢«åŠ¨æ–­å¼€è¿æ¥<br><img src=\"/images/http/auto-disconnect.png\" alt=\"ä¸»åŠ¨æ–­å¼€è¿æ¥\"><br>ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡ä¸»åŠ¨æ‰“å¼€è¿æ¥ã€‚ä¹‹åæˆ‘ä»¬ä¸å†è¿›è¡Œè¯·æ±‚ï¼Œä¸€æ®µæ—¶é—´ä¹‹åè¿æ¥è‡ªåŠ¨æ–­å¼€ã€‚</p>\n</li>\n</ul>\n<p><strong>åˆ†æä¸Šå›¾æµç¨‹</strong></p>\n<ul>\n<li>é¦–å…ˆï¼š10.21.21.6ï¼ˆæœ¬æœºipï¼‰ç‡å…ˆå‘æœåŠ¡ç«¯ å‘èµ·äº† Keep-Alive æŠ¥æ–‡</li>\n<li>æœåŠ¡ç«¯ä¼šè¿›è¡Œ Keep-Alive ACK</li>\n<li>è§„å¾‹æ˜¯ å®¢æˆ·ç«¯ä¸€ç›´åœ¨å‘é€ Keep-Alive ï¼ŒæœåŠ¡ç«¯å‘¢ï¼Œä¸€ç›´åœ¨ Keep-Alive ACKï¼Œä¸” Seq å’Œ Ack ä¸€ç›´æ²¡æœ‰å˜</li>\n<li>å¤§æ¦‚è¿‡äº† 5min æœåŠ¡ç«¯ç‡å…ˆå‘èµ· FIN ACK è¿›å…¥ è¿›å…¥æŒ¥æ‰‹ æ–­å¼€è¿æ¥é˜¶æ®µ</li>\n</ul>\n<p><strong>çŒœæƒ³</strong></p>\n<ul>\n<li>å®¢æˆ·ç«¯ TCP åœ¨æ²¡æœ‰æ•°æ®æµé€šæ—¶æœ‰è‡ªå·±çš„æ¢æ´»æœºåˆ¶ï¼Œç”±å®¢æˆ·ç«¯ä¸ŠæŠ¥ Keep-Alive æŠ¥æ–‡ï¼ŒæœåŠ¡ç«¯ ACK ï¼ŒåŒæ–¹ç¡®è®¤å½¼æ­¤æ´»ç€ã€‚</li>\n<li>æ¢æ´»æœ‰æ—¶é—´é™åˆ¶ï¼Œè¶…è¿‡é™å®šæ—¶é—´ï¼Œå¦‚æœä¸€ç›´æ²¡æœ‰æ•°æ®äº¤æ¢ï¼Œå³ä½¿æ¢æ´»å¿ƒè·³æ­£å¸¸ï¼Œä¹Ÿä¼šè¿›è¡ŒæŒ¥æ‰‹æ–­è¿ï¼Œé‡Šæ”¾èµ„æºã€‚</li>\n</ul>\n<h2 id=\"TCP-Keep-Alive-æœºåˆ¶\"><a href=\"#TCP-Keep-Alive-æœºåˆ¶\" class=\"headerlink\" title=\"TCP  Keep-Alive æœºåˆ¶\"></a>TCP  Keep-Alive æœºåˆ¶</h2><blockquote>\n<ul>\n<li>TCP Keep-Alive å¹¶ä¸æ˜¯ TCP æ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯ç”±åè®®æ ˆå®ç°è€…è¿›è¡Œæ‹“å±•å®ç°ï¼Œä¸»æµæ“ä½œç³»ç»Ÿ Linuxã€Windowsã€MacOS éƒ½è¿›è¡Œäº†å¯¹åº”çš„å®ç°ã€‚ </li>\n<li>TCP Keep-Alive æŠ¥æ–‡æ˜¯ç”±æ“ä½œç³»ç»Ÿæˆ–ç½‘ç»œåº“å®ç°çš„ï¼Œè€Œä¸æ˜¯ç”±ç‰¹å®šçš„åº”ç”¨ç¨‹åºï¼ˆå¦‚æµè§ˆå™¨æˆ–HTTPå®¢æˆ·ç«¯åº“ï¼‰ç›´æ¥å‘é€çš„ã€‚å®ƒæ˜¯ä¸€ç§ç½‘ç»œå±‚çš„åŠŸèƒ½ï¼Œç”¨äºç»´æŒä¸¤ä¸ªç½‘ç»œè®¾å¤‡ä¹‹é—´çš„è¿æ¥çŠ¶æ€ã€‚è¿™ä¸ªæœºåˆ¶åœ¨TCPåè®®ä¸­å®šä¹‰ï¼Œå…è®¸ä¸€æ–¹åœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°æ•°æ®æ—¶å‘é€æ¢æµ‹åŒ…ï¼Œä»¥ç¡®è®¤è¿æ¥çš„å¦ä¸€ç«¯æ˜¯å¦ä»ç„¶å¯è¾¾ã€‚ </li>\n<li>åœ¨Windowsæ“ä½œç³»ç»Ÿä¸­ï¼Œè¿™é€šå¸¸é€šè¿‡å‘é€TCP Keep-Aliveæ¢æµ‹åŒ…æ¥å®ç°ï¼Œè¿™äº›æ¢æµ‹åŒ…æ˜¯ç”±æ“ä½œç³»ç»Ÿçš„ç½‘ç»œå †æ ˆè‡ªåŠ¨å‘é€çš„ã€‚</li>\n</ul>\n</blockquote>\n<p>ä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½å‘é€TCP Keep-AliveæŠ¥æ–‡çš„å®ä½“ï¼š</p>\n<ol>\n<li>æ“ä½œç³»ç»Ÿç½‘ç»œå †æ ˆï¼šå¤§å¤šæ•°ç°ä»£æ“ä½œç³»ç»Ÿéƒ½ä¼šå®ç°TCP Keep-AliveåŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œåœ¨Windowsä¸­ï¼Œå¯ä»¥é€šè¿‡æ³¨å†Œè¡¨è®¾ç½®æˆ–ä½¿ç”¨netshå‘½ä»¤æ¥é…ç½®TCP Keep-Aliveå‚æ•°ã€‚</li>\n<li>ç½‘ç»œåº“ï¼šæŸäº›ç¼–ç¨‹è¯­è¨€çš„ç½‘ç»œåº“å¯èƒ½å®ç°äº†è‡ªå·±çš„Keep-Aliveé€»è¾‘ã€‚ä¾‹å¦‚ï¼ŒJavaçš„HttpURLConnectionæˆ–C#çš„HttpClientå¯èƒ½ä¼šåœ¨åº•å±‚TCPè¿æ¥ä¸Šå¯ç”¨Keep-Aliveã€‚</li>\n<li>æµè§ˆå™¨ï¼šè™½ç„¶æµè§ˆå™¨å¯èƒ½ä¸ä¼šåœ¨æ²¡æœ‰HTTPè¯·æ±‚çš„æƒ…å†µä¸‹å‘é€Keep-AliveæŠ¥æ–‡ï¼Œä½†å®ƒä»¬å¯èƒ½ä¼šå®šæœŸå‘é€HTTP&#x2F;1.1åè®®ä¸­çš„Keep-Aliveå¤´éƒ¨ï¼Œè¿™æ˜¯ä¸€ç§åº”ç”¨å±‚çš„æœºåˆ¶ï¼Œç”¨äºç»´æŒHTTPè¿æ¥çš„æ´»è·ƒçŠ¶æ€ã€‚</li>\n<li>å…¶ä»–ç½‘ç»œåº”ç”¨ç¨‹åºï¼šä»»ä½•ä½¿ç”¨TCPè¿æ¥çš„åº”ç”¨ç¨‹åºéƒ½å¯èƒ½å®ç°è‡ªå·±çš„Keep-Aliveé€»è¾‘ï¼Œä»¥ç¡®ä¿è¿æ¥çš„æŒç»­æ€§ã€‚</li>\n</ol>\n<h2 id=\"ç»“è¯­\"><a href=\"#ç»“è¯­\" class=\"headerlink\" title=\"ç»“è¯­\"></a>ç»“è¯­</h2><p>HTTP Connection å¤´æ˜¯ HTTP åè®®ä¸­éå¸¸é‡è¦çš„å¤´éƒ¨å­—æ®µä¹‹ä¸€ï¼Œå®ƒæ§åˆ¶ç€å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥è¡Œä¸ºï¼Œç›´æ¥å½±å“ç€é€šä¿¡çš„æ•ˆç‡å’Œæ€§èƒ½ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œåˆç†ä½¿ç”¨ HTTP Connection å¤´å¯ä»¥æœ‰æ•ˆåœ°ç®¡ç†ç½‘ç»œèµ„æºï¼Œæé«˜é€šä¿¡çš„æ•ˆç‡ã€‚å¸Œæœ›æœ¬æ–‡èƒ½å¤Ÿå¸®åŠ©è¯»è€…æ›´æ·±å…¥åœ°ç†è§£ HTTP Connection å¤´çš„ä½œç”¨å’Œç”¨æ³•ï¼Œå¹¶åœ¨å®é™…å¼€å‘ä¸­åŠ ä»¥åº”ç”¨ã€‚</p>\n<p>æ›´å¤šä¸€æ‰‹è®¯æ¯ï¼Œå¯å…³æ³¨å…¬ä¼—å·ï¼š<a href=\"https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg\">ITProHub</a></p>\n<p><img src=\"https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg\" alt=\"ITProHub\"></p>\n","site":{"data":{}},"excerpt":"","more":"<p>HTTP Connection å¤´æ˜¯ HTTP åè®®ä¸­çš„ä¸€ä¸ªé‡è¦å¤´éƒ¨å­—æ®µï¼Œå®ƒç”¨äºæ§åˆ¶å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥è¡Œä¸ºã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ HTTP Connection å¤´éƒ¨çš„ä½œç”¨ã€ç”¨æ³•ï¼Œå¹¶ç»“åˆå®é™…å¼€å‘æ¡ˆä¾‹å±•ç¤ºå…¶åœ¨åº”ç”¨ç¨‹åºå¼€å‘ä¸­çš„åº”ç”¨ã€‚</p>\n<p>åœ¨å¼€å§‹æœ¬æ–‡çš„é˜…è¯»ä¹‹å‰ï¼Œé»˜è®¤å±å¹•å‰çš„è€é“å·²ç»å¯¹HTTPæœ‰äº†åŸºç¡€çš„è®¤è¯†ã€‚å¦‚æœä¸æ˜¯ï¼Œè¯·ç§»æ­¥å­¦ä¹ <a href=\"https://zh.wikipedia.org/wiki/%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE#\">è¶…æ–‡æœ¬ä¼ è¾“åè®®</a></p>\n<h2 id=\"ä½œç”¨ä¸è¯­æ³•\"><a href=\"#ä½œç”¨ä¸è¯­æ³•\" class=\"headerlink\" title=\"ä½œç”¨ä¸è¯­æ³•\"></a>ä½œç”¨ä¸è¯­æ³•</h2><p>HTTP Connectionå¤´æ˜¯é€šç”¨ç±»å‹æ ‡å¤´ï¼Œå…è®¸å‘é€æ–¹æˆ–å®¢æˆ·ç«¯æŒ‡å®šè¯¥ç‰¹å®šè¿æ¥æ‰€éœ€çš„é€‰é¡¹ã€‚Connection å¸®åŠ©ä½¿ç”¨å•ä¸ª TCP è¿æ¥å‘é€æˆ–æ¥æ”¶å¤šä¸ª HTTP è¯·æ±‚&#x2F;å“åº”ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ä¸ªè¯·æ±‚&#x2F;å“åº”æ‰“å¼€ä¸€ä¸ªæ–°è¿æ¥ã€‚å®ƒè¿˜æ§åˆ¶å½“å‰äº‹åŠ¡å®Œæˆåç½‘ç»œæ˜¯å¦ä¿æŒæ‰“å¼€æˆ–å…³é—­çŠ¶æ€ã€‚</p>\n<h3 id=\"è¯­æ³•\"><a href=\"#è¯­æ³•\" class=\"headerlink\" title=\"è¯­æ³•\"></a>è¯­æ³•</h3><figure class=\"highlight http\"><figcaption><span>request</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">Connection</span><span class=\"punctuation\">: </span>keep-alive</span><br><span class=\"line\"><span class=\"attribute\">Connection</span><span class=\"punctuation\">: </span>close</span><br></pre></td></tr></table></figure>\n\n<p>HTTP Connectionå¤´æ¥å—ä¸Šé¢æåˆ°çš„ä¸¤ä¸ªæŒ‡ä»¤ï¼Œå¹¶å¦‚ä¸‹æ‰€è¿°ï¼š</p>\n<ul>\n<li>keep-aliveè¯¥æŒ‡ä»¤è¡¨æ˜å®¢æˆ·ç«¯åœ¨å‘é€å“åº”æ¶ˆæ¯åå¸Œæœ›ä¿æŒè¿æ¥æ‰“å¼€æˆ–æ´»åŠ¨ã€‚åœ¨ HTTP 1.1 ç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨æŒä¹…è¿æ¥ï¼Œè¯¥è¿æ¥åœ¨äº‹åŠ¡åä¸ä¼šè‡ªåŠ¨å…³é—­ã€‚ä½†HTTP 1.0ä¸ä¼šå°†è¿æ¥è§†ä¸ºæŒä¹…è¿æ¥ï¼Œå› æ­¤å¦‚æœè¦ä¿æŒè¿æ¥å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œåˆ™éœ€è¦åŒ…å«ä¸€ä¸ªä¿æŒæ´»åŠ¨è¿æ¥æ ‡å¤´ã€‚</li>\n<li>closeè¿™ä¸ªå…³é—­è¿æ¥æŒ‡ä»¤è¡¨æ˜å®¢æˆ·ç«¯åœ¨å‘é€å“åº”æ¶ˆæ¯åæƒ³è¦å…³é—­è¿æ¥ã€‚åœ¨ HTTP 1.0 ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹è¿æ¥ä¼šå…³é—­ã€‚ä½†åœ¨ HTTP 1.1 ä¸­ï¼Œå¦‚æœæ‚¨å¸Œæœ›å…³é—­è¿æ¥ï¼Œåˆ™éœ€è¦å°†å…¶åŒ…å«åœ¨æ ‡å¤´ä¸­ã€‚</li>\n</ul>\n<p>Http1.1 ä»¥åï¼ŒKeep-Aliveå·²ç»é»˜è®¤æ”¯æŒå¹¶å¼€å¯ã€‚å®¢æˆ·ç«¯ï¼ˆåŒ…æ‹¬ä½†ä¸é™äºæµè§ˆå™¨ï¼‰å‘é€è¯·æ±‚æ—¶ä¼šåœ¨ Header ä¸­å¢åŠ ä¸€ä¸ªè¯·æ±‚å¤´Connection: Keep-Aliveï¼Œå½“æœåŠ¡å™¨æ”¶åˆ°é™„å¸¦æœ‰Connection: Keep-Aliveçš„è¯·æ±‚æ—¶ï¼Œä¹Ÿä¼šåœ¨å“åº”å¤´ä¸­æ·»åŠ  Keep-Aliveã€‚è¿™æ ·ä¸€æ¥ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ HTTP è¿æ¥å°±ä¼šè¢«ä¿æŒï¼Œä¸ä¼šæ–­å¼€ï¼ˆæ–­å¼€æ–¹å¼ä¸‹é¢ä»‹ç»ï¼‰ï¼Œå½“å®¢æˆ·ç«¯å‘é€å¦å¤–ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œå°±å¯ä»¥å¤ç”¨å·²å»ºç«‹çš„è¿æ¥ã€‚</p>\n<p><em>ä¿æŒè¿æ¥å’Œä¸ä¿æŒè¿æ¥åŒºåˆ«å¯ä»¥å‚è€ƒä¸‹é¢çš„å›¾</em><br><img src=\"/images/http/perisitent-connection.png\" alt=\"handshake\"></p>\n<h2 id=\"Keep-Aliveçš„ä¼˜ç¼ºç‚¹\"><a href=\"#Keep-Aliveçš„ä¼˜ç¼ºç‚¹\" class=\"headerlink\" title=\"Keep-Aliveçš„ä¼˜ç¼ºç‚¹\"></a>Keep-Aliveçš„ä¼˜ç¼ºç‚¹</h2><p>keep-alive è¿™ä¹ˆå®Œç¾ä¹ˆï¼Ÿ</p>\n<h3 id=\"ä¼˜ç‚¹ï¼š\"><a href=\"#ä¼˜ç‚¹ï¼š\" class=\"headerlink\" title=\"ä¼˜ç‚¹ï¼š\"></a>ä¼˜ç‚¹ï¼š</h3><ol>\n<li>å‡å°‘è¿æ¥å»ºç«‹å’Œæ–­å¼€çš„å¼€é”€ï¼š ä½¿ç”¨é•¿è¿æ¥å¯ä»¥é¿å…åœ¨æ¯æ¬¡è¯·æ±‚æ—¶éƒ½é‡æ–°å»ºç«‹è¿æ¥ï¼Œä»è€Œå‡å°‘äº†è¿æ¥å»ºç«‹å’Œæ–­å¼€çš„æ—¶é—´å’Œå¼€é”€ã€‚</li>\n<li>å‡å°‘ç½‘ç»œå»¶è¿Ÿï¼š ç”±äºè¿æ¥å·²ç»å»ºç«‹ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œä¸éœ€è¦ç­‰å¾…è¿æ¥çš„å»ºç«‹è¿‡ç¨‹ï¼Œä»è€Œå‡å°‘äº†ç½‘ç»œå»¶è¿Ÿï¼Œæé«˜äº†æ•°æ®ä¼ è¾“æ•ˆç‡ã€‚</li>\n<li>æé«˜æ€§èƒ½ï¼š é•¿è¿æ¥å¯ä»¥å®ç°è¿æ¥çš„å¤ç”¨ï¼Œå¤šä¸ªè¯·æ±‚å¯ä»¥å…±äº«åŒä¸€ä¸ªè¿æ¥ï¼Œä»è€Œå‡å°‘äº†æœåŠ¡å™¨çš„è´Ÿæ‹…ï¼Œæé«˜äº†ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½ã€‚</li>\n</ol>\n<h3 id=\"ç¼ºç‚¹ï¼š\"><a href=\"#ç¼ºç‚¹ï¼š\" class=\"headerlink\" title=\"ç¼ºç‚¹ï¼š\"></a>ç¼ºç‚¹ï¼š</h3><ol>\n<li>èµ„æºå ç”¨ï¼š é•¿è¿æ¥ä¼šå ç”¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„èµ„æºï¼Œå°¤å…¶æ˜¯åœ¨è¿æ¥ç©ºé—²æ—¶ï¼Œä¼šæŒç»­å ç”¨èµ„æºï¼Œå¯èƒ½å¯¼è‡´èµ„æºæµªè´¹ã€‚</li>\n<li>å¯èƒ½é€ æˆèµ„æºä¸è¶³ï¼š å¦‚æœé•¿æ—¶é—´ä¿æŒå¤§é‡çš„é•¿è¿æ¥ï¼Œå¯èƒ½ä¼šè€—å°½æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„èµ„æºï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ç”šè‡³å´©æºƒã€‚</li>\n</ol>\n<h2 id=\"æ€ä¹ˆæ–­å¼€è¿æ¥\"><a href=\"#æ€ä¹ˆæ–­å¼€è¿æ¥\" class=\"headerlink\" title=\"æ€ä¹ˆæ–­å¼€è¿æ¥\"></a>æ€ä¹ˆæ–­å¼€è¿æ¥</h2><h3 id=\"é€šè¿‡-Keep-Alive-Timeout-æ ‡è¯†\"><a href=\"#é€šè¿‡-Keep-Alive-Timeout-æ ‡è¯†\" class=\"headerlink\" title=\"é€šè¿‡ Keep-Alive Timeout æ ‡è¯†\"></a>é€šè¿‡ Keep-Alive Timeout æ ‡è¯†</h3><p>keep-aliveä¸ä¼šæ°¸ä¹…ä¿æŒè¿æ¥ï¼Œå®ƒæœ‰ä¸€ä¸ªä¿æŒæ—¶é—´ï¼Œå¯ä»¥åœ¨ä¸åŒçš„æœåŠ¡å™¨è½¯ä»¶ï¼ˆå¦‚Apacheï¼‰ä¸­è®¾å®šè¿™ä¸ªæ—¶é—´ã€‚å®ç°é•¿è¿æ¥éœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æ”¯æŒé•¿è¿æ¥ã€‚<br>Keep-Aliveï¼šå¦‚æœæµè§ˆå™¨è¯·æ±‚ä¿æŒè¿æ¥ï¼Œåˆ™è¯¥å¤´éƒ¨è¡¨æ˜å¸Œæœ› WEB æœåŠ¡å™¨ä¿æŒè¿æ¥å¤šé•¿æ—¶é—´ï¼ˆç§’ï¼‰ã€‚ä¾‹å¦‚ï¼š</p>\n<figure class=\"highlight http\"><figcaption><span>request</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Keep-Alive:timeout=5</span><br></pre></td></tr></table></figure>\n<p><font color=\"#dd0000\">æ³¨æ„ï¼šMozilla å’Œ Konquor æµè§ˆå™¨èƒ½è¯†åˆ« â€œKeep-Aliveï¼šTimeout&#x3D;Timeâ€ æŠ¥å¤´å­—æ®µï¼Œè€Œ MSIE åœ¨å¤§çº¦ 60 ç§’å†…è‡ªè¡Œå…³é—­ä¿æ´»è¿æ¥ã€‚</font></p>\n<h3 id=\"é€šè¿‡-Connection-close-æ ‡è¯†\"><a href=\"#é€šè¿‡-Connection-close-æ ‡è¯†\" class=\"headerlink\" title=\"é€šè¿‡ Connection close æ ‡è¯†\"></a>é€šè¿‡ Connection close æ ‡è¯†</h3><p>é€šåœ¨ Response Header ä¸­å¢åŠ Connection closeæ ‡è¯†ï¼Œæ¥ä¸»åŠ¨å‘Šè¯‰å‘é€ç«¯ï¼Œè¿æ¥å·²ç»æ–­å¼€äº†ï¼Œä¸èƒ½å†å¤ç”¨äº†ï¼›å®¢æˆ·ç«¯æ¥æ”¶åˆ°æ­¤æ ‡ç¤ºåï¼Œä¼šé”€æ¯è¿æ¥ï¼Œå†æ¬¡è¯·æ±‚æ—¶ä¼šé‡æ–°å»ºç«‹è¿æ¥ã€‚</p>\n<p>æ³¨æ„ï¼šé…ç½® close é…ç½®åï¼Œå¹¶ä¸æ˜¯è¯´æ¯æ¬¡éƒ½æ–°å»ºè¿æ¥ï¼Œè€Œæ˜¯çº¦å®šæ­¤è¿æ¥å¯ä»¥ç”¨å‡ æ¬¡ï¼Œè¾¾åˆ°è¿™ä¸ªæœ€å¤§æ¬¡æ•°æ—¶ï¼Œæ¥æ”¶ç«¯å°±ä¼šè¿”å› close æ ‡è¯†</p>\n<h2 id=\"åŠ¨æ‰‹è¯•ä¸€è¯•\"><a href=\"#åŠ¨æ‰‹è¯•ä¸€è¯•\" class=\"headerlink\" title=\"åŠ¨æ‰‹è¯•ä¸€è¯•\"></a>åŠ¨æ‰‹è¯•ä¸€è¯•</h2><p>ä¸ºäº†æ›´å¥½çš„ç†è§£keep-aliveæ˜¯æ€ä¹ˆç©çš„ï¼Œæˆ‘å†™äº†ä¸€ä¸ªç®€å•çš„ä¾‹å­</p>\n<ul>\n<li>ä¸»åŠ¨æ–­å¼€è¿æ¥<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[HttpGet]</span><br><span class=\"line\">[ActionTitle(Name = &quot;å…³é—­è¿æ¥&quot;)]</span><br><span class=\"line\">[Route(&quot;close.svc&quot;)]</span><br><span class=\"line\">public void Close()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    Response.Headers.Connection = &quot;close&quot;;</span><br><span class=\"line\">    return;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<img src=\"/images/http/handshake-2.png\" alt=\"ä¸»åŠ¨æ–­å¼€è¿æ¥\"><br>é¦–å…ˆï¼Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡è°ƒç”¨startæ¥å£æ‰“å¼€è¿æ¥ï¼Œå¯ä»¥çœ‹åˆ°å¼€å§‹çš„ä¸‰æ¬¡æ¡æ‰‹ã€‚åç»­æˆ‘ä»¬å†æ¬¡å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œç”±äºè¿æ¥è¿˜æ²¡æœ‰æ–­å¼€ï¼Œæ‰€ä»¥å°±ä¸å†æœ‰ä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹ã€‚</li>\n</ul>\n<p>ç„¶åï¼Œæˆ‘ä»¬åˆä¸»åŠ¨è°ƒç”¨äº†closeè¿™ä¸ªæ¥å£ï¼Œè¿™ä¸ªæ¥å£è¿”å›çš„å¤´éƒ¨ä¿¡æ¯ä¸­æºå¸¦äº†â€œconnection: closeâ€ï¼Œå‘Šè¯‰æµè§ˆå™¨è¦å…³é—­è¿æ¥ã€‚å› æ­¤åœ¨æ­¤ä¹‹åæˆ‘ä»¬ç«‹é©¬å°±çœ‹åˆ°äº†4æ¬¡æŒ¥æ‰‹ã€‚</p>\n<ul>\n<li><p>è¶…æ—¶æ–­å¼€è¿æ¥(Mozilla)</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"meta\">HttpGet</span>]</span><br><span class=\"line\">[<span class=\"meta\">ActionTitle(Name = <span class=\"string\">&quot;å¼€å¯è¿æ¥&quot;</span>)</span>]</span><br><span class=\"line\">[<span class=\"meta\">Route(<span class=\"string\">&quot;start.svc&quot;</span>)</span>]</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Start</span>()</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    Response.Headers.KeepAlive = <span class=\"string\">&quot;timeout=10, max=3&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/images/http/timeout-auto-disconnect.png\" alt=\"ä¸»åŠ¨æ–­å¼€è¿æ¥\"><br>åœ¨æœåŠ¡ç«¯è®¾ç½®10sè¶…æ—¶ã€‚ç¬¬ä¸€æ¬¡ä¸»åŠ¨æ‰“å¼€è¿æ¥ï¼Œä¹‹åæˆ‘ä»¬ä¸å†è¿›è¡Œè¯·æ±‚ï¼Œ10sä¹‹åè¿æ¥è‡ªåŠ¨æ–­å¼€ã€‚</p>\n</li>\n<li><p>è¢«åŠ¨æ–­å¼€è¿æ¥<br><img src=\"/images/http/auto-disconnect.png\" alt=\"ä¸»åŠ¨æ–­å¼€è¿æ¥\"><br>ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡ä¸»åŠ¨æ‰“å¼€è¿æ¥ã€‚ä¹‹åæˆ‘ä»¬ä¸å†è¿›è¡Œè¯·æ±‚ï¼Œä¸€æ®µæ—¶é—´ä¹‹åè¿æ¥è‡ªåŠ¨æ–­å¼€ã€‚</p>\n</li>\n</ul>\n<p><strong>åˆ†æä¸Šå›¾æµç¨‹</strong></p>\n<ul>\n<li>é¦–å…ˆï¼š10.21.21.6ï¼ˆæœ¬æœºipï¼‰ç‡å…ˆå‘æœåŠ¡ç«¯ å‘èµ·äº† Keep-Alive æŠ¥æ–‡</li>\n<li>æœåŠ¡ç«¯ä¼šè¿›è¡Œ Keep-Alive ACK</li>\n<li>è§„å¾‹æ˜¯ å®¢æˆ·ç«¯ä¸€ç›´åœ¨å‘é€ Keep-Alive ï¼ŒæœåŠ¡ç«¯å‘¢ï¼Œä¸€ç›´åœ¨ Keep-Alive ACKï¼Œä¸” Seq å’Œ Ack ä¸€ç›´æ²¡æœ‰å˜</li>\n<li>å¤§æ¦‚è¿‡äº† 5min æœåŠ¡ç«¯ç‡å…ˆå‘èµ· FIN ACK è¿›å…¥ è¿›å…¥æŒ¥æ‰‹ æ–­å¼€è¿æ¥é˜¶æ®µ</li>\n</ul>\n<p><strong>çŒœæƒ³</strong></p>\n<ul>\n<li>å®¢æˆ·ç«¯ TCP åœ¨æ²¡æœ‰æ•°æ®æµé€šæ—¶æœ‰è‡ªå·±çš„æ¢æ´»æœºåˆ¶ï¼Œç”±å®¢æˆ·ç«¯ä¸ŠæŠ¥ Keep-Alive æŠ¥æ–‡ï¼ŒæœåŠ¡ç«¯ ACK ï¼ŒåŒæ–¹ç¡®è®¤å½¼æ­¤æ´»ç€ã€‚</li>\n<li>æ¢æ´»æœ‰æ—¶é—´é™åˆ¶ï¼Œè¶…è¿‡é™å®šæ—¶é—´ï¼Œå¦‚æœä¸€ç›´æ²¡æœ‰æ•°æ®äº¤æ¢ï¼Œå³ä½¿æ¢æ´»å¿ƒè·³æ­£å¸¸ï¼Œä¹Ÿä¼šè¿›è¡ŒæŒ¥æ‰‹æ–­è¿ï¼Œé‡Šæ”¾èµ„æºã€‚</li>\n</ul>\n<h2 id=\"TCP-Keep-Alive-æœºåˆ¶\"><a href=\"#TCP-Keep-Alive-æœºåˆ¶\" class=\"headerlink\" title=\"TCP  Keep-Alive æœºåˆ¶\"></a>TCP  Keep-Alive æœºåˆ¶</h2><blockquote>\n<ul>\n<li>TCP Keep-Alive å¹¶ä¸æ˜¯ TCP æ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯ç”±åè®®æ ˆå®ç°è€…è¿›è¡Œæ‹“å±•å®ç°ï¼Œä¸»æµæ“ä½œç³»ç»Ÿ Linuxã€Windowsã€MacOS éƒ½è¿›è¡Œäº†å¯¹åº”çš„å®ç°ã€‚ </li>\n<li>TCP Keep-Alive æŠ¥æ–‡æ˜¯ç”±æ“ä½œç³»ç»Ÿæˆ–ç½‘ç»œåº“å®ç°çš„ï¼Œè€Œä¸æ˜¯ç”±ç‰¹å®šçš„åº”ç”¨ç¨‹åºï¼ˆå¦‚æµè§ˆå™¨æˆ–HTTPå®¢æˆ·ç«¯åº“ï¼‰ç›´æ¥å‘é€çš„ã€‚å®ƒæ˜¯ä¸€ç§ç½‘ç»œå±‚çš„åŠŸèƒ½ï¼Œç”¨äºç»´æŒä¸¤ä¸ªç½‘ç»œè®¾å¤‡ä¹‹é—´çš„è¿æ¥çŠ¶æ€ã€‚è¿™ä¸ªæœºåˆ¶åœ¨TCPåè®®ä¸­å®šä¹‰ï¼Œå…è®¸ä¸€æ–¹åœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°æ•°æ®æ—¶å‘é€æ¢æµ‹åŒ…ï¼Œä»¥ç¡®è®¤è¿æ¥çš„å¦ä¸€ç«¯æ˜¯å¦ä»ç„¶å¯è¾¾ã€‚ </li>\n<li>åœ¨Windowsæ“ä½œç³»ç»Ÿä¸­ï¼Œè¿™é€šå¸¸é€šè¿‡å‘é€TCP Keep-Aliveæ¢æµ‹åŒ…æ¥å®ç°ï¼Œè¿™äº›æ¢æµ‹åŒ…æ˜¯ç”±æ“ä½œç³»ç»Ÿçš„ç½‘ç»œå †æ ˆè‡ªåŠ¨å‘é€çš„ã€‚</li>\n</ul>\n</blockquote>\n<p>ä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½å‘é€TCP Keep-AliveæŠ¥æ–‡çš„å®ä½“ï¼š</p>\n<ol>\n<li>æ“ä½œç³»ç»Ÿç½‘ç»œå †æ ˆï¼šå¤§å¤šæ•°ç°ä»£æ“ä½œç³»ç»Ÿéƒ½ä¼šå®ç°TCP Keep-AliveåŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œåœ¨Windowsä¸­ï¼Œå¯ä»¥é€šè¿‡æ³¨å†Œè¡¨è®¾ç½®æˆ–ä½¿ç”¨netshå‘½ä»¤æ¥é…ç½®TCP Keep-Aliveå‚æ•°ã€‚</li>\n<li>ç½‘ç»œåº“ï¼šæŸäº›ç¼–ç¨‹è¯­è¨€çš„ç½‘ç»œåº“å¯èƒ½å®ç°äº†è‡ªå·±çš„Keep-Aliveé€»è¾‘ã€‚ä¾‹å¦‚ï¼ŒJavaçš„HttpURLConnectionæˆ–C#çš„HttpClientå¯èƒ½ä¼šåœ¨åº•å±‚TCPè¿æ¥ä¸Šå¯ç”¨Keep-Aliveã€‚</li>\n<li>æµè§ˆå™¨ï¼šè™½ç„¶æµè§ˆå™¨å¯èƒ½ä¸ä¼šåœ¨æ²¡æœ‰HTTPè¯·æ±‚çš„æƒ…å†µä¸‹å‘é€Keep-AliveæŠ¥æ–‡ï¼Œä½†å®ƒä»¬å¯èƒ½ä¼šå®šæœŸå‘é€HTTP&#x2F;1.1åè®®ä¸­çš„Keep-Aliveå¤´éƒ¨ï¼Œè¿™æ˜¯ä¸€ç§åº”ç”¨å±‚çš„æœºåˆ¶ï¼Œç”¨äºç»´æŒHTTPè¿æ¥çš„æ´»è·ƒçŠ¶æ€ã€‚</li>\n<li>å…¶ä»–ç½‘ç»œåº”ç”¨ç¨‹åºï¼šä»»ä½•ä½¿ç”¨TCPè¿æ¥çš„åº”ç”¨ç¨‹åºéƒ½å¯èƒ½å®ç°è‡ªå·±çš„Keep-Aliveé€»è¾‘ï¼Œä»¥ç¡®ä¿è¿æ¥çš„æŒç»­æ€§ã€‚</li>\n</ol>\n<h2 id=\"ç»“è¯­\"><a href=\"#ç»“è¯­\" class=\"headerlink\" title=\"ç»“è¯­\"></a>ç»“è¯­</h2><p>HTTP Connection å¤´æ˜¯ HTTP åè®®ä¸­éå¸¸é‡è¦çš„å¤´éƒ¨å­—æ®µä¹‹ä¸€ï¼Œå®ƒæ§åˆ¶ç€å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥è¡Œä¸ºï¼Œç›´æ¥å½±å“ç€é€šä¿¡çš„æ•ˆç‡å’Œæ€§èƒ½ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œåˆç†ä½¿ç”¨ HTTP Connection å¤´å¯ä»¥æœ‰æ•ˆåœ°ç®¡ç†ç½‘ç»œèµ„æºï¼Œæé«˜é€šä¿¡çš„æ•ˆç‡ã€‚å¸Œæœ›æœ¬æ–‡èƒ½å¤Ÿå¸®åŠ©è¯»è€…æ›´æ·±å…¥åœ°ç†è§£ HTTP Connection å¤´çš„ä½œç”¨å’Œç”¨æ³•ï¼Œå¹¶åœ¨å®é™…å¼€å‘ä¸­åŠ ä»¥åº”ç”¨ã€‚</p>\n<p>æ›´å¤šä¸€æ‰‹è®¯æ¯ï¼Œå¯å…³æ³¨å…¬ä¼—å·ï¼š<a href=\"https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg\">ITProHub</a></p>\n<p><img src=\"https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg\" alt=\"ITProHub\"></p>\n"},{"title":"ç»„ç»‡å‘å±•è‡´å‘½æ€æ‰‹ï¼šå†…è€—","date":"2024-03-28T09:49:50.000Z","_content":"\nå‰æ®µæ—¶é—´å‘è¡¨çš„éƒ½æ˜¯æŠ€æœ¯ç›¸å…³çš„æ–‡ç« ï¼Œä»Šå¤©æ¢æ¢å£å‘³ï¼Œè°ˆä¸€è°ˆæœ€è¿‘å…³äºç»„ç»‡å·¥ä½œä¸Šçš„ä¸€äº›æ€è€ƒã€‚å½“ç„¶ä¹Ÿæ˜¯æ‰¾ä¸ªåœ°æ–¹å‘å‘ç‰¢éªšã€‚ã€‚ã€‚å¯èƒ½å°±æ˜¯æƒ³åˆ°å“ªé‡Œå†™åˆ°å“ªé‡Œ\n![éƒé—·](/images/internal-loss/depressed.jpg)\n\nç›¸ä¿¡å¤§å®¶åœ¨æ­¤ä¹‹å‰ä¹Ÿå¸¸å¸¸å¬è¿‡ä¸€ä¸ªè¯´æ³•â€œåœ¨ç»„ç»‡ç®¡ç†ä¸­ï¼Œäººå°±æ˜¯å…¨éƒ¨ï¼Œäººæ‰ä¹‹ç—›ï¼Œæ˜¯æœ€å¤§çš„ç—›ç‚¹ã€‚â€\n\nä¸€å®¶ä¼ä¸šåœ¨å¢é•¿çš„è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤šé—®é¢˜éƒ½ä¼šè¢«éšè—æˆ–è€…è¯´æ˜¯å¿½ç•¥ã€‚ä½†æ˜¯ä¸€æ—¦ä¸å¢é•¿æˆ–è€…è´Ÿå¢é•¿äº†ï¼Œæ‰€æœ‰é—®é¢˜éƒ½ä¼šæš´éœ²å‡ºæ¥ï¼Œç”šè‡³æ˜¯æˆå€çš„çˆ†å‘ã€‚\n\næ¯«ä¸å¤¸å¼ çš„è¯´ï¼Œ***ç»„ç»‡å†…è€—*** å°±æ˜¯æ¯æ‰ä¸€å®¶ä¼ä¸šæœ€å¿«çš„æ–¹å¼ã€‚\n\n# ç»„ç»‡å†…è€—çš„è¡¨ç°\nä»¥ä¸‹æ˜¯æˆ‘æƒ³åˆ°çš„æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªç‚¹ï¼Œæ’ååˆ†å…ˆåï¼æ›´å¯æ€•çš„æ˜¯ï¼Œè¿™äº›è¡¨ç°ä¸€èˆ¬ä¸ä¼šå•ç‹¬å‡ºç°ï¼Œéƒ½æ˜¯æŠ±å›¢å‡ºç°çš„ã€‚\n## 1. å†…å·ï¼ˆä¸å¥åº·çš„ç«äº‰ï¼‰\n\n åœ¨å›¢é˜Ÿå†…éƒ¨ï¼Œç»„ç»‡å†…è€—ä¸€ä¸ªé‡è¦çš„è¡¨ç°å½¢å¼ï¼šå†…å·ã€‚ å•¥æ˜¯å†…å·ï¼Ÿæ— æ„ä¹‰çš„æ¶ˆè€—ï¼Œå½¢å¼ä¸»ä¹‰éƒ½å¯ä»¥å®šä¹‰ä¸ºå†…å·ã€‚\n\nè¿™å‡ å¹´è¡Œä¸šä¸‹è¡Œï¼Œè€å¤«å°±èŒçš„å…¬å¸ä¹Ÿå‡ºç°äº†ä¸¥é‡çš„ä¸šç»©ä¸‹æ»‘ã€äºæŸã€‚ä¸ºäº†å®ç°â€œé€†åŠ¿å¢é•¿â€ï¼Œå…¬å¸è¦æ±‚æé«˜äººæ•ˆï¼Œäºæ˜¯æå‡ºäº†â€œä»˜å‡º120%çš„åŠªåŠ›â€å£å·ã€‚å¯¹äºé‚£å¤šå‡ºæ¥çš„20%çš„ç†è§£ï¼Œå„äº‹ä¸šéƒ¨çš„ç†è§£éƒ½æ˜¯ä¸€è‡´çš„ï¼Œ\né‚£å°±æ˜¯**åŠ ç­**ã€‚äºæ˜¯ä¹å„éƒ¨é—¨æ€èµ·äº†ä¸€æ³¢åŠ ç­æ½®ï¼Œè¡¨æ¼”å¼çš„åŠ ç­æ½®ã€‚ä¸‹ç­æ—¶é—´æ— è®ºæœ‰æ²¡æœ‰äº‹åæ­£æ˜¯èµ°ä¸äº†çš„ï¼Œèµ°äº†çš„å°±æ˜¯å·¥ä½œé‡é¥±å’Œã€‚ç„¶åå°±è¡ç”Ÿå‡ºäº†å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œâ€œç£¨æ´‹å·¥â€ã€‚æ˜æ˜åŠå¤©èƒ½æå®šçš„éœ€æ±‚ï¼Œç¡¬æ˜¯æ‰˜ç€ä¸€å¤©æ‰è§£å†³ï¼Œæˆ–è€…ç™½å¤©æ‘¸é±¼ï¼ŒåŠ ç­å¹²æ´»ã€‚\n\nå›¢é˜Ÿç®¡ç†ä¹Ÿæ˜¯è¿™æ ·ï¼Œè¿‡åº¦è¿½æ±‚å½¢å¼ä¸»ä¹‰ï¼Œåªæ³¨é‡è¿‡ç¨‹ï¼Œä¸æ³¨é‡ç»“æœã€‚æœ€åå°±æ˜¯äººæ•ˆæ°´å¹³æ›´ä½äº†ï¼Œå‘äº†å‘˜å·¥ï¼Œä¹Ÿå‘äº†ç®¡ç†è€…ã€‚\n\nåŒæ—¶ï¼Œä¸å¥åº·çš„å†…éƒ¨ç«äº‰å¯èƒ½å¯¼è‡´å‘˜å·¥ä¹‹é—´çš„å¯¹æŠ—å’Œä¸åˆä½œï¼Œå½±å“å›¢é˜Ÿåä½œï¼Œäº§ç”Ÿä¸‹é¢ä¼šè¯´åˆ°çš„â€œéƒ¨é—¨éš”é˜‚â€ã€‚\n## 2. ä¿¡ä»»ç¼ºå¤±\nä¸šç»©å¢é•¿çš„æ—¶å€™è¿˜å¥½ï¼Œä¸€æ—¦ä¸šç»©ä¸‹æ»‘ï¼Œæ•´ä¸ªå…¬å¸é™·å…¥äº†ä¸€æ¡çŒœç–‘é“¾ã€‚\n\nè€æ¿æ€€ç–‘ç®¡ç†è€…æ˜¯ä¸æ˜¯èƒ½åŠ›å’ŒèŒä½ä¸åŒ¹é…ï¼Œäºæ˜¯å‡ºå°å„ç§æ”¿ç­–å’Œå˜é©ï¼Œç›‘ç£ç®¡ç†è€…å¥½å¥½å¹²æ´»ã€‚\n\nç®¡ç†è€…æ€€ç–‘å‘˜å·¥ï¼Œæ˜¯ä¸æ˜¯æ¯å¤©ä¸Šç­éƒ½åœ¨æ‘¸é±¼ï¼Œæ··æ—¥å­ã€‚\n\nå‘˜å·¥æ€€ç–‘å…¬å¸ï¼Œå…¬å¸æ˜¯ä¸æ˜¯ä¸è¡Œäº†ï¼Œæˆ‘æ˜¯ä¸æ˜¯è¦è¢«å¼€äº†ï¼Œç¼ºä¹å®‰å…¨æ„Ÿã€‚\n\nä¸€æ—¦ç–‘å¿ƒé“¾å½¢æˆï¼Œå…¬å¸å°±é€‰å…¥äº†ä¸€ç§æ¶æ€§å¾ªç¯ï¼š\n+ è€æ¿ä¸æ•¢æ”¾æƒç®¡ç†è€…ï¼Œé™çº§ä½¿ç”¨ã€‚å„ç§æ±‡æŠ¥ï¼Œæœˆåº¦ã€å­£åº¦ã€åŠå¹´åº¦ã€‚\n+ ç®¡ç†è€…ç”¨åŠ›è¿‡çŒ›ï¼ŒåŠ¨ä½œå˜å½¢ã€‚å¯¹å‘˜å·¥æé™å‹æ¦¨ï¼Œä¸¤ä¸ªäººçš„äº‹æƒ…ä¸€ä¸ªäººå¹²ï¼Œ996æèµ·æ¥ï¼\n\n![996](/images/internal-loss/996.jpg)\n\næˆ‘æ›¾ç»å¬è¿‡è¿™æ ·ä¸€å¥è¯â€œæ€ä¹ˆåˆ¤æ–­ä¸€ä¸ªå…¬å¸å¼€å§‹èµ°ä¸‹å¡è·¯äº†ï¼Ÿçœ‹ä»–æ˜¯ä¸æ˜¯çªç„¶å¼€å§‹æŠ“è€ƒå‹¤äº†â€ã€‚ç¡®å®å¦‚æ­¤ã€‚\nå…¬å¸å¢é•¿çš„æ—¶å€™å„ç§å®£ä¼ å¼¹æ€§å·¥ä½œåˆ¶ï¼Œè¯·å‡åŠå¤©èµ·ï¼Œ2hå°æ—¶ä»¥å†…çš„å‡æœŸä¸éœ€è¦å‘è¯·å‡ç”³è¯·ï¼Œç‰¹æ®Šæƒ…å†µå¯ä»¥ç”³è¯·å±…å®¶åŠå…¬ã€‚\n\nçªç„¶æœ‰ä¸€å¤©è·Ÿä½ è¯´ï¼Œè¿Ÿåˆ°è¦è¯´æ˜åŸå› ï¼Œè¿Ÿåˆ°è¦æ‰£é’±ã€‚è¯·å‡çš„ç³»ç»Ÿæ”¯æŒåˆ°äº†å°æ—¶çº§ï¼ŒåŠ ç­ç”³è¯·å‘˜å·¥æ— æ³•å‘èµ·ï¼Œè¦é¢†å¯¼å‘èµ·ã€‚\n\nè¿™ä¸ªæ—¶å€™å°±èƒ½çŸ¥é“ï¼Œå…¬å¸èµ°ä¸‹å¡è·¯äº†ã€‚è€Œä¸”è€æ¿æ²¡ä»è‡ªèº«æ‰¾åˆ°åŸå› ï¼Œå¼€å§‹ä»å‘˜å·¥èº«ä¸Šæ‰¾åŸå› ï¼Œå‘˜å·¥æ²¡å¥½å¥½å¹²æ´»ï¼\nä»æ„Ÿè°¢å‘˜å·¥çš„ä»˜å‡ºï¼Œåˆ°å‘˜å·¥è¦æ„Ÿè°¢å…¬å¸ç»™çš„å·¥ä½œå²—ä½ã€‚\n\n## 3. éƒ¨é—¨éš”é˜‚\n\nç”±äºå„éƒ¨é—¨ä¸ªå›¢é˜Ÿä¹‹é—´éƒ½æ˜¯ç«äº‰å…³ç³»ã€‚å„éƒ¨é—¨æˆ–å›¢é˜Ÿä¹‹é—´å½¢æˆä¿¡æ¯å­¤å²›ï¼Œç¼ºä¹åˆä½œå’Œå…±äº«èµ„æºçš„æ„æ„¿ï¼Œå¯¼è‡´æ•´ä½“æ•ˆç‡ä½ä¸‹ã€‚\nä¸šç»©ä¸‹æ»‘ï¼Œå„å›¢é˜Ÿä¹‹é—´äº’ç›¸é”…ç”©é”…ã€‚é›†å›¢è¯´é”€å”®èƒ½åŠ›å·®ï¼Œé”€å”®è¯´é¡¹ç›®åƒåœ¾ï¼Œé¡¹ç›®è¯´äº§å“åƒåœ¾ï¼Œäº§å“è¯´å¹³å°åƒåœ¾ã€‚\n\n+ æ²Ÿé€šä¸ç•…ï¼šéƒ¨é—¨ä¹‹é—´æˆ–å›¢é˜Ÿæˆå‘˜ä¹‹é—´çš„æ²Ÿé€šå­˜åœ¨éšœç¢ï¼Œä¿¡æ¯ä¼ é€’ä¸é¡ºç•…ï¼Œå¯¼è‡´è¯¯è§£å’Œå†²çªã€‚\n+ å†³ç­–è¿Ÿç¼“ï¼šå†³ç­–è¿‡ç¨‹ä¸­çš„çŠ¹è±«ä¸å†³ã€æ¨è¯¿è´£ä»»æˆ–è¿‡åº¦åˆ†æå¯¼è‡´æœºä¼šçš„ä¸§å¤±å’Œé¡¹ç›®è¿›åº¦çš„å»¶è¿Ÿã€‚\n+ èµ„æºé‡å¤æˆ–æµªè´¹ï¼šç”±äºç¼ºä¹åè°ƒå’Œè§„åˆ’ï¼Œå¯èƒ½å¯¼è‡´èµ„æºåœ¨ä¸åŒéƒ¨é—¨æˆ–é¡¹ç›®ä¸­é‡å¤æŠ•å…¥æˆ–æœªèƒ½æœ‰æ•ˆåˆ©ç”¨ã€‚\n\n\n# å’‹åŠï¼Ÿ\n<font size=\"2\" color=\"#A9A9A9\">å°½äººäº‹ï¼Œå¬å¤©å‘½ã€‚æ‰“èƒœä»—æ˜¯æœ€å¥½çš„å›¢å»º</font>\n\nä¸‹é¢æ˜¯è€å¤«è‡ªå·±çš„ä¸€ç‚¹yyï¼Œéšä¾¿èƒ¡ä¾ƒã€‚ã€‚ã€‚\n\nå‡å°‘ç»„ç»‡å†…è€—ï¼Œä¹Ÿè¯´ä¸ä¸Šä»€ä¹ˆæªæ–½å§ï¼Œåªèƒ½è¯´è¦åšæŒçš„åŸåˆ™\n\n1. ä»»äººå”¯è´¤ï¼Œç–‘äººä¸ç”¨ï¼Œç”¨äººä¸ç–‘\næ— è®ºæ˜¯å¯¹äºç®¡ç†è€…è¿˜æ˜¯å‘˜å·¥ï¼ŒçŒœç–‘æ˜¯å†…è€—çš„å§‹ä½œä¿‘è€…\n2. åšå¯¹çš„äº‹\né€‰å¯¹äººï¼Œè¿˜è¦åšå¯¹çš„äº‹ã€‚å‰©ä¸‹çš„å°±äº¤ç»™æ—¶é—´å§ã€‚å†µä¸”å‰©ä¸‹çš„å¯èƒ½ä¹Ÿä¸æ˜¯äººåŠ›èƒ½å¤ŸæŠ—è¡¡çš„äº†ã€‚\n\n\n# ç»“è¯­\næ²¡å•¥å¥½æ€»ç»“çš„äº†ã€‚\n\nç»„ç»‡å†…è€—æ˜¯ä¼ä¸šå‘å±•çš„è‡´å‘½æ€æ‰‹ã€‚\n\né€‰å¯¹äººï¼Œåšå¯¹äº‹ï¼Œæ‹’ç»å†…å·ï¼\n\n\n\næ›´å¤šä¸€æ‰‹è®¯æ¯ï¼Œå¯å…³æ³¨å…¬ä¼—å·ï¼š[ITProHub](https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg)\n\n![ITProHub](https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg)","source":"_posts/organization-internal-loss.md","raw":"---\ntitle: ç»„ç»‡å‘å±•è‡´å‘½æ€æ‰‹ï¼šå†…è€—\ndate: 2024-03-28 17:49:50\ntags: ç»„ç»‡ å†…è€—\n---\n\nå‰æ®µæ—¶é—´å‘è¡¨çš„éƒ½æ˜¯æŠ€æœ¯ç›¸å…³çš„æ–‡ç« ï¼Œä»Šå¤©æ¢æ¢å£å‘³ï¼Œè°ˆä¸€è°ˆæœ€è¿‘å…³äºç»„ç»‡å·¥ä½œä¸Šçš„ä¸€äº›æ€è€ƒã€‚å½“ç„¶ä¹Ÿæ˜¯æ‰¾ä¸ªåœ°æ–¹å‘å‘ç‰¢éªšã€‚ã€‚ã€‚å¯èƒ½å°±æ˜¯æƒ³åˆ°å“ªé‡Œå†™åˆ°å“ªé‡Œ\n![éƒé—·](/images/internal-loss/depressed.jpg)\n\nç›¸ä¿¡å¤§å®¶åœ¨æ­¤ä¹‹å‰ä¹Ÿå¸¸å¸¸å¬è¿‡ä¸€ä¸ªè¯´æ³•â€œåœ¨ç»„ç»‡ç®¡ç†ä¸­ï¼Œäººå°±æ˜¯å…¨éƒ¨ï¼Œäººæ‰ä¹‹ç—›ï¼Œæ˜¯æœ€å¤§çš„ç—›ç‚¹ã€‚â€\n\nä¸€å®¶ä¼ä¸šåœ¨å¢é•¿çš„è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤šé—®é¢˜éƒ½ä¼šè¢«éšè—æˆ–è€…è¯´æ˜¯å¿½ç•¥ã€‚ä½†æ˜¯ä¸€æ—¦ä¸å¢é•¿æˆ–è€…è´Ÿå¢é•¿äº†ï¼Œæ‰€æœ‰é—®é¢˜éƒ½ä¼šæš´éœ²å‡ºæ¥ï¼Œç”šè‡³æ˜¯æˆå€çš„çˆ†å‘ã€‚\n\næ¯«ä¸å¤¸å¼ çš„è¯´ï¼Œ***ç»„ç»‡å†…è€—*** å°±æ˜¯æ¯æ‰ä¸€å®¶ä¼ä¸šæœ€å¿«çš„æ–¹å¼ã€‚\n\n# ç»„ç»‡å†…è€—çš„è¡¨ç°\nä»¥ä¸‹æ˜¯æˆ‘æƒ³åˆ°çš„æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªç‚¹ï¼Œæ’ååˆ†å…ˆåï¼æ›´å¯æ€•çš„æ˜¯ï¼Œè¿™äº›è¡¨ç°ä¸€èˆ¬ä¸ä¼šå•ç‹¬å‡ºç°ï¼Œéƒ½æ˜¯æŠ±å›¢å‡ºç°çš„ã€‚\n## 1. å†…å·ï¼ˆä¸å¥åº·çš„ç«äº‰ï¼‰\n\n åœ¨å›¢é˜Ÿå†…éƒ¨ï¼Œç»„ç»‡å†…è€—ä¸€ä¸ªé‡è¦çš„è¡¨ç°å½¢å¼ï¼šå†…å·ã€‚ å•¥æ˜¯å†…å·ï¼Ÿæ— æ„ä¹‰çš„æ¶ˆè€—ï¼Œå½¢å¼ä¸»ä¹‰éƒ½å¯ä»¥å®šä¹‰ä¸ºå†…å·ã€‚\n\nè¿™å‡ å¹´è¡Œä¸šä¸‹è¡Œï¼Œè€å¤«å°±èŒçš„å…¬å¸ä¹Ÿå‡ºç°äº†ä¸¥é‡çš„ä¸šç»©ä¸‹æ»‘ã€äºæŸã€‚ä¸ºäº†å®ç°â€œé€†åŠ¿å¢é•¿â€ï¼Œå…¬å¸è¦æ±‚æé«˜äººæ•ˆï¼Œäºæ˜¯æå‡ºäº†â€œä»˜å‡º120%çš„åŠªåŠ›â€å£å·ã€‚å¯¹äºé‚£å¤šå‡ºæ¥çš„20%çš„ç†è§£ï¼Œå„äº‹ä¸šéƒ¨çš„ç†è§£éƒ½æ˜¯ä¸€è‡´çš„ï¼Œ\né‚£å°±æ˜¯**åŠ ç­**ã€‚äºæ˜¯ä¹å„éƒ¨é—¨æ€èµ·äº†ä¸€æ³¢åŠ ç­æ½®ï¼Œè¡¨æ¼”å¼çš„åŠ ç­æ½®ã€‚ä¸‹ç­æ—¶é—´æ— è®ºæœ‰æ²¡æœ‰äº‹åæ­£æ˜¯èµ°ä¸äº†çš„ï¼Œèµ°äº†çš„å°±æ˜¯å·¥ä½œé‡é¥±å’Œã€‚ç„¶åå°±è¡ç”Ÿå‡ºäº†å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œâ€œç£¨æ´‹å·¥â€ã€‚æ˜æ˜åŠå¤©èƒ½æå®šçš„éœ€æ±‚ï¼Œç¡¬æ˜¯æ‰˜ç€ä¸€å¤©æ‰è§£å†³ï¼Œæˆ–è€…ç™½å¤©æ‘¸é±¼ï¼ŒåŠ ç­å¹²æ´»ã€‚\n\nå›¢é˜Ÿç®¡ç†ä¹Ÿæ˜¯è¿™æ ·ï¼Œè¿‡åº¦è¿½æ±‚å½¢å¼ä¸»ä¹‰ï¼Œåªæ³¨é‡è¿‡ç¨‹ï¼Œä¸æ³¨é‡ç»“æœã€‚æœ€åå°±æ˜¯äººæ•ˆæ°´å¹³æ›´ä½äº†ï¼Œå‘äº†å‘˜å·¥ï¼Œä¹Ÿå‘äº†ç®¡ç†è€…ã€‚\n\nåŒæ—¶ï¼Œä¸å¥åº·çš„å†…éƒ¨ç«äº‰å¯èƒ½å¯¼è‡´å‘˜å·¥ä¹‹é—´çš„å¯¹æŠ—å’Œä¸åˆä½œï¼Œå½±å“å›¢é˜Ÿåä½œï¼Œäº§ç”Ÿä¸‹é¢ä¼šè¯´åˆ°çš„â€œéƒ¨é—¨éš”é˜‚â€ã€‚\n## 2. ä¿¡ä»»ç¼ºå¤±\nä¸šç»©å¢é•¿çš„æ—¶å€™è¿˜å¥½ï¼Œä¸€æ—¦ä¸šç»©ä¸‹æ»‘ï¼Œæ•´ä¸ªå…¬å¸é™·å…¥äº†ä¸€æ¡çŒœç–‘é“¾ã€‚\n\nè€æ¿æ€€ç–‘ç®¡ç†è€…æ˜¯ä¸æ˜¯èƒ½åŠ›å’ŒèŒä½ä¸åŒ¹é…ï¼Œäºæ˜¯å‡ºå°å„ç§æ”¿ç­–å’Œå˜é©ï¼Œç›‘ç£ç®¡ç†è€…å¥½å¥½å¹²æ´»ã€‚\n\nç®¡ç†è€…æ€€ç–‘å‘˜å·¥ï¼Œæ˜¯ä¸æ˜¯æ¯å¤©ä¸Šç­éƒ½åœ¨æ‘¸é±¼ï¼Œæ··æ—¥å­ã€‚\n\nå‘˜å·¥æ€€ç–‘å…¬å¸ï¼Œå…¬å¸æ˜¯ä¸æ˜¯ä¸è¡Œäº†ï¼Œæˆ‘æ˜¯ä¸æ˜¯è¦è¢«å¼€äº†ï¼Œç¼ºä¹å®‰å…¨æ„Ÿã€‚\n\nä¸€æ—¦ç–‘å¿ƒé“¾å½¢æˆï¼Œå…¬å¸å°±é€‰å…¥äº†ä¸€ç§æ¶æ€§å¾ªç¯ï¼š\n+ è€æ¿ä¸æ•¢æ”¾æƒç®¡ç†è€…ï¼Œé™çº§ä½¿ç”¨ã€‚å„ç§æ±‡æŠ¥ï¼Œæœˆåº¦ã€å­£åº¦ã€åŠå¹´åº¦ã€‚\n+ ç®¡ç†è€…ç”¨åŠ›è¿‡çŒ›ï¼ŒåŠ¨ä½œå˜å½¢ã€‚å¯¹å‘˜å·¥æé™å‹æ¦¨ï¼Œä¸¤ä¸ªäººçš„äº‹æƒ…ä¸€ä¸ªäººå¹²ï¼Œ996æèµ·æ¥ï¼\n\n![996](/images/internal-loss/996.jpg)\n\næˆ‘æ›¾ç»å¬è¿‡è¿™æ ·ä¸€å¥è¯â€œæ€ä¹ˆåˆ¤æ–­ä¸€ä¸ªå…¬å¸å¼€å§‹èµ°ä¸‹å¡è·¯äº†ï¼Ÿçœ‹ä»–æ˜¯ä¸æ˜¯çªç„¶å¼€å§‹æŠ“è€ƒå‹¤äº†â€ã€‚ç¡®å®å¦‚æ­¤ã€‚\nå…¬å¸å¢é•¿çš„æ—¶å€™å„ç§å®£ä¼ å¼¹æ€§å·¥ä½œåˆ¶ï¼Œè¯·å‡åŠå¤©èµ·ï¼Œ2hå°æ—¶ä»¥å†…çš„å‡æœŸä¸éœ€è¦å‘è¯·å‡ç”³è¯·ï¼Œç‰¹æ®Šæƒ…å†µå¯ä»¥ç”³è¯·å±…å®¶åŠå…¬ã€‚\n\nçªç„¶æœ‰ä¸€å¤©è·Ÿä½ è¯´ï¼Œè¿Ÿåˆ°è¦è¯´æ˜åŸå› ï¼Œè¿Ÿåˆ°è¦æ‰£é’±ã€‚è¯·å‡çš„ç³»ç»Ÿæ”¯æŒåˆ°äº†å°æ—¶çº§ï¼ŒåŠ ç­ç”³è¯·å‘˜å·¥æ— æ³•å‘èµ·ï¼Œè¦é¢†å¯¼å‘èµ·ã€‚\n\nè¿™ä¸ªæ—¶å€™å°±èƒ½çŸ¥é“ï¼Œå…¬å¸èµ°ä¸‹å¡è·¯äº†ã€‚è€Œä¸”è€æ¿æ²¡ä»è‡ªèº«æ‰¾åˆ°åŸå› ï¼Œå¼€å§‹ä»å‘˜å·¥èº«ä¸Šæ‰¾åŸå› ï¼Œå‘˜å·¥æ²¡å¥½å¥½å¹²æ´»ï¼\nä»æ„Ÿè°¢å‘˜å·¥çš„ä»˜å‡ºï¼Œåˆ°å‘˜å·¥è¦æ„Ÿè°¢å…¬å¸ç»™çš„å·¥ä½œå²—ä½ã€‚\n\n## 3. éƒ¨é—¨éš”é˜‚\n\nç”±äºå„éƒ¨é—¨ä¸ªå›¢é˜Ÿä¹‹é—´éƒ½æ˜¯ç«äº‰å…³ç³»ã€‚å„éƒ¨é—¨æˆ–å›¢é˜Ÿä¹‹é—´å½¢æˆä¿¡æ¯å­¤å²›ï¼Œç¼ºä¹åˆä½œå’Œå…±äº«èµ„æºçš„æ„æ„¿ï¼Œå¯¼è‡´æ•´ä½“æ•ˆç‡ä½ä¸‹ã€‚\nä¸šç»©ä¸‹æ»‘ï¼Œå„å›¢é˜Ÿä¹‹é—´äº’ç›¸é”…ç”©é”…ã€‚é›†å›¢è¯´é”€å”®èƒ½åŠ›å·®ï¼Œé”€å”®è¯´é¡¹ç›®åƒåœ¾ï¼Œé¡¹ç›®è¯´äº§å“åƒåœ¾ï¼Œäº§å“è¯´å¹³å°åƒåœ¾ã€‚\n\n+ æ²Ÿé€šä¸ç•…ï¼šéƒ¨é—¨ä¹‹é—´æˆ–å›¢é˜Ÿæˆå‘˜ä¹‹é—´çš„æ²Ÿé€šå­˜åœ¨éšœç¢ï¼Œä¿¡æ¯ä¼ é€’ä¸é¡ºç•…ï¼Œå¯¼è‡´è¯¯è§£å’Œå†²çªã€‚\n+ å†³ç­–è¿Ÿç¼“ï¼šå†³ç­–è¿‡ç¨‹ä¸­çš„çŠ¹è±«ä¸å†³ã€æ¨è¯¿è´£ä»»æˆ–è¿‡åº¦åˆ†æå¯¼è‡´æœºä¼šçš„ä¸§å¤±å’Œé¡¹ç›®è¿›åº¦çš„å»¶è¿Ÿã€‚\n+ èµ„æºé‡å¤æˆ–æµªè´¹ï¼šç”±äºç¼ºä¹åè°ƒå’Œè§„åˆ’ï¼Œå¯èƒ½å¯¼è‡´èµ„æºåœ¨ä¸åŒéƒ¨é—¨æˆ–é¡¹ç›®ä¸­é‡å¤æŠ•å…¥æˆ–æœªèƒ½æœ‰æ•ˆåˆ©ç”¨ã€‚\n\n\n# å’‹åŠï¼Ÿ\n<font size=\"2\" color=\"#A9A9A9\">å°½äººäº‹ï¼Œå¬å¤©å‘½ã€‚æ‰“èƒœä»—æ˜¯æœ€å¥½çš„å›¢å»º</font>\n\nä¸‹é¢æ˜¯è€å¤«è‡ªå·±çš„ä¸€ç‚¹yyï¼Œéšä¾¿èƒ¡ä¾ƒã€‚ã€‚ã€‚\n\nå‡å°‘ç»„ç»‡å†…è€—ï¼Œä¹Ÿè¯´ä¸ä¸Šä»€ä¹ˆæªæ–½å§ï¼Œåªèƒ½è¯´è¦åšæŒçš„åŸåˆ™\n\n1. ä»»äººå”¯è´¤ï¼Œç–‘äººä¸ç”¨ï¼Œç”¨äººä¸ç–‘\næ— è®ºæ˜¯å¯¹äºç®¡ç†è€…è¿˜æ˜¯å‘˜å·¥ï¼ŒçŒœç–‘æ˜¯å†…è€—çš„å§‹ä½œä¿‘è€…\n2. åšå¯¹çš„äº‹\né€‰å¯¹äººï¼Œè¿˜è¦åšå¯¹çš„äº‹ã€‚å‰©ä¸‹çš„å°±äº¤ç»™æ—¶é—´å§ã€‚å†µä¸”å‰©ä¸‹çš„å¯èƒ½ä¹Ÿä¸æ˜¯äººåŠ›èƒ½å¤ŸæŠ—è¡¡çš„äº†ã€‚\n\n\n# ç»“è¯­\næ²¡å•¥å¥½æ€»ç»“çš„äº†ã€‚\n\nç»„ç»‡å†…è€—æ˜¯ä¼ä¸šå‘å±•çš„è‡´å‘½æ€æ‰‹ã€‚\n\né€‰å¯¹äººï¼Œåšå¯¹äº‹ï¼Œæ‹’ç»å†…å·ï¼\n\n\n\næ›´å¤šä¸€æ‰‹è®¯æ¯ï¼Œå¯å…³æ³¨å…¬ä¼—å·ï¼š[ITProHub](https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg)\n\n![ITProHub](https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg)","slug":"organization-internal-loss","published":1,"updated":"2024-04-26T03:06:35.957Z","_id":"cluc17m5x0000qsp19fjj1lmy","comments":1,"layout":"post","photos":[],"link":"","content":"<p>å‰æ®µæ—¶é—´å‘è¡¨çš„éƒ½æ˜¯æŠ€æœ¯ç›¸å…³çš„æ–‡ç« ï¼Œä»Šå¤©æ¢æ¢å£å‘³ï¼Œè°ˆä¸€è°ˆæœ€è¿‘å…³äºç»„ç»‡å·¥ä½œä¸Šçš„ä¸€äº›æ€è€ƒã€‚å½“ç„¶ä¹Ÿæ˜¯æ‰¾ä¸ªåœ°æ–¹å‘å‘ç‰¢éªšã€‚ã€‚ã€‚å¯èƒ½å°±æ˜¯æƒ³åˆ°å“ªé‡Œå†™åˆ°å“ªé‡Œ<br><img src=\"/images/internal-loss/depressed.jpg\" alt=\"éƒé—·\"></p>\n<p>ç›¸ä¿¡å¤§å®¶åœ¨æ­¤ä¹‹å‰ä¹Ÿå¸¸å¸¸å¬è¿‡ä¸€ä¸ªè¯´æ³•â€œåœ¨ç»„ç»‡ç®¡ç†ä¸­ï¼Œäººå°±æ˜¯å…¨éƒ¨ï¼Œäººæ‰ä¹‹ç—›ï¼Œæ˜¯æœ€å¤§çš„ç—›ç‚¹ã€‚â€</p>\n<p>ä¸€å®¶ä¼ä¸šåœ¨å¢é•¿çš„è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤šé—®é¢˜éƒ½ä¼šè¢«éšè—æˆ–è€…è¯´æ˜¯å¿½ç•¥ã€‚ä½†æ˜¯ä¸€æ—¦ä¸å¢é•¿æˆ–è€…è´Ÿå¢é•¿äº†ï¼Œæ‰€æœ‰é—®é¢˜éƒ½ä¼šæš´éœ²å‡ºæ¥ï¼Œç”šè‡³æ˜¯æˆå€çš„çˆ†å‘ã€‚</p>\n<p>æ¯«ä¸å¤¸å¼ çš„è¯´ï¼Œ<em><strong>ç»„ç»‡å†…è€—</strong></em> å°±æ˜¯æ¯æ‰ä¸€å®¶ä¼ä¸šæœ€å¿«çš„æ–¹å¼ã€‚</p>\n<h1 id=\"ç»„ç»‡å†…è€—çš„è¡¨ç°\"><a href=\"#ç»„ç»‡å†…è€—çš„è¡¨ç°\" class=\"headerlink\" title=\"ç»„ç»‡å†…è€—çš„è¡¨ç°\"></a>ç»„ç»‡å†…è€—çš„è¡¨ç°</h1><p>ä»¥ä¸‹æ˜¯æˆ‘æƒ³åˆ°çš„æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªç‚¹ï¼Œæ’ååˆ†å…ˆåï¼æ›´å¯æ€•çš„æ˜¯ï¼Œè¿™äº›è¡¨ç°ä¸€èˆ¬ä¸ä¼šå•ç‹¬å‡ºç°ï¼Œéƒ½æ˜¯æŠ±å›¢å‡ºç°çš„ã€‚</p>\n<h2 id=\"1-å†…å·ï¼ˆä¸å¥åº·çš„ç«äº‰ï¼‰\"><a href=\"#1-å†…å·ï¼ˆä¸å¥åº·çš„ç«äº‰ï¼‰\" class=\"headerlink\" title=\"1. å†…å·ï¼ˆä¸å¥åº·çš„ç«äº‰ï¼‰\"></a>1. å†…å·ï¼ˆä¸å¥åº·çš„ç«äº‰ï¼‰</h2><p> åœ¨å›¢é˜Ÿå†…éƒ¨ï¼Œç»„ç»‡å†…è€—ä¸€ä¸ªé‡è¦çš„è¡¨ç°å½¢å¼ï¼šå†…å·ã€‚ å•¥æ˜¯å†…å·ï¼Ÿæ— æ„ä¹‰çš„æ¶ˆè€—ï¼Œå½¢å¼ä¸»ä¹‰éƒ½å¯ä»¥å®šä¹‰ä¸ºå†…å·ã€‚</p>\n<p>è¿™å‡ å¹´è¡Œä¸šä¸‹è¡Œï¼Œè€å¤«å°±èŒçš„å…¬å¸ä¹Ÿå‡ºç°äº†ä¸¥é‡çš„ä¸šç»©ä¸‹æ»‘ã€äºæŸã€‚ä¸ºäº†å®ç°â€œé€†åŠ¿å¢é•¿â€ï¼Œå…¬å¸è¦æ±‚æé«˜äººæ•ˆï¼Œäºæ˜¯æå‡ºäº†â€œä»˜å‡º120%çš„åŠªåŠ›â€å£å·ã€‚å¯¹äºé‚£å¤šå‡ºæ¥çš„20%çš„ç†è§£ï¼Œå„äº‹ä¸šéƒ¨çš„ç†è§£éƒ½æ˜¯ä¸€è‡´çš„ï¼Œ<br>é‚£å°±æ˜¯<strong>åŠ ç­</strong>ã€‚äºæ˜¯ä¹å„éƒ¨é—¨æ€èµ·äº†ä¸€æ³¢åŠ ç­æ½®ï¼Œè¡¨æ¼”å¼çš„åŠ ç­æ½®ã€‚ä¸‹ç­æ—¶é—´æ— è®ºæœ‰æ²¡æœ‰äº‹åæ­£æ˜¯èµ°ä¸äº†çš„ï¼Œèµ°äº†çš„å°±æ˜¯å·¥ä½œé‡é¥±å’Œã€‚ç„¶åå°±è¡ç”Ÿå‡ºäº†å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œâ€œç£¨æ´‹å·¥â€ã€‚æ˜æ˜åŠå¤©èƒ½æå®šçš„éœ€æ±‚ï¼Œç¡¬æ˜¯æ‰˜ç€ä¸€å¤©æ‰è§£å†³ï¼Œæˆ–è€…ç™½å¤©æ‘¸é±¼ï¼ŒåŠ ç­å¹²æ´»ã€‚</p>\n<p>å›¢é˜Ÿç®¡ç†ä¹Ÿæ˜¯è¿™æ ·ï¼Œè¿‡åº¦è¿½æ±‚å½¢å¼ä¸»ä¹‰ï¼Œåªæ³¨é‡è¿‡ç¨‹ï¼Œä¸æ³¨é‡ç»“æœã€‚æœ€åå°±æ˜¯äººæ•ˆæ°´å¹³æ›´ä½äº†ï¼Œå‘äº†å‘˜å·¥ï¼Œä¹Ÿå‘äº†ç®¡ç†è€…ã€‚</p>\n<p>åŒæ—¶ï¼Œä¸å¥åº·çš„å†…éƒ¨ç«äº‰å¯èƒ½å¯¼è‡´å‘˜å·¥ä¹‹é—´çš„å¯¹æŠ—å’Œä¸åˆä½œï¼Œå½±å“å›¢é˜Ÿåä½œï¼Œäº§ç”Ÿä¸‹é¢ä¼šè¯´åˆ°çš„â€œéƒ¨é—¨éš”é˜‚â€ã€‚</p>\n<h2 id=\"2-ä¿¡ä»»ç¼ºå¤±\"><a href=\"#2-ä¿¡ä»»ç¼ºå¤±\" class=\"headerlink\" title=\"2. ä¿¡ä»»ç¼ºå¤±\"></a>2. ä¿¡ä»»ç¼ºå¤±</h2><p>ä¸šç»©å¢é•¿çš„æ—¶å€™è¿˜å¥½ï¼Œä¸€æ—¦ä¸šç»©ä¸‹æ»‘ï¼Œæ•´ä¸ªå…¬å¸é™·å…¥äº†ä¸€æ¡çŒœç–‘é“¾ã€‚</p>\n<p>è€æ¿æ€€ç–‘ç®¡ç†è€…æ˜¯ä¸æ˜¯èƒ½åŠ›å’ŒèŒä½ä¸åŒ¹é…ï¼Œäºæ˜¯å‡ºå°å„ç§æ”¿ç­–å’Œå˜é©ï¼Œç›‘ç£ç®¡ç†è€…å¥½å¥½å¹²æ´»ã€‚</p>\n<p>ç®¡ç†è€…æ€€ç–‘å‘˜å·¥ï¼Œæ˜¯ä¸æ˜¯æ¯å¤©ä¸Šç­éƒ½åœ¨æ‘¸é±¼ï¼Œæ··æ—¥å­ã€‚</p>\n<p>å‘˜å·¥æ€€ç–‘å…¬å¸ï¼Œå…¬å¸æ˜¯ä¸æ˜¯ä¸è¡Œäº†ï¼Œæˆ‘æ˜¯ä¸æ˜¯è¦è¢«å¼€äº†ï¼Œç¼ºä¹å®‰å…¨æ„Ÿã€‚</p>\n<p>ä¸€æ—¦ç–‘å¿ƒé“¾å½¢æˆï¼Œå…¬å¸å°±é€‰å…¥äº†ä¸€ç§æ¶æ€§å¾ªç¯ï¼š</p>\n<ul>\n<li>è€æ¿ä¸æ•¢æ”¾æƒç®¡ç†è€…ï¼Œé™çº§ä½¿ç”¨ã€‚å„ç§æ±‡æŠ¥ï¼Œæœˆåº¦ã€å­£åº¦ã€åŠå¹´åº¦ã€‚</li>\n<li>ç®¡ç†è€…ç”¨åŠ›è¿‡çŒ›ï¼ŒåŠ¨ä½œå˜å½¢ã€‚å¯¹å‘˜å·¥æé™å‹æ¦¨ï¼Œä¸¤ä¸ªäººçš„äº‹æƒ…ä¸€ä¸ªäººå¹²ï¼Œ996æèµ·æ¥ï¼</li>\n</ul>\n<p><img src=\"/images/internal-loss/996.jpg\" alt=\"996\"></p>\n<p>æˆ‘æ›¾ç»å¬è¿‡è¿™æ ·ä¸€å¥è¯â€œæ€ä¹ˆåˆ¤æ–­ä¸€ä¸ªå…¬å¸å¼€å§‹èµ°ä¸‹å¡è·¯äº†ï¼Ÿçœ‹ä»–æ˜¯ä¸æ˜¯çªç„¶å¼€å§‹æŠ“è€ƒå‹¤äº†â€ã€‚ç¡®å®å¦‚æ­¤ã€‚<br>å…¬å¸å¢é•¿çš„æ—¶å€™å„ç§å®£ä¼ å¼¹æ€§å·¥ä½œåˆ¶ï¼Œè¯·å‡åŠå¤©èµ·ï¼Œ2hå°æ—¶ä»¥å†…çš„å‡æœŸä¸éœ€è¦å‘è¯·å‡ç”³è¯·ï¼Œç‰¹æ®Šæƒ…å†µå¯ä»¥ç”³è¯·å±…å®¶åŠå…¬ã€‚</p>\n<p>çªç„¶æœ‰ä¸€å¤©è·Ÿä½ è¯´ï¼Œè¿Ÿåˆ°è¦è¯´æ˜åŸå› ï¼Œè¿Ÿåˆ°è¦æ‰£é’±ã€‚è¯·å‡çš„ç³»ç»Ÿæ”¯æŒåˆ°äº†å°æ—¶çº§ï¼ŒåŠ ç­ç”³è¯·å‘˜å·¥æ— æ³•å‘èµ·ï¼Œè¦é¢†å¯¼å‘èµ·ã€‚</p>\n<p>è¿™ä¸ªæ—¶å€™å°±èƒ½çŸ¥é“ï¼Œå…¬å¸èµ°ä¸‹å¡è·¯äº†ã€‚è€Œä¸”è€æ¿æ²¡ä»è‡ªèº«æ‰¾åˆ°åŸå› ï¼Œå¼€å§‹ä»å‘˜å·¥èº«ä¸Šæ‰¾åŸå› ï¼Œå‘˜å·¥æ²¡å¥½å¥½å¹²æ´»ï¼<br>ä»æ„Ÿè°¢å‘˜å·¥çš„ä»˜å‡ºï¼Œåˆ°å‘˜å·¥è¦æ„Ÿè°¢å…¬å¸ç»™çš„å·¥ä½œå²—ä½ã€‚</p>\n<h2 id=\"3-éƒ¨é—¨éš”é˜‚\"><a href=\"#3-éƒ¨é—¨éš”é˜‚\" class=\"headerlink\" title=\"3. éƒ¨é—¨éš”é˜‚\"></a>3. éƒ¨é—¨éš”é˜‚</h2><p>ç”±äºå„éƒ¨é—¨ä¸ªå›¢é˜Ÿä¹‹é—´éƒ½æ˜¯ç«äº‰å…³ç³»ã€‚å„éƒ¨é—¨æˆ–å›¢é˜Ÿä¹‹é—´å½¢æˆä¿¡æ¯å­¤å²›ï¼Œç¼ºä¹åˆä½œå’Œå…±äº«èµ„æºçš„æ„æ„¿ï¼Œå¯¼è‡´æ•´ä½“æ•ˆç‡ä½ä¸‹ã€‚<br>ä¸šç»©ä¸‹æ»‘ï¼Œå„å›¢é˜Ÿä¹‹é—´äº’ç›¸é”…ç”©é”…ã€‚é›†å›¢è¯´é”€å”®èƒ½åŠ›å·®ï¼Œé”€å”®è¯´é¡¹ç›®åƒåœ¾ï¼Œé¡¹ç›®è¯´äº§å“åƒåœ¾ï¼Œäº§å“è¯´å¹³å°åƒåœ¾ã€‚</p>\n<ul>\n<li>æ²Ÿé€šä¸ç•…ï¼šéƒ¨é—¨ä¹‹é—´æˆ–å›¢é˜Ÿæˆå‘˜ä¹‹é—´çš„æ²Ÿé€šå­˜åœ¨éšœç¢ï¼Œä¿¡æ¯ä¼ é€’ä¸é¡ºç•…ï¼Œå¯¼è‡´è¯¯è§£å’Œå†²çªã€‚</li>\n<li>å†³ç­–è¿Ÿç¼“ï¼šå†³ç­–è¿‡ç¨‹ä¸­çš„çŠ¹è±«ä¸å†³ã€æ¨è¯¿è´£ä»»æˆ–è¿‡åº¦åˆ†æå¯¼è‡´æœºä¼šçš„ä¸§å¤±å’Œé¡¹ç›®è¿›åº¦çš„å»¶è¿Ÿã€‚</li>\n<li>èµ„æºé‡å¤æˆ–æµªè´¹ï¼šç”±äºç¼ºä¹åè°ƒå’Œè§„åˆ’ï¼Œå¯èƒ½å¯¼è‡´èµ„æºåœ¨ä¸åŒéƒ¨é—¨æˆ–é¡¹ç›®ä¸­é‡å¤æŠ•å…¥æˆ–æœªèƒ½æœ‰æ•ˆåˆ©ç”¨ã€‚</li>\n</ul>\n<h1 id=\"å’‹åŠï¼Ÿ\"><a href=\"#å’‹åŠï¼Ÿ\" class=\"headerlink\" title=\"å’‹åŠï¼Ÿ\"></a>å’‹åŠï¼Ÿ</h1><p><font size=\"2\" color=\"#A9A9A9\">å°½äººäº‹ï¼Œå¬å¤©å‘½ã€‚æ‰“èƒœä»—æ˜¯æœ€å¥½çš„å›¢å»º</font></p>\n<p>ä¸‹é¢æ˜¯è€å¤«è‡ªå·±çš„ä¸€ç‚¹yyï¼Œéšä¾¿èƒ¡ä¾ƒã€‚ã€‚ã€‚</p>\n<p>å‡å°‘ç»„ç»‡å†…è€—ï¼Œä¹Ÿè¯´ä¸ä¸Šä»€ä¹ˆæªæ–½å§ï¼Œåªèƒ½è¯´è¦åšæŒçš„åŸåˆ™</p>\n<ol>\n<li>ä»»äººå”¯è´¤ï¼Œç–‘äººä¸ç”¨ï¼Œç”¨äººä¸ç–‘<br>æ— è®ºæ˜¯å¯¹äºç®¡ç†è€…è¿˜æ˜¯å‘˜å·¥ï¼ŒçŒœç–‘æ˜¯å†…è€—çš„å§‹ä½œä¿‘è€…</li>\n<li>åšå¯¹çš„äº‹<br>é€‰å¯¹äººï¼Œè¿˜è¦åšå¯¹çš„äº‹ã€‚å‰©ä¸‹çš„å°±äº¤ç»™æ—¶é—´å§ã€‚å†µä¸”å‰©ä¸‹çš„å¯èƒ½ä¹Ÿä¸æ˜¯äººåŠ›èƒ½å¤ŸæŠ—è¡¡çš„äº†ã€‚</li>\n</ol>\n<h1 id=\"ç»“è¯­\"><a href=\"#ç»“è¯­\" class=\"headerlink\" title=\"ç»“è¯­\"></a>ç»“è¯­</h1><p>æ²¡å•¥å¥½æ€»ç»“çš„äº†ã€‚</p>\n<p>ç»„ç»‡å†…è€—æ˜¯ä¼ä¸šå‘å±•çš„è‡´å‘½æ€æ‰‹ã€‚</p>\n<p>é€‰å¯¹äººï¼Œåšå¯¹äº‹ï¼Œæ‹’ç»å†…å·ï¼</p>\n<p>æ›´å¤šä¸€æ‰‹è®¯æ¯ï¼Œå¯å…³æ³¨å…¬ä¼—å·ï¼š<a href=\"https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg\">ITProHub</a></p>\n<p><img src=\"https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg\" alt=\"ITProHub\"></p>\n","site":{"data":{}},"excerpt":"","more":"<p>å‰æ®µæ—¶é—´å‘è¡¨çš„éƒ½æ˜¯æŠ€æœ¯ç›¸å…³çš„æ–‡ç« ï¼Œä»Šå¤©æ¢æ¢å£å‘³ï¼Œè°ˆä¸€è°ˆæœ€è¿‘å…³äºç»„ç»‡å·¥ä½œä¸Šçš„ä¸€äº›æ€è€ƒã€‚å½“ç„¶ä¹Ÿæ˜¯æ‰¾ä¸ªåœ°æ–¹å‘å‘ç‰¢éªšã€‚ã€‚ã€‚å¯èƒ½å°±æ˜¯æƒ³åˆ°å“ªé‡Œå†™åˆ°å“ªé‡Œ<br><img src=\"/images/internal-loss/depressed.jpg\" alt=\"éƒé—·\"></p>\n<p>ç›¸ä¿¡å¤§å®¶åœ¨æ­¤ä¹‹å‰ä¹Ÿå¸¸å¸¸å¬è¿‡ä¸€ä¸ªè¯´æ³•â€œåœ¨ç»„ç»‡ç®¡ç†ä¸­ï¼Œäººå°±æ˜¯å…¨éƒ¨ï¼Œäººæ‰ä¹‹ç—›ï¼Œæ˜¯æœ€å¤§çš„ç—›ç‚¹ã€‚â€</p>\n<p>ä¸€å®¶ä¼ä¸šåœ¨å¢é•¿çš„è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤šé—®é¢˜éƒ½ä¼šè¢«éšè—æˆ–è€…è¯´æ˜¯å¿½ç•¥ã€‚ä½†æ˜¯ä¸€æ—¦ä¸å¢é•¿æˆ–è€…è´Ÿå¢é•¿äº†ï¼Œæ‰€æœ‰é—®é¢˜éƒ½ä¼šæš´éœ²å‡ºæ¥ï¼Œç”šè‡³æ˜¯æˆå€çš„çˆ†å‘ã€‚</p>\n<p>æ¯«ä¸å¤¸å¼ çš„è¯´ï¼Œ<em><strong>ç»„ç»‡å†…è€—</strong></em> å°±æ˜¯æ¯æ‰ä¸€å®¶ä¼ä¸šæœ€å¿«çš„æ–¹å¼ã€‚</p>\n<h1 id=\"ç»„ç»‡å†…è€—çš„è¡¨ç°\"><a href=\"#ç»„ç»‡å†…è€—çš„è¡¨ç°\" class=\"headerlink\" title=\"ç»„ç»‡å†…è€—çš„è¡¨ç°\"></a>ç»„ç»‡å†…è€—çš„è¡¨ç°</h1><p>ä»¥ä¸‹æ˜¯æˆ‘æƒ³åˆ°çš„æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªç‚¹ï¼Œæ’ååˆ†å…ˆåï¼æ›´å¯æ€•çš„æ˜¯ï¼Œè¿™äº›è¡¨ç°ä¸€èˆ¬ä¸ä¼šå•ç‹¬å‡ºç°ï¼Œéƒ½æ˜¯æŠ±å›¢å‡ºç°çš„ã€‚</p>\n<h2 id=\"1-å†…å·ï¼ˆä¸å¥åº·çš„ç«äº‰ï¼‰\"><a href=\"#1-å†…å·ï¼ˆä¸å¥åº·çš„ç«äº‰ï¼‰\" class=\"headerlink\" title=\"1. å†…å·ï¼ˆä¸å¥åº·çš„ç«äº‰ï¼‰\"></a>1. å†…å·ï¼ˆä¸å¥åº·çš„ç«äº‰ï¼‰</h2><p> åœ¨å›¢é˜Ÿå†…éƒ¨ï¼Œç»„ç»‡å†…è€—ä¸€ä¸ªé‡è¦çš„è¡¨ç°å½¢å¼ï¼šå†…å·ã€‚ å•¥æ˜¯å†…å·ï¼Ÿæ— æ„ä¹‰çš„æ¶ˆè€—ï¼Œå½¢å¼ä¸»ä¹‰éƒ½å¯ä»¥å®šä¹‰ä¸ºå†…å·ã€‚</p>\n<p>è¿™å‡ å¹´è¡Œä¸šä¸‹è¡Œï¼Œè€å¤«å°±èŒçš„å…¬å¸ä¹Ÿå‡ºç°äº†ä¸¥é‡çš„ä¸šç»©ä¸‹æ»‘ã€äºæŸã€‚ä¸ºäº†å®ç°â€œé€†åŠ¿å¢é•¿â€ï¼Œå…¬å¸è¦æ±‚æé«˜äººæ•ˆï¼Œäºæ˜¯æå‡ºäº†â€œä»˜å‡º120%çš„åŠªåŠ›â€å£å·ã€‚å¯¹äºé‚£å¤šå‡ºæ¥çš„20%çš„ç†è§£ï¼Œå„äº‹ä¸šéƒ¨çš„ç†è§£éƒ½æ˜¯ä¸€è‡´çš„ï¼Œ<br>é‚£å°±æ˜¯<strong>åŠ ç­</strong>ã€‚äºæ˜¯ä¹å„éƒ¨é—¨æ€èµ·äº†ä¸€æ³¢åŠ ç­æ½®ï¼Œè¡¨æ¼”å¼çš„åŠ ç­æ½®ã€‚ä¸‹ç­æ—¶é—´æ— è®ºæœ‰æ²¡æœ‰äº‹åæ­£æ˜¯èµ°ä¸äº†çš„ï¼Œèµ°äº†çš„å°±æ˜¯å·¥ä½œé‡é¥±å’Œã€‚ç„¶åå°±è¡ç”Ÿå‡ºäº†å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œâ€œç£¨æ´‹å·¥â€ã€‚æ˜æ˜åŠå¤©èƒ½æå®šçš„éœ€æ±‚ï¼Œç¡¬æ˜¯æ‰˜ç€ä¸€å¤©æ‰è§£å†³ï¼Œæˆ–è€…ç™½å¤©æ‘¸é±¼ï¼ŒåŠ ç­å¹²æ´»ã€‚</p>\n<p>å›¢é˜Ÿç®¡ç†ä¹Ÿæ˜¯è¿™æ ·ï¼Œè¿‡åº¦è¿½æ±‚å½¢å¼ä¸»ä¹‰ï¼Œåªæ³¨é‡è¿‡ç¨‹ï¼Œä¸æ³¨é‡ç»“æœã€‚æœ€åå°±æ˜¯äººæ•ˆæ°´å¹³æ›´ä½äº†ï¼Œå‘äº†å‘˜å·¥ï¼Œä¹Ÿå‘äº†ç®¡ç†è€…ã€‚</p>\n<p>åŒæ—¶ï¼Œä¸å¥åº·çš„å†…éƒ¨ç«äº‰å¯èƒ½å¯¼è‡´å‘˜å·¥ä¹‹é—´çš„å¯¹æŠ—å’Œä¸åˆä½œï¼Œå½±å“å›¢é˜Ÿåä½œï¼Œäº§ç”Ÿä¸‹é¢ä¼šè¯´åˆ°çš„â€œéƒ¨é—¨éš”é˜‚â€ã€‚</p>\n<h2 id=\"2-ä¿¡ä»»ç¼ºå¤±\"><a href=\"#2-ä¿¡ä»»ç¼ºå¤±\" class=\"headerlink\" title=\"2. ä¿¡ä»»ç¼ºå¤±\"></a>2. ä¿¡ä»»ç¼ºå¤±</h2><p>ä¸šç»©å¢é•¿çš„æ—¶å€™è¿˜å¥½ï¼Œä¸€æ—¦ä¸šç»©ä¸‹æ»‘ï¼Œæ•´ä¸ªå…¬å¸é™·å…¥äº†ä¸€æ¡çŒœç–‘é“¾ã€‚</p>\n<p>è€æ¿æ€€ç–‘ç®¡ç†è€…æ˜¯ä¸æ˜¯èƒ½åŠ›å’ŒèŒä½ä¸åŒ¹é…ï¼Œäºæ˜¯å‡ºå°å„ç§æ”¿ç­–å’Œå˜é©ï¼Œç›‘ç£ç®¡ç†è€…å¥½å¥½å¹²æ´»ã€‚</p>\n<p>ç®¡ç†è€…æ€€ç–‘å‘˜å·¥ï¼Œæ˜¯ä¸æ˜¯æ¯å¤©ä¸Šç­éƒ½åœ¨æ‘¸é±¼ï¼Œæ··æ—¥å­ã€‚</p>\n<p>å‘˜å·¥æ€€ç–‘å…¬å¸ï¼Œå…¬å¸æ˜¯ä¸æ˜¯ä¸è¡Œäº†ï¼Œæˆ‘æ˜¯ä¸æ˜¯è¦è¢«å¼€äº†ï¼Œç¼ºä¹å®‰å…¨æ„Ÿã€‚</p>\n<p>ä¸€æ—¦ç–‘å¿ƒé“¾å½¢æˆï¼Œå…¬å¸å°±é€‰å…¥äº†ä¸€ç§æ¶æ€§å¾ªç¯ï¼š</p>\n<ul>\n<li>è€æ¿ä¸æ•¢æ”¾æƒç®¡ç†è€…ï¼Œé™çº§ä½¿ç”¨ã€‚å„ç§æ±‡æŠ¥ï¼Œæœˆåº¦ã€å­£åº¦ã€åŠå¹´åº¦ã€‚</li>\n<li>ç®¡ç†è€…ç”¨åŠ›è¿‡çŒ›ï¼ŒåŠ¨ä½œå˜å½¢ã€‚å¯¹å‘˜å·¥æé™å‹æ¦¨ï¼Œä¸¤ä¸ªäººçš„äº‹æƒ…ä¸€ä¸ªäººå¹²ï¼Œ996æèµ·æ¥ï¼</li>\n</ul>\n<p><img src=\"/images/internal-loss/996.jpg\" alt=\"996\"></p>\n<p>æˆ‘æ›¾ç»å¬è¿‡è¿™æ ·ä¸€å¥è¯â€œæ€ä¹ˆåˆ¤æ–­ä¸€ä¸ªå…¬å¸å¼€å§‹èµ°ä¸‹å¡è·¯äº†ï¼Ÿçœ‹ä»–æ˜¯ä¸æ˜¯çªç„¶å¼€å§‹æŠ“è€ƒå‹¤äº†â€ã€‚ç¡®å®å¦‚æ­¤ã€‚<br>å…¬å¸å¢é•¿çš„æ—¶å€™å„ç§å®£ä¼ å¼¹æ€§å·¥ä½œåˆ¶ï¼Œè¯·å‡åŠå¤©èµ·ï¼Œ2hå°æ—¶ä»¥å†…çš„å‡æœŸä¸éœ€è¦å‘è¯·å‡ç”³è¯·ï¼Œç‰¹æ®Šæƒ…å†µå¯ä»¥ç”³è¯·å±…å®¶åŠå…¬ã€‚</p>\n<p>çªç„¶æœ‰ä¸€å¤©è·Ÿä½ è¯´ï¼Œè¿Ÿåˆ°è¦è¯´æ˜åŸå› ï¼Œè¿Ÿåˆ°è¦æ‰£é’±ã€‚è¯·å‡çš„ç³»ç»Ÿæ”¯æŒåˆ°äº†å°æ—¶çº§ï¼ŒåŠ ç­ç”³è¯·å‘˜å·¥æ— æ³•å‘èµ·ï¼Œè¦é¢†å¯¼å‘èµ·ã€‚</p>\n<p>è¿™ä¸ªæ—¶å€™å°±èƒ½çŸ¥é“ï¼Œå…¬å¸èµ°ä¸‹å¡è·¯äº†ã€‚è€Œä¸”è€æ¿æ²¡ä»è‡ªèº«æ‰¾åˆ°åŸå› ï¼Œå¼€å§‹ä»å‘˜å·¥èº«ä¸Šæ‰¾åŸå› ï¼Œå‘˜å·¥æ²¡å¥½å¥½å¹²æ´»ï¼<br>ä»æ„Ÿè°¢å‘˜å·¥çš„ä»˜å‡ºï¼Œåˆ°å‘˜å·¥è¦æ„Ÿè°¢å…¬å¸ç»™çš„å·¥ä½œå²—ä½ã€‚</p>\n<h2 id=\"3-éƒ¨é—¨éš”é˜‚\"><a href=\"#3-éƒ¨é—¨éš”é˜‚\" class=\"headerlink\" title=\"3. éƒ¨é—¨éš”é˜‚\"></a>3. éƒ¨é—¨éš”é˜‚</h2><p>ç”±äºå„éƒ¨é—¨ä¸ªå›¢é˜Ÿä¹‹é—´éƒ½æ˜¯ç«äº‰å…³ç³»ã€‚å„éƒ¨é—¨æˆ–å›¢é˜Ÿä¹‹é—´å½¢æˆä¿¡æ¯å­¤å²›ï¼Œç¼ºä¹åˆä½œå’Œå…±äº«èµ„æºçš„æ„æ„¿ï¼Œå¯¼è‡´æ•´ä½“æ•ˆç‡ä½ä¸‹ã€‚<br>ä¸šç»©ä¸‹æ»‘ï¼Œå„å›¢é˜Ÿä¹‹é—´äº’ç›¸é”…ç”©é”…ã€‚é›†å›¢è¯´é”€å”®èƒ½åŠ›å·®ï¼Œé”€å”®è¯´é¡¹ç›®åƒåœ¾ï¼Œé¡¹ç›®è¯´äº§å“åƒåœ¾ï¼Œäº§å“è¯´å¹³å°åƒåœ¾ã€‚</p>\n<ul>\n<li>æ²Ÿé€šä¸ç•…ï¼šéƒ¨é—¨ä¹‹é—´æˆ–å›¢é˜Ÿæˆå‘˜ä¹‹é—´çš„æ²Ÿé€šå­˜åœ¨éšœç¢ï¼Œä¿¡æ¯ä¼ é€’ä¸é¡ºç•…ï¼Œå¯¼è‡´è¯¯è§£å’Œå†²çªã€‚</li>\n<li>å†³ç­–è¿Ÿç¼“ï¼šå†³ç­–è¿‡ç¨‹ä¸­çš„çŠ¹è±«ä¸å†³ã€æ¨è¯¿è´£ä»»æˆ–è¿‡åº¦åˆ†æå¯¼è‡´æœºä¼šçš„ä¸§å¤±å’Œé¡¹ç›®è¿›åº¦çš„å»¶è¿Ÿã€‚</li>\n<li>èµ„æºé‡å¤æˆ–æµªè´¹ï¼šç”±äºç¼ºä¹åè°ƒå’Œè§„åˆ’ï¼Œå¯èƒ½å¯¼è‡´èµ„æºåœ¨ä¸åŒéƒ¨é—¨æˆ–é¡¹ç›®ä¸­é‡å¤æŠ•å…¥æˆ–æœªèƒ½æœ‰æ•ˆåˆ©ç”¨ã€‚</li>\n</ul>\n<h1 id=\"å’‹åŠï¼Ÿ\"><a href=\"#å’‹åŠï¼Ÿ\" class=\"headerlink\" title=\"å’‹åŠï¼Ÿ\"></a>å’‹åŠï¼Ÿ</h1><p><font size=\"2\" color=\"#A9A9A9\">å°½äººäº‹ï¼Œå¬å¤©å‘½ã€‚æ‰“èƒœä»—æ˜¯æœ€å¥½çš„å›¢å»º</font></p>\n<p>ä¸‹é¢æ˜¯è€å¤«è‡ªå·±çš„ä¸€ç‚¹yyï¼Œéšä¾¿èƒ¡ä¾ƒã€‚ã€‚ã€‚</p>\n<p>å‡å°‘ç»„ç»‡å†…è€—ï¼Œä¹Ÿè¯´ä¸ä¸Šä»€ä¹ˆæªæ–½å§ï¼Œåªèƒ½è¯´è¦åšæŒçš„åŸåˆ™</p>\n<ol>\n<li>ä»»äººå”¯è´¤ï¼Œç–‘äººä¸ç”¨ï¼Œç”¨äººä¸ç–‘<br>æ— è®ºæ˜¯å¯¹äºç®¡ç†è€…è¿˜æ˜¯å‘˜å·¥ï¼ŒçŒœç–‘æ˜¯å†…è€—çš„å§‹ä½œä¿‘è€…</li>\n<li>åšå¯¹çš„äº‹<br>é€‰å¯¹äººï¼Œè¿˜è¦åšå¯¹çš„äº‹ã€‚å‰©ä¸‹çš„å°±äº¤ç»™æ—¶é—´å§ã€‚å†µä¸”å‰©ä¸‹çš„å¯èƒ½ä¹Ÿä¸æ˜¯äººåŠ›èƒ½å¤ŸæŠ—è¡¡çš„äº†ã€‚</li>\n</ol>\n<h1 id=\"ç»“è¯­\"><a href=\"#ç»“è¯­\" class=\"headerlink\" title=\"ç»“è¯­\"></a>ç»“è¯­</h1><p>æ²¡å•¥å¥½æ€»ç»“çš„äº†ã€‚</p>\n<p>ç»„ç»‡å†…è€—æ˜¯ä¼ä¸šå‘å±•çš„è‡´å‘½æ€æ‰‹ã€‚</p>\n<p>é€‰å¯¹äººï¼Œåšå¯¹äº‹ï¼Œæ‹’ç»å†…å·ï¼</p>\n<p>æ›´å¤šä¸€æ‰‹è®¯æ¯ï¼Œå¯å…³æ³¨å…¬ä¼—å·ï¼š<a href=\"https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg\">ITProHub</a></p>\n<p><img src=\"https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg\" alt=\"ITProHub\"></p>\n"},{"title":"Garnetï¼Œç¼“å­˜çš„æ–°é€‰æ‹©ï¼","date":"2024-04-07T07:24:24.000Z","_content":"\nå·å¤–å·å¤–ï¼\n1. redisä¸å†â€œå¼€æºâ€ï¼›\n2. å¾®è½¯å¼€æºäº†Garnet\n\n#  ä»€ä¹ˆæ˜¯Garnetï¼Ÿ\nGarnetæ˜¯å¾®è½¯æ¨å‡ºçš„ä¸€æ¬¾è¿œç¨‹ç¼“å­˜å­˜å‚¨ç³»ç»Ÿï¼Œæ—¨åœ¨ä¸ºå¼€å‘è€…æä¾›é«˜æ€§èƒ½ã€å¯é æ€§å’Œå¯ä¼¸ç¼©æ€§çš„ç¼“å­˜è§£å†³æ–¹æ¡ˆã€‚å®ƒé‡‡ç”¨äº†ç°ä»£åŒ–çš„æ¶æ„å’ŒæŠ€æœ¯ï¼Œå…·æœ‰é«˜åº¦å¯å®šåˆ¶æ€§å’Œçµæ´»æ€§ï¼Œé€‚ç”¨äºå„ç§è§„æ¨¡å’Œç±»å‹çš„åº”ç”¨åœºæ™¯ã€‚\n\n# ç‰¹æ€§å’Œä¼˜åŠ¿\n1. é«˜æ€§èƒ½\n\n   &nbsp; Garneté‡‡ç”¨äº†é«˜æ•ˆçš„ç¼“å­˜ç®—æ³•å’Œæ•°æ®ç»“æ„ï¼Œä»¥å®ç°å¿«é€Ÿçš„æ•°æ®è®¿é—®å’Œå“åº”ã€‚å®ƒæ”¯æŒå¹¶å‘è®¿é—®å’Œé«˜ååé‡ï¼Œèƒ½å¤Ÿå¤„ç†å¤§è§„æ¨¡çš„è¯·æ±‚æµé‡ã€‚\n  Garneté€šè¿‡æ™ºèƒ½ç¼“å­˜ç­–ç•¥ï¼Œå°†çƒ­ç‚¹æ•°æ®ï¼ˆç»å¸¸è®¿é—®çš„æ•°æ®ï¼‰å­˜å‚¨åœ¨ç”¨æˆ·é™„è¿‘çš„èŠ‚ç‚¹ä¸Šï¼Œä»è€Œå‡å°‘äº†æ•°æ®ä¼ è¾“çš„æ—¶é—´å’Œè·ç¦»ï¼Œå®ç°äº†ä½å»¶è¿Ÿè®¿é—®ã€‚\n\n2. å¯é æ€§\n\n   &nbsp; Garnetå…·æœ‰å¼ºå¤§çš„æ•°æ®ä¿æŠ¤å’Œå®¹é”™æœºåˆ¶ï¼Œèƒ½å¤Ÿç¡®ä¿æ•°æ®çš„æŒä¹…æ€§å’Œä¸€è‡´æ€§ã€‚å®ƒæ”¯æŒæ•°æ®å¤‡ä»½ã€å¤åˆ¶å’Œæ•…éšœè½¬ç§»ï¼Œæœ‰æ•ˆåœ°é™ä½äº†æ•°æ®ä¸¢å¤±å’Œç³»ç»Ÿæ•…éšœçš„é£é™©ã€‚\n\n3. å¯æ‰©å±•æ€§\n\n   &nbsp; Garnetçš„æ¶æ„è®¾è®¡å…·æœ‰è‰¯å¥½çš„æ°´å¹³æ‰©å±•æ€§ï¼Œå¯ä»¥è½»æ¾åœ°æ‰©å±•åˆ°æ•°ç™¾ç”šè‡³æ•°åƒå°æœåŠ¡å™¨ã€‚å®ƒæ”¯æŒåŠ¨æ€æ·»åŠ å’Œç§»é™¤èŠ‚ç‚¹ï¼Œèƒ½å¤Ÿæ ¹æ®éœ€æ±‚çµæ´»è°ƒæ•´é›†ç¾¤è§„æ¨¡ã€‚\n\n4. å¤šç§æ•°æ®ç±»å‹æ”¯æŒï¼š\n\n   &nbsp; é™¤äº†å¸¸è§„çš„é”®å€¼å¯¹å­˜å‚¨ä¹‹å¤–ï¼ŒGarnetè¿˜æ”¯æŒå¤šç§æ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬åˆ—è¡¨ã€é›†åˆã€å“ˆå¸Œè¡¨ç­‰ï¼Œæ»¡è¶³äº†ä¸åŒåº”ç”¨åœºæ™¯çš„éœ€æ±‚ã€‚\n\n5. ä¸°å¯Œçš„åŠŸèƒ½\n\n   &nbsp; Garnetæä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½å’Œå·¥å…·ï¼ŒåŒ…æ‹¬ç›‘æ§ã€è°ƒä¼˜ã€æ•…éšœæ’é™¤ç­‰ï¼Œå¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°ç®¡ç†å’Œè¿ç»´ç¼“å­˜ç³»ç»Ÿã€‚\n\n# é«˜æ€§èƒ½\nå¯¹äºä¸€ä¸ªä¸­é—´ä»¶æ¥è¯´ï¼Œå¤§å®¶æœ€å…³å¿ƒçš„åº”è¯¥å°±æ˜¯æ€§èƒ½åˆ°åº•æ€ä¹ˆæ ·ï¼ŸåŸºå‡†æµ‹è¯•çš„ç»“æœï¼Œæ€»ä½“è¿˜æ˜¯è¡¨ç°ä¸é”™çš„ã€‚\n\nå…·ä½“æ€§èƒ½æµ‹è¯•è¯¦æƒ…å¯ä»¥æŸ¥çœ‹é“¾æ¥ï¼š [Evaluating Garnet's Performance Benefits](https://microsoft.github.io/garnet/docs/benchmarking/results-resp-bench)\n\nå®é™…åº”ç”¨çš„è¿‡ç¨‹ä¸­æ•ˆæœåˆ°åº•å’‹æ ·å½“ç„¶è¿˜éœ€è¦æˆ‘ä»¬åœ¨é€šè¿‡ä»£ç æ¥éªŒè¯ä¸€ä¸‹ã€‚\n\nä¸‹é¢æˆ‘å†™äº†ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œç›´æ¥å¾ªç¯å¾€garnetå’Œredisé‡Œé¢å†™å…¥å’Œè¯»å–æ•°æ®ã€‚é€šè¿‡è®¡ç®—æ—¶é—´æ¥å¯¹æ¯”ä¸€ä¸‹ä¸¤è€…çš„å·®è·åˆ°åº•æœ‰å¤šå¤§\n```C#\n[HttpGet]\n[ActionTitle(Name = \"æµ‹è¯•Garnet\")]\n[Route(\"test.svc\")]\npublic void Start()\n{\n    // Redis connection\n    var redis = ConnectionMultiplexer.Connect(\"localhost\");\n    var redisDb = redis.GetDatabase();\n\n    // Garnet connection\n    var garnet = new GarnetClient(\"localhost\", 3278);\n\n    // Test data\n    string key = \"test_key\";\n    string value = \"test_value\";\n\n    // Test with Redis\n   var redisStartTime = DateTime.Now;\n   for( int i = 0; i < 1000; i++ ) {\n       redisDb.StringSet(key + i, value + i);\n   }\n   var redisEndTime = DateTime.Now;\n   Console.WriteLine($\"StringSet Time taken by Redis: {(redisEndTime - redisStartTime).TotalMilliseconds} ms\");\n   \n   // Test with Garnet\n   var garnetStartTime = DateTime.Now;\n   for( int i = 0; i < 1000; i++ ) {\n       garnet.StringSet(key + i, value + i, null);\n   }\n   var garnetEndTime = DateTime.Now;\n   Console.WriteLine($\"StringSet Time taken by Garnet: {(garnetEndTime - garnetStartTime).TotalMilliseconds} ms\");\n   \n   // Test with Redis\n   redisStartTime = DateTime.Now;\n   for( int i = 0; i < 1000; i++ ) {\n       string a = redisDb.StringGet(key + i).ToString();\n   }\n   redisEndTime = DateTime.Now;\n   Console.WriteLine($\"StringGet Time taken by Redis: {(redisEndTime - redisStartTime).TotalMilliseconds} ms\");\n   \n   // Test with Garnet\n   garnetStartTime = DateTime.Now;\n   for( int i = 0; i < 1000; i++ ) {\n       garnet.StringGet(key + i, null);\n   }\n   garnetEndTime = DateTime.Now;\n   Console.WriteLine($\"StringGet Time taken by Garnet: {(garnetEndTime - garnetStartTime).TotalMilliseconds} ms\");\n}\n```\næœ€åè¿è¡Œçš„ç»“æœè¿˜æ˜¯æŒºæŒ¯å¥‹äººå¿ƒçš„!\n\n![è¿è¡Œç»“æœ1](/images/garnet/compare1.png)\n\n# å…¼å®¹æ€§\nå½“ç„¶åœ¨è¿›è¡Œä¸­é—´ä»¶é€‰æ‹©çš„æ—¶å€™ï¼Œåˆ‡æ¢çš„æˆæœ¬ä¹Ÿæ˜¯é‡ç‚¹è¦çº³å…¥è€ƒè™‘çš„ã€‚â€œç™½å«–ä¸€æ—¶çˆ½ï¼Œé‡æ„ç«è‘¬åœºï¼â€è¿™ç§äº‹æƒ…æ˜¾ç„¶æ˜¯æˆ‘ä»¬ä¸æ„¿æ„çœ‹åˆ°çš„ã€‚\n\nè¿™ä¸ªæ—¶å€™æˆ‘ä»¬åœ¨å®˜ç½‘çœ‹åˆ°è¿™æ ·ä¸€å¥è¯\n> Garnet å¹¶ä¸æ˜¯è¦æˆä¸º Redis 100% å®Œç¾çš„æ›¿ä»£å“ï¼Œè€Œæ˜¯åº”è¯¥å°†å…¶è§†ä¸ºä¸€ä¸ªè¶³å¤Ÿæ¥è¿‘çš„èµ·ç‚¹ï¼Œä»¥ç¡®ä¿å¯¹æ‚¨é‡è¦çš„åŠŸèƒ½çš„å…¼å®¹æ€§ã€‚ Garnet ç¡®å®å¯ä»¥åœ¨æœªç»ä¿®æ”¹çš„æƒ…å†µä¸‹ä¸è®¸å¤š Redis å®¢æˆ·ç«¯ä¸€èµ·ä½¿ç”¨ï¼ˆæˆ‘ä»¬ç‰¹åˆ«å¯¹ Garnet è¿›è¡Œäº†StackExchange.Rediså¾ˆå¥½çš„æµ‹è¯•ï¼‰ï¼Œå› æ­¤å…¥é—¨éå¸¸å®¹æ˜“ã€‚\n\näºæ˜¯ï¼Œæˆ‘ä»¬å†æ•´ä¸ªdemo\n```C#\n[HttpGet]\n[ActionTitle(Name = \"æµ‹è¯•Garnetè¿æ¥\")]\n[Route(\"connect.svc\")]\npublic void Connect()\n{\n    // Redis connection\n    var redis = ConnectionMultiplexer.Connect(\"localhost\");\n    var redisDb = redis.GetDatabase();\n\n    // Garnet connection\n    var garnet = ConnectionMultiplexer.Connect(\"localhost:3278\");\n    var garnetDb = garnet.GetDatabase();\n\n    // Test data\n    string key = \"test_key\";\n\n    // Test with Redis\n    string a = redisDb.StringGet(key + 1).ToString();\n    Console.WriteLine($\"StringGet by Redis : {a}\");\n\n    // Test with Garnet\n    string b = garnetDb.StringGet(key + 1).ToString();\n    Console.WriteLine($\"StringGet by Garnet : {b}\");\n}\n```\nå¾®è½¯ è¯šä¸æˆ‘æ¬ºï¼\n\nåœ¨ä¸åŠ¨å®¢æˆ·ç«¯ä»£ç çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬èƒ½å¤Ÿéå¸¸å¹³æ»‘çš„åˆ‡æ¢åˆ°Garnet\n![connect](/images/garnet/connect.png)\n\nredisæ¡Œé¢å®¢æˆ·ç«¯ä¹Ÿèƒ½ç›´æ¥è¿æ¥Garnet\n![client](/images/garnet/client.png)\n\n\n# æ—¥å¿—å’Œè¯Šæ–­\nGarnet æä¾›äº†ä¸°å¯Œçš„æ—¥å¿—å’Œè¯Šæ–­ç‰¹æ€§ï¼Œä»¥å¸®åŠ©å¼€å‘äººå‘˜ç›‘è§†å’Œè°ƒè¯•å…¶åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œè¡Œä¸ºã€‚ä»¥ä¸‹æ˜¯ Garnet æ—¥å¿—å’Œè¯Šæ–­ç‰¹æ€§çš„ä¸»è¦å†…å®¹ï¼š\n\n1. è¯¦ç»†æ—¥å¿—è®°å½•ï¼šGarnet å…·æœ‰çµæ´»çš„æ—¥å¿—è®°å½•åŠŸèƒ½ï¼Œå¯ä»¥è®°å½•å„ç§çº§åˆ«çš„æ—¥å¿—æ¶ˆæ¯ï¼ŒåŒ…æ‹¬ä¿¡æ¯ã€è­¦å‘Šå’Œé”™è¯¯ã€‚è¿™äº›æ—¥å¿—æ¶ˆæ¯å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜äº†è§£ç³»ç»Ÿçš„è¿è¡Œæƒ…å†µï¼Œè¯†åˆ«æ½œåœ¨çš„é—®é¢˜å¹¶è¿›è¡Œæ•…éšœæ’é™¤ã€‚\n\n2. æ€§èƒ½æŒ‡æ ‡ï¼šGarnet è¿˜æä¾›äº†ä¸°å¯Œçš„æ€§èƒ½æŒ‡æ ‡ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜ç›‘è§†ç³»ç»Ÿçš„æ€§èƒ½çŠ¶å†µã€‚è¿™äº›æŒ‡æ ‡å¯ä»¥åŒ…æ‹¬å„ç§å…³é”®æ€§èƒ½æŒ‡æ ‡ï¼Œå¦‚è¯·æ±‚å“åº”æ—¶é—´ã€ååé‡ã€å»¶è¿Ÿç­‰ã€‚\n\n3. å¼‚å¸¸è·Ÿè¸ªï¼šGarnet å…·æœ‰å¼‚å¸¸è·Ÿè¸ªåŠŸèƒ½ï¼Œå¯ä»¥æ•è·å’Œè®°å½•åº”ç”¨ç¨‹åºä¸­çš„å¼‚å¸¸æƒ…å†µã€‚è¿™äº›å¼‚å¸¸è·Ÿè¸ªä¿¡æ¯å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜å¿«é€Ÿå®šä½å’Œä¿®å¤é—®é¢˜ã€‚\n\n4. è¯Šæ–­å·¥å…·ï¼šGarnet è¿˜æä¾›äº†ä¸€ç³»åˆ—è¯Šæ–­å·¥å…·ï¼Œç”¨äºåˆ†æå’Œè°ƒè¯•ç³»ç»Ÿçš„è¡Œä¸ºã€‚è¿™äº›å·¥å…·å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ·±å…¥äº†è§£ç³»ç»Ÿçš„å†…éƒ¨å·¥ä½œåŸç†ï¼Œå¹¶è¯†åˆ«æ½œåœ¨çš„æ€§èƒ½ç“¶é¢ˆå’Œé—®é¢˜ã€‚\n\n```C#\nstatic void Main(string[] args)\n{\n    try\n    {\n\n        var loggerFactory = LoggerFactory.Create(x =>\n        {\n            x.ClearProviders();\n            x.SetMinimumLevel(LogLevel.Trace);\n            x.AddZLoggerConsole(options =>\n            {\n                options.UsePlainTextFormatter(formatter =>\n                {\n                    formatter.SetPrefixFormatter($\"[{0}]\", (in MessageTemplate template, in LogInfo info) => template.Format(info.Category));\n                });\n            });\n        });\n\n\n        using var server = new GarnetServer(args, loggerFactory);\n\n        // Optional: register custom extensions\n        RegisterExtensions(server);\n\n        // Start the server\n        server.Start();\n\n        Thread.Sleep(Timeout.Infinite);\n    }\n    catch (Exception ex)\n    {\n        Console.WriteLine($\"Unable to initialize server due to exception: {ex.Message}\");\n    }\n}\n```\n![æ—¥å¿—](/images/garnet/log.png)\n\n\n\n# è‡ªå®šä¹‰å‘½ä»¤\næƒ³è¦åœ¨ Redis ä¸Šæ‰§è¡Œä¸€äº›å¤æ‚çš„æ‰§è¡Œæ˜¯å¾ˆå¸¸è§çš„ï¼Œåœ¨ Redis çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿‡å»å¸¸å¸¸ä½¿ç”¨ Lua è„šæœ¬æ¥å¤„ç†å®ƒï¼Œä½†ä½¿ç”¨ Garnetï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ C# ä¸­å®ç°å’Œåˆå¹¶è‡ªå®šä¹‰å‘½ä»¤ã€‚ å¦‚æœä½ ä¸çŸ¥é“ LUA æ˜¯å¦åœ¨æ€§èƒ½æ–¹é¢ï¼Œæˆ–è€…å¦‚æœä½ æƒ³åšä¸€äº› LUA åšä¸åˆ°çš„ç›¸å½“å¤æ‚çš„äº‹æƒ…ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒè€Œä¸ä¼šæœ‰ä»»ä½•æ€§èƒ½åŠ£åŠ¿ã€‚ æ›´å¥½çš„æ˜¯ï¼ŒæœåŠ¡å™¨ç«¯æä¾›çš„æ‰©å±•å‘½ä»¤éµå¾ª RESPï¼Œå› æ­¤å®¢æˆ·ç«¯å¯ä»¥ä» PHP æˆ– Go è°ƒç”¨å®ƒä»¬ï¼Œè€Œä¸ä»…ä»…æ˜¯é’ˆå¯¹ C#ã€‚\n\nå› æ­¤ï¼Œè®©æˆ‘ä»¬ç«‹å³åˆ›å»ºä¸€ä¸ªåä¸ºâ€œTESTâ€çš„è‡ªå®šä¹‰å‘½ä»¤ã€‚å‘½ä»¤å¾ˆç®€å•ï¼Œç›´æ¥è¿”å›ä¸€ä¸ªâ€œHello Garnet!â€\n\næ³¨å†Œè‡ªå®šä¹‰å‘½ä»¤æœ¬èº«éå¸¸ç®€å•ï¼Œåªéœ€æ·»åŠ ä¸€ä¸ªå®ç°çš„ç±»ï¼Œæˆ–è€…ä¸å‘½ä»¤åç§°ä¸€èµ·æ·»åŠ å³å¯ã€‚\n\n```Garnet Server\n// æµ‹è¯•è‡ªå®šä¹‰å‘½ä»¤\nserver.Register.NewTransactionProc(\"TEST\", 0, () => new TestCustomCommand());\n\n\nsealed class TestCustomCommand : CustomTransactionProcedure\n{\n    /// <summary>\n    /// No transactional phase, skip Prepare\n    /// </summary>\n    public override bool Prepare<TGarnetReadApi>(TGarnetReadApi api, ArgSlice input)\n        => false;\n\n    /// <summary>\n    /// Main will not be called because Prepare returns false\n    /// </summary>\n    public override void Main<TGarnetApi>(TGarnetApi api, ArgSlice input, ref MemoryResult<byte> output)\n        => throw new InvalidOperationException();\n\n    /// <summary>\n    /// Finalize reads two keys (non-transactionally) and return their values as an array of bulk strings\n    /// </summary>\n    public override void Finalize<TGarnetApi>(TGarnetApi api, ArgSlice input, ref MemoryResult<byte> output)\n    {\n        // Return the two keys as an array of bulk strings\n        WriteSimpleString(ref output, \"Hello Garnet!\");\n    }\n}\n\n```\n\nåŒæ—¶è¿˜æ˜¯å› ä¸ºGarnetéµå¾ª RESPï¼Œå› æ­¤å®¢æˆ·ç«¯ä¸æ˜¯ä¸“ç”¨äº C#ï¼Œä¹Ÿä¸æ˜¯ Garnet å®¢æˆ·ç«¯ç‹¬æœ‰çš„ã€‚ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨rediså®¢æˆ·ç«¯è°ƒç”¨Garnetçš„è‡ªå®šä¹‰å‘½ä»¤\n```Garnet client\n [HttpGet]\n [ActionTitle(Name = \"æµ‹è¯•Garnet è‡ªå®šä¹‰å‘½ä»¤\")]\n [Route(\"custom-command.svc\")]\n public async void Test()\n {       \n     // Garnet connection\n     var garnet = new GarnetClient(\"localhost\", 3278);\n     garnet.Connect();\n     // Test data\n     string result = await garnet.ExecuteForStringResultAsync(\"TEST\");\n\n     Console.WriteLine($\"Garnet Custom Command Result: {result}\");\n\n     // é‡‡ç”¨rediså®¢æˆ·ç«¯è¿æ¥\n     var client = ConnectionMultiplexer.Connect(\"localhost:3278\");\n     var db = client.GetDatabase();\n\n     RedisResult redisResult = db.Execute(\"TEST\");\n\n     Console.WriteLine($\"Redis Client Custom Command Result: {((string?)redisResult)}\");\n }\n```\næœ€åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç”¨ä¸¤ç§å®¢æˆ·ç«¯æ‰§è¡Œè‡ªå®šä¹‰å‘½ä»¤éƒ½è¾“å‡ºäº†åŒæ ·çš„ç»“æœ\n![custom command result](/images/garnet/custom-command.png)\n\n# ç»“è¯­\nGarnetä½œä¸ºå¾®è½¯æœ€æ–°æ¨å‡ºçš„è¿œç¨‹ç¼“å­˜å­˜å‚¨ç³»ç»Ÿï¼Œä¸ºå¼€å‘è€…æä¾›äº†ä¸€ç§å…¨æ–°çš„é€‰æ‹©ã€‚å®ƒå…·æœ‰é«˜æ€§èƒ½ã€å¯é æ€§å’Œå¯ä¼¸ç¼©æ€§çš„ç‰¹æ€§ï¼Œé€‚ç”¨äºå„ç§è§„æ¨¡å’Œç±»å‹çš„åº”ç”¨åœºæ™¯ã€‚é€šè¿‡ä½¿ç”¨Garnetï¼Œå¼€å‘è€…å¯ä»¥æ›´å¥½åœ°æå‡åº”ç”¨çš„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒï¼Œå®ç°ä¸šåŠ¡çš„å¿«é€Ÿå‘å±•å’ŒæŒç»­åˆ›æ–°ã€‚\n\n# å‚è€ƒæ–‡æ¡£\n+ [Garnet å¼€å‘å…¥é—¨](https://microsoft.github.io/garnet/docs)\n\n\n\næ›´å¤šä¸€æ‰‹è®¯æ¯ï¼Œå¯å…³æ³¨å…¬ä¼—å·ï¼š[ITProHub](https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg)\n\n![ITProHub](https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg)","source":"_posts/garnet.md","raw":"---\ntitle: Garnetï¼Œç¼“å­˜çš„æ–°é€‰æ‹©ï¼\ndate: 2024-04-07 15:24:24\ntags: Garnet ç¼“å­˜ å¾®è½¯\n---\n\nå·å¤–å·å¤–ï¼\n1. redisä¸å†â€œå¼€æºâ€ï¼›\n2. å¾®è½¯å¼€æºäº†Garnet\n\n#  ä»€ä¹ˆæ˜¯Garnetï¼Ÿ\nGarnetæ˜¯å¾®è½¯æ¨å‡ºçš„ä¸€æ¬¾è¿œç¨‹ç¼“å­˜å­˜å‚¨ç³»ç»Ÿï¼Œæ—¨åœ¨ä¸ºå¼€å‘è€…æä¾›é«˜æ€§èƒ½ã€å¯é æ€§å’Œå¯ä¼¸ç¼©æ€§çš„ç¼“å­˜è§£å†³æ–¹æ¡ˆã€‚å®ƒé‡‡ç”¨äº†ç°ä»£åŒ–çš„æ¶æ„å’ŒæŠ€æœ¯ï¼Œå…·æœ‰é«˜åº¦å¯å®šåˆ¶æ€§å’Œçµæ´»æ€§ï¼Œé€‚ç”¨äºå„ç§è§„æ¨¡å’Œç±»å‹çš„åº”ç”¨åœºæ™¯ã€‚\n\n# ç‰¹æ€§å’Œä¼˜åŠ¿\n1. é«˜æ€§èƒ½\n\n   &nbsp; Garneté‡‡ç”¨äº†é«˜æ•ˆçš„ç¼“å­˜ç®—æ³•å’Œæ•°æ®ç»“æ„ï¼Œä»¥å®ç°å¿«é€Ÿçš„æ•°æ®è®¿é—®å’Œå“åº”ã€‚å®ƒæ”¯æŒå¹¶å‘è®¿é—®å’Œé«˜ååé‡ï¼Œèƒ½å¤Ÿå¤„ç†å¤§è§„æ¨¡çš„è¯·æ±‚æµé‡ã€‚\n  Garneté€šè¿‡æ™ºèƒ½ç¼“å­˜ç­–ç•¥ï¼Œå°†çƒ­ç‚¹æ•°æ®ï¼ˆç»å¸¸è®¿é—®çš„æ•°æ®ï¼‰å­˜å‚¨åœ¨ç”¨æˆ·é™„è¿‘çš„èŠ‚ç‚¹ä¸Šï¼Œä»è€Œå‡å°‘äº†æ•°æ®ä¼ è¾“çš„æ—¶é—´å’Œè·ç¦»ï¼Œå®ç°äº†ä½å»¶è¿Ÿè®¿é—®ã€‚\n\n2. å¯é æ€§\n\n   &nbsp; Garnetå…·æœ‰å¼ºå¤§çš„æ•°æ®ä¿æŠ¤å’Œå®¹é”™æœºåˆ¶ï¼Œèƒ½å¤Ÿç¡®ä¿æ•°æ®çš„æŒä¹…æ€§å’Œä¸€è‡´æ€§ã€‚å®ƒæ”¯æŒæ•°æ®å¤‡ä»½ã€å¤åˆ¶å’Œæ•…éšœè½¬ç§»ï¼Œæœ‰æ•ˆåœ°é™ä½äº†æ•°æ®ä¸¢å¤±å’Œç³»ç»Ÿæ•…éšœçš„é£é™©ã€‚\n\n3. å¯æ‰©å±•æ€§\n\n   &nbsp; Garnetçš„æ¶æ„è®¾è®¡å…·æœ‰è‰¯å¥½çš„æ°´å¹³æ‰©å±•æ€§ï¼Œå¯ä»¥è½»æ¾åœ°æ‰©å±•åˆ°æ•°ç™¾ç”šè‡³æ•°åƒå°æœåŠ¡å™¨ã€‚å®ƒæ”¯æŒåŠ¨æ€æ·»åŠ å’Œç§»é™¤èŠ‚ç‚¹ï¼Œèƒ½å¤Ÿæ ¹æ®éœ€æ±‚çµæ´»è°ƒæ•´é›†ç¾¤è§„æ¨¡ã€‚\n\n4. å¤šç§æ•°æ®ç±»å‹æ”¯æŒï¼š\n\n   &nbsp; é™¤äº†å¸¸è§„çš„é”®å€¼å¯¹å­˜å‚¨ä¹‹å¤–ï¼ŒGarnetè¿˜æ”¯æŒå¤šç§æ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬åˆ—è¡¨ã€é›†åˆã€å“ˆå¸Œè¡¨ç­‰ï¼Œæ»¡è¶³äº†ä¸åŒåº”ç”¨åœºæ™¯çš„éœ€æ±‚ã€‚\n\n5. ä¸°å¯Œçš„åŠŸèƒ½\n\n   &nbsp; Garnetæä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½å’Œå·¥å…·ï¼ŒåŒ…æ‹¬ç›‘æ§ã€è°ƒä¼˜ã€æ•…éšœæ’é™¤ç­‰ï¼Œå¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°ç®¡ç†å’Œè¿ç»´ç¼“å­˜ç³»ç»Ÿã€‚\n\n# é«˜æ€§èƒ½\nå¯¹äºä¸€ä¸ªä¸­é—´ä»¶æ¥è¯´ï¼Œå¤§å®¶æœ€å…³å¿ƒçš„åº”è¯¥å°±æ˜¯æ€§èƒ½åˆ°åº•æ€ä¹ˆæ ·ï¼ŸåŸºå‡†æµ‹è¯•çš„ç»“æœï¼Œæ€»ä½“è¿˜æ˜¯è¡¨ç°ä¸é”™çš„ã€‚\n\nå…·ä½“æ€§èƒ½æµ‹è¯•è¯¦æƒ…å¯ä»¥æŸ¥çœ‹é“¾æ¥ï¼š [Evaluating Garnet's Performance Benefits](https://microsoft.github.io/garnet/docs/benchmarking/results-resp-bench)\n\nå®é™…åº”ç”¨çš„è¿‡ç¨‹ä¸­æ•ˆæœåˆ°åº•å’‹æ ·å½“ç„¶è¿˜éœ€è¦æˆ‘ä»¬åœ¨é€šè¿‡ä»£ç æ¥éªŒè¯ä¸€ä¸‹ã€‚\n\nä¸‹é¢æˆ‘å†™äº†ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œç›´æ¥å¾ªç¯å¾€garnetå’Œredisé‡Œé¢å†™å…¥å’Œè¯»å–æ•°æ®ã€‚é€šè¿‡è®¡ç®—æ—¶é—´æ¥å¯¹æ¯”ä¸€ä¸‹ä¸¤è€…çš„å·®è·åˆ°åº•æœ‰å¤šå¤§\n```C#\n[HttpGet]\n[ActionTitle(Name = \"æµ‹è¯•Garnet\")]\n[Route(\"test.svc\")]\npublic void Start()\n{\n    // Redis connection\n    var redis = ConnectionMultiplexer.Connect(\"localhost\");\n    var redisDb = redis.GetDatabase();\n\n    // Garnet connection\n    var garnet = new GarnetClient(\"localhost\", 3278);\n\n    // Test data\n    string key = \"test_key\";\n    string value = \"test_value\";\n\n    // Test with Redis\n   var redisStartTime = DateTime.Now;\n   for( int i = 0; i < 1000; i++ ) {\n       redisDb.StringSet(key + i, value + i);\n   }\n   var redisEndTime = DateTime.Now;\n   Console.WriteLine($\"StringSet Time taken by Redis: {(redisEndTime - redisStartTime).TotalMilliseconds} ms\");\n   \n   // Test with Garnet\n   var garnetStartTime = DateTime.Now;\n   for( int i = 0; i < 1000; i++ ) {\n       garnet.StringSet(key + i, value + i, null);\n   }\n   var garnetEndTime = DateTime.Now;\n   Console.WriteLine($\"StringSet Time taken by Garnet: {(garnetEndTime - garnetStartTime).TotalMilliseconds} ms\");\n   \n   // Test with Redis\n   redisStartTime = DateTime.Now;\n   for( int i = 0; i < 1000; i++ ) {\n       string a = redisDb.StringGet(key + i).ToString();\n   }\n   redisEndTime = DateTime.Now;\n   Console.WriteLine($\"StringGet Time taken by Redis: {(redisEndTime - redisStartTime).TotalMilliseconds} ms\");\n   \n   // Test with Garnet\n   garnetStartTime = DateTime.Now;\n   for( int i = 0; i < 1000; i++ ) {\n       garnet.StringGet(key + i, null);\n   }\n   garnetEndTime = DateTime.Now;\n   Console.WriteLine($\"StringGet Time taken by Garnet: {(garnetEndTime - garnetStartTime).TotalMilliseconds} ms\");\n}\n```\næœ€åè¿è¡Œçš„ç»“æœè¿˜æ˜¯æŒºæŒ¯å¥‹äººå¿ƒçš„!\n\n![è¿è¡Œç»“æœ1](/images/garnet/compare1.png)\n\n# å…¼å®¹æ€§\nå½“ç„¶åœ¨è¿›è¡Œä¸­é—´ä»¶é€‰æ‹©çš„æ—¶å€™ï¼Œåˆ‡æ¢çš„æˆæœ¬ä¹Ÿæ˜¯é‡ç‚¹è¦çº³å…¥è€ƒè™‘çš„ã€‚â€œç™½å«–ä¸€æ—¶çˆ½ï¼Œé‡æ„ç«è‘¬åœºï¼â€è¿™ç§äº‹æƒ…æ˜¾ç„¶æ˜¯æˆ‘ä»¬ä¸æ„¿æ„çœ‹åˆ°çš„ã€‚\n\nè¿™ä¸ªæ—¶å€™æˆ‘ä»¬åœ¨å®˜ç½‘çœ‹åˆ°è¿™æ ·ä¸€å¥è¯\n> Garnet å¹¶ä¸æ˜¯è¦æˆä¸º Redis 100% å®Œç¾çš„æ›¿ä»£å“ï¼Œè€Œæ˜¯åº”è¯¥å°†å…¶è§†ä¸ºä¸€ä¸ªè¶³å¤Ÿæ¥è¿‘çš„èµ·ç‚¹ï¼Œä»¥ç¡®ä¿å¯¹æ‚¨é‡è¦çš„åŠŸèƒ½çš„å…¼å®¹æ€§ã€‚ Garnet ç¡®å®å¯ä»¥åœ¨æœªç»ä¿®æ”¹çš„æƒ…å†µä¸‹ä¸è®¸å¤š Redis å®¢æˆ·ç«¯ä¸€èµ·ä½¿ç”¨ï¼ˆæˆ‘ä»¬ç‰¹åˆ«å¯¹ Garnet è¿›è¡Œäº†StackExchange.Rediså¾ˆå¥½çš„æµ‹è¯•ï¼‰ï¼Œå› æ­¤å…¥é—¨éå¸¸å®¹æ˜“ã€‚\n\näºæ˜¯ï¼Œæˆ‘ä»¬å†æ•´ä¸ªdemo\n```C#\n[HttpGet]\n[ActionTitle(Name = \"æµ‹è¯•Garnetè¿æ¥\")]\n[Route(\"connect.svc\")]\npublic void Connect()\n{\n    // Redis connection\n    var redis = ConnectionMultiplexer.Connect(\"localhost\");\n    var redisDb = redis.GetDatabase();\n\n    // Garnet connection\n    var garnet = ConnectionMultiplexer.Connect(\"localhost:3278\");\n    var garnetDb = garnet.GetDatabase();\n\n    // Test data\n    string key = \"test_key\";\n\n    // Test with Redis\n    string a = redisDb.StringGet(key + 1).ToString();\n    Console.WriteLine($\"StringGet by Redis : {a}\");\n\n    // Test with Garnet\n    string b = garnetDb.StringGet(key + 1).ToString();\n    Console.WriteLine($\"StringGet by Garnet : {b}\");\n}\n```\nå¾®è½¯ è¯šä¸æˆ‘æ¬ºï¼\n\nåœ¨ä¸åŠ¨å®¢æˆ·ç«¯ä»£ç çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬èƒ½å¤Ÿéå¸¸å¹³æ»‘çš„åˆ‡æ¢åˆ°Garnet\n![connect](/images/garnet/connect.png)\n\nredisæ¡Œé¢å®¢æˆ·ç«¯ä¹Ÿèƒ½ç›´æ¥è¿æ¥Garnet\n![client](/images/garnet/client.png)\n\n\n# æ—¥å¿—å’Œè¯Šæ–­\nGarnet æä¾›äº†ä¸°å¯Œçš„æ—¥å¿—å’Œè¯Šæ–­ç‰¹æ€§ï¼Œä»¥å¸®åŠ©å¼€å‘äººå‘˜ç›‘è§†å’Œè°ƒè¯•å…¶åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œè¡Œä¸ºã€‚ä»¥ä¸‹æ˜¯ Garnet æ—¥å¿—å’Œè¯Šæ–­ç‰¹æ€§çš„ä¸»è¦å†…å®¹ï¼š\n\n1. è¯¦ç»†æ—¥å¿—è®°å½•ï¼šGarnet å…·æœ‰çµæ´»çš„æ—¥å¿—è®°å½•åŠŸèƒ½ï¼Œå¯ä»¥è®°å½•å„ç§çº§åˆ«çš„æ—¥å¿—æ¶ˆæ¯ï¼ŒåŒ…æ‹¬ä¿¡æ¯ã€è­¦å‘Šå’Œé”™è¯¯ã€‚è¿™äº›æ—¥å¿—æ¶ˆæ¯å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜äº†è§£ç³»ç»Ÿçš„è¿è¡Œæƒ…å†µï¼Œè¯†åˆ«æ½œåœ¨çš„é—®é¢˜å¹¶è¿›è¡Œæ•…éšœæ’é™¤ã€‚\n\n2. æ€§èƒ½æŒ‡æ ‡ï¼šGarnet è¿˜æä¾›äº†ä¸°å¯Œçš„æ€§èƒ½æŒ‡æ ‡ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜ç›‘è§†ç³»ç»Ÿçš„æ€§èƒ½çŠ¶å†µã€‚è¿™äº›æŒ‡æ ‡å¯ä»¥åŒ…æ‹¬å„ç§å…³é”®æ€§èƒ½æŒ‡æ ‡ï¼Œå¦‚è¯·æ±‚å“åº”æ—¶é—´ã€ååé‡ã€å»¶è¿Ÿç­‰ã€‚\n\n3. å¼‚å¸¸è·Ÿè¸ªï¼šGarnet å…·æœ‰å¼‚å¸¸è·Ÿè¸ªåŠŸèƒ½ï¼Œå¯ä»¥æ•è·å’Œè®°å½•åº”ç”¨ç¨‹åºä¸­çš„å¼‚å¸¸æƒ…å†µã€‚è¿™äº›å¼‚å¸¸è·Ÿè¸ªä¿¡æ¯å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜å¿«é€Ÿå®šä½å’Œä¿®å¤é—®é¢˜ã€‚\n\n4. è¯Šæ–­å·¥å…·ï¼šGarnet è¿˜æä¾›äº†ä¸€ç³»åˆ—è¯Šæ–­å·¥å…·ï¼Œç”¨äºåˆ†æå’Œè°ƒè¯•ç³»ç»Ÿçš„è¡Œä¸ºã€‚è¿™äº›å·¥å…·å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ·±å…¥äº†è§£ç³»ç»Ÿçš„å†…éƒ¨å·¥ä½œåŸç†ï¼Œå¹¶è¯†åˆ«æ½œåœ¨çš„æ€§èƒ½ç“¶é¢ˆå’Œé—®é¢˜ã€‚\n\n```C#\nstatic void Main(string[] args)\n{\n    try\n    {\n\n        var loggerFactory = LoggerFactory.Create(x =>\n        {\n            x.ClearProviders();\n            x.SetMinimumLevel(LogLevel.Trace);\n            x.AddZLoggerConsole(options =>\n            {\n                options.UsePlainTextFormatter(formatter =>\n                {\n                    formatter.SetPrefixFormatter($\"[{0}]\", (in MessageTemplate template, in LogInfo info) => template.Format(info.Category));\n                });\n            });\n        });\n\n\n        using var server = new GarnetServer(args, loggerFactory);\n\n        // Optional: register custom extensions\n        RegisterExtensions(server);\n\n        // Start the server\n        server.Start();\n\n        Thread.Sleep(Timeout.Infinite);\n    }\n    catch (Exception ex)\n    {\n        Console.WriteLine($\"Unable to initialize server due to exception: {ex.Message}\");\n    }\n}\n```\n![æ—¥å¿—](/images/garnet/log.png)\n\n\n\n# è‡ªå®šä¹‰å‘½ä»¤\næƒ³è¦åœ¨ Redis ä¸Šæ‰§è¡Œä¸€äº›å¤æ‚çš„æ‰§è¡Œæ˜¯å¾ˆå¸¸è§çš„ï¼Œåœ¨ Redis çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿‡å»å¸¸å¸¸ä½¿ç”¨ Lua è„šæœ¬æ¥å¤„ç†å®ƒï¼Œä½†ä½¿ç”¨ Garnetï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ C# ä¸­å®ç°å’Œåˆå¹¶è‡ªå®šä¹‰å‘½ä»¤ã€‚ å¦‚æœä½ ä¸çŸ¥é“ LUA æ˜¯å¦åœ¨æ€§èƒ½æ–¹é¢ï¼Œæˆ–è€…å¦‚æœä½ æƒ³åšä¸€äº› LUA åšä¸åˆ°çš„ç›¸å½“å¤æ‚çš„äº‹æƒ…ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒè€Œä¸ä¼šæœ‰ä»»ä½•æ€§èƒ½åŠ£åŠ¿ã€‚ æ›´å¥½çš„æ˜¯ï¼ŒæœåŠ¡å™¨ç«¯æä¾›çš„æ‰©å±•å‘½ä»¤éµå¾ª RESPï¼Œå› æ­¤å®¢æˆ·ç«¯å¯ä»¥ä» PHP æˆ– Go è°ƒç”¨å®ƒä»¬ï¼Œè€Œä¸ä»…ä»…æ˜¯é’ˆå¯¹ C#ã€‚\n\nå› æ­¤ï¼Œè®©æˆ‘ä»¬ç«‹å³åˆ›å»ºä¸€ä¸ªåä¸ºâ€œTESTâ€çš„è‡ªå®šä¹‰å‘½ä»¤ã€‚å‘½ä»¤å¾ˆç®€å•ï¼Œç›´æ¥è¿”å›ä¸€ä¸ªâ€œHello Garnet!â€\n\næ³¨å†Œè‡ªå®šä¹‰å‘½ä»¤æœ¬èº«éå¸¸ç®€å•ï¼Œåªéœ€æ·»åŠ ä¸€ä¸ªå®ç°çš„ç±»ï¼Œæˆ–è€…ä¸å‘½ä»¤åç§°ä¸€èµ·æ·»åŠ å³å¯ã€‚\n\n```Garnet Server\n// æµ‹è¯•è‡ªå®šä¹‰å‘½ä»¤\nserver.Register.NewTransactionProc(\"TEST\", 0, () => new TestCustomCommand());\n\n\nsealed class TestCustomCommand : CustomTransactionProcedure\n{\n    /// <summary>\n    /// No transactional phase, skip Prepare\n    /// </summary>\n    public override bool Prepare<TGarnetReadApi>(TGarnetReadApi api, ArgSlice input)\n        => false;\n\n    /// <summary>\n    /// Main will not be called because Prepare returns false\n    /// </summary>\n    public override void Main<TGarnetApi>(TGarnetApi api, ArgSlice input, ref MemoryResult<byte> output)\n        => throw new InvalidOperationException();\n\n    /// <summary>\n    /// Finalize reads two keys (non-transactionally) and return their values as an array of bulk strings\n    /// </summary>\n    public override void Finalize<TGarnetApi>(TGarnetApi api, ArgSlice input, ref MemoryResult<byte> output)\n    {\n        // Return the two keys as an array of bulk strings\n        WriteSimpleString(ref output, \"Hello Garnet!\");\n    }\n}\n\n```\n\nåŒæ—¶è¿˜æ˜¯å› ä¸ºGarnetéµå¾ª RESPï¼Œå› æ­¤å®¢æˆ·ç«¯ä¸æ˜¯ä¸“ç”¨äº C#ï¼Œä¹Ÿä¸æ˜¯ Garnet å®¢æˆ·ç«¯ç‹¬æœ‰çš„ã€‚ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨rediså®¢æˆ·ç«¯è°ƒç”¨Garnetçš„è‡ªå®šä¹‰å‘½ä»¤\n```Garnet client\n [HttpGet]\n [ActionTitle(Name = \"æµ‹è¯•Garnet è‡ªå®šä¹‰å‘½ä»¤\")]\n [Route(\"custom-command.svc\")]\n public async void Test()\n {       \n     // Garnet connection\n     var garnet = new GarnetClient(\"localhost\", 3278);\n     garnet.Connect();\n     // Test data\n     string result = await garnet.ExecuteForStringResultAsync(\"TEST\");\n\n     Console.WriteLine($\"Garnet Custom Command Result: {result}\");\n\n     // é‡‡ç”¨rediså®¢æˆ·ç«¯è¿æ¥\n     var client = ConnectionMultiplexer.Connect(\"localhost:3278\");\n     var db = client.GetDatabase();\n\n     RedisResult redisResult = db.Execute(\"TEST\");\n\n     Console.WriteLine($\"Redis Client Custom Command Result: {((string?)redisResult)}\");\n }\n```\næœ€åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç”¨ä¸¤ç§å®¢æˆ·ç«¯æ‰§è¡Œè‡ªå®šä¹‰å‘½ä»¤éƒ½è¾“å‡ºäº†åŒæ ·çš„ç»“æœ\n![custom command result](/images/garnet/custom-command.png)\n\n# ç»“è¯­\nGarnetä½œä¸ºå¾®è½¯æœ€æ–°æ¨å‡ºçš„è¿œç¨‹ç¼“å­˜å­˜å‚¨ç³»ç»Ÿï¼Œä¸ºå¼€å‘è€…æä¾›äº†ä¸€ç§å…¨æ–°çš„é€‰æ‹©ã€‚å®ƒå…·æœ‰é«˜æ€§èƒ½ã€å¯é æ€§å’Œå¯ä¼¸ç¼©æ€§çš„ç‰¹æ€§ï¼Œé€‚ç”¨äºå„ç§è§„æ¨¡å’Œç±»å‹çš„åº”ç”¨åœºæ™¯ã€‚é€šè¿‡ä½¿ç”¨Garnetï¼Œå¼€å‘è€…å¯ä»¥æ›´å¥½åœ°æå‡åº”ç”¨çš„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒï¼Œå®ç°ä¸šåŠ¡çš„å¿«é€Ÿå‘å±•å’ŒæŒç»­åˆ›æ–°ã€‚\n\n# å‚è€ƒæ–‡æ¡£\n+ [Garnet å¼€å‘å…¥é—¨](https://microsoft.github.io/garnet/docs)\n\n\n\næ›´å¤šä¸€æ‰‹è®¯æ¯ï¼Œå¯å…³æ³¨å…¬ä¼—å·ï¼š[ITProHub](https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg)\n\n![ITProHub](https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg)","slug":"garnet","published":1,"updated":"2024-04-26T03:07:22.478Z","_id":"clup9vupa0000okp14bz96eiy","comments":1,"layout":"post","photos":[],"link":"","content":"<p>å·å¤–å·å¤–ï¼</p>\n<ol>\n<li>redisä¸å†â€œå¼€æºâ€ï¼›</li>\n<li>å¾®è½¯å¼€æºäº†Garnet</li>\n</ol>\n<h1 id=\"ä»€ä¹ˆæ˜¯Garnetï¼Ÿ\"><a href=\"#ä»€ä¹ˆæ˜¯Garnetï¼Ÿ\" class=\"headerlink\" title=\"ä»€ä¹ˆæ˜¯Garnetï¼Ÿ\"></a>ä»€ä¹ˆæ˜¯Garnetï¼Ÿ</h1><p>Garnetæ˜¯å¾®è½¯æ¨å‡ºçš„ä¸€æ¬¾è¿œç¨‹ç¼“å­˜å­˜å‚¨ç³»ç»Ÿï¼Œæ—¨åœ¨ä¸ºå¼€å‘è€…æä¾›é«˜æ€§èƒ½ã€å¯é æ€§å’Œå¯ä¼¸ç¼©æ€§çš„ç¼“å­˜è§£å†³æ–¹æ¡ˆã€‚å®ƒé‡‡ç”¨äº†ç°ä»£åŒ–çš„æ¶æ„å’ŒæŠ€æœ¯ï¼Œå…·æœ‰é«˜åº¦å¯å®šåˆ¶æ€§å’Œçµæ´»æ€§ï¼Œé€‚ç”¨äºå„ç§è§„æ¨¡å’Œç±»å‹çš„åº”ç”¨åœºæ™¯ã€‚</p>\n<h1 id=\"ç‰¹æ€§å’Œä¼˜åŠ¿\"><a href=\"#ç‰¹æ€§å’Œä¼˜åŠ¿\" class=\"headerlink\" title=\"ç‰¹æ€§å’Œä¼˜åŠ¿\"></a>ç‰¹æ€§å’Œä¼˜åŠ¿</h1><ol>\n<li><p>é«˜æ€§èƒ½</p>\n<p>&nbsp; Garneté‡‡ç”¨äº†é«˜æ•ˆçš„ç¼“å­˜ç®—æ³•å’Œæ•°æ®ç»“æ„ï¼Œä»¥å®ç°å¿«é€Ÿçš„æ•°æ®è®¿é—®å’Œå“åº”ã€‚å®ƒæ”¯æŒå¹¶å‘è®¿é—®å’Œé«˜ååé‡ï¼Œèƒ½å¤Ÿå¤„ç†å¤§è§„æ¨¡çš„è¯·æ±‚æµé‡ã€‚</p>\n</li>\n</ol>\n<p>  Garneté€šè¿‡æ™ºèƒ½ç¼“å­˜ç­–ç•¥ï¼Œå°†çƒ­ç‚¹æ•°æ®ï¼ˆç»å¸¸è®¿é—®çš„æ•°æ®ï¼‰å­˜å‚¨åœ¨ç”¨æˆ·é™„è¿‘çš„èŠ‚ç‚¹ä¸Šï¼Œä»è€Œå‡å°‘äº†æ•°æ®ä¼ è¾“çš„æ—¶é—´å’Œè·ç¦»ï¼Œå®ç°äº†ä½å»¶è¿Ÿè®¿é—®ã€‚</p>\n<ol start=\"2\">\n<li><p>å¯é æ€§</p>\n<p>&nbsp; Garnetå…·æœ‰å¼ºå¤§çš„æ•°æ®ä¿æŠ¤å’Œå®¹é”™æœºåˆ¶ï¼Œèƒ½å¤Ÿç¡®ä¿æ•°æ®çš„æŒä¹…æ€§å’Œä¸€è‡´æ€§ã€‚å®ƒæ”¯æŒæ•°æ®å¤‡ä»½ã€å¤åˆ¶å’Œæ•…éšœè½¬ç§»ï¼Œæœ‰æ•ˆåœ°é™ä½äº†æ•°æ®ä¸¢å¤±å’Œç³»ç»Ÿæ•…éšœçš„é£é™©ã€‚</p>\n</li>\n<li><p>å¯æ‰©å±•æ€§</p>\n<p>&nbsp; Garnetçš„æ¶æ„è®¾è®¡å…·æœ‰è‰¯å¥½çš„æ°´å¹³æ‰©å±•æ€§ï¼Œå¯ä»¥è½»æ¾åœ°æ‰©å±•åˆ°æ•°ç™¾ç”šè‡³æ•°åƒå°æœåŠ¡å™¨ã€‚å®ƒæ”¯æŒåŠ¨æ€æ·»åŠ å’Œç§»é™¤èŠ‚ç‚¹ï¼Œèƒ½å¤Ÿæ ¹æ®éœ€æ±‚çµæ´»è°ƒæ•´é›†ç¾¤è§„æ¨¡ã€‚</p>\n</li>\n<li><p>å¤šç§æ•°æ®ç±»å‹æ”¯æŒï¼š</p>\n<p>&nbsp; é™¤äº†å¸¸è§„çš„é”®å€¼å¯¹å­˜å‚¨ä¹‹å¤–ï¼ŒGarnetè¿˜æ”¯æŒå¤šç§æ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬åˆ—è¡¨ã€é›†åˆã€å“ˆå¸Œè¡¨ç­‰ï¼Œæ»¡è¶³äº†ä¸åŒåº”ç”¨åœºæ™¯çš„éœ€æ±‚ã€‚</p>\n</li>\n<li><p>ä¸°å¯Œçš„åŠŸèƒ½</p>\n<p>&nbsp; Garnetæä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½å’Œå·¥å…·ï¼ŒåŒ…æ‹¬ç›‘æ§ã€è°ƒä¼˜ã€æ•…éšœæ’é™¤ç­‰ï¼Œå¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°ç®¡ç†å’Œè¿ç»´ç¼“å­˜ç³»ç»Ÿã€‚</p>\n</li>\n</ol>\n<h1 id=\"é«˜æ€§èƒ½\"><a href=\"#é«˜æ€§èƒ½\" class=\"headerlink\" title=\"é«˜æ€§èƒ½\"></a>é«˜æ€§èƒ½</h1><p>å¯¹äºä¸€ä¸ªä¸­é—´ä»¶æ¥è¯´ï¼Œå¤§å®¶æœ€å…³å¿ƒçš„åº”è¯¥å°±æ˜¯æ€§èƒ½åˆ°åº•æ€ä¹ˆæ ·ï¼ŸåŸºå‡†æµ‹è¯•çš„ç»“æœï¼Œæ€»ä½“è¿˜æ˜¯è¡¨ç°ä¸é”™çš„ã€‚</p>\n<p>å…·ä½“æ€§èƒ½æµ‹è¯•è¯¦æƒ…å¯ä»¥æŸ¥çœ‹é“¾æ¥ï¼š <a href=\"https://microsoft.github.io/garnet/docs/benchmarking/results-resp-bench\">Evaluating Garnetâ€™s Performance Benefits</a></p>\n<p>å®é™…åº”ç”¨çš„è¿‡ç¨‹ä¸­æ•ˆæœåˆ°åº•å’‹æ ·å½“ç„¶è¿˜éœ€è¦æˆ‘ä»¬åœ¨é€šè¿‡ä»£ç æ¥éªŒè¯ä¸€ä¸‹ã€‚</p>\n<p>ä¸‹é¢æˆ‘å†™äº†ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œç›´æ¥å¾ªç¯å¾€garnetå’Œredisé‡Œé¢å†™å…¥å’Œè¯»å–æ•°æ®ã€‚é€šè¿‡è®¡ç®—æ—¶é—´æ¥å¯¹æ¯”ä¸€ä¸‹ä¸¤è€…çš„å·®è·åˆ°åº•æœ‰å¤šå¤§</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"meta\">HttpGet</span>]</span><br><span class=\"line\">[<span class=\"meta\">ActionTitle(Name = <span class=\"string\">&quot;æµ‹è¯•Garnet&quot;</span>)</span>]</span><br><span class=\"line\">[<span class=\"meta\">Route(<span class=\"string\">&quot;test.svc&quot;</span>)</span>]</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Start</span>()</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\">// Redis connection</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> redis = ConnectionMultiplexer.Connect(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> redisDb = redis.GetDatabase();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Garnet connection</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> garnet = <span class=\"keyword\">new</span> GarnetClient(<span class=\"string\">&quot;localhost&quot;</span>, <span class=\"number\">3278</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Test data</span></span><br><span class=\"line\">    <span class=\"built_in\">string</span> key = <span class=\"string\">&quot;test_key&quot;</span>;</span><br><span class=\"line\">    <span class=\"built_in\">string</span> <span class=\"keyword\">value</span> = <span class=\"string\">&quot;test_value&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Test with Redis</span></span><br><span class=\"line\">   <span class=\"keyword\">var</span> redisStartTime = DateTime.Now;</span><br><span class=\"line\">   <span class=\"keyword\">for</span>( <span class=\"built_in\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">1000</span>; i++ ) &#123;</span><br><span class=\"line\">       redisDb.StringSet(key + i, <span class=\"keyword\">value</span> + i);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   <span class=\"keyword\">var</span> redisEndTime = DateTime.Now;</span><br><span class=\"line\">   Console.WriteLine(<span class=\"string\">$&quot;StringSet Time taken by Redis: <span class=\"subst\">&#123;(redisEndTime - redisStartTime).TotalMilliseconds&#125;</span> ms&quot;</span>);</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"comment\">// Test with Garnet</span></span><br><span class=\"line\">   <span class=\"keyword\">var</span> garnetStartTime = DateTime.Now;</span><br><span class=\"line\">   <span class=\"keyword\">for</span>( <span class=\"built_in\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">1000</span>; i++ ) &#123;</span><br><span class=\"line\">       garnet.StringSet(key + i, <span class=\"keyword\">value</span> + i, <span class=\"literal\">null</span>);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   <span class=\"keyword\">var</span> garnetEndTime = DateTime.Now;</span><br><span class=\"line\">   Console.WriteLine(<span class=\"string\">$&quot;StringSet Time taken by Garnet: <span class=\"subst\">&#123;(garnetEndTime - garnetStartTime).TotalMilliseconds&#125;</span> ms&quot;</span>);</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"comment\">// Test with Redis</span></span><br><span class=\"line\">   redisStartTime = DateTime.Now;</span><br><span class=\"line\">   <span class=\"keyword\">for</span>( <span class=\"built_in\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">1000</span>; i++ ) &#123;</span><br><span class=\"line\">       <span class=\"built_in\">string</span> a = redisDb.StringGet(key + i).ToString();</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   redisEndTime = DateTime.Now;</span><br><span class=\"line\">   Console.WriteLine(<span class=\"string\">$&quot;StringGet Time taken by Redis: <span class=\"subst\">&#123;(redisEndTime - redisStartTime).TotalMilliseconds&#125;</span> ms&quot;</span>);</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"comment\">// Test with Garnet</span></span><br><span class=\"line\">   garnetStartTime = DateTime.Now;</span><br><span class=\"line\">   <span class=\"keyword\">for</span>( <span class=\"built_in\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">1000</span>; i++ ) &#123;</span><br><span class=\"line\">       garnet.StringGet(key + i, <span class=\"literal\">null</span>);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   garnetEndTime = DateTime.Now;</span><br><span class=\"line\">   Console.WriteLine(<span class=\"string\">$&quot;StringGet Time taken by Garnet: <span class=\"subst\">&#123;(garnetEndTime - garnetStartTime).TotalMilliseconds&#125;</span> ms&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æœ€åè¿è¡Œçš„ç»“æœè¿˜æ˜¯æŒºæŒ¯å¥‹äººå¿ƒçš„!</p>\n<p><img src=\"/images/garnet/compare1.png\" alt=\"è¿è¡Œç»“æœ1\"></p>\n<h1 id=\"å…¼å®¹æ€§\"><a href=\"#å…¼å®¹æ€§\" class=\"headerlink\" title=\"å…¼å®¹æ€§\"></a>å…¼å®¹æ€§</h1><p>å½“ç„¶åœ¨è¿›è¡Œä¸­é—´ä»¶é€‰æ‹©çš„æ—¶å€™ï¼Œåˆ‡æ¢çš„æˆæœ¬ä¹Ÿæ˜¯é‡ç‚¹è¦çº³å…¥è€ƒè™‘çš„ã€‚â€œç™½å«–ä¸€æ—¶çˆ½ï¼Œé‡æ„ç«è‘¬åœºï¼â€è¿™ç§äº‹æƒ…æ˜¾ç„¶æ˜¯æˆ‘ä»¬ä¸æ„¿æ„çœ‹åˆ°çš„ã€‚</p>\n<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬åœ¨å®˜ç½‘çœ‹åˆ°è¿™æ ·ä¸€å¥è¯</p>\n<blockquote>\n<p>Garnet å¹¶ä¸æ˜¯è¦æˆä¸º Redis 100% å®Œç¾çš„æ›¿ä»£å“ï¼Œè€Œæ˜¯åº”è¯¥å°†å…¶è§†ä¸ºä¸€ä¸ªè¶³å¤Ÿæ¥è¿‘çš„èµ·ç‚¹ï¼Œä»¥ç¡®ä¿å¯¹æ‚¨é‡è¦çš„åŠŸèƒ½çš„å…¼å®¹æ€§ã€‚ Garnet ç¡®å®å¯ä»¥åœ¨æœªç»ä¿®æ”¹çš„æƒ…å†µä¸‹ä¸è®¸å¤š Redis å®¢æˆ·ç«¯ä¸€èµ·ä½¿ç”¨ï¼ˆæˆ‘ä»¬ç‰¹åˆ«å¯¹ Garnet è¿›è¡Œäº†StackExchange.Rediså¾ˆå¥½çš„æµ‹è¯•ï¼‰ï¼Œå› æ­¤å…¥é—¨éå¸¸å®¹æ˜“ã€‚</p>\n</blockquote>\n<p>äºæ˜¯ï¼Œæˆ‘ä»¬å†æ•´ä¸ªdemo</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"meta\">HttpGet</span>]</span><br><span class=\"line\">[<span class=\"meta\">ActionTitle(Name = <span class=\"string\">&quot;æµ‹è¯•Garnetè¿æ¥&quot;</span>)</span>]</span><br><span class=\"line\">[<span class=\"meta\">Route(<span class=\"string\">&quot;connect.svc&quot;</span>)</span>]</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Connect</span>()</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\">// Redis connection</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> redis = ConnectionMultiplexer.Connect(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> redisDb = redis.GetDatabase();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Garnet connection</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> garnet = ConnectionMultiplexer.Connect(<span class=\"string\">&quot;localhost:3278&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> garnetDb = garnet.GetDatabase();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Test data</span></span><br><span class=\"line\">    <span class=\"built_in\">string</span> key = <span class=\"string\">&quot;test_key&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Test with Redis</span></span><br><span class=\"line\">    <span class=\"built_in\">string</span> a = redisDb.StringGet(key + <span class=\"number\">1</span>).ToString();</span><br><span class=\"line\">    Console.WriteLine(<span class=\"string\">$&quot;StringGet by Redis : <span class=\"subst\">&#123;a&#125;</span>&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Test with Garnet</span></span><br><span class=\"line\">    <span class=\"built_in\">string</span> b = garnetDb.StringGet(key + <span class=\"number\">1</span>).ToString();</span><br><span class=\"line\">    Console.WriteLine(<span class=\"string\">$&quot;StringGet by Garnet : <span class=\"subst\">&#123;b&#125;</span>&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å¾®è½¯ è¯šä¸æˆ‘æ¬ºï¼</p>\n<p>åœ¨ä¸åŠ¨å®¢æˆ·ç«¯ä»£ç çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬èƒ½å¤Ÿéå¸¸å¹³æ»‘çš„åˆ‡æ¢åˆ°Garnet<br><img src=\"/images/garnet/connect.png\" alt=\"connect\"></p>\n<p>redisæ¡Œé¢å®¢æˆ·ç«¯ä¹Ÿèƒ½ç›´æ¥è¿æ¥Garnet<br><img src=\"/images/garnet/client.png\" alt=\"client\"></p>\n<h1 id=\"æ—¥å¿—å’Œè¯Šæ–­\"><a href=\"#æ—¥å¿—å’Œè¯Šæ–­\" class=\"headerlink\" title=\"æ—¥å¿—å’Œè¯Šæ–­\"></a>æ—¥å¿—å’Œè¯Šæ–­</h1><p>Garnet æä¾›äº†ä¸°å¯Œçš„æ—¥å¿—å’Œè¯Šæ–­ç‰¹æ€§ï¼Œä»¥å¸®åŠ©å¼€å‘äººå‘˜ç›‘è§†å’Œè°ƒè¯•å…¶åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œè¡Œä¸ºã€‚ä»¥ä¸‹æ˜¯ Garnet æ—¥å¿—å’Œè¯Šæ–­ç‰¹æ€§çš„ä¸»è¦å†…å®¹ï¼š</p>\n<ol>\n<li><p>è¯¦ç»†æ—¥å¿—è®°å½•ï¼šGarnet å…·æœ‰çµæ´»çš„æ—¥å¿—è®°å½•åŠŸèƒ½ï¼Œå¯ä»¥è®°å½•å„ç§çº§åˆ«çš„æ—¥å¿—æ¶ˆæ¯ï¼ŒåŒ…æ‹¬ä¿¡æ¯ã€è­¦å‘Šå’Œé”™è¯¯ã€‚è¿™äº›æ—¥å¿—æ¶ˆæ¯å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜äº†è§£ç³»ç»Ÿçš„è¿è¡Œæƒ…å†µï¼Œè¯†åˆ«æ½œåœ¨çš„é—®é¢˜å¹¶è¿›è¡Œæ•…éšœæ’é™¤ã€‚</p>\n</li>\n<li><p>æ€§èƒ½æŒ‡æ ‡ï¼šGarnet è¿˜æä¾›äº†ä¸°å¯Œçš„æ€§èƒ½æŒ‡æ ‡ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜ç›‘è§†ç³»ç»Ÿçš„æ€§èƒ½çŠ¶å†µã€‚è¿™äº›æŒ‡æ ‡å¯ä»¥åŒ…æ‹¬å„ç§å…³é”®æ€§èƒ½æŒ‡æ ‡ï¼Œå¦‚è¯·æ±‚å“åº”æ—¶é—´ã€ååé‡ã€å»¶è¿Ÿç­‰ã€‚</p>\n</li>\n<li><p>å¼‚å¸¸è·Ÿè¸ªï¼šGarnet å…·æœ‰å¼‚å¸¸è·Ÿè¸ªåŠŸèƒ½ï¼Œå¯ä»¥æ•è·å’Œè®°å½•åº”ç”¨ç¨‹åºä¸­çš„å¼‚å¸¸æƒ…å†µã€‚è¿™äº›å¼‚å¸¸è·Ÿè¸ªä¿¡æ¯å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜å¿«é€Ÿå®šä½å’Œä¿®å¤é—®é¢˜ã€‚</p>\n</li>\n<li><p>è¯Šæ–­å·¥å…·ï¼šGarnet è¿˜æä¾›äº†ä¸€ç³»åˆ—è¯Šæ–­å·¥å…·ï¼Œç”¨äºåˆ†æå’Œè°ƒè¯•ç³»ç»Ÿçš„è¡Œä¸ºã€‚è¿™äº›å·¥å…·å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ·±å…¥äº†è§£ç³»ç»Ÿçš„å†…éƒ¨å·¥ä½œåŸç†ï¼Œå¹¶è¯†åˆ«æ½œåœ¨çš„æ€§èƒ½ç“¶é¢ˆå’Œé—®é¢˜ã€‚</p>\n</li>\n</ol>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">Main</span>(<span class=\"params\"><span class=\"built_in\">string</span>[] args</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">var</span> loggerFactory = LoggerFactory.Create(x =&gt;</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            x.ClearProviders();</span><br><span class=\"line\">            x.SetMinimumLevel(LogLevel.Trace);</span><br><span class=\"line\">            x.AddZLoggerConsole(options =&gt;</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                options.UsePlainTextFormatter(formatter =&gt;</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    formatter.SetPrefixFormatter(<span class=\"string\">$&quot;[<span class=\"subst\">&#123;<span class=\"number\">0</span>&#125;</span>]&quot;</span>, (<span class=\"keyword\">in</span> MessageTemplate template, <span class=\"keyword\">in</span> LogInfo info) =&gt; template.Format(info.Category));</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">using</span> <span class=\"keyword\">var</span> server = <span class=\"keyword\">new</span> GarnetServer(args, loggerFactory);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Optional: register custom extensions</span></span><br><span class=\"line\">        RegisterExtensions(server);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Start the server</span></span><br><span class=\"line\">        server.Start();</span><br><span class=\"line\"></span><br><span class=\"line\">        Thread.Sleep(Timeout.Infinite);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">catch</span> (Exception ex)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        Console.WriteLine(<span class=\"string\">$&quot;Unable to initialize server due to exception: <span class=\"subst\">&#123;ex.Message&#125;</span>&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/images/garnet/log.png\" alt=\"æ—¥å¿—\"></p>\n<h1 id=\"è‡ªå®šä¹‰å‘½ä»¤\"><a href=\"#è‡ªå®šä¹‰å‘½ä»¤\" class=\"headerlink\" title=\"è‡ªå®šä¹‰å‘½ä»¤\"></a>è‡ªå®šä¹‰å‘½ä»¤</h1><p>æƒ³è¦åœ¨ Redis ä¸Šæ‰§è¡Œä¸€äº›å¤æ‚çš„æ‰§è¡Œæ˜¯å¾ˆå¸¸è§çš„ï¼Œåœ¨ Redis çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿‡å»å¸¸å¸¸ä½¿ç”¨ Lua è„šæœ¬æ¥å¤„ç†å®ƒï¼Œä½†ä½¿ç”¨ Garnetï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ C# ä¸­å®ç°å’Œåˆå¹¶è‡ªå®šä¹‰å‘½ä»¤ã€‚ å¦‚æœä½ ä¸çŸ¥é“ LUA æ˜¯å¦åœ¨æ€§èƒ½æ–¹é¢ï¼Œæˆ–è€…å¦‚æœä½ æƒ³åšä¸€äº› LUA åšä¸åˆ°çš„ç›¸å½“å¤æ‚çš„äº‹æƒ…ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒè€Œä¸ä¼šæœ‰ä»»ä½•æ€§èƒ½åŠ£åŠ¿ã€‚ æ›´å¥½çš„æ˜¯ï¼ŒæœåŠ¡å™¨ç«¯æä¾›çš„æ‰©å±•å‘½ä»¤éµå¾ª RESPï¼Œå› æ­¤å®¢æˆ·ç«¯å¯ä»¥ä» PHP æˆ– Go è°ƒç”¨å®ƒä»¬ï¼Œè€Œä¸ä»…ä»…æ˜¯é’ˆå¯¹ C#ã€‚</p>\n<p>å› æ­¤ï¼Œè®©æˆ‘ä»¬ç«‹å³åˆ›å»ºä¸€ä¸ªåä¸ºâ€œTESTâ€çš„è‡ªå®šä¹‰å‘½ä»¤ã€‚å‘½ä»¤å¾ˆç®€å•ï¼Œç›´æ¥è¿”å›ä¸€ä¸ªâ€œHello Garnet!â€</p>\n<p>æ³¨å†Œè‡ªå®šä¹‰å‘½ä»¤æœ¬èº«éå¸¸ç®€å•ï¼Œåªéœ€æ·»åŠ ä¸€ä¸ªå®ç°çš„ç±»ï¼Œæˆ–è€…ä¸å‘½ä»¤åç§°ä¸€èµ·æ·»åŠ å³å¯ã€‚</p>\n<figure class=\"highlight plaintext\"><figcaption><span>Server</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// æµ‹è¯•è‡ªå®šä¹‰å‘½ä»¤</span><br><span class=\"line\">server.Register.NewTransactionProc(&quot;TEST&quot;, 0, () =&gt; new TestCustomCommand());</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">sealed class TestCustomCommand : CustomTransactionProcedure</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    /// &lt;summary&gt;</span><br><span class=\"line\">    /// No transactional phase, skip Prepare</span><br><span class=\"line\">    /// &lt;/summary&gt;</span><br><span class=\"line\">    public override bool Prepare&lt;TGarnetReadApi&gt;(TGarnetReadApi api, ArgSlice input)</span><br><span class=\"line\">        =&gt; false;</span><br><span class=\"line\"></span><br><span class=\"line\">    /// &lt;summary&gt;</span><br><span class=\"line\">    /// Main will not be called because Prepare returns false</span><br><span class=\"line\">    /// &lt;/summary&gt;</span><br><span class=\"line\">    public override void Main&lt;TGarnetApi&gt;(TGarnetApi api, ArgSlice input, ref MemoryResult&lt;byte&gt; output)</span><br><span class=\"line\">        =&gt; throw new InvalidOperationException();</span><br><span class=\"line\"></span><br><span class=\"line\">    /// &lt;summary&gt;</span><br><span class=\"line\">    /// Finalize reads two keys (non-transactionally) and return their values as an array of bulk strings</span><br><span class=\"line\">    /// &lt;/summary&gt;</span><br><span class=\"line\">    public override void Finalize&lt;TGarnetApi&gt;(TGarnetApi api, ArgSlice input, ref MemoryResult&lt;byte&gt; output)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        // Return the two keys as an array of bulk strings</span><br><span class=\"line\">        WriteSimpleString(ref output, &quot;Hello Garnet!&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>åŒæ—¶è¿˜æ˜¯å› ä¸ºGarnetéµå¾ª RESPï¼Œå› æ­¤å®¢æˆ·ç«¯ä¸æ˜¯ä¸“ç”¨äº C#ï¼Œä¹Ÿä¸æ˜¯ Garnet å®¢æˆ·ç«¯ç‹¬æœ‰çš„ã€‚ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨rediså®¢æˆ·ç«¯è°ƒç”¨Garnetçš„è‡ªå®šä¹‰å‘½ä»¤</p>\n<figure class=\"highlight plaintext\"><figcaption><span>client</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[HttpGet]</span><br><span class=\"line\">[ActionTitle(Name = &quot;æµ‹è¯•Garnet è‡ªå®šä¹‰å‘½ä»¤&quot;)]</span><br><span class=\"line\">[Route(&quot;custom-command.svc&quot;)]</span><br><span class=\"line\">public async void Test()</span><br><span class=\"line\">&#123;       </span><br><span class=\"line\">    // Garnet connection</span><br><span class=\"line\">    var garnet = new GarnetClient(&quot;localhost&quot;, 3278);</span><br><span class=\"line\">    garnet.Connect();</span><br><span class=\"line\">    // Test data</span><br><span class=\"line\">    string result = await garnet.ExecuteForStringResultAsync(&quot;TEST&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">    Console.WriteLine($&quot;Garnet Custom Command Result: &#123;result&#125;&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">    // é‡‡ç”¨rediså®¢æˆ·ç«¯è¿æ¥</span><br><span class=\"line\">    var client = ConnectionMultiplexer.Connect(&quot;localhost:3278&quot;);</span><br><span class=\"line\">    var db = client.GetDatabase();</span><br><span class=\"line\"></span><br><span class=\"line\">    RedisResult redisResult = db.Execute(&quot;TEST&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">    Console.WriteLine($&quot;Redis Client Custom Command Result: &#123;((string?)redisResult)&#125;&quot;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æœ€åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç”¨ä¸¤ç§å®¢æˆ·ç«¯æ‰§è¡Œè‡ªå®šä¹‰å‘½ä»¤éƒ½è¾“å‡ºäº†åŒæ ·çš„ç»“æœ<br><img src=\"/images/garnet/custom-command.png\" alt=\"custom command result\"></p>\n<h1 id=\"ç»“è¯­\"><a href=\"#ç»“è¯­\" class=\"headerlink\" title=\"ç»“è¯­\"></a>ç»“è¯­</h1><p>Garnetä½œä¸ºå¾®è½¯æœ€æ–°æ¨å‡ºçš„è¿œç¨‹ç¼“å­˜å­˜å‚¨ç³»ç»Ÿï¼Œä¸ºå¼€å‘è€…æä¾›äº†ä¸€ç§å…¨æ–°çš„é€‰æ‹©ã€‚å®ƒå…·æœ‰é«˜æ€§èƒ½ã€å¯é æ€§å’Œå¯ä¼¸ç¼©æ€§çš„ç‰¹æ€§ï¼Œé€‚ç”¨äºå„ç§è§„æ¨¡å’Œç±»å‹çš„åº”ç”¨åœºæ™¯ã€‚é€šè¿‡ä½¿ç”¨Garnetï¼Œå¼€å‘è€…å¯ä»¥æ›´å¥½åœ°æå‡åº”ç”¨çš„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒï¼Œå®ç°ä¸šåŠ¡çš„å¿«é€Ÿå‘å±•å’ŒæŒç»­åˆ›æ–°ã€‚</p>\n<h1 id=\"å‚è€ƒæ–‡æ¡£\"><a href=\"#å‚è€ƒæ–‡æ¡£\" class=\"headerlink\" title=\"å‚è€ƒæ–‡æ¡£\"></a>å‚è€ƒæ–‡æ¡£</h1><ul>\n<li><a href=\"https://microsoft.github.io/garnet/docs\">Garnet å¼€å‘å…¥é—¨</a></li>\n</ul>\n<p>æ›´å¤šä¸€æ‰‹è®¯æ¯ï¼Œå¯å…³æ³¨å…¬ä¼—å·ï¼š<a href=\"https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg\">ITProHub</a></p>\n<p><img src=\"https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg\" alt=\"ITProHub\"></p>\n","site":{"data":{}},"excerpt":"","more":"<p>å·å¤–å·å¤–ï¼</p>\n<ol>\n<li>redisä¸å†â€œå¼€æºâ€ï¼›</li>\n<li>å¾®è½¯å¼€æºäº†Garnet</li>\n</ol>\n<h1 id=\"ä»€ä¹ˆæ˜¯Garnetï¼Ÿ\"><a href=\"#ä»€ä¹ˆæ˜¯Garnetï¼Ÿ\" class=\"headerlink\" title=\"ä»€ä¹ˆæ˜¯Garnetï¼Ÿ\"></a>ä»€ä¹ˆæ˜¯Garnetï¼Ÿ</h1><p>Garnetæ˜¯å¾®è½¯æ¨å‡ºçš„ä¸€æ¬¾è¿œç¨‹ç¼“å­˜å­˜å‚¨ç³»ç»Ÿï¼Œæ—¨åœ¨ä¸ºå¼€å‘è€…æä¾›é«˜æ€§èƒ½ã€å¯é æ€§å’Œå¯ä¼¸ç¼©æ€§çš„ç¼“å­˜è§£å†³æ–¹æ¡ˆã€‚å®ƒé‡‡ç”¨äº†ç°ä»£åŒ–çš„æ¶æ„å’ŒæŠ€æœ¯ï¼Œå…·æœ‰é«˜åº¦å¯å®šåˆ¶æ€§å’Œçµæ´»æ€§ï¼Œé€‚ç”¨äºå„ç§è§„æ¨¡å’Œç±»å‹çš„åº”ç”¨åœºæ™¯ã€‚</p>\n<h1 id=\"ç‰¹æ€§å’Œä¼˜åŠ¿\"><a href=\"#ç‰¹æ€§å’Œä¼˜åŠ¿\" class=\"headerlink\" title=\"ç‰¹æ€§å’Œä¼˜åŠ¿\"></a>ç‰¹æ€§å’Œä¼˜åŠ¿</h1><ol>\n<li><p>é«˜æ€§èƒ½</p>\n<p>&nbsp; Garneté‡‡ç”¨äº†é«˜æ•ˆçš„ç¼“å­˜ç®—æ³•å’Œæ•°æ®ç»“æ„ï¼Œä»¥å®ç°å¿«é€Ÿçš„æ•°æ®è®¿é—®å’Œå“åº”ã€‚å®ƒæ”¯æŒå¹¶å‘è®¿é—®å’Œé«˜ååé‡ï¼Œèƒ½å¤Ÿå¤„ç†å¤§è§„æ¨¡çš„è¯·æ±‚æµé‡ã€‚</p>\n</li>\n</ol>\n<p>  Garneté€šè¿‡æ™ºèƒ½ç¼“å­˜ç­–ç•¥ï¼Œå°†çƒ­ç‚¹æ•°æ®ï¼ˆç»å¸¸è®¿é—®çš„æ•°æ®ï¼‰å­˜å‚¨åœ¨ç”¨æˆ·é™„è¿‘çš„èŠ‚ç‚¹ä¸Šï¼Œä»è€Œå‡å°‘äº†æ•°æ®ä¼ è¾“çš„æ—¶é—´å’Œè·ç¦»ï¼Œå®ç°äº†ä½å»¶è¿Ÿè®¿é—®ã€‚</p>\n<ol start=\"2\">\n<li><p>å¯é æ€§</p>\n<p>&nbsp; Garnetå…·æœ‰å¼ºå¤§çš„æ•°æ®ä¿æŠ¤å’Œå®¹é”™æœºåˆ¶ï¼Œèƒ½å¤Ÿç¡®ä¿æ•°æ®çš„æŒä¹…æ€§å’Œä¸€è‡´æ€§ã€‚å®ƒæ”¯æŒæ•°æ®å¤‡ä»½ã€å¤åˆ¶å’Œæ•…éšœè½¬ç§»ï¼Œæœ‰æ•ˆåœ°é™ä½äº†æ•°æ®ä¸¢å¤±å’Œç³»ç»Ÿæ•…éšœçš„é£é™©ã€‚</p>\n</li>\n<li><p>å¯æ‰©å±•æ€§</p>\n<p>&nbsp; Garnetçš„æ¶æ„è®¾è®¡å…·æœ‰è‰¯å¥½çš„æ°´å¹³æ‰©å±•æ€§ï¼Œå¯ä»¥è½»æ¾åœ°æ‰©å±•åˆ°æ•°ç™¾ç”šè‡³æ•°åƒå°æœåŠ¡å™¨ã€‚å®ƒæ”¯æŒåŠ¨æ€æ·»åŠ å’Œç§»é™¤èŠ‚ç‚¹ï¼Œèƒ½å¤Ÿæ ¹æ®éœ€æ±‚çµæ´»è°ƒæ•´é›†ç¾¤è§„æ¨¡ã€‚</p>\n</li>\n<li><p>å¤šç§æ•°æ®ç±»å‹æ”¯æŒï¼š</p>\n<p>&nbsp; é™¤äº†å¸¸è§„çš„é”®å€¼å¯¹å­˜å‚¨ä¹‹å¤–ï¼ŒGarnetè¿˜æ”¯æŒå¤šç§æ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬åˆ—è¡¨ã€é›†åˆã€å“ˆå¸Œè¡¨ç­‰ï¼Œæ»¡è¶³äº†ä¸åŒåº”ç”¨åœºæ™¯çš„éœ€æ±‚ã€‚</p>\n</li>\n<li><p>ä¸°å¯Œçš„åŠŸèƒ½</p>\n<p>&nbsp; Garnetæä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½å’Œå·¥å…·ï¼ŒåŒ…æ‹¬ç›‘æ§ã€è°ƒä¼˜ã€æ•…éšœæ’é™¤ç­‰ï¼Œå¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°ç®¡ç†å’Œè¿ç»´ç¼“å­˜ç³»ç»Ÿã€‚</p>\n</li>\n</ol>\n<h1 id=\"é«˜æ€§èƒ½\"><a href=\"#é«˜æ€§èƒ½\" class=\"headerlink\" title=\"é«˜æ€§èƒ½\"></a>é«˜æ€§èƒ½</h1><p>å¯¹äºä¸€ä¸ªä¸­é—´ä»¶æ¥è¯´ï¼Œå¤§å®¶æœ€å…³å¿ƒçš„åº”è¯¥å°±æ˜¯æ€§èƒ½åˆ°åº•æ€ä¹ˆæ ·ï¼ŸåŸºå‡†æµ‹è¯•çš„ç»“æœï¼Œæ€»ä½“è¿˜æ˜¯è¡¨ç°ä¸é”™çš„ã€‚</p>\n<p>å…·ä½“æ€§èƒ½æµ‹è¯•è¯¦æƒ…å¯ä»¥æŸ¥çœ‹é“¾æ¥ï¼š <a href=\"https://microsoft.github.io/garnet/docs/benchmarking/results-resp-bench\">Evaluating Garnetâ€™s Performance Benefits</a></p>\n<p>å®é™…åº”ç”¨çš„è¿‡ç¨‹ä¸­æ•ˆæœåˆ°åº•å’‹æ ·å½“ç„¶è¿˜éœ€è¦æˆ‘ä»¬åœ¨é€šè¿‡ä»£ç æ¥éªŒè¯ä¸€ä¸‹ã€‚</p>\n<p>ä¸‹é¢æˆ‘å†™äº†ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œç›´æ¥å¾ªç¯å¾€garnetå’Œredisé‡Œé¢å†™å…¥å’Œè¯»å–æ•°æ®ã€‚é€šè¿‡è®¡ç®—æ—¶é—´æ¥å¯¹æ¯”ä¸€ä¸‹ä¸¤è€…çš„å·®è·åˆ°åº•æœ‰å¤šå¤§</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"meta\">HttpGet</span>]</span><br><span class=\"line\">[<span class=\"meta\">ActionTitle(Name = <span class=\"string\">&quot;æµ‹è¯•Garnet&quot;</span>)</span>]</span><br><span class=\"line\">[<span class=\"meta\">Route(<span class=\"string\">&quot;test.svc&quot;</span>)</span>]</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Start</span>()</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\">// Redis connection</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> redis = ConnectionMultiplexer.Connect(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> redisDb = redis.GetDatabase();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Garnet connection</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> garnet = <span class=\"keyword\">new</span> GarnetClient(<span class=\"string\">&quot;localhost&quot;</span>, <span class=\"number\">3278</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Test data</span></span><br><span class=\"line\">    <span class=\"built_in\">string</span> key = <span class=\"string\">&quot;test_key&quot;</span>;</span><br><span class=\"line\">    <span class=\"built_in\">string</span> <span class=\"keyword\">value</span> = <span class=\"string\">&quot;test_value&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Test with Redis</span></span><br><span class=\"line\">   <span class=\"keyword\">var</span> redisStartTime = DateTime.Now;</span><br><span class=\"line\">   <span class=\"keyword\">for</span>( <span class=\"built_in\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">1000</span>; i++ ) &#123;</span><br><span class=\"line\">       redisDb.StringSet(key + i, <span class=\"keyword\">value</span> + i);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   <span class=\"keyword\">var</span> redisEndTime = DateTime.Now;</span><br><span class=\"line\">   Console.WriteLine(<span class=\"string\">$&quot;StringSet Time taken by Redis: <span class=\"subst\">&#123;(redisEndTime - redisStartTime).TotalMilliseconds&#125;</span> ms&quot;</span>);</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"comment\">// Test with Garnet</span></span><br><span class=\"line\">   <span class=\"keyword\">var</span> garnetStartTime = DateTime.Now;</span><br><span class=\"line\">   <span class=\"keyword\">for</span>( <span class=\"built_in\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">1000</span>; i++ ) &#123;</span><br><span class=\"line\">       garnet.StringSet(key + i, <span class=\"keyword\">value</span> + i, <span class=\"literal\">null</span>);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   <span class=\"keyword\">var</span> garnetEndTime = DateTime.Now;</span><br><span class=\"line\">   Console.WriteLine(<span class=\"string\">$&quot;StringSet Time taken by Garnet: <span class=\"subst\">&#123;(garnetEndTime - garnetStartTime).TotalMilliseconds&#125;</span> ms&quot;</span>);</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"comment\">// Test with Redis</span></span><br><span class=\"line\">   redisStartTime = DateTime.Now;</span><br><span class=\"line\">   <span class=\"keyword\">for</span>( <span class=\"built_in\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">1000</span>; i++ ) &#123;</span><br><span class=\"line\">       <span class=\"built_in\">string</span> a = redisDb.StringGet(key + i).ToString();</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   redisEndTime = DateTime.Now;</span><br><span class=\"line\">   Console.WriteLine(<span class=\"string\">$&quot;StringGet Time taken by Redis: <span class=\"subst\">&#123;(redisEndTime - redisStartTime).TotalMilliseconds&#125;</span> ms&quot;</span>);</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"comment\">// Test with Garnet</span></span><br><span class=\"line\">   garnetStartTime = DateTime.Now;</span><br><span class=\"line\">   <span class=\"keyword\">for</span>( <span class=\"built_in\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">1000</span>; i++ ) &#123;</span><br><span class=\"line\">       garnet.StringGet(key + i, <span class=\"literal\">null</span>);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   garnetEndTime = DateTime.Now;</span><br><span class=\"line\">   Console.WriteLine(<span class=\"string\">$&quot;StringGet Time taken by Garnet: <span class=\"subst\">&#123;(garnetEndTime - garnetStartTime).TotalMilliseconds&#125;</span> ms&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æœ€åè¿è¡Œçš„ç»“æœè¿˜æ˜¯æŒºæŒ¯å¥‹äººå¿ƒçš„!</p>\n<p><img src=\"/images/garnet/compare1.png\" alt=\"è¿è¡Œç»“æœ1\"></p>\n<h1 id=\"å…¼å®¹æ€§\"><a href=\"#å…¼å®¹æ€§\" class=\"headerlink\" title=\"å…¼å®¹æ€§\"></a>å…¼å®¹æ€§</h1><p>å½“ç„¶åœ¨è¿›è¡Œä¸­é—´ä»¶é€‰æ‹©çš„æ—¶å€™ï¼Œåˆ‡æ¢çš„æˆæœ¬ä¹Ÿæ˜¯é‡ç‚¹è¦çº³å…¥è€ƒè™‘çš„ã€‚â€œç™½å«–ä¸€æ—¶çˆ½ï¼Œé‡æ„ç«è‘¬åœºï¼â€è¿™ç§äº‹æƒ…æ˜¾ç„¶æ˜¯æˆ‘ä»¬ä¸æ„¿æ„çœ‹åˆ°çš„ã€‚</p>\n<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬åœ¨å®˜ç½‘çœ‹åˆ°è¿™æ ·ä¸€å¥è¯</p>\n<blockquote>\n<p>Garnet å¹¶ä¸æ˜¯è¦æˆä¸º Redis 100% å®Œç¾çš„æ›¿ä»£å“ï¼Œè€Œæ˜¯åº”è¯¥å°†å…¶è§†ä¸ºä¸€ä¸ªè¶³å¤Ÿæ¥è¿‘çš„èµ·ç‚¹ï¼Œä»¥ç¡®ä¿å¯¹æ‚¨é‡è¦çš„åŠŸèƒ½çš„å…¼å®¹æ€§ã€‚ Garnet ç¡®å®å¯ä»¥åœ¨æœªç»ä¿®æ”¹çš„æƒ…å†µä¸‹ä¸è®¸å¤š Redis å®¢æˆ·ç«¯ä¸€èµ·ä½¿ç”¨ï¼ˆæˆ‘ä»¬ç‰¹åˆ«å¯¹ Garnet è¿›è¡Œäº†StackExchange.Rediså¾ˆå¥½çš„æµ‹è¯•ï¼‰ï¼Œå› æ­¤å…¥é—¨éå¸¸å®¹æ˜“ã€‚</p>\n</blockquote>\n<p>äºæ˜¯ï¼Œæˆ‘ä»¬å†æ•´ä¸ªdemo</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"meta\">HttpGet</span>]</span><br><span class=\"line\">[<span class=\"meta\">ActionTitle(Name = <span class=\"string\">&quot;æµ‹è¯•Garnetè¿æ¥&quot;</span>)</span>]</span><br><span class=\"line\">[<span class=\"meta\">Route(<span class=\"string\">&quot;connect.svc&quot;</span>)</span>]</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Connect</span>()</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\">// Redis connection</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> redis = ConnectionMultiplexer.Connect(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> redisDb = redis.GetDatabase();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Garnet connection</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> garnet = ConnectionMultiplexer.Connect(<span class=\"string\">&quot;localhost:3278&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> garnetDb = garnet.GetDatabase();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Test data</span></span><br><span class=\"line\">    <span class=\"built_in\">string</span> key = <span class=\"string\">&quot;test_key&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Test with Redis</span></span><br><span class=\"line\">    <span class=\"built_in\">string</span> a = redisDb.StringGet(key + <span class=\"number\">1</span>).ToString();</span><br><span class=\"line\">    Console.WriteLine(<span class=\"string\">$&quot;StringGet by Redis : <span class=\"subst\">&#123;a&#125;</span>&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Test with Garnet</span></span><br><span class=\"line\">    <span class=\"built_in\">string</span> b = garnetDb.StringGet(key + <span class=\"number\">1</span>).ToString();</span><br><span class=\"line\">    Console.WriteLine(<span class=\"string\">$&quot;StringGet by Garnet : <span class=\"subst\">&#123;b&#125;</span>&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å¾®è½¯ è¯šä¸æˆ‘æ¬ºï¼</p>\n<p>åœ¨ä¸åŠ¨å®¢æˆ·ç«¯ä»£ç çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬èƒ½å¤Ÿéå¸¸å¹³æ»‘çš„åˆ‡æ¢åˆ°Garnet<br><img src=\"/images/garnet/connect.png\" alt=\"connect\"></p>\n<p>redisæ¡Œé¢å®¢æˆ·ç«¯ä¹Ÿèƒ½ç›´æ¥è¿æ¥Garnet<br><img src=\"/images/garnet/client.png\" alt=\"client\"></p>\n<h1 id=\"æ—¥å¿—å’Œè¯Šæ–­\"><a href=\"#æ—¥å¿—å’Œè¯Šæ–­\" class=\"headerlink\" title=\"æ—¥å¿—å’Œè¯Šæ–­\"></a>æ—¥å¿—å’Œè¯Šæ–­</h1><p>Garnet æä¾›äº†ä¸°å¯Œçš„æ—¥å¿—å’Œè¯Šæ–­ç‰¹æ€§ï¼Œä»¥å¸®åŠ©å¼€å‘äººå‘˜ç›‘è§†å’Œè°ƒè¯•å…¶åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œè¡Œä¸ºã€‚ä»¥ä¸‹æ˜¯ Garnet æ—¥å¿—å’Œè¯Šæ–­ç‰¹æ€§çš„ä¸»è¦å†…å®¹ï¼š</p>\n<ol>\n<li><p>è¯¦ç»†æ—¥å¿—è®°å½•ï¼šGarnet å…·æœ‰çµæ´»çš„æ—¥å¿—è®°å½•åŠŸèƒ½ï¼Œå¯ä»¥è®°å½•å„ç§çº§åˆ«çš„æ—¥å¿—æ¶ˆæ¯ï¼ŒåŒ…æ‹¬ä¿¡æ¯ã€è­¦å‘Šå’Œé”™è¯¯ã€‚è¿™äº›æ—¥å¿—æ¶ˆæ¯å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜äº†è§£ç³»ç»Ÿçš„è¿è¡Œæƒ…å†µï¼Œè¯†åˆ«æ½œåœ¨çš„é—®é¢˜å¹¶è¿›è¡Œæ•…éšœæ’é™¤ã€‚</p>\n</li>\n<li><p>æ€§èƒ½æŒ‡æ ‡ï¼šGarnet è¿˜æä¾›äº†ä¸°å¯Œçš„æ€§èƒ½æŒ‡æ ‡ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜ç›‘è§†ç³»ç»Ÿçš„æ€§èƒ½çŠ¶å†µã€‚è¿™äº›æŒ‡æ ‡å¯ä»¥åŒ…æ‹¬å„ç§å…³é”®æ€§èƒ½æŒ‡æ ‡ï¼Œå¦‚è¯·æ±‚å“åº”æ—¶é—´ã€ååé‡ã€å»¶è¿Ÿç­‰ã€‚</p>\n</li>\n<li><p>å¼‚å¸¸è·Ÿè¸ªï¼šGarnet å…·æœ‰å¼‚å¸¸è·Ÿè¸ªåŠŸèƒ½ï¼Œå¯ä»¥æ•è·å’Œè®°å½•åº”ç”¨ç¨‹åºä¸­çš„å¼‚å¸¸æƒ…å†µã€‚è¿™äº›å¼‚å¸¸è·Ÿè¸ªä¿¡æ¯å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜å¿«é€Ÿå®šä½å’Œä¿®å¤é—®é¢˜ã€‚</p>\n</li>\n<li><p>è¯Šæ–­å·¥å…·ï¼šGarnet è¿˜æä¾›äº†ä¸€ç³»åˆ—è¯Šæ–­å·¥å…·ï¼Œç”¨äºåˆ†æå’Œè°ƒè¯•ç³»ç»Ÿçš„è¡Œä¸ºã€‚è¿™äº›å·¥å…·å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ·±å…¥äº†è§£ç³»ç»Ÿçš„å†…éƒ¨å·¥ä½œåŸç†ï¼Œå¹¶è¯†åˆ«æ½œåœ¨çš„æ€§èƒ½ç“¶é¢ˆå’Œé—®é¢˜ã€‚</p>\n</li>\n</ol>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">Main</span>(<span class=\"params\"><span class=\"built_in\">string</span>[] args</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">var</span> loggerFactory = LoggerFactory.Create(x =&gt;</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            x.ClearProviders();</span><br><span class=\"line\">            x.SetMinimumLevel(LogLevel.Trace);</span><br><span class=\"line\">            x.AddZLoggerConsole(options =&gt;</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                options.UsePlainTextFormatter(formatter =&gt;</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    formatter.SetPrefixFormatter(<span class=\"string\">$&quot;[<span class=\"subst\">&#123;<span class=\"number\">0</span>&#125;</span>]&quot;</span>, (<span class=\"keyword\">in</span> MessageTemplate template, <span class=\"keyword\">in</span> LogInfo info) =&gt; template.Format(info.Category));</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">using</span> <span class=\"keyword\">var</span> server = <span class=\"keyword\">new</span> GarnetServer(args, loggerFactory);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Optional: register custom extensions</span></span><br><span class=\"line\">        RegisterExtensions(server);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Start the server</span></span><br><span class=\"line\">        server.Start();</span><br><span class=\"line\"></span><br><span class=\"line\">        Thread.Sleep(Timeout.Infinite);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">catch</span> (Exception ex)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        Console.WriteLine(<span class=\"string\">$&quot;Unable to initialize server due to exception: <span class=\"subst\">&#123;ex.Message&#125;</span>&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/images/garnet/log.png\" alt=\"æ—¥å¿—\"></p>\n<h1 id=\"è‡ªå®šä¹‰å‘½ä»¤\"><a href=\"#è‡ªå®šä¹‰å‘½ä»¤\" class=\"headerlink\" title=\"è‡ªå®šä¹‰å‘½ä»¤\"></a>è‡ªå®šä¹‰å‘½ä»¤</h1><p>æƒ³è¦åœ¨ Redis ä¸Šæ‰§è¡Œä¸€äº›å¤æ‚çš„æ‰§è¡Œæ˜¯å¾ˆå¸¸è§çš„ï¼Œåœ¨ Redis çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿‡å»å¸¸å¸¸ä½¿ç”¨ Lua è„šæœ¬æ¥å¤„ç†å®ƒï¼Œä½†ä½¿ç”¨ Garnetï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ C# ä¸­å®ç°å’Œåˆå¹¶è‡ªå®šä¹‰å‘½ä»¤ã€‚ å¦‚æœä½ ä¸çŸ¥é“ LUA æ˜¯å¦åœ¨æ€§èƒ½æ–¹é¢ï¼Œæˆ–è€…å¦‚æœä½ æƒ³åšä¸€äº› LUA åšä¸åˆ°çš„ç›¸å½“å¤æ‚çš„äº‹æƒ…ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒè€Œä¸ä¼šæœ‰ä»»ä½•æ€§èƒ½åŠ£åŠ¿ã€‚ æ›´å¥½çš„æ˜¯ï¼ŒæœåŠ¡å™¨ç«¯æä¾›çš„æ‰©å±•å‘½ä»¤éµå¾ª RESPï¼Œå› æ­¤å®¢æˆ·ç«¯å¯ä»¥ä» PHP æˆ– Go è°ƒç”¨å®ƒä»¬ï¼Œè€Œä¸ä»…ä»…æ˜¯é’ˆå¯¹ C#ã€‚</p>\n<p>å› æ­¤ï¼Œè®©æˆ‘ä»¬ç«‹å³åˆ›å»ºä¸€ä¸ªåä¸ºâ€œTESTâ€çš„è‡ªå®šä¹‰å‘½ä»¤ã€‚å‘½ä»¤å¾ˆç®€å•ï¼Œç›´æ¥è¿”å›ä¸€ä¸ªâ€œHello Garnet!â€</p>\n<p>æ³¨å†Œè‡ªå®šä¹‰å‘½ä»¤æœ¬èº«éå¸¸ç®€å•ï¼Œåªéœ€æ·»åŠ ä¸€ä¸ªå®ç°çš„ç±»ï¼Œæˆ–è€…ä¸å‘½ä»¤åç§°ä¸€èµ·æ·»åŠ å³å¯ã€‚</p>\n<figure class=\"highlight plaintext\"><figcaption><span>Server</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// æµ‹è¯•è‡ªå®šä¹‰å‘½ä»¤</span><br><span class=\"line\">server.Register.NewTransactionProc(&quot;TEST&quot;, 0, () =&gt; new TestCustomCommand());</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">sealed class TestCustomCommand : CustomTransactionProcedure</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    /// &lt;summary&gt;</span><br><span class=\"line\">    /// No transactional phase, skip Prepare</span><br><span class=\"line\">    /// &lt;/summary&gt;</span><br><span class=\"line\">    public override bool Prepare&lt;TGarnetReadApi&gt;(TGarnetReadApi api, ArgSlice input)</span><br><span class=\"line\">        =&gt; false;</span><br><span class=\"line\"></span><br><span class=\"line\">    /// &lt;summary&gt;</span><br><span class=\"line\">    /// Main will not be called because Prepare returns false</span><br><span class=\"line\">    /// &lt;/summary&gt;</span><br><span class=\"line\">    public override void Main&lt;TGarnetApi&gt;(TGarnetApi api, ArgSlice input, ref MemoryResult&lt;byte&gt; output)</span><br><span class=\"line\">        =&gt; throw new InvalidOperationException();</span><br><span class=\"line\"></span><br><span class=\"line\">    /// &lt;summary&gt;</span><br><span class=\"line\">    /// Finalize reads two keys (non-transactionally) and return their values as an array of bulk strings</span><br><span class=\"line\">    /// &lt;/summary&gt;</span><br><span class=\"line\">    public override void Finalize&lt;TGarnetApi&gt;(TGarnetApi api, ArgSlice input, ref MemoryResult&lt;byte&gt; output)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        // Return the two keys as an array of bulk strings</span><br><span class=\"line\">        WriteSimpleString(ref output, &quot;Hello Garnet!&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>åŒæ—¶è¿˜æ˜¯å› ä¸ºGarnetéµå¾ª RESPï¼Œå› æ­¤å®¢æˆ·ç«¯ä¸æ˜¯ä¸“ç”¨äº C#ï¼Œä¹Ÿä¸æ˜¯ Garnet å®¢æˆ·ç«¯ç‹¬æœ‰çš„ã€‚ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨rediså®¢æˆ·ç«¯è°ƒç”¨Garnetçš„è‡ªå®šä¹‰å‘½ä»¤</p>\n<figure class=\"highlight plaintext\"><figcaption><span>client</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[HttpGet]</span><br><span class=\"line\">[ActionTitle(Name = &quot;æµ‹è¯•Garnet è‡ªå®šä¹‰å‘½ä»¤&quot;)]</span><br><span class=\"line\">[Route(&quot;custom-command.svc&quot;)]</span><br><span class=\"line\">public async void Test()</span><br><span class=\"line\">&#123;       </span><br><span class=\"line\">    // Garnet connection</span><br><span class=\"line\">    var garnet = new GarnetClient(&quot;localhost&quot;, 3278);</span><br><span class=\"line\">    garnet.Connect();</span><br><span class=\"line\">    // Test data</span><br><span class=\"line\">    string result = await garnet.ExecuteForStringResultAsync(&quot;TEST&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">    Console.WriteLine($&quot;Garnet Custom Command Result: &#123;result&#125;&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">    // é‡‡ç”¨rediså®¢æˆ·ç«¯è¿æ¥</span><br><span class=\"line\">    var client = ConnectionMultiplexer.Connect(&quot;localhost:3278&quot;);</span><br><span class=\"line\">    var db = client.GetDatabase();</span><br><span class=\"line\"></span><br><span class=\"line\">    RedisResult redisResult = db.Execute(&quot;TEST&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">    Console.WriteLine($&quot;Redis Client Custom Command Result: &#123;((string?)redisResult)&#125;&quot;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æœ€åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç”¨ä¸¤ç§å®¢æˆ·ç«¯æ‰§è¡Œè‡ªå®šä¹‰å‘½ä»¤éƒ½è¾“å‡ºäº†åŒæ ·çš„ç»“æœ<br><img src=\"/images/garnet/custom-command.png\" alt=\"custom command result\"></p>\n<h1 id=\"ç»“è¯­\"><a href=\"#ç»“è¯­\" class=\"headerlink\" title=\"ç»“è¯­\"></a>ç»“è¯­</h1><p>Garnetä½œä¸ºå¾®è½¯æœ€æ–°æ¨å‡ºçš„è¿œç¨‹ç¼“å­˜å­˜å‚¨ç³»ç»Ÿï¼Œä¸ºå¼€å‘è€…æä¾›äº†ä¸€ç§å…¨æ–°çš„é€‰æ‹©ã€‚å®ƒå…·æœ‰é«˜æ€§èƒ½ã€å¯é æ€§å’Œå¯ä¼¸ç¼©æ€§çš„ç‰¹æ€§ï¼Œé€‚ç”¨äºå„ç§è§„æ¨¡å’Œç±»å‹çš„åº”ç”¨åœºæ™¯ã€‚é€šè¿‡ä½¿ç”¨Garnetï¼Œå¼€å‘è€…å¯ä»¥æ›´å¥½åœ°æå‡åº”ç”¨çš„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒï¼Œå®ç°ä¸šåŠ¡çš„å¿«é€Ÿå‘å±•å’ŒæŒç»­åˆ›æ–°ã€‚</p>\n<h1 id=\"å‚è€ƒæ–‡æ¡£\"><a href=\"#å‚è€ƒæ–‡æ¡£\" class=\"headerlink\" title=\"å‚è€ƒæ–‡æ¡£\"></a>å‚è€ƒæ–‡æ¡£</h1><ul>\n<li><a href=\"https://microsoft.github.io/garnet/docs\">Garnet å¼€å‘å…¥é—¨</a></li>\n</ul>\n<p>æ›´å¤šä¸€æ‰‹è®¯æ¯ï¼Œå¯å…³æ³¨å…¬ä¼—å·ï¼š<a href=\"https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg\">ITProHub</a></p>\n<p><img src=\"https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg\" alt=\"ITProHub\"></p>\n"},{"title":"HTTPSçš„å·¥ä½œåŸç†ä»¥åŠå®‰è£…","date":"2024-04-11T07:36:46.000Z","_content":"\n# ä»€ä¹ˆæ˜¯ HTTPSï¼Ÿ\nHTTP æ˜¯ä¸€ç§ç”¨äºåœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼ˆWeb æµè§ˆå™¨ï¼‰ä¹‹é—´äº¤æ¢æ•°æ®çš„äº’è”ç½‘åè®®ã€‚ HTTPS åªä¸è¿‡æ˜¯åœ¨HTTPçš„åŸºç¡€ä¸Šæ·»åŠ äº†å®‰å…¨å±‚ã€‚\nHTTP ä¸æ˜¯ä¸€ä¸ªå®‰å…¨åè®®ï¼šå®ƒæ˜¯ä¸ºäº†çº¯ç²¹çš„åŠŸèƒ½ç›®æ ‡è€Œè®¾è®¡çš„ï¼Œæ²¡æœ‰è€ƒè™‘ä»»ä½•å®‰å…¨çº¦æŸã€‚\n\næ‰€ä»¥æˆ‘ä»¬ç»™HTTPæ·»åŠ äº†ä¸€ä¸ªå®‰å…¨å±‚ã€‚æ›´å‡†ç¡®åœ°è¯´ï¼Œå°† HTTP å°è£…åˆ°å®‰å…¨è¿æ¥ä¸­ã€‚\n\n![å®‰å…¨è¿æ¥](/images/https/security.png)\n\nHTTPS ä½¿æˆ‘ä»¬èƒ½å¤Ÿå®ç°ä¸‰ä¸ªç›®æ ‡ï¼š\n\n+ èº«ä»½éªŒè¯ï¼šHTTPS ä½¿ç”¨æ•°å­—è¯ä¹¦æ¥éªŒè¯æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„èº«ä»½ï¼Œé˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚æœåŠ¡å™¨éœ€è¦æä¾›æœ‰æ•ˆçš„æ•°å­—è¯ä¹¦ï¼Œè€Œå®¢æˆ·ç«¯å¯ä»¥éªŒè¯è¯ä¹¦çš„æœ‰æ•ˆæ€§ï¼Œç¡®ä¿ä¸æ­£ç¡®çš„æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚\n+ éšç§ï¼šç½‘ç»œä¸Šçš„ä»»ä½•äººéƒ½æ— æ³•è¯»å–æ•°æ®ï¼Œå› ä¸ºå®ƒæ˜¯åŠ å¯†çš„\n+ å®Œæ•´æ€§ï¼šHTTPS ä½¿ç”¨æ¶ˆæ¯æ‘˜è¦ç®—æ³•ï¼ˆå¦‚ SHA-256ï¼‰æ¥è®¡ç®—æ•°æ®çš„æ‘˜è¦ï¼Œå¹¶å°†æ‘˜è¦ä¸æ•°æ®ä¸€èµ·ä¼ è¾“ã€‚æ¥æ”¶æ–¹å¯ä»¥éªŒè¯æ•°æ®çš„å®Œæ•´æ€§ï¼Œç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æœªè¢«ç¯¡æ”¹ã€‚\n\n\n# è¯ä¹¦é¢å‘æœºæ„\nè¯ä¹¦é¢å‘æœºæ„æ˜¯æä¾› SSL è¯ä¹¦çš„å…¬å¸ã€‚è¿™äº›ç»„ç»‡ä¸ºç½‘ç»œæµè§ˆå™¨æ‰€ç†ŸçŸ¥ï¼Œå¹¶æ¥å—è¿™äº›æœºæ„æä¾›çš„è¯ä¹¦ã€‚\nä»»ä½•äººéƒ½å¯ä»¥ç”Ÿæˆè¯ä¹¦ï¼Œä½†å¦‚æœä¸æ˜¯ç”±å·²çŸ¥æœºæ„æä¾›çš„ï¼Œæµè§ˆå™¨ä¼šæ˜¾ç¤ºå®‰å…¨è­¦æŠ¥ã€‚\n\nè¯ä¹¦é¢å‘æœºæ„ç¤ºä¾‹ï¼šDigiCertã€GeoTrustã€GlobalSignã€CFCAã€TrustAsia\n\n![ca](/images/https/ca2.png)\n\n# SSL æ¡æ‰‹\nSSL æ¡æ‰‹æ˜¯ Web æœåŠ¡å™¨å’Œæµè§ˆå™¨è®¨è®ºå¹¶å•†å®šè¦ä½¿ç”¨çš„åè®®ï¼ˆç‰¹å®šç‰ˆæœ¬ä¸­çš„ SSL æˆ– TLSï¼‰ã€è¦ä½¿ç”¨çš„å¯†ç å¥—ä»¶ä»¥åŠæœ€åè¦ä½¿ç”¨çš„ä¼šè¯å¯†é’¥çš„è¿‡ç¨‹ã€‚æ¡æ‰‹å®Œæˆåè¿›è¡Œé€šä¿¡ã€‚\n\n![æ¡æ‰‹è¿‡ç¨‹](/images/https/handshake.png)å›¾ç‰‡æ¥æºï¼šhttps://code-maze.com/wp-content/uploads/2017/07/TLS-handshake.png\n\nä¸æ·±ç©¶ç»†èŠ‚ï¼Œæ¡æ‰‹ä¼šç»è¿‡ä»¥ä¸‹æ­¥éª¤ï¼š\n\n1. æµè§ˆå™¨å’ŒæœåŠ¡å™¨å°±æ‰€ä½¿ç”¨çš„åè®®è¾¾æˆä¸€è‡´ï¼ˆSSL Xã€TLS Xï¼‰\n2. æµè§ˆå™¨éªŒè¯æœåŠ¡å™¨çš„çœŸå®æ€§ï¼ˆè¯ä¹¦é¢å‘æœºæ„ï¼‰\n3. æµè§ˆå™¨åˆ›å»ºä¼šè¯å¯†é’¥å¹¶ä½¿ç”¨æœåŠ¡å™¨çš„å…¬é’¥å¯¹å…¶è¿›è¡ŒåŠ å¯†\n4. æœåŠ¡å™¨ç”¨å…¶ç§é’¥è§£å¯†å…ˆå‰çš„æ¶ˆæ¯\n5. æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä½¿ç”¨ä»–ä»¬åˆšåˆšå•†å®šçš„ä¼šè¯å¯†é’¥è¿›è¡Œé€šä¿¡ã€‚æ¡æ‰‹å®Œæ¯•ã€‚\n\n\n\n\næ„Ÿå…´è¶£çš„åŒå­¦ä¹Ÿå¯ä»¥æŠ“åŒ…çœ‹ä¸€ä¸‹httpsè®¿é—®çš„è¯¦ç»†è¿‡ç¨‹ï¼Œä¸‹é¢æ˜¯ç”¨wiresharkæŠ“åŒ…çš„ç»“æœ\n![æ¡æ‰‹](/images/https/client-hello.png)\næ¡æ‰‹å®Œæˆåæ•°æ®ä¼ è¾“çš„éƒ½æ˜¯åŠ å¯†çš„æ•°æ®\n![æ•°æ®åŠ å¯†](/images/https/encrypted.png)\n\n\n\n\n# å¯†ç å¥—ä»¶\nHTTPS å†…å­˜åœ¨ä¸åŒçº§åˆ«çš„åŠ å¯†ã€‚\nå¦‚å‰æ‰€è¿°ï¼ŒHTTPS æ˜¯å°† HTTP å°è£…åˆ°å®‰å…¨åè®® SSL æˆ– TLS ä¸­ã€‚\nè¿™ä¸¤ç§å®‰å…¨åè®®å­˜åœ¨ä¸åŒçš„ç‰ˆæœ¬ï¼Œå…¶ä¸­ä¸€äº›è¢«è®¤ä¸ºæ˜¯è¾ƒå¼±çš„ã€‚è‡ªâ€œPOODLEâ€æ¼æ´ä»¥æ¥ï¼ŒSSL V2 å·²è¿‡æ—¶ï¼ŒSSL V3 ä¹Ÿå·²è¿‡æ—¶ã€‚ï¼ˆæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡Œç™¾åº¦ï¼‰\nä½¿ç”¨ï¼šTLS v1.0ã€v1.1ã€v1.2\n\næ­¤å¤–ï¼ŒSSLå’ŒTLSä½¿ç”¨ä¸åŒçš„åŠ å¯†ç®—æ³•ã€‚è¿™äº›ç®—æ³•åœ¨é€šä¿¡è¿‡ç¨‹ä¸­ä½¿ç”¨ï¼Œä½¿ç”¨å“ªç§ç®—æ³•å–å†³äºæœåŠ¡å™¨å’Œæµè§ˆå™¨æ¥å—çš„ç®—æ³•ã€‚\néšç€æ—¶é—´çš„æ¨ç§»ï¼Œå…¶ä¸­ä¸€äº›ç®—æ³•ä¼šå˜å¾—å¾ˆå¼±ï¼Œå¿…é¡»åœç”¨ï¼š\nä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æåˆ°å¯†é’¥å¤§å°ä½äº 128 ä½çš„æ‰€æœ‰å¯†ç å’Œ RC4 ç®—æ³•ã€‚\n\nå› æ­¤ï¼Œæœ‰å¿…è¦ä½¿ç³»ç»Ÿä¿æŒæœ€æ–°ï¼Œç‰¹åˆ«æ˜¯ Web æœåŠ¡å™¨çš„ HTTPS é…ç½®ã€‚\n\n## client hello\nä¸‹é¢æ˜¯æˆ‘ä»¬é€šè¿‡wiresharæŠ“åŒ…æŸ¥çœ‹å®¢æˆ·ç«¯æ”¯æŒçš„å¯†ç å¥—ä»¶\n![å®¢æˆ·ç«¯æ”¯æŒçš„å¯†ç å¥—ä»¶](/images/https/cipher-suites.png)\n\n## server hello\nå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯åå•†å¯†ç å¥—ä»¶, ä¸»è¦æ˜¯ä»å®¢æˆ·ç«¯æ”¯æŒçš„åŠ å¯†æ–¹å¼ä¸­é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„å‘Šè¯‰å®¢æˆ·ç«¯ã€‚\n![åå•†å¯†ç å¥—ä»¶](/images/https/negotiated-cipher-suite.png)\n\n## è¯¥å¯†ç ä¸²çš„å«ä¹‰\nECDHEï¼šå¯†é’¥äº¤æ¢ç®—æ³•\nECDSAï¼šèº«ä»½éªŒè¯\nAES_128_CBCï¼šç”¨äºæ¶ˆæ¯åŠ å¯†çš„æ‰¹é‡å¯†ç \nSHAï¼šMAC ç®—æ³•\n\n\n# åœ¨ Web æœåŠ¡å™¨ä¸Šå®‰è£… HTTPS\nå¯¹äºä¸åŒç±»å‹çš„æœåŠ¡å™¨ï¼Œåœ¨ Web æœåŠ¡å™¨ä¸Šé…ç½® HTTPS ç›¸å¯¹ç®€å•ï¼Œå¹¶ä¸”æœ‰è¯¦ç»†çš„æ–‡æ¡£è®°å½•ã€‚\n\nè®¾ç½®çš„ä¸»è¦æ­¥éª¤æ˜¯ï¼š\n\n+ å‘è¯ä¹¦é¢å‘æœºæ„è®¢è´­ SSL è¯ä¹¦\n+ åœ¨ Web æœåŠ¡å™¨ä¸­å®‰è£…è¯ä¹¦ï¼ˆè¦å¤åˆ¶åˆ°æœåŠ¡å™¨çš„æ–‡ä»¶ï¼‰\n+ é…ç½®ç½‘ç»œæœåŠ¡å™¨\n\næœåŠ¡å™¨çš„é…ç½®å¯èƒ½åŒ…æ‹¬ï¼š\n\n+ è¯ä¹¦ç»‘å®šçš„IPåœ°å€-ç«¯å£/åŸŸå\n+ æ¿€æ´»åè®®çš„é…ç½®ï¼ˆTLS/SSLï¼‰\n+ ç®—æ³•å’Œå¯†ç å¯†é’¥å¤§å°çš„é…ç½®ï¼ˆå¯†ç å¥—ä»¶ï¼‰\n\n```nginx\nserver {\n    listen 443 ssl;\n    server_name xxx;\n\n    ssl_certificate /cert/xxx.crt;\n    ssl_certificate_key /cert/xxx.key;\n\n    location / {\n        proxy_pass http://localhost:4000;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n}\n```\n\nå¯ä»¥åœ¨ä¸‹é¢æ‰¾åˆ°è¯¦ç»†è¯´æ˜å¦‚ä½•åœ¨ä¸‰ä¸ªä¸»è¦ Web æœåŠ¡å™¨ä¸Šå®‰è£… SSL çš„æ–‡æ¡£é“¾æ¥ï¼š\nApacheï¼š  https://wiki.apache.org/httpd/SSL\nIISï¼š http://www.iis.net/learn/manage/configuring-security/how-to-set-up-ssl-on-iis\nNginxï¼š http://nginx.org/en/docs/http/configuring_https_servers.html\n\nMozilla å‘å¸ƒäº†ä¸€ä¸ªç«™ç‚¹ï¼Œä½ å¯ä»¥åœ¨å…¶ä¸­ç”Ÿæˆå®‰å…¨çš„ HTTPS é…ç½®ï¼š\n\n[Mozilla SSL é…ç½®ç”Ÿæˆå™¨](https://mozilla.github.io/server-side-tls/ssl-config-generator/)\n\n\n# ä¿æŒ HTTPS æ›´æ–°ä¸ºæœ€æ–°\nHTTPS é…ç½®ä¸æ˜¯ä¸€æ¬¡æ€§äº‹ä»¶ã€‚å®‰è£…åï¼Œå¿…é¡»ä¿æŒå…¶é…ç½®æœ€æ–°ã€‚\nå¾ˆå¤šbugéƒ½ä¼šå½±å“ä¸€äº›è¾ƒä½ç‰ˆæœ¬çš„openSSLåº“(ä¾‹å¦‚[Heartbleed](https://baike.baidu.com/item/Heartbleed/13580882)), ç³»ç»Ÿæ›´æ–°å¯ä»¥å¸®åŠ©é¿å…ä¸€äº›ä¸ HTTPS ä½¿ç”¨ç›´æ¥ç›¸å…³çš„æ¼æ´ã€‚\n\næ­¤å¤–ï¼Œæœ‰å¿…è¦éšæ—¶äº†è§£ä¸åŒåè®®å’Œå¯†ç å¥—ä»¶çš„å®‰å…¨æ€§ã€‚è¿™é‡Œçš„ç›®æ ‡æ˜¯åœ¨æŸäº›æ—¶å€™è¢«è®¤ä¸ºè¾ƒå¼±çš„æƒ…å†µä¸‹åœç”¨å…¶ä¸­ä¸€äº›ã€‚\n\næœ€åä¸€ç‚¹ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ï¼Œä¹Ÿæ˜¯å¾ˆæ˜æ˜¾ä½†ç»å¸¸è¢«é—å¿˜çš„ï¼šè¯ä¹¦è¿‡æœŸã€‚ä¸€æ—¦è¯ä¹¦è¿‡æœŸï¼Œç½‘ç»œæµè§ˆå™¨å°†æ˜¾ç¤ºéå¸¸å…·æœ‰åŠé˜»æ€§çš„å®‰å…¨è­¦æŠ¥ï¼Œé¼“åŠ±ç”¨æˆ·ç¦»å¼€ç½‘ç«™ã€‚\n\nç›¸ä¿¡å¤§å®¶åœ¨æµè§ˆç½‘ç«™çš„æ—¶å€™é‡åˆ°è¿‡è¿™æ ·çš„æƒ…å†µ\n![è¿‡æœŸ](/images/https/expire.png)\n\n\n# HTTPS ä¸åšä»€ä¹ˆ\näººä»¬å¾ˆå®¹æ˜“è®¤ä¸º HTTPS æ˜¯ä¸€ä¸ªç¥å¥‡çš„äº’è”ç½‘å®‰å…¨è§£å†³æ–¹æ¡ˆï¼Œä½†å®ƒè¿˜æœ‰å¾ˆå¤šä¸èƒ½åšçš„äº‹æƒ…ã€‚\n\n## HTTPS ä¸ä¼šï¼š\n1. éšè—ä½ æ­£åœ¨è®¿é—®çš„ç½‘ç«™çš„åç§°\n\nè¿™æ˜¯å› ä¸ºç½‘ç«™çš„åç§°ï¼ˆåˆåâ€œåŸŸâ€ï¼‰æ˜¯ä½¿ç”¨ DNSï¼ˆåŸŸåæœåŠ¡ï¼‰å‘é€çš„ï¼Œè€Œ DNS ä¸åœ¨ HTTPS éš§é“å†…ã€‚å®ƒåœ¨å»ºç«‹å®‰å…¨è¿æ¥ä¹‹å‰å‘é€ã€‚ä¸­é—´çš„çªƒå¬è€…å¯ä»¥çœ‹åˆ°ä½ è¦è®¿é—®çš„ç½‘ç«™çš„åç§°ï¼ˆä¾‹å¦‚ TipTopSecurity.comï¼‰ï¼Œä»–ä»¬åªæ˜¯æ— æ³•è¯»å–æ¥å›ä¼ è¾“çš„ä»»ä½•å®é™…å†…å®¹ã€‚ç›´åˆ°DNSSECå®Œå…¨å®æ–½åï¼Œè¿™ç§æƒ…å†µæ‰ä¼šæ”¹å˜ã€‚\n\n2. ä¿æŠ¤ä½ å…å—è®¿é—®é‚ªæ¶ç½‘ç«™çš„ä¾µå®³\n\nHTTPS ä¸èƒ½ç¡®ä¿ç½‘ç«™æœ¬èº«çš„å®‰å…¨ã€‚ä»…ä»…å› ä¸ºä½ å®‰å…¨è¿æ¥å¹¶ä¸æ„å‘³ç€ä½ æ²¡æœ‰è¿æ¥åˆ°ç”±åäººè¿è¡Œçš„ç½‘ç«™ã€‚æˆ‘ä»¬å°è¯•é€šè¿‡å—ä¿¡ä»»çš„è¯ä¹¦é¢å‘æœºæ„æ¥è§£å†³æ­¤é—®é¢˜ï¼Œä½†è¯¥ç³»ç»Ÿå¹¶ä¸å®Œç¾ï¼ˆè¯·ç»§ç»­å…³æ³¨æœ‰å…³æ­¤æ–¹é¢çš„æ›´å¤šä¿¡æ¯ï¼‰ã€‚\n\n3. æä¾›åŒ¿å\n\nHTTPS ä¸ä¼šéšè—ä½ çš„ç‰©ç†ä½ç½®æˆ–ä¸ªäººèº«ä»½ã€‚ä½ çš„ä¸ªäºº IP åœ°å€ï¼ˆä½ åœ¨äº’è”ç½‘ä¸Šçš„åœ°å€ï¼‰å¿…é¡»é™„åŠ åˆ°åŠ å¯†æ•°æ®çš„å¤–éƒ¨ï¼Œå› ä¸ºå¦‚æœä½ çš„ IP åœ°å€ä¹Ÿè¢«åŠ å¯†ï¼Œäº’è”ç½‘å°†ä¸çŸ¥é“å°†å…¶å‘é€åˆ°å“ªé‡Œã€‚è€Œä¸”å®ƒä¹Ÿä¸ä¼šåœ¨ä½ æ­£åœ¨è®¿é—®çš„ç½‘ç«™ä¸Šéšè—ä½ çš„èº«ä»½ã€‚ä½ è®¿é—®çš„ç½‘ç«™ä»ç„¶äº†è§£ä½ çš„ä¸€åˆ‡ï¼Œå°±åƒåœ¨éå®‰å…¨è¿æ¥ä¸Šä¸€æ ·ã€‚\n\n4. é˜²æ­¢ä½ æ„ŸæŸ“ç—…æ¯’\n\nHTTPS ä¸æ˜¯è¿‡æ»¤å™¨ã€‚æœ‰å¯èƒ½é€šè¿‡ HTTPS è¿æ¥æ¥æ”¶ç—…æ¯’å’Œå…¶ä»–æ¶æ„è½¯ä»¶ã€‚å¦‚æœ Web æœåŠ¡å™¨è¢«æ„ŸæŸ“æˆ–è€…ä½ æ‰€åœ¨çš„æ¶æ„ç½‘ç«™æ­£åœ¨åˆ†å‘æ¶æ„è½¯ä»¶ï¼Œåˆ™è¯¥æ¶æ„è½¯ä»¶å°†åƒå…¶ä»–æ‰€æœ‰å†…å®¹ä¸€æ ·åœ¨ HTTPS æµä¸­å‘é€ã€‚ç„¶è€Œï¼Œ HTTPSç¡®å®å¯ä»¥é˜²æ­¢ä¸­é—´çš„ä»»ä½•äººå°†æ¶æ„è½¯ä»¶æ³¨å…¥åˆ°ä½ çš„ç§»åŠ¨æµé‡ä¸­ã€‚\n\n5. ä¿æŠ¤ä½ çš„è®¡ç®—æœºå…é­é»‘å®¢æ”»å‡»\n\nHTTPS ä»…ä¿æŠ¤åœ¨ä½ çš„è®¡ç®—æœºå’Œ Web æœåŠ¡å™¨ä¹‹é—´ç§»åŠ¨çš„æ•°æ®ã€‚å®ƒä¸ä¼šä¸ºä½ çš„å®é™…è®¡ç®—æœºæˆ–æœåŠ¡å™¨æœ¬èº«æä¾›ä»»ä½•ä¿æŠ¤ã€‚è¿™ä¹Ÿæ„å‘³ç€ï¼Œå¦‚æœæœ‰æ¶æ„è½¯ä»¶æ­£åœ¨ç›‘è§†è¿æ¥ä¸€ç«¯çš„æµé‡ï¼Œå®ƒå°±å¯ä»¥è¯»å– HTTPS æµä¸­åŠ å¯†ä¹‹å‰å’Œä¹‹åçš„æµé‡ã€‚\n\n\næ›´å¤šä¸€æ‰‹è®¯æ¯ï¼Œå¯å…³æ³¨å…¬ä¼—å·ï¼š[ITProHub](https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg)\n\n![ITProHub](https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg)","source":"_posts/https.md","raw":"---\ntitle: HTTPSçš„å·¥ä½œåŸç†ä»¥åŠå®‰è£…\ndate: 2024-04-11 15:36:46\ntags: https http ssl tls\n---\n\n# ä»€ä¹ˆæ˜¯ HTTPSï¼Ÿ\nHTTP æ˜¯ä¸€ç§ç”¨äºåœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼ˆWeb æµè§ˆå™¨ï¼‰ä¹‹é—´äº¤æ¢æ•°æ®çš„äº’è”ç½‘åè®®ã€‚ HTTPS åªä¸è¿‡æ˜¯åœ¨HTTPçš„åŸºç¡€ä¸Šæ·»åŠ äº†å®‰å…¨å±‚ã€‚\nHTTP ä¸æ˜¯ä¸€ä¸ªå®‰å…¨åè®®ï¼šå®ƒæ˜¯ä¸ºäº†çº¯ç²¹çš„åŠŸèƒ½ç›®æ ‡è€Œè®¾è®¡çš„ï¼Œæ²¡æœ‰è€ƒè™‘ä»»ä½•å®‰å…¨çº¦æŸã€‚\n\næ‰€ä»¥æˆ‘ä»¬ç»™HTTPæ·»åŠ äº†ä¸€ä¸ªå®‰å…¨å±‚ã€‚æ›´å‡†ç¡®åœ°è¯´ï¼Œå°† HTTP å°è£…åˆ°å®‰å…¨è¿æ¥ä¸­ã€‚\n\n![å®‰å…¨è¿æ¥](/images/https/security.png)\n\nHTTPS ä½¿æˆ‘ä»¬èƒ½å¤Ÿå®ç°ä¸‰ä¸ªç›®æ ‡ï¼š\n\n+ èº«ä»½éªŒè¯ï¼šHTTPS ä½¿ç”¨æ•°å­—è¯ä¹¦æ¥éªŒè¯æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„èº«ä»½ï¼Œé˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚æœåŠ¡å™¨éœ€è¦æä¾›æœ‰æ•ˆçš„æ•°å­—è¯ä¹¦ï¼Œè€Œå®¢æˆ·ç«¯å¯ä»¥éªŒè¯è¯ä¹¦çš„æœ‰æ•ˆæ€§ï¼Œç¡®ä¿ä¸æ­£ç¡®çš„æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚\n+ éšç§ï¼šç½‘ç»œä¸Šçš„ä»»ä½•äººéƒ½æ— æ³•è¯»å–æ•°æ®ï¼Œå› ä¸ºå®ƒæ˜¯åŠ å¯†çš„\n+ å®Œæ•´æ€§ï¼šHTTPS ä½¿ç”¨æ¶ˆæ¯æ‘˜è¦ç®—æ³•ï¼ˆå¦‚ SHA-256ï¼‰æ¥è®¡ç®—æ•°æ®çš„æ‘˜è¦ï¼Œå¹¶å°†æ‘˜è¦ä¸æ•°æ®ä¸€èµ·ä¼ è¾“ã€‚æ¥æ”¶æ–¹å¯ä»¥éªŒè¯æ•°æ®çš„å®Œæ•´æ€§ï¼Œç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æœªè¢«ç¯¡æ”¹ã€‚\n\n\n# è¯ä¹¦é¢å‘æœºæ„\nè¯ä¹¦é¢å‘æœºæ„æ˜¯æä¾› SSL è¯ä¹¦çš„å…¬å¸ã€‚è¿™äº›ç»„ç»‡ä¸ºç½‘ç»œæµè§ˆå™¨æ‰€ç†ŸçŸ¥ï¼Œå¹¶æ¥å—è¿™äº›æœºæ„æä¾›çš„è¯ä¹¦ã€‚\nä»»ä½•äººéƒ½å¯ä»¥ç”Ÿæˆè¯ä¹¦ï¼Œä½†å¦‚æœä¸æ˜¯ç”±å·²çŸ¥æœºæ„æä¾›çš„ï¼Œæµè§ˆå™¨ä¼šæ˜¾ç¤ºå®‰å…¨è­¦æŠ¥ã€‚\n\nè¯ä¹¦é¢å‘æœºæ„ç¤ºä¾‹ï¼šDigiCertã€GeoTrustã€GlobalSignã€CFCAã€TrustAsia\n\n![ca](/images/https/ca2.png)\n\n# SSL æ¡æ‰‹\nSSL æ¡æ‰‹æ˜¯ Web æœåŠ¡å™¨å’Œæµè§ˆå™¨è®¨è®ºå¹¶å•†å®šè¦ä½¿ç”¨çš„åè®®ï¼ˆç‰¹å®šç‰ˆæœ¬ä¸­çš„ SSL æˆ– TLSï¼‰ã€è¦ä½¿ç”¨çš„å¯†ç å¥—ä»¶ä»¥åŠæœ€åè¦ä½¿ç”¨çš„ä¼šè¯å¯†é’¥çš„è¿‡ç¨‹ã€‚æ¡æ‰‹å®Œæˆåè¿›è¡Œé€šä¿¡ã€‚\n\n![æ¡æ‰‹è¿‡ç¨‹](/images/https/handshake.png)å›¾ç‰‡æ¥æºï¼šhttps://code-maze.com/wp-content/uploads/2017/07/TLS-handshake.png\n\nä¸æ·±ç©¶ç»†èŠ‚ï¼Œæ¡æ‰‹ä¼šç»è¿‡ä»¥ä¸‹æ­¥éª¤ï¼š\n\n1. æµè§ˆå™¨å’ŒæœåŠ¡å™¨å°±æ‰€ä½¿ç”¨çš„åè®®è¾¾æˆä¸€è‡´ï¼ˆSSL Xã€TLS Xï¼‰\n2. æµè§ˆå™¨éªŒè¯æœåŠ¡å™¨çš„çœŸå®æ€§ï¼ˆè¯ä¹¦é¢å‘æœºæ„ï¼‰\n3. æµè§ˆå™¨åˆ›å»ºä¼šè¯å¯†é’¥å¹¶ä½¿ç”¨æœåŠ¡å™¨çš„å…¬é’¥å¯¹å…¶è¿›è¡ŒåŠ å¯†\n4. æœåŠ¡å™¨ç”¨å…¶ç§é’¥è§£å¯†å…ˆå‰çš„æ¶ˆæ¯\n5. æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä½¿ç”¨ä»–ä»¬åˆšåˆšå•†å®šçš„ä¼šè¯å¯†é’¥è¿›è¡Œé€šä¿¡ã€‚æ¡æ‰‹å®Œæ¯•ã€‚\n\n\n\n\næ„Ÿå…´è¶£çš„åŒå­¦ä¹Ÿå¯ä»¥æŠ“åŒ…çœ‹ä¸€ä¸‹httpsè®¿é—®çš„è¯¦ç»†è¿‡ç¨‹ï¼Œä¸‹é¢æ˜¯ç”¨wiresharkæŠ“åŒ…çš„ç»“æœ\n![æ¡æ‰‹](/images/https/client-hello.png)\næ¡æ‰‹å®Œæˆåæ•°æ®ä¼ è¾“çš„éƒ½æ˜¯åŠ å¯†çš„æ•°æ®\n![æ•°æ®åŠ å¯†](/images/https/encrypted.png)\n\n\n\n\n# å¯†ç å¥—ä»¶\nHTTPS å†…å­˜åœ¨ä¸åŒçº§åˆ«çš„åŠ å¯†ã€‚\nå¦‚å‰æ‰€è¿°ï¼ŒHTTPS æ˜¯å°† HTTP å°è£…åˆ°å®‰å…¨åè®® SSL æˆ– TLS ä¸­ã€‚\nè¿™ä¸¤ç§å®‰å…¨åè®®å­˜åœ¨ä¸åŒçš„ç‰ˆæœ¬ï¼Œå…¶ä¸­ä¸€äº›è¢«è®¤ä¸ºæ˜¯è¾ƒå¼±çš„ã€‚è‡ªâ€œPOODLEâ€æ¼æ´ä»¥æ¥ï¼ŒSSL V2 å·²è¿‡æ—¶ï¼ŒSSL V3 ä¹Ÿå·²è¿‡æ—¶ã€‚ï¼ˆæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡Œç™¾åº¦ï¼‰\nä½¿ç”¨ï¼šTLS v1.0ã€v1.1ã€v1.2\n\næ­¤å¤–ï¼ŒSSLå’ŒTLSä½¿ç”¨ä¸åŒçš„åŠ å¯†ç®—æ³•ã€‚è¿™äº›ç®—æ³•åœ¨é€šä¿¡è¿‡ç¨‹ä¸­ä½¿ç”¨ï¼Œä½¿ç”¨å“ªç§ç®—æ³•å–å†³äºæœåŠ¡å™¨å’Œæµè§ˆå™¨æ¥å—çš„ç®—æ³•ã€‚\néšç€æ—¶é—´çš„æ¨ç§»ï¼Œå…¶ä¸­ä¸€äº›ç®—æ³•ä¼šå˜å¾—å¾ˆå¼±ï¼Œå¿…é¡»åœç”¨ï¼š\nä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æåˆ°å¯†é’¥å¤§å°ä½äº 128 ä½çš„æ‰€æœ‰å¯†ç å’Œ RC4 ç®—æ³•ã€‚\n\nå› æ­¤ï¼Œæœ‰å¿…è¦ä½¿ç³»ç»Ÿä¿æŒæœ€æ–°ï¼Œç‰¹åˆ«æ˜¯ Web æœåŠ¡å™¨çš„ HTTPS é…ç½®ã€‚\n\n## client hello\nä¸‹é¢æ˜¯æˆ‘ä»¬é€šè¿‡wiresharæŠ“åŒ…æŸ¥çœ‹å®¢æˆ·ç«¯æ”¯æŒçš„å¯†ç å¥—ä»¶\n![å®¢æˆ·ç«¯æ”¯æŒçš„å¯†ç å¥—ä»¶](/images/https/cipher-suites.png)\n\n## server hello\nå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯åå•†å¯†ç å¥—ä»¶, ä¸»è¦æ˜¯ä»å®¢æˆ·ç«¯æ”¯æŒçš„åŠ å¯†æ–¹å¼ä¸­é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„å‘Šè¯‰å®¢æˆ·ç«¯ã€‚\n![åå•†å¯†ç å¥—ä»¶](/images/https/negotiated-cipher-suite.png)\n\n## è¯¥å¯†ç ä¸²çš„å«ä¹‰\nECDHEï¼šå¯†é’¥äº¤æ¢ç®—æ³•\nECDSAï¼šèº«ä»½éªŒè¯\nAES_128_CBCï¼šç”¨äºæ¶ˆæ¯åŠ å¯†çš„æ‰¹é‡å¯†ç \nSHAï¼šMAC ç®—æ³•\n\n\n# åœ¨ Web æœåŠ¡å™¨ä¸Šå®‰è£… HTTPS\nå¯¹äºä¸åŒç±»å‹çš„æœåŠ¡å™¨ï¼Œåœ¨ Web æœåŠ¡å™¨ä¸Šé…ç½® HTTPS ç›¸å¯¹ç®€å•ï¼Œå¹¶ä¸”æœ‰è¯¦ç»†çš„æ–‡æ¡£è®°å½•ã€‚\n\nè®¾ç½®çš„ä¸»è¦æ­¥éª¤æ˜¯ï¼š\n\n+ å‘è¯ä¹¦é¢å‘æœºæ„è®¢è´­ SSL è¯ä¹¦\n+ åœ¨ Web æœåŠ¡å™¨ä¸­å®‰è£…è¯ä¹¦ï¼ˆè¦å¤åˆ¶åˆ°æœåŠ¡å™¨çš„æ–‡ä»¶ï¼‰\n+ é…ç½®ç½‘ç»œæœåŠ¡å™¨\n\næœåŠ¡å™¨çš„é…ç½®å¯èƒ½åŒ…æ‹¬ï¼š\n\n+ è¯ä¹¦ç»‘å®šçš„IPåœ°å€-ç«¯å£/åŸŸå\n+ æ¿€æ´»åè®®çš„é…ç½®ï¼ˆTLS/SSLï¼‰\n+ ç®—æ³•å’Œå¯†ç å¯†é’¥å¤§å°çš„é…ç½®ï¼ˆå¯†ç å¥—ä»¶ï¼‰\n\n```nginx\nserver {\n    listen 443 ssl;\n    server_name xxx;\n\n    ssl_certificate /cert/xxx.crt;\n    ssl_certificate_key /cert/xxx.key;\n\n    location / {\n        proxy_pass http://localhost:4000;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n}\n```\n\nå¯ä»¥åœ¨ä¸‹é¢æ‰¾åˆ°è¯¦ç»†è¯´æ˜å¦‚ä½•åœ¨ä¸‰ä¸ªä¸»è¦ Web æœåŠ¡å™¨ä¸Šå®‰è£… SSL çš„æ–‡æ¡£é“¾æ¥ï¼š\nApacheï¼š  https://wiki.apache.org/httpd/SSL\nIISï¼š http://www.iis.net/learn/manage/configuring-security/how-to-set-up-ssl-on-iis\nNginxï¼š http://nginx.org/en/docs/http/configuring_https_servers.html\n\nMozilla å‘å¸ƒäº†ä¸€ä¸ªç«™ç‚¹ï¼Œä½ å¯ä»¥åœ¨å…¶ä¸­ç”Ÿæˆå®‰å…¨çš„ HTTPS é…ç½®ï¼š\n\n[Mozilla SSL é…ç½®ç”Ÿæˆå™¨](https://mozilla.github.io/server-side-tls/ssl-config-generator/)\n\n\n# ä¿æŒ HTTPS æ›´æ–°ä¸ºæœ€æ–°\nHTTPS é…ç½®ä¸æ˜¯ä¸€æ¬¡æ€§äº‹ä»¶ã€‚å®‰è£…åï¼Œå¿…é¡»ä¿æŒå…¶é…ç½®æœ€æ–°ã€‚\nå¾ˆå¤šbugéƒ½ä¼šå½±å“ä¸€äº›è¾ƒä½ç‰ˆæœ¬çš„openSSLåº“(ä¾‹å¦‚[Heartbleed](https://baike.baidu.com/item/Heartbleed/13580882)), ç³»ç»Ÿæ›´æ–°å¯ä»¥å¸®åŠ©é¿å…ä¸€äº›ä¸ HTTPS ä½¿ç”¨ç›´æ¥ç›¸å…³çš„æ¼æ´ã€‚\n\næ­¤å¤–ï¼Œæœ‰å¿…è¦éšæ—¶äº†è§£ä¸åŒåè®®å’Œå¯†ç å¥—ä»¶çš„å®‰å…¨æ€§ã€‚è¿™é‡Œçš„ç›®æ ‡æ˜¯åœ¨æŸäº›æ—¶å€™è¢«è®¤ä¸ºè¾ƒå¼±çš„æƒ…å†µä¸‹åœç”¨å…¶ä¸­ä¸€äº›ã€‚\n\næœ€åä¸€ç‚¹ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ï¼Œä¹Ÿæ˜¯å¾ˆæ˜æ˜¾ä½†ç»å¸¸è¢«é—å¿˜çš„ï¼šè¯ä¹¦è¿‡æœŸã€‚ä¸€æ—¦è¯ä¹¦è¿‡æœŸï¼Œç½‘ç»œæµè§ˆå™¨å°†æ˜¾ç¤ºéå¸¸å…·æœ‰åŠé˜»æ€§çš„å®‰å…¨è­¦æŠ¥ï¼Œé¼“åŠ±ç”¨æˆ·ç¦»å¼€ç½‘ç«™ã€‚\n\nç›¸ä¿¡å¤§å®¶åœ¨æµè§ˆç½‘ç«™çš„æ—¶å€™é‡åˆ°è¿‡è¿™æ ·çš„æƒ…å†µ\n![è¿‡æœŸ](/images/https/expire.png)\n\n\n# HTTPS ä¸åšä»€ä¹ˆ\näººä»¬å¾ˆå®¹æ˜“è®¤ä¸º HTTPS æ˜¯ä¸€ä¸ªç¥å¥‡çš„äº’è”ç½‘å®‰å…¨è§£å†³æ–¹æ¡ˆï¼Œä½†å®ƒè¿˜æœ‰å¾ˆå¤šä¸èƒ½åšçš„äº‹æƒ…ã€‚\n\n## HTTPS ä¸ä¼šï¼š\n1. éšè—ä½ æ­£åœ¨è®¿é—®çš„ç½‘ç«™çš„åç§°\n\nè¿™æ˜¯å› ä¸ºç½‘ç«™çš„åç§°ï¼ˆåˆåâ€œåŸŸâ€ï¼‰æ˜¯ä½¿ç”¨ DNSï¼ˆåŸŸåæœåŠ¡ï¼‰å‘é€çš„ï¼Œè€Œ DNS ä¸åœ¨ HTTPS éš§é“å†…ã€‚å®ƒåœ¨å»ºç«‹å®‰å…¨è¿æ¥ä¹‹å‰å‘é€ã€‚ä¸­é—´çš„çªƒå¬è€…å¯ä»¥çœ‹åˆ°ä½ è¦è®¿é—®çš„ç½‘ç«™çš„åç§°ï¼ˆä¾‹å¦‚ TipTopSecurity.comï¼‰ï¼Œä»–ä»¬åªæ˜¯æ— æ³•è¯»å–æ¥å›ä¼ è¾“çš„ä»»ä½•å®é™…å†…å®¹ã€‚ç›´åˆ°DNSSECå®Œå…¨å®æ–½åï¼Œè¿™ç§æƒ…å†µæ‰ä¼šæ”¹å˜ã€‚\n\n2. ä¿æŠ¤ä½ å…å—è®¿é—®é‚ªæ¶ç½‘ç«™çš„ä¾µå®³\n\nHTTPS ä¸èƒ½ç¡®ä¿ç½‘ç«™æœ¬èº«çš„å®‰å…¨ã€‚ä»…ä»…å› ä¸ºä½ å®‰å…¨è¿æ¥å¹¶ä¸æ„å‘³ç€ä½ æ²¡æœ‰è¿æ¥åˆ°ç”±åäººè¿è¡Œçš„ç½‘ç«™ã€‚æˆ‘ä»¬å°è¯•é€šè¿‡å—ä¿¡ä»»çš„è¯ä¹¦é¢å‘æœºæ„æ¥è§£å†³æ­¤é—®é¢˜ï¼Œä½†è¯¥ç³»ç»Ÿå¹¶ä¸å®Œç¾ï¼ˆè¯·ç»§ç»­å…³æ³¨æœ‰å…³æ­¤æ–¹é¢çš„æ›´å¤šä¿¡æ¯ï¼‰ã€‚\n\n3. æä¾›åŒ¿å\n\nHTTPS ä¸ä¼šéšè—ä½ çš„ç‰©ç†ä½ç½®æˆ–ä¸ªäººèº«ä»½ã€‚ä½ çš„ä¸ªäºº IP åœ°å€ï¼ˆä½ åœ¨äº’è”ç½‘ä¸Šçš„åœ°å€ï¼‰å¿…é¡»é™„åŠ åˆ°åŠ å¯†æ•°æ®çš„å¤–éƒ¨ï¼Œå› ä¸ºå¦‚æœä½ çš„ IP åœ°å€ä¹Ÿè¢«åŠ å¯†ï¼Œäº’è”ç½‘å°†ä¸çŸ¥é“å°†å…¶å‘é€åˆ°å“ªé‡Œã€‚è€Œä¸”å®ƒä¹Ÿä¸ä¼šåœ¨ä½ æ­£åœ¨è®¿é—®çš„ç½‘ç«™ä¸Šéšè—ä½ çš„èº«ä»½ã€‚ä½ è®¿é—®çš„ç½‘ç«™ä»ç„¶äº†è§£ä½ çš„ä¸€åˆ‡ï¼Œå°±åƒåœ¨éå®‰å…¨è¿æ¥ä¸Šä¸€æ ·ã€‚\n\n4. é˜²æ­¢ä½ æ„ŸæŸ“ç—…æ¯’\n\nHTTPS ä¸æ˜¯è¿‡æ»¤å™¨ã€‚æœ‰å¯èƒ½é€šè¿‡ HTTPS è¿æ¥æ¥æ”¶ç—…æ¯’å’Œå…¶ä»–æ¶æ„è½¯ä»¶ã€‚å¦‚æœ Web æœåŠ¡å™¨è¢«æ„ŸæŸ“æˆ–è€…ä½ æ‰€åœ¨çš„æ¶æ„ç½‘ç«™æ­£åœ¨åˆ†å‘æ¶æ„è½¯ä»¶ï¼Œåˆ™è¯¥æ¶æ„è½¯ä»¶å°†åƒå…¶ä»–æ‰€æœ‰å†…å®¹ä¸€æ ·åœ¨ HTTPS æµä¸­å‘é€ã€‚ç„¶è€Œï¼Œ HTTPSç¡®å®å¯ä»¥é˜²æ­¢ä¸­é—´çš„ä»»ä½•äººå°†æ¶æ„è½¯ä»¶æ³¨å…¥åˆ°ä½ çš„ç§»åŠ¨æµé‡ä¸­ã€‚\n\n5. ä¿æŠ¤ä½ çš„è®¡ç®—æœºå…é­é»‘å®¢æ”»å‡»\n\nHTTPS ä»…ä¿æŠ¤åœ¨ä½ çš„è®¡ç®—æœºå’Œ Web æœåŠ¡å™¨ä¹‹é—´ç§»åŠ¨çš„æ•°æ®ã€‚å®ƒä¸ä¼šä¸ºä½ çš„å®é™…è®¡ç®—æœºæˆ–æœåŠ¡å™¨æœ¬èº«æä¾›ä»»ä½•ä¿æŠ¤ã€‚è¿™ä¹Ÿæ„å‘³ç€ï¼Œå¦‚æœæœ‰æ¶æ„è½¯ä»¶æ­£åœ¨ç›‘è§†è¿æ¥ä¸€ç«¯çš„æµé‡ï¼Œå®ƒå°±å¯ä»¥è¯»å– HTTPS æµä¸­åŠ å¯†ä¹‹å‰å’Œä¹‹åçš„æµé‡ã€‚\n\n\næ›´å¤šä¸€æ‰‹è®¯æ¯ï¼Œå¯å…³æ³¨å…¬ä¼—å·ï¼š[ITProHub](https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg)\n\n![ITProHub](https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg)","slug":"https","published":1,"updated":"2024-04-26T03:06:40.272Z","_id":"cluuzgyxx000088p1frvnfrom","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"ä»€ä¹ˆæ˜¯-HTTPSï¼Ÿ\"><a href=\"#ä»€ä¹ˆæ˜¯-HTTPSï¼Ÿ\" class=\"headerlink\" title=\"ä»€ä¹ˆæ˜¯ HTTPSï¼Ÿ\"></a>ä»€ä¹ˆæ˜¯ HTTPSï¼Ÿ</h1><p>HTTP æ˜¯ä¸€ç§ç”¨äºåœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼ˆWeb æµè§ˆå™¨ï¼‰ä¹‹é—´äº¤æ¢æ•°æ®çš„äº’è”ç½‘åè®®ã€‚ HTTPS åªä¸è¿‡æ˜¯åœ¨HTTPçš„åŸºç¡€ä¸Šæ·»åŠ äº†å®‰å…¨å±‚ã€‚<br>HTTP ä¸æ˜¯ä¸€ä¸ªå®‰å…¨åè®®ï¼šå®ƒæ˜¯ä¸ºäº†çº¯ç²¹çš„åŠŸèƒ½ç›®æ ‡è€Œè®¾è®¡çš„ï¼Œæ²¡æœ‰è€ƒè™‘ä»»ä½•å®‰å…¨çº¦æŸã€‚</p>\n<p>æ‰€ä»¥æˆ‘ä»¬ç»™HTTPæ·»åŠ äº†ä¸€ä¸ªå®‰å…¨å±‚ã€‚æ›´å‡†ç¡®åœ°è¯´ï¼Œå°† HTTP å°è£…åˆ°å®‰å…¨è¿æ¥ä¸­ã€‚</p>\n<p><img src=\"/images/https/security.png\" alt=\"å®‰å…¨è¿æ¥\"></p>\n<p>HTTPS ä½¿æˆ‘ä»¬èƒ½å¤Ÿå®ç°ä¸‰ä¸ªç›®æ ‡ï¼š</p>\n<ul>\n<li>èº«ä»½éªŒè¯ï¼šHTTPS ä½¿ç”¨æ•°å­—è¯ä¹¦æ¥éªŒè¯æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„èº«ä»½ï¼Œé˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚æœåŠ¡å™¨éœ€è¦æä¾›æœ‰æ•ˆçš„æ•°å­—è¯ä¹¦ï¼Œè€Œå®¢æˆ·ç«¯å¯ä»¥éªŒè¯è¯ä¹¦çš„æœ‰æ•ˆæ€§ï¼Œç¡®ä¿ä¸æ­£ç¡®çš„æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚</li>\n<li>éšç§ï¼šç½‘ç»œä¸Šçš„ä»»ä½•äººéƒ½æ— æ³•è¯»å–æ•°æ®ï¼Œå› ä¸ºå®ƒæ˜¯åŠ å¯†çš„</li>\n<li>å®Œæ•´æ€§ï¼šHTTPS ä½¿ç”¨æ¶ˆæ¯æ‘˜è¦ç®—æ³•ï¼ˆå¦‚ SHA-256ï¼‰æ¥è®¡ç®—æ•°æ®çš„æ‘˜è¦ï¼Œå¹¶å°†æ‘˜è¦ä¸æ•°æ®ä¸€èµ·ä¼ è¾“ã€‚æ¥æ”¶æ–¹å¯ä»¥éªŒè¯æ•°æ®çš„å®Œæ•´æ€§ï¼Œç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æœªè¢«ç¯¡æ”¹ã€‚</li>\n</ul>\n<h1 id=\"è¯ä¹¦é¢å‘æœºæ„\"><a href=\"#è¯ä¹¦é¢å‘æœºæ„\" class=\"headerlink\" title=\"è¯ä¹¦é¢å‘æœºæ„\"></a>è¯ä¹¦é¢å‘æœºæ„</h1><p>è¯ä¹¦é¢å‘æœºæ„æ˜¯æä¾› SSL è¯ä¹¦çš„å…¬å¸ã€‚è¿™äº›ç»„ç»‡ä¸ºç½‘ç»œæµè§ˆå™¨æ‰€ç†ŸçŸ¥ï¼Œå¹¶æ¥å—è¿™äº›æœºæ„æä¾›çš„è¯ä¹¦ã€‚<br>ä»»ä½•äººéƒ½å¯ä»¥ç”Ÿæˆè¯ä¹¦ï¼Œä½†å¦‚æœä¸æ˜¯ç”±å·²çŸ¥æœºæ„æä¾›çš„ï¼Œæµè§ˆå™¨ä¼šæ˜¾ç¤ºå®‰å…¨è­¦æŠ¥ã€‚</p>\n<p>è¯ä¹¦é¢å‘æœºæ„ç¤ºä¾‹ï¼šDigiCertã€GeoTrustã€GlobalSignã€CFCAã€TrustAsia</p>\n<p><img src=\"/images/https/ca2.png\" alt=\"ca\"></p>\n<h1 id=\"SSL-æ¡æ‰‹\"><a href=\"#SSL-æ¡æ‰‹\" class=\"headerlink\" title=\"SSL æ¡æ‰‹\"></a>SSL æ¡æ‰‹</h1><p>SSL æ¡æ‰‹æ˜¯ Web æœåŠ¡å™¨å’Œæµè§ˆå™¨è®¨è®ºå¹¶å•†å®šè¦ä½¿ç”¨çš„åè®®ï¼ˆç‰¹å®šç‰ˆæœ¬ä¸­çš„ SSL æˆ– TLSï¼‰ã€è¦ä½¿ç”¨çš„å¯†ç å¥—ä»¶ä»¥åŠæœ€åè¦ä½¿ç”¨çš„ä¼šè¯å¯†é’¥çš„è¿‡ç¨‹ã€‚æ¡æ‰‹å®Œæˆåè¿›è¡Œé€šä¿¡ã€‚</p>\n<p><img src=\"/images/https/handshake.png\" alt=\"æ¡æ‰‹è¿‡ç¨‹\">å›¾ç‰‡æ¥æºï¼š<a href=\"https://code-maze.com/wp-content/uploads/2017/07/TLS-handshake.png\">https://code-maze.com/wp-content/uploads/2017/07/TLS-handshake.png</a></p>\n<p>ä¸æ·±ç©¶ç»†èŠ‚ï¼Œæ¡æ‰‹ä¼šç»è¿‡ä»¥ä¸‹æ­¥éª¤ï¼š</p>\n<ol>\n<li>æµè§ˆå™¨å’ŒæœåŠ¡å™¨å°±æ‰€ä½¿ç”¨çš„åè®®è¾¾æˆä¸€è‡´ï¼ˆSSL Xã€TLS Xï¼‰</li>\n<li>æµè§ˆå™¨éªŒè¯æœåŠ¡å™¨çš„çœŸå®æ€§ï¼ˆè¯ä¹¦é¢å‘æœºæ„ï¼‰</li>\n<li>æµè§ˆå™¨åˆ›å»ºä¼šè¯å¯†é’¥å¹¶ä½¿ç”¨æœåŠ¡å™¨çš„å…¬é’¥å¯¹å…¶è¿›è¡ŒåŠ å¯†</li>\n<li>æœåŠ¡å™¨ç”¨å…¶ç§é’¥è§£å¯†å…ˆå‰çš„æ¶ˆæ¯</li>\n<li>æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä½¿ç”¨ä»–ä»¬åˆšåˆšå•†å®šçš„ä¼šè¯å¯†é’¥è¿›è¡Œé€šä¿¡ã€‚æ¡æ‰‹å®Œæ¯•ã€‚</li>\n</ol>\n<p>æ„Ÿå…´è¶£çš„åŒå­¦ä¹Ÿå¯ä»¥æŠ“åŒ…çœ‹ä¸€ä¸‹httpsè®¿é—®çš„è¯¦ç»†è¿‡ç¨‹ï¼Œä¸‹é¢æ˜¯ç”¨wiresharkæŠ“åŒ…çš„ç»“æœ<br><img src=\"/images/https/client-hello.png\" alt=\"æ¡æ‰‹\"><br>æ¡æ‰‹å®Œæˆåæ•°æ®ä¼ è¾“çš„éƒ½æ˜¯åŠ å¯†çš„æ•°æ®<br><img src=\"/images/https/encrypted.png\" alt=\"æ•°æ®åŠ å¯†\"></p>\n<h1 id=\"å¯†ç å¥—ä»¶\"><a href=\"#å¯†ç å¥—ä»¶\" class=\"headerlink\" title=\"å¯†ç å¥—ä»¶\"></a>å¯†ç å¥—ä»¶</h1><p>HTTPS å†…å­˜åœ¨ä¸åŒçº§åˆ«çš„åŠ å¯†ã€‚<br>å¦‚å‰æ‰€è¿°ï¼ŒHTTPS æ˜¯å°† HTTP å°è£…åˆ°å®‰å…¨åè®® SSL æˆ– TLS ä¸­ã€‚<br>è¿™ä¸¤ç§å®‰å…¨åè®®å­˜åœ¨ä¸åŒçš„ç‰ˆæœ¬ï¼Œå…¶ä¸­ä¸€äº›è¢«è®¤ä¸ºæ˜¯è¾ƒå¼±çš„ã€‚è‡ªâ€œPOODLEâ€æ¼æ´ä»¥æ¥ï¼ŒSSL V2 å·²è¿‡æ—¶ï¼ŒSSL V3 ä¹Ÿå·²è¿‡æ—¶ã€‚ï¼ˆæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡Œç™¾åº¦ï¼‰<br>ä½¿ç”¨ï¼šTLS v1.0ã€v1.1ã€v1.2</p>\n<p>æ­¤å¤–ï¼ŒSSLå’ŒTLSä½¿ç”¨ä¸åŒçš„åŠ å¯†ç®—æ³•ã€‚è¿™äº›ç®—æ³•åœ¨é€šä¿¡è¿‡ç¨‹ä¸­ä½¿ç”¨ï¼Œä½¿ç”¨å“ªç§ç®—æ³•å–å†³äºæœåŠ¡å™¨å’Œæµè§ˆå™¨æ¥å—çš„ç®—æ³•ã€‚<br>éšç€æ—¶é—´çš„æ¨ç§»ï¼Œå…¶ä¸­ä¸€äº›ç®—æ³•ä¼šå˜å¾—å¾ˆå¼±ï¼Œå¿…é¡»åœç”¨ï¼š<br>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æåˆ°å¯†é’¥å¤§å°ä½äº 128 ä½çš„æ‰€æœ‰å¯†ç å’Œ RC4 ç®—æ³•ã€‚</p>\n<p>å› æ­¤ï¼Œæœ‰å¿…è¦ä½¿ç³»ç»Ÿä¿æŒæœ€æ–°ï¼Œç‰¹åˆ«æ˜¯ Web æœåŠ¡å™¨çš„ HTTPS é…ç½®ã€‚</p>\n<h2 id=\"client-hello\"><a href=\"#client-hello\" class=\"headerlink\" title=\"client hello\"></a>client hello</h2><p>ä¸‹é¢æ˜¯æˆ‘ä»¬é€šè¿‡wiresharæŠ“åŒ…æŸ¥çœ‹å®¢æˆ·ç«¯æ”¯æŒçš„å¯†ç å¥—ä»¶<br><img src=\"/images/https/cipher-suites.png\" alt=\"å®¢æˆ·ç«¯æ”¯æŒçš„å¯†ç å¥—ä»¶\"></p>\n<h2 id=\"server-hello\"><a href=\"#server-hello\" class=\"headerlink\" title=\"server hello\"></a>server hello</h2><p>å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯åå•†å¯†ç å¥—ä»¶, ä¸»è¦æ˜¯ä»å®¢æˆ·ç«¯æ”¯æŒçš„åŠ å¯†æ–¹å¼ä¸­é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„å‘Šè¯‰å®¢æˆ·ç«¯ã€‚<br><img src=\"/images/https/negotiated-cipher-suite.png\" alt=\"åå•†å¯†ç å¥—ä»¶\"></p>\n<h2 id=\"è¯¥å¯†ç ä¸²çš„å«ä¹‰\"><a href=\"#è¯¥å¯†ç ä¸²çš„å«ä¹‰\" class=\"headerlink\" title=\"è¯¥å¯†ç ä¸²çš„å«ä¹‰\"></a>è¯¥å¯†ç ä¸²çš„å«ä¹‰</h2><p>ECDHEï¼šå¯†é’¥äº¤æ¢ç®—æ³•<br>ECDSAï¼šèº«ä»½éªŒè¯<br>AES_128_CBCï¼šç”¨äºæ¶ˆæ¯åŠ å¯†çš„æ‰¹é‡å¯†ç <br>SHAï¼šMAC ç®—æ³•</p>\n<h1 id=\"åœ¨-Web-æœåŠ¡å™¨ä¸Šå®‰è£…-HTTPS\"><a href=\"#åœ¨-Web-æœåŠ¡å™¨ä¸Šå®‰è£…-HTTPS\" class=\"headerlink\" title=\"åœ¨ Web æœåŠ¡å™¨ä¸Šå®‰è£… HTTPS\"></a>åœ¨ Web æœåŠ¡å™¨ä¸Šå®‰è£… HTTPS</h1><p>å¯¹äºä¸åŒç±»å‹çš„æœåŠ¡å™¨ï¼Œåœ¨ Web æœåŠ¡å™¨ä¸Šé…ç½® HTTPS ç›¸å¯¹ç®€å•ï¼Œå¹¶ä¸”æœ‰è¯¦ç»†çš„æ–‡æ¡£è®°å½•ã€‚</p>\n<p>è®¾ç½®çš„ä¸»è¦æ­¥éª¤æ˜¯ï¼š</p>\n<ul>\n<li>å‘è¯ä¹¦é¢å‘æœºæ„è®¢è´­ SSL è¯ä¹¦</li>\n<li>åœ¨ Web æœåŠ¡å™¨ä¸­å®‰è£…è¯ä¹¦ï¼ˆè¦å¤åˆ¶åˆ°æœåŠ¡å™¨çš„æ–‡ä»¶ï¼‰</li>\n<li>é…ç½®ç½‘ç»œæœåŠ¡å™¨</li>\n</ul>\n<p>æœåŠ¡å™¨çš„é…ç½®å¯èƒ½åŒ…æ‹¬ï¼š</p>\n<ul>\n<li>è¯ä¹¦ç»‘å®šçš„IPåœ°å€-ç«¯å£&#x2F;åŸŸå</li>\n<li>æ¿€æ´»åè®®çš„é…ç½®ï¼ˆTLS&#x2F;SSLï¼‰</li>\n<li>ç®—æ³•å’Œå¯†ç å¯†é’¥å¤§å°çš„é…ç½®ï¼ˆå¯†ç å¥—ä»¶ï¼‰</li>\n</ul>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">server</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">listen</span> <span class=\"number\">443</span> ssl;</span><br><span class=\"line\">    <span class=\"attribute\">server_name</span> xxx;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">ssl_certificate</span> /cert/xxx.crt;</span><br><span class=\"line\">    <span class=\"attribute\">ssl_certificate_key</span> /cert/xxx.key;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"section\">location</span> / &#123;</span><br><span class=\"line\">        <span class=\"attribute\">proxy_pass</span> http://localhost:4000;</span><br><span class=\"line\">        <span class=\"attribute\">proxy_set_header</span> Host <span class=\"variable\">$host</span>;</span><br><span class=\"line\">        <span class=\"attribute\">proxy_set_header</span> X-Real-IP <span class=\"variable\">$remote_addr</span>;</span><br><span class=\"line\">        <span class=\"attribute\">proxy_set_header</span> X-Forwarded-For <span class=\"variable\">$proxy_add_x_forwarded_for</span>;</span><br><span class=\"line\">        <span class=\"attribute\">proxy_set_header</span> X-Forwarded-Proto <span class=\"variable\">$scheme</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å¯ä»¥åœ¨ä¸‹é¢æ‰¾åˆ°è¯¦ç»†è¯´æ˜å¦‚ä½•åœ¨ä¸‰ä¸ªä¸»è¦ Web æœåŠ¡å™¨ä¸Šå®‰è£… SSL çš„æ–‡æ¡£é“¾æ¥ï¼š<br>Apacheï¼š  <a href=\"https://wiki.apache.org/httpd/SSL\">https://wiki.apache.org/httpd/SSL</a><br>IISï¼š <a href=\"http://www.iis.net/learn/manage/configuring-security/how-to-set-up-ssl-on-iis\">http://www.iis.net/learn/manage/configuring-security/how-to-set-up-ssl-on-iis</a><br>Nginxï¼š <a href=\"http://nginx.org/en/docs/http/configuring_https_servers.html\">http://nginx.org/en/docs/http/configuring_https_servers.html</a></p>\n<p>Mozilla å‘å¸ƒäº†ä¸€ä¸ªç«™ç‚¹ï¼Œä½ å¯ä»¥åœ¨å…¶ä¸­ç”Ÿæˆå®‰å…¨çš„ HTTPS é…ç½®ï¼š</p>\n<p><a href=\"https://mozilla.github.io/server-side-tls/ssl-config-generator/\">Mozilla SSL é…ç½®ç”Ÿæˆå™¨</a></p>\n<h1 id=\"ä¿æŒ-HTTPS-æ›´æ–°ä¸ºæœ€æ–°\"><a href=\"#ä¿æŒ-HTTPS-æ›´æ–°ä¸ºæœ€æ–°\" class=\"headerlink\" title=\"ä¿æŒ HTTPS æ›´æ–°ä¸ºæœ€æ–°\"></a>ä¿æŒ HTTPS æ›´æ–°ä¸ºæœ€æ–°</h1><p>HTTPS é…ç½®ä¸æ˜¯ä¸€æ¬¡æ€§äº‹ä»¶ã€‚å®‰è£…åï¼Œå¿…é¡»ä¿æŒå…¶é…ç½®æœ€æ–°ã€‚<br>å¾ˆå¤šbugéƒ½ä¼šå½±å“ä¸€äº›è¾ƒä½ç‰ˆæœ¬çš„openSSLåº“(ä¾‹å¦‚<a href=\"https://baike.baidu.com/item/Heartbleed/13580882\">Heartbleed</a>), ç³»ç»Ÿæ›´æ–°å¯ä»¥å¸®åŠ©é¿å…ä¸€äº›ä¸ HTTPS ä½¿ç”¨ç›´æ¥ç›¸å…³çš„æ¼æ´ã€‚</p>\n<p>æ­¤å¤–ï¼Œæœ‰å¿…è¦éšæ—¶äº†è§£ä¸åŒåè®®å’Œå¯†ç å¥—ä»¶çš„å®‰å…¨æ€§ã€‚è¿™é‡Œçš„ç›®æ ‡æ˜¯åœ¨æŸäº›æ—¶å€™è¢«è®¤ä¸ºè¾ƒå¼±çš„æƒ…å†µä¸‹åœç”¨å…¶ä¸­ä¸€äº›ã€‚</p>\n<p>æœ€åä¸€ç‚¹ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ï¼Œä¹Ÿæ˜¯å¾ˆæ˜æ˜¾ä½†ç»å¸¸è¢«é—å¿˜çš„ï¼šè¯ä¹¦è¿‡æœŸã€‚ä¸€æ—¦è¯ä¹¦è¿‡æœŸï¼Œç½‘ç»œæµè§ˆå™¨å°†æ˜¾ç¤ºéå¸¸å…·æœ‰åŠé˜»æ€§çš„å®‰å…¨è­¦æŠ¥ï¼Œé¼“åŠ±ç”¨æˆ·ç¦»å¼€ç½‘ç«™ã€‚</p>\n<p>ç›¸ä¿¡å¤§å®¶åœ¨æµè§ˆç½‘ç«™çš„æ—¶å€™é‡åˆ°è¿‡è¿™æ ·çš„æƒ…å†µ<br><img src=\"/images/https/expire.png\" alt=\"è¿‡æœŸ\"></p>\n<h1 id=\"HTTPS-ä¸åšä»€ä¹ˆ\"><a href=\"#HTTPS-ä¸åšä»€ä¹ˆ\" class=\"headerlink\" title=\"HTTPS ä¸åšä»€ä¹ˆ\"></a>HTTPS ä¸åšä»€ä¹ˆ</h1><p>äººä»¬å¾ˆå®¹æ˜“è®¤ä¸º HTTPS æ˜¯ä¸€ä¸ªç¥å¥‡çš„äº’è”ç½‘å®‰å…¨è§£å†³æ–¹æ¡ˆï¼Œä½†å®ƒè¿˜æœ‰å¾ˆå¤šä¸èƒ½åšçš„äº‹æƒ…ã€‚</p>\n<h2 id=\"HTTPS-ä¸ä¼šï¼š\"><a href=\"#HTTPS-ä¸ä¼šï¼š\" class=\"headerlink\" title=\"HTTPS ä¸ä¼šï¼š\"></a>HTTPS ä¸ä¼šï¼š</h2><ol>\n<li>éšè—ä½ æ­£åœ¨è®¿é—®çš„ç½‘ç«™çš„åç§°</li>\n</ol>\n<p>è¿™æ˜¯å› ä¸ºç½‘ç«™çš„åç§°ï¼ˆåˆåâ€œåŸŸâ€ï¼‰æ˜¯ä½¿ç”¨ DNSï¼ˆåŸŸåæœåŠ¡ï¼‰å‘é€çš„ï¼Œè€Œ DNS ä¸åœ¨ HTTPS éš§é“å†…ã€‚å®ƒåœ¨å»ºç«‹å®‰å…¨è¿æ¥ä¹‹å‰å‘é€ã€‚ä¸­é—´çš„çªƒå¬è€…å¯ä»¥çœ‹åˆ°ä½ è¦è®¿é—®çš„ç½‘ç«™çš„åç§°ï¼ˆä¾‹å¦‚ TipTopSecurity.comï¼‰ï¼Œä»–ä»¬åªæ˜¯æ— æ³•è¯»å–æ¥å›ä¼ è¾“çš„ä»»ä½•å®é™…å†…å®¹ã€‚ç›´åˆ°DNSSECå®Œå…¨å®æ–½åï¼Œè¿™ç§æƒ…å†µæ‰ä¼šæ”¹å˜ã€‚</p>\n<ol start=\"2\">\n<li>ä¿æŠ¤ä½ å…å—è®¿é—®é‚ªæ¶ç½‘ç«™çš„ä¾µå®³</li>\n</ol>\n<p>HTTPS ä¸èƒ½ç¡®ä¿ç½‘ç«™æœ¬èº«çš„å®‰å…¨ã€‚ä»…ä»…å› ä¸ºä½ å®‰å…¨è¿æ¥å¹¶ä¸æ„å‘³ç€ä½ æ²¡æœ‰è¿æ¥åˆ°ç”±åäººè¿è¡Œçš„ç½‘ç«™ã€‚æˆ‘ä»¬å°è¯•é€šè¿‡å—ä¿¡ä»»çš„è¯ä¹¦é¢å‘æœºæ„æ¥è§£å†³æ­¤é—®é¢˜ï¼Œä½†è¯¥ç³»ç»Ÿå¹¶ä¸å®Œç¾ï¼ˆè¯·ç»§ç»­å…³æ³¨æœ‰å…³æ­¤æ–¹é¢çš„æ›´å¤šä¿¡æ¯ï¼‰ã€‚</p>\n<ol start=\"3\">\n<li>æä¾›åŒ¿å</li>\n</ol>\n<p>HTTPS ä¸ä¼šéšè—ä½ çš„ç‰©ç†ä½ç½®æˆ–ä¸ªäººèº«ä»½ã€‚ä½ çš„ä¸ªäºº IP åœ°å€ï¼ˆä½ åœ¨äº’è”ç½‘ä¸Šçš„åœ°å€ï¼‰å¿…é¡»é™„åŠ åˆ°åŠ å¯†æ•°æ®çš„å¤–éƒ¨ï¼Œå› ä¸ºå¦‚æœä½ çš„ IP åœ°å€ä¹Ÿè¢«åŠ å¯†ï¼Œäº’è”ç½‘å°†ä¸çŸ¥é“å°†å…¶å‘é€åˆ°å“ªé‡Œã€‚è€Œä¸”å®ƒä¹Ÿä¸ä¼šåœ¨ä½ æ­£åœ¨è®¿é—®çš„ç½‘ç«™ä¸Šéšè—ä½ çš„èº«ä»½ã€‚ä½ è®¿é—®çš„ç½‘ç«™ä»ç„¶äº†è§£ä½ çš„ä¸€åˆ‡ï¼Œå°±åƒåœ¨éå®‰å…¨è¿æ¥ä¸Šä¸€æ ·ã€‚</p>\n<ol start=\"4\">\n<li>é˜²æ­¢ä½ æ„ŸæŸ“ç—…æ¯’</li>\n</ol>\n<p>HTTPS ä¸æ˜¯è¿‡æ»¤å™¨ã€‚æœ‰å¯èƒ½é€šè¿‡ HTTPS è¿æ¥æ¥æ”¶ç—…æ¯’å’Œå…¶ä»–æ¶æ„è½¯ä»¶ã€‚å¦‚æœ Web æœåŠ¡å™¨è¢«æ„ŸæŸ“æˆ–è€…ä½ æ‰€åœ¨çš„æ¶æ„ç½‘ç«™æ­£åœ¨åˆ†å‘æ¶æ„è½¯ä»¶ï¼Œåˆ™è¯¥æ¶æ„è½¯ä»¶å°†åƒå…¶ä»–æ‰€æœ‰å†…å®¹ä¸€æ ·åœ¨ HTTPS æµä¸­å‘é€ã€‚ç„¶è€Œï¼Œ HTTPSç¡®å®å¯ä»¥é˜²æ­¢ä¸­é—´çš„ä»»ä½•äººå°†æ¶æ„è½¯ä»¶æ³¨å…¥åˆ°ä½ çš„ç§»åŠ¨æµé‡ä¸­ã€‚</p>\n<ol start=\"5\">\n<li>ä¿æŠ¤ä½ çš„è®¡ç®—æœºå…é­é»‘å®¢æ”»å‡»</li>\n</ol>\n<p>HTTPS ä»…ä¿æŠ¤åœ¨ä½ çš„è®¡ç®—æœºå’Œ Web æœåŠ¡å™¨ä¹‹é—´ç§»åŠ¨çš„æ•°æ®ã€‚å®ƒä¸ä¼šä¸ºä½ çš„å®é™…è®¡ç®—æœºæˆ–æœåŠ¡å™¨æœ¬èº«æä¾›ä»»ä½•ä¿æŠ¤ã€‚è¿™ä¹Ÿæ„å‘³ç€ï¼Œå¦‚æœæœ‰æ¶æ„è½¯ä»¶æ­£åœ¨ç›‘è§†è¿æ¥ä¸€ç«¯çš„æµé‡ï¼Œå®ƒå°±å¯ä»¥è¯»å– HTTPS æµä¸­åŠ å¯†ä¹‹å‰å’Œä¹‹åçš„æµé‡ã€‚</p>\n<p>æ›´å¤šä¸€æ‰‹è®¯æ¯ï¼Œå¯å…³æ³¨å…¬ä¼—å·ï¼š<a href=\"https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg\">ITProHub</a></p>\n<p><img src=\"https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg\" alt=\"ITProHub\"></p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"ä»€ä¹ˆæ˜¯-HTTPSï¼Ÿ\"><a href=\"#ä»€ä¹ˆæ˜¯-HTTPSï¼Ÿ\" class=\"headerlink\" title=\"ä»€ä¹ˆæ˜¯ HTTPSï¼Ÿ\"></a>ä»€ä¹ˆæ˜¯ HTTPSï¼Ÿ</h1><p>HTTP æ˜¯ä¸€ç§ç”¨äºåœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼ˆWeb æµè§ˆå™¨ï¼‰ä¹‹é—´äº¤æ¢æ•°æ®çš„äº’è”ç½‘åè®®ã€‚ HTTPS åªä¸è¿‡æ˜¯åœ¨HTTPçš„åŸºç¡€ä¸Šæ·»åŠ äº†å®‰å…¨å±‚ã€‚<br>HTTP ä¸æ˜¯ä¸€ä¸ªå®‰å…¨åè®®ï¼šå®ƒæ˜¯ä¸ºäº†çº¯ç²¹çš„åŠŸèƒ½ç›®æ ‡è€Œè®¾è®¡çš„ï¼Œæ²¡æœ‰è€ƒè™‘ä»»ä½•å®‰å…¨çº¦æŸã€‚</p>\n<p>æ‰€ä»¥æˆ‘ä»¬ç»™HTTPæ·»åŠ äº†ä¸€ä¸ªå®‰å…¨å±‚ã€‚æ›´å‡†ç¡®åœ°è¯´ï¼Œå°† HTTP å°è£…åˆ°å®‰å…¨è¿æ¥ä¸­ã€‚</p>\n<p><img src=\"/images/https/security.png\" alt=\"å®‰å…¨è¿æ¥\"></p>\n<p>HTTPS ä½¿æˆ‘ä»¬èƒ½å¤Ÿå®ç°ä¸‰ä¸ªç›®æ ‡ï¼š</p>\n<ul>\n<li>èº«ä»½éªŒè¯ï¼šHTTPS ä½¿ç”¨æ•°å­—è¯ä¹¦æ¥éªŒè¯æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„èº«ä»½ï¼Œé˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚æœåŠ¡å™¨éœ€è¦æä¾›æœ‰æ•ˆçš„æ•°å­—è¯ä¹¦ï¼Œè€Œå®¢æˆ·ç«¯å¯ä»¥éªŒè¯è¯ä¹¦çš„æœ‰æ•ˆæ€§ï¼Œç¡®ä¿ä¸æ­£ç¡®çš„æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚</li>\n<li>éšç§ï¼šç½‘ç»œä¸Šçš„ä»»ä½•äººéƒ½æ— æ³•è¯»å–æ•°æ®ï¼Œå› ä¸ºå®ƒæ˜¯åŠ å¯†çš„</li>\n<li>å®Œæ•´æ€§ï¼šHTTPS ä½¿ç”¨æ¶ˆæ¯æ‘˜è¦ç®—æ³•ï¼ˆå¦‚ SHA-256ï¼‰æ¥è®¡ç®—æ•°æ®çš„æ‘˜è¦ï¼Œå¹¶å°†æ‘˜è¦ä¸æ•°æ®ä¸€èµ·ä¼ è¾“ã€‚æ¥æ”¶æ–¹å¯ä»¥éªŒè¯æ•°æ®çš„å®Œæ•´æ€§ï¼Œç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æœªè¢«ç¯¡æ”¹ã€‚</li>\n</ul>\n<h1 id=\"è¯ä¹¦é¢å‘æœºæ„\"><a href=\"#è¯ä¹¦é¢å‘æœºæ„\" class=\"headerlink\" title=\"è¯ä¹¦é¢å‘æœºæ„\"></a>è¯ä¹¦é¢å‘æœºæ„</h1><p>è¯ä¹¦é¢å‘æœºæ„æ˜¯æä¾› SSL è¯ä¹¦çš„å…¬å¸ã€‚è¿™äº›ç»„ç»‡ä¸ºç½‘ç»œæµè§ˆå™¨æ‰€ç†ŸçŸ¥ï¼Œå¹¶æ¥å—è¿™äº›æœºæ„æä¾›çš„è¯ä¹¦ã€‚<br>ä»»ä½•äººéƒ½å¯ä»¥ç”Ÿæˆè¯ä¹¦ï¼Œä½†å¦‚æœä¸æ˜¯ç”±å·²çŸ¥æœºæ„æä¾›çš„ï¼Œæµè§ˆå™¨ä¼šæ˜¾ç¤ºå®‰å…¨è­¦æŠ¥ã€‚</p>\n<p>è¯ä¹¦é¢å‘æœºæ„ç¤ºä¾‹ï¼šDigiCertã€GeoTrustã€GlobalSignã€CFCAã€TrustAsia</p>\n<p><img src=\"/images/https/ca2.png\" alt=\"ca\"></p>\n<h1 id=\"SSL-æ¡æ‰‹\"><a href=\"#SSL-æ¡æ‰‹\" class=\"headerlink\" title=\"SSL æ¡æ‰‹\"></a>SSL æ¡æ‰‹</h1><p>SSL æ¡æ‰‹æ˜¯ Web æœåŠ¡å™¨å’Œæµè§ˆå™¨è®¨è®ºå¹¶å•†å®šè¦ä½¿ç”¨çš„åè®®ï¼ˆç‰¹å®šç‰ˆæœ¬ä¸­çš„ SSL æˆ– TLSï¼‰ã€è¦ä½¿ç”¨çš„å¯†ç å¥—ä»¶ä»¥åŠæœ€åè¦ä½¿ç”¨çš„ä¼šè¯å¯†é’¥çš„è¿‡ç¨‹ã€‚æ¡æ‰‹å®Œæˆåè¿›è¡Œé€šä¿¡ã€‚</p>\n<p><img src=\"/images/https/handshake.png\" alt=\"æ¡æ‰‹è¿‡ç¨‹\">å›¾ç‰‡æ¥æºï¼š<a href=\"https://code-maze.com/wp-content/uploads/2017/07/TLS-handshake.png\">https://code-maze.com/wp-content/uploads/2017/07/TLS-handshake.png</a></p>\n<p>ä¸æ·±ç©¶ç»†èŠ‚ï¼Œæ¡æ‰‹ä¼šç»è¿‡ä»¥ä¸‹æ­¥éª¤ï¼š</p>\n<ol>\n<li>æµè§ˆå™¨å’ŒæœåŠ¡å™¨å°±æ‰€ä½¿ç”¨çš„åè®®è¾¾æˆä¸€è‡´ï¼ˆSSL Xã€TLS Xï¼‰</li>\n<li>æµè§ˆå™¨éªŒè¯æœåŠ¡å™¨çš„çœŸå®æ€§ï¼ˆè¯ä¹¦é¢å‘æœºæ„ï¼‰</li>\n<li>æµè§ˆå™¨åˆ›å»ºä¼šè¯å¯†é’¥å¹¶ä½¿ç”¨æœåŠ¡å™¨çš„å…¬é’¥å¯¹å…¶è¿›è¡ŒåŠ å¯†</li>\n<li>æœåŠ¡å™¨ç”¨å…¶ç§é’¥è§£å¯†å…ˆå‰çš„æ¶ˆæ¯</li>\n<li>æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä½¿ç”¨ä»–ä»¬åˆšåˆšå•†å®šçš„ä¼šè¯å¯†é’¥è¿›è¡Œé€šä¿¡ã€‚æ¡æ‰‹å®Œæ¯•ã€‚</li>\n</ol>\n<p>æ„Ÿå…´è¶£çš„åŒå­¦ä¹Ÿå¯ä»¥æŠ“åŒ…çœ‹ä¸€ä¸‹httpsè®¿é—®çš„è¯¦ç»†è¿‡ç¨‹ï¼Œä¸‹é¢æ˜¯ç”¨wiresharkæŠ“åŒ…çš„ç»“æœ<br><img src=\"/images/https/client-hello.png\" alt=\"æ¡æ‰‹\"><br>æ¡æ‰‹å®Œæˆåæ•°æ®ä¼ è¾“çš„éƒ½æ˜¯åŠ å¯†çš„æ•°æ®<br><img src=\"/images/https/encrypted.png\" alt=\"æ•°æ®åŠ å¯†\"></p>\n<h1 id=\"å¯†ç å¥—ä»¶\"><a href=\"#å¯†ç å¥—ä»¶\" class=\"headerlink\" title=\"å¯†ç å¥—ä»¶\"></a>å¯†ç å¥—ä»¶</h1><p>HTTPS å†…å­˜åœ¨ä¸åŒçº§åˆ«çš„åŠ å¯†ã€‚<br>å¦‚å‰æ‰€è¿°ï¼ŒHTTPS æ˜¯å°† HTTP å°è£…åˆ°å®‰å…¨åè®® SSL æˆ– TLS ä¸­ã€‚<br>è¿™ä¸¤ç§å®‰å…¨åè®®å­˜åœ¨ä¸åŒçš„ç‰ˆæœ¬ï¼Œå…¶ä¸­ä¸€äº›è¢«è®¤ä¸ºæ˜¯è¾ƒå¼±çš„ã€‚è‡ªâ€œPOODLEâ€æ¼æ´ä»¥æ¥ï¼ŒSSL V2 å·²è¿‡æ—¶ï¼ŒSSL V3 ä¹Ÿå·²è¿‡æ—¶ã€‚ï¼ˆæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡Œç™¾åº¦ï¼‰<br>ä½¿ç”¨ï¼šTLS v1.0ã€v1.1ã€v1.2</p>\n<p>æ­¤å¤–ï¼ŒSSLå’ŒTLSä½¿ç”¨ä¸åŒçš„åŠ å¯†ç®—æ³•ã€‚è¿™äº›ç®—æ³•åœ¨é€šä¿¡è¿‡ç¨‹ä¸­ä½¿ç”¨ï¼Œä½¿ç”¨å“ªç§ç®—æ³•å–å†³äºæœåŠ¡å™¨å’Œæµè§ˆå™¨æ¥å—çš„ç®—æ³•ã€‚<br>éšç€æ—¶é—´çš„æ¨ç§»ï¼Œå…¶ä¸­ä¸€äº›ç®—æ³•ä¼šå˜å¾—å¾ˆå¼±ï¼Œå¿…é¡»åœç”¨ï¼š<br>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æåˆ°å¯†é’¥å¤§å°ä½äº 128 ä½çš„æ‰€æœ‰å¯†ç å’Œ RC4 ç®—æ³•ã€‚</p>\n<p>å› æ­¤ï¼Œæœ‰å¿…è¦ä½¿ç³»ç»Ÿä¿æŒæœ€æ–°ï¼Œç‰¹åˆ«æ˜¯ Web æœåŠ¡å™¨çš„ HTTPS é…ç½®ã€‚</p>\n<h2 id=\"client-hello\"><a href=\"#client-hello\" class=\"headerlink\" title=\"client hello\"></a>client hello</h2><p>ä¸‹é¢æ˜¯æˆ‘ä»¬é€šè¿‡wiresharæŠ“åŒ…æŸ¥çœ‹å®¢æˆ·ç«¯æ”¯æŒçš„å¯†ç å¥—ä»¶<br><img src=\"/images/https/cipher-suites.png\" alt=\"å®¢æˆ·ç«¯æ”¯æŒçš„å¯†ç å¥—ä»¶\"></p>\n<h2 id=\"server-hello\"><a href=\"#server-hello\" class=\"headerlink\" title=\"server hello\"></a>server hello</h2><p>å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯åå•†å¯†ç å¥—ä»¶, ä¸»è¦æ˜¯ä»å®¢æˆ·ç«¯æ”¯æŒçš„åŠ å¯†æ–¹å¼ä¸­é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„å‘Šè¯‰å®¢æˆ·ç«¯ã€‚<br><img src=\"/images/https/negotiated-cipher-suite.png\" alt=\"åå•†å¯†ç å¥—ä»¶\"></p>\n<h2 id=\"è¯¥å¯†ç ä¸²çš„å«ä¹‰\"><a href=\"#è¯¥å¯†ç ä¸²çš„å«ä¹‰\" class=\"headerlink\" title=\"è¯¥å¯†ç ä¸²çš„å«ä¹‰\"></a>è¯¥å¯†ç ä¸²çš„å«ä¹‰</h2><p>ECDHEï¼šå¯†é’¥äº¤æ¢ç®—æ³•<br>ECDSAï¼šèº«ä»½éªŒè¯<br>AES_128_CBCï¼šç”¨äºæ¶ˆæ¯åŠ å¯†çš„æ‰¹é‡å¯†ç <br>SHAï¼šMAC ç®—æ³•</p>\n<h1 id=\"åœ¨-Web-æœåŠ¡å™¨ä¸Šå®‰è£…-HTTPS\"><a href=\"#åœ¨-Web-æœåŠ¡å™¨ä¸Šå®‰è£…-HTTPS\" class=\"headerlink\" title=\"åœ¨ Web æœåŠ¡å™¨ä¸Šå®‰è£… HTTPS\"></a>åœ¨ Web æœåŠ¡å™¨ä¸Šå®‰è£… HTTPS</h1><p>å¯¹äºä¸åŒç±»å‹çš„æœåŠ¡å™¨ï¼Œåœ¨ Web æœåŠ¡å™¨ä¸Šé…ç½® HTTPS ç›¸å¯¹ç®€å•ï¼Œå¹¶ä¸”æœ‰è¯¦ç»†çš„æ–‡æ¡£è®°å½•ã€‚</p>\n<p>è®¾ç½®çš„ä¸»è¦æ­¥éª¤æ˜¯ï¼š</p>\n<ul>\n<li>å‘è¯ä¹¦é¢å‘æœºæ„è®¢è´­ SSL è¯ä¹¦</li>\n<li>åœ¨ Web æœåŠ¡å™¨ä¸­å®‰è£…è¯ä¹¦ï¼ˆè¦å¤åˆ¶åˆ°æœåŠ¡å™¨çš„æ–‡ä»¶ï¼‰</li>\n<li>é…ç½®ç½‘ç»œæœåŠ¡å™¨</li>\n</ul>\n<p>æœåŠ¡å™¨çš„é…ç½®å¯èƒ½åŒ…æ‹¬ï¼š</p>\n<ul>\n<li>è¯ä¹¦ç»‘å®šçš„IPåœ°å€-ç«¯å£&#x2F;åŸŸå</li>\n<li>æ¿€æ´»åè®®çš„é…ç½®ï¼ˆTLS&#x2F;SSLï¼‰</li>\n<li>ç®—æ³•å’Œå¯†ç å¯†é’¥å¤§å°çš„é…ç½®ï¼ˆå¯†ç å¥—ä»¶ï¼‰</li>\n</ul>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">server</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">listen</span> <span class=\"number\">443</span> ssl;</span><br><span class=\"line\">    <span class=\"attribute\">server_name</span> xxx;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">ssl_certificate</span> /cert/xxx.crt;</span><br><span class=\"line\">    <span class=\"attribute\">ssl_certificate_key</span> /cert/xxx.key;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"section\">location</span> / &#123;</span><br><span class=\"line\">        <span class=\"attribute\">proxy_pass</span> http://localhost:4000;</span><br><span class=\"line\">        <span class=\"attribute\">proxy_set_header</span> Host <span class=\"variable\">$host</span>;</span><br><span class=\"line\">        <span class=\"attribute\">proxy_set_header</span> X-Real-IP <span class=\"variable\">$remote_addr</span>;</span><br><span class=\"line\">        <span class=\"attribute\">proxy_set_header</span> X-Forwarded-For <span class=\"variable\">$proxy_add_x_forwarded_for</span>;</span><br><span class=\"line\">        <span class=\"attribute\">proxy_set_header</span> X-Forwarded-Proto <span class=\"variable\">$scheme</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å¯ä»¥åœ¨ä¸‹é¢æ‰¾åˆ°è¯¦ç»†è¯´æ˜å¦‚ä½•åœ¨ä¸‰ä¸ªä¸»è¦ Web æœåŠ¡å™¨ä¸Šå®‰è£… SSL çš„æ–‡æ¡£é“¾æ¥ï¼š<br>Apacheï¼š  <a href=\"https://wiki.apache.org/httpd/SSL\">https://wiki.apache.org/httpd/SSL</a><br>IISï¼š <a href=\"http://www.iis.net/learn/manage/configuring-security/how-to-set-up-ssl-on-iis\">http://www.iis.net/learn/manage/configuring-security/how-to-set-up-ssl-on-iis</a><br>Nginxï¼š <a href=\"http://nginx.org/en/docs/http/configuring_https_servers.html\">http://nginx.org/en/docs/http/configuring_https_servers.html</a></p>\n<p>Mozilla å‘å¸ƒäº†ä¸€ä¸ªç«™ç‚¹ï¼Œä½ å¯ä»¥åœ¨å…¶ä¸­ç”Ÿæˆå®‰å…¨çš„ HTTPS é…ç½®ï¼š</p>\n<p><a href=\"https://mozilla.github.io/server-side-tls/ssl-config-generator/\">Mozilla SSL é…ç½®ç”Ÿæˆå™¨</a></p>\n<h1 id=\"ä¿æŒ-HTTPS-æ›´æ–°ä¸ºæœ€æ–°\"><a href=\"#ä¿æŒ-HTTPS-æ›´æ–°ä¸ºæœ€æ–°\" class=\"headerlink\" title=\"ä¿æŒ HTTPS æ›´æ–°ä¸ºæœ€æ–°\"></a>ä¿æŒ HTTPS æ›´æ–°ä¸ºæœ€æ–°</h1><p>HTTPS é…ç½®ä¸æ˜¯ä¸€æ¬¡æ€§äº‹ä»¶ã€‚å®‰è£…åï¼Œå¿…é¡»ä¿æŒå…¶é…ç½®æœ€æ–°ã€‚<br>å¾ˆå¤šbugéƒ½ä¼šå½±å“ä¸€äº›è¾ƒä½ç‰ˆæœ¬çš„openSSLåº“(ä¾‹å¦‚<a href=\"https://baike.baidu.com/item/Heartbleed/13580882\">Heartbleed</a>), ç³»ç»Ÿæ›´æ–°å¯ä»¥å¸®åŠ©é¿å…ä¸€äº›ä¸ HTTPS ä½¿ç”¨ç›´æ¥ç›¸å…³çš„æ¼æ´ã€‚</p>\n<p>æ­¤å¤–ï¼Œæœ‰å¿…è¦éšæ—¶äº†è§£ä¸åŒåè®®å’Œå¯†ç å¥—ä»¶çš„å®‰å…¨æ€§ã€‚è¿™é‡Œçš„ç›®æ ‡æ˜¯åœ¨æŸäº›æ—¶å€™è¢«è®¤ä¸ºè¾ƒå¼±çš„æƒ…å†µä¸‹åœç”¨å…¶ä¸­ä¸€äº›ã€‚</p>\n<p>æœ€åä¸€ç‚¹ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ï¼Œä¹Ÿæ˜¯å¾ˆæ˜æ˜¾ä½†ç»å¸¸è¢«é—å¿˜çš„ï¼šè¯ä¹¦è¿‡æœŸã€‚ä¸€æ—¦è¯ä¹¦è¿‡æœŸï¼Œç½‘ç»œæµè§ˆå™¨å°†æ˜¾ç¤ºéå¸¸å…·æœ‰åŠé˜»æ€§çš„å®‰å…¨è­¦æŠ¥ï¼Œé¼“åŠ±ç”¨æˆ·ç¦»å¼€ç½‘ç«™ã€‚</p>\n<p>ç›¸ä¿¡å¤§å®¶åœ¨æµè§ˆç½‘ç«™çš„æ—¶å€™é‡åˆ°è¿‡è¿™æ ·çš„æƒ…å†µ<br><img src=\"/images/https/expire.png\" alt=\"è¿‡æœŸ\"></p>\n<h1 id=\"HTTPS-ä¸åšä»€ä¹ˆ\"><a href=\"#HTTPS-ä¸åšä»€ä¹ˆ\" class=\"headerlink\" title=\"HTTPS ä¸åšä»€ä¹ˆ\"></a>HTTPS ä¸åšä»€ä¹ˆ</h1><p>äººä»¬å¾ˆå®¹æ˜“è®¤ä¸º HTTPS æ˜¯ä¸€ä¸ªç¥å¥‡çš„äº’è”ç½‘å®‰å…¨è§£å†³æ–¹æ¡ˆï¼Œä½†å®ƒè¿˜æœ‰å¾ˆå¤šä¸èƒ½åšçš„äº‹æƒ…ã€‚</p>\n<h2 id=\"HTTPS-ä¸ä¼šï¼š\"><a href=\"#HTTPS-ä¸ä¼šï¼š\" class=\"headerlink\" title=\"HTTPS ä¸ä¼šï¼š\"></a>HTTPS ä¸ä¼šï¼š</h2><ol>\n<li>éšè—ä½ æ­£åœ¨è®¿é—®çš„ç½‘ç«™çš„åç§°</li>\n</ol>\n<p>è¿™æ˜¯å› ä¸ºç½‘ç«™çš„åç§°ï¼ˆåˆåâ€œåŸŸâ€ï¼‰æ˜¯ä½¿ç”¨ DNSï¼ˆåŸŸåæœåŠ¡ï¼‰å‘é€çš„ï¼Œè€Œ DNS ä¸åœ¨ HTTPS éš§é“å†…ã€‚å®ƒåœ¨å»ºç«‹å®‰å…¨è¿æ¥ä¹‹å‰å‘é€ã€‚ä¸­é—´çš„çªƒå¬è€…å¯ä»¥çœ‹åˆ°ä½ è¦è®¿é—®çš„ç½‘ç«™çš„åç§°ï¼ˆä¾‹å¦‚ TipTopSecurity.comï¼‰ï¼Œä»–ä»¬åªæ˜¯æ— æ³•è¯»å–æ¥å›ä¼ è¾“çš„ä»»ä½•å®é™…å†…å®¹ã€‚ç›´åˆ°DNSSECå®Œå…¨å®æ–½åï¼Œè¿™ç§æƒ…å†µæ‰ä¼šæ”¹å˜ã€‚</p>\n<ol start=\"2\">\n<li>ä¿æŠ¤ä½ å…å—è®¿é—®é‚ªæ¶ç½‘ç«™çš„ä¾µå®³</li>\n</ol>\n<p>HTTPS ä¸èƒ½ç¡®ä¿ç½‘ç«™æœ¬èº«çš„å®‰å…¨ã€‚ä»…ä»…å› ä¸ºä½ å®‰å…¨è¿æ¥å¹¶ä¸æ„å‘³ç€ä½ æ²¡æœ‰è¿æ¥åˆ°ç”±åäººè¿è¡Œçš„ç½‘ç«™ã€‚æˆ‘ä»¬å°è¯•é€šè¿‡å—ä¿¡ä»»çš„è¯ä¹¦é¢å‘æœºæ„æ¥è§£å†³æ­¤é—®é¢˜ï¼Œä½†è¯¥ç³»ç»Ÿå¹¶ä¸å®Œç¾ï¼ˆè¯·ç»§ç»­å…³æ³¨æœ‰å…³æ­¤æ–¹é¢çš„æ›´å¤šä¿¡æ¯ï¼‰ã€‚</p>\n<ol start=\"3\">\n<li>æä¾›åŒ¿å</li>\n</ol>\n<p>HTTPS ä¸ä¼šéšè—ä½ çš„ç‰©ç†ä½ç½®æˆ–ä¸ªäººèº«ä»½ã€‚ä½ çš„ä¸ªäºº IP åœ°å€ï¼ˆä½ åœ¨äº’è”ç½‘ä¸Šçš„åœ°å€ï¼‰å¿…é¡»é™„åŠ åˆ°åŠ å¯†æ•°æ®çš„å¤–éƒ¨ï¼Œå› ä¸ºå¦‚æœä½ çš„ IP åœ°å€ä¹Ÿè¢«åŠ å¯†ï¼Œäº’è”ç½‘å°†ä¸çŸ¥é“å°†å…¶å‘é€åˆ°å“ªé‡Œã€‚è€Œä¸”å®ƒä¹Ÿä¸ä¼šåœ¨ä½ æ­£åœ¨è®¿é—®çš„ç½‘ç«™ä¸Šéšè—ä½ çš„èº«ä»½ã€‚ä½ è®¿é—®çš„ç½‘ç«™ä»ç„¶äº†è§£ä½ çš„ä¸€åˆ‡ï¼Œå°±åƒåœ¨éå®‰å…¨è¿æ¥ä¸Šä¸€æ ·ã€‚</p>\n<ol start=\"4\">\n<li>é˜²æ­¢ä½ æ„ŸæŸ“ç—…æ¯’</li>\n</ol>\n<p>HTTPS ä¸æ˜¯è¿‡æ»¤å™¨ã€‚æœ‰å¯èƒ½é€šè¿‡ HTTPS è¿æ¥æ¥æ”¶ç—…æ¯’å’Œå…¶ä»–æ¶æ„è½¯ä»¶ã€‚å¦‚æœ Web æœåŠ¡å™¨è¢«æ„ŸæŸ“æˆ–è€…ä½ æ‰€åœ¨çš„æ¶æ„ç½‘ç«™æ­£åœ¨åˆ†å‘æ¶æ„è½¯ä»¶ï¼Œåˆ™è¯¥æ¶æ„è½¯ä»¶å°†åƒå…¶ä»–æ‰€æœ‰å†…å®¹ä¸€æ ·åœ¨ HTTPS æµä¸­å‘é€ã€‚ç„¶è€Œï¼Œ HTTPSç¡®å®å¯ä»¥é˜²æ­¢ä¸­é—´çš„ä»»ä½•äººå°†æ¶æ„è½¯ä»¶æ³¨å…¥åˆ°ä½ çš„ç§»åŠ¨æµé‡ä¸­ã€‚</p>\n<ol start=\"5\">\n<li>ä¿æŠ¤ä½ çš„è®¡ç®—æœºå…é­é»‘å®¢æ”»å‡»</li>\n</ol>\n<p>HTTPS ä»…ä¿æŠ¤åœ¨ä½ çš„è®¡ç®—æœºå’Œ Web æœåŠ¡å™¨ä¹‹é—´ç§»åŠ¨çš„æ•°æ®ã€‚å®ƒä¸ä¼šä¸ºä½ çš„å®é™…è®¡ç®—æœºæˆ–æœåŠ¡å™¨æœ¬èº«æä¾›ä»»ä½•ä¿æŠ¤ã€‚è¿™ä¹Ÿæ„å‘³ç€ï¼Œå¦‚æœæœ‰æ¶æ„è½¯ä»¶æ­£åœ¨ç›‘è§†è¿æ¥ä¸€ç«¯çš„æµé‡ï¼Œå®ƒå°±å¯ä»¥è¯»å– HTTPS æµä¸­åŠ å¯†ä¹‹å‰å’Œä¹‹åçš„æµé‡ã€‚</p>\n<p>æ›´å¤šä¸€æ‰‹è®¯æ¯ï¼Œå¯å…³æ³¨å…¬ä¼—å·ï¼š<a href=\"https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg\">ITProHub</a></p>\n<p><img src=\"https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg\" alt=\"ITProHub\"></p>\n"},{"title":"Redisæˆé•¿è®° - Redisçš„é™·é˜±ï¼ˆä¸€ï¼‰","date":"2024-04-18T07:09:28.000Z","_content":"ç›¸ä¿¡å¾ˆå¤šè€é“åœ¨æ±‚èŒè¿‡ç¨‹ä¸­éƒ½çœ‹åˆ°è¿‡ç±»ä¼¼ä¸‹é¢è¿™æ ·çš„ä»»èŒè¦æ±‚\n\n<img src=\"/images/redis-interview/recruitment.png\" width=\"50%\">\n\nä½ ç”³è¯·çš„å²—ä½ä¸Šé¢å†™ç€â€ç†Ÿæ‚‰Redisâ€ï¼Œé‚£ä¹ˆä½ å·²ç»å‡†å¤‡å¥½å›ç­”é¢è¯•å®˜å¯èƒ½ä¼šé—®åˆ°çš„é—®é¢˜äº†ä¹ˆï¼Ÿ\nåé¢æˆ‘å°†å¼€å¯ä¸€ä¸ªé’ˆå¯¹Redisçš„ç³»åˆ—åˆ†äº«ï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆšåˆšå¼€å§‹å­¦ä¹ Redisçš„æœ‹å‹ä»¬ã€‚\n\nåœ¨å¼€å§‹é˜…è¯»æœ¬ç¯‡æ–‡ç« ä¹‹å‰ï¼Œé»˜è®¤ä½ å·²ç»å…·å¤‡åŸºç¡€çš„RedisçŸ¥è¯†ï¼Œå¦‚æœä½ æ²¡æœ‰ï¼Œå¯ä»¥å…ˆé˜…è¯»æ–‡æœ«[ç›¸å…³æ–‡ç« æ¨è](#References)\n\n\nå½“ä½¿ç”¨ Redis ä½œä¸ºç¼“å­˜æˆ–æ•°æ®å­˜å‚¨æ—¶ï¼Œè™½ç„¶å®ƒæä¾›äº†é«˜æ€§èƒ½å’Œçµæ´»æ€§ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸€äº›é™·é˜±éœ€è¦æ³¨æ„ã€‚ä¹‹å‰çœ‹åšå®¢çš„æ—¶å€™çœ‹åˆ°è¿‡è¿™æ ·ä¸€å¥è¯â€Experts arenâ€™t the only people who know what to do. Theyâ€™re the people who know what not to do.â€œ ä¸“å®¶å¹¶ä¸æ˜¯å”¯ä¸€çŸ¥é“å¦‚ä½•åšçš„äººï¼Œä»–ä»¬åªæ˜¯çŸ¥é“å¦‚ä½•é¿å…ä¸€äº›é™·é˜±ã€‚\n\nä¸‹é¢è®²è¯‰çš„æ˜¯ä¸€äº›å¸¸è§çš„ Redis é™·é˜±ï¼Œæˆ–è€…è¯´å®¹æ˜“å¿½ç•¥çš„é—®é¢˜ã€‚å†…å®¹è¾ƒå¤šï¼Œå¯èƒ½ä¼šåˆ†å¤šç¯‡æ–‡ç« ï¼Œå°½æƒ…æœŸå¾…ã€‚\nåŒæ—¶ç”±äºè¦è®²çš„å†…å®¹å®åœ¨æ˜¯å¤ªå¤šï¼Œæ‰€ä»¥æœ¬æ–‡æ›´å¤šçš„åªæ˜¯èµ·åˆ°â€æŠ›ç –â€œçš„ä½œç”¨ï¼Œæ›´å¤šçš„è¯¦ç»†çš„å†…å®¹è¿˜éœ€è¦è€é“ä»¬è‡ªå·±å†æ·±å±‚æ¬¡çš„å»å­¦ä¹ ã€‚\n\n# ç¼“å­˜ç©¿é€\nç¼“å­˜ç©¿é€æŒ‡çš„æ˜¯æ¶æ„è¯·æ±‚æˆ–è€…å¤§é‡ä¸å­˜åœ¨çš„ key å¯¼è‡´ç¼“å­˜æ— æ³•å‘½ä¸­ï¼Œä»è€Œç»•è¿‡ç¼“å­˜ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›è¿‡å¤§ï¼Œç”šè‡³å®•æœºçš„æƒ…å†µã€‚\n\n![ç¼“å­˜ç©¿é€](/images/redis-interview/cache-penetration.png)\n\n## ç¼“å­˜ç©¿é€çš„åŸå› \nç¼“å­˜ç©¿é€é€šå¸¸å‘ç”Ÿåœ¨ä»¥ä¸‹æƒ…å†µä¸‹ï¼š\n\n1. æ¶æ„è¯·æ±‚ï¼šæ”»å‡»è€…å‘é€å¤§é‡ä¸å­˜åœ¨äºç¼“å­˜ä¸­çš„ keyï¼Œå¯¼è‡´ç¼“å­˜æ— æ³•å‘½ä¸­ï¼Œç›´æ¥è®¿é—®æ•°æ®åº“ã€‚\n2. å¤§é‡å¹¶å‘æŸ¥è¯¢ï¼šå½“å¹¶å‘æŸ¥è¯¢é‡å¾ˆå¤§æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°å¤§é‡ä¸å­˜åœ¨äºç¼“å­˜ä¸­çš„ keyï¼Œä»è€Œå¯¼è‡´ç¼“å­˜ç©¿é€ã€‚\n\n## ç¼“å­˜ç©¿é€çš„å½±å“\n+ æ•°æ®åº“å‹åŠ›è¿‡å¤§ï¼šå¤§é‡æ— æ•ˆè¯·æ±‚ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›è¿‡å¤§ï¼Œç”šè‡³å¯¼è‡´æ•°æ®åº“å®•æœºã€‚\n+ ç³»ç»Ÿæ€§èƒ½ä¸‹é™ï¼šæ•°æ®åº“å‹åŠ›å¢å¤§ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå“åº”å˜æ…¢ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚\n\n## ç¼“å­˜ç©¿é€çš„è§£å†³æ–¹æ³•\n1. ç©ºå¯¹è±¡ç¼“å­˜ï¼šå½“æŸ¥è¯¢ç»“æœä¸ºç©ºæ—¶ï¼Œä¹Ÿå°†è¯¥ç©ºç»“æœç¼“å­˜èµ·æ¥ï¼Œä½†è®¾ç½®ä¸€ä¸ªè¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢æ”»å‡»è€…åˆ©ç”¨ç¼“å­˜ç©¿é€é—®é¢˜ã€‚\n2. å¸ƒéš†è¿‡æ»¤å™¨ï¼šåœ¨ç¼“å­˜å±‚ä¹‹å‰å¢åŠ å¸ƒéš†è¿‡æ»¤å™¨ï¼Œç”¨äºå¿«é€Ÿè¿‡æ»¤æ‰ä¸å­˜åœ¨äºç¼“å­˜ä¸­çš„ keyï¼Œä»è€Œé¿å…ç¼“å­˜ç©¿é€ã€‚\n3. çƒ­ç‚¹æ•°æ®é¢„çƒ­ï¼šå°†çƒ­ç‚¹æ•°æ®æå‰åŠ è½½åˆ°ç¼“å­˜ä¸­ï¼Œæé«˜å‘½ä¸­ç‡ï¼Œå‡å°‘ç¼“å­˜ç©¿é€çš„å‘ç”Ÿã€‚\n4. é™æµæ§åˆ¶ï¼šå¯¹äºé¢‘ç¹æŸ¥è¯¢çš„æ¥å£ï¼Œå¯ä»¥è¿›è¡Œé™æµæ§åˆ¶ï¼Œé˜²æ­¢æ”»å‡»è€…å‘èµ·å¤§é‡æ— æ•ˆè¯·æ±‚ã€‚\n5. ä½¿ç”¨ç¼“å­˜é”ï¼šåœ¨æŸ¥è¯¢æ•°æ®åº“æ—¶ï¼Œä½¿ç”¨ç¼“å­˜é”è¿›è¡Œä¸²è¡ŒåŒ–å¤„ç†ï¼Œé˜²æ­¢å¤§é‡å¹¶å‘æŸ¥è¯¢å¯¼è‡´ç¼“å­˜ç©¿é€ã€‚\n\nä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ C# ç©ºå¯¹è±¡ç¼“å­˜çš„ç¤ºä¾‹ä»£ç ï¼š\n\n```C#\npublic class UserBll\n{\n    public static readonly int CACHE_NULL_TTL = 10;\n    public static readonly int CACHE_TTL = 20;\n    /** \n     * ç¼“å­˜ç©¿é€* \n     * @param id \n     * @ return \n     */\n    public WebUserInfo QueryUser(string key)\n    {\n        var redis = Redis.GetDatabase(0);\n        // 1.ä»redisä¸­æŸ¥è¯¢storeç¼“å­˜\n        String value = redis.StringGet(key);\n        WebUserInfo user = null;\n        // 2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨\n        if( value.HasValue() ) {\n            user = value.FromJson<WebUserInfo>();\n            // 3.å­˜åœ¨ï¼Œç›´æ¥è¿”å›\n            return user;\n        }\n        // åˆ¤æ–­å‘½ä¸­æ˜¯å¦ä¸ºç©ºå€¼\n        if ( value == null) {\n            // è¿”å›é”™è¯¯ä¿¡æ¯\n            return null;\n        }\n        // 4.ä¸å­˜åœ¨ï¼Œæ ¹æ®idæŸ¥è¯¢æ•°æ®åº“\n        user = DatabaseQuery(key);\n        // 5. ä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯\n        if( user == null ) {\n            // å‘rediså†™å…¥ç©ºå€¼ï¼ˆç¼“å­˜ç©¿é€ï¼‰\n            redis.StringSet(key, \"\", new TimeSpan(0, CACHE_NULL_TTL, 0));\n            return null;\n        }\n        // 6.å­˜åœ¨ï¼Œå†™å…¥redis\n        redis.StringSet(key, user.ToJson(), new TimeSpan(0, CACHE_TTL, 0));\n        // 7. è¿”å›\n        return user;\n}\n\n\n    public WebUserInfo DatabaseQuery(string key)\n    {\n        // æ¨¡æ‹Ÿä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®\n        // å®é™…æƒ…å†µä¸‹ï¼Œè¿™é‡Œå¯ä»¥æ˜¯è®¿é—®æ•°æ®åº“ã€è°ƒç”¨å¤–éƒ¨ API ç­‰æ“ä½œ\n        // è¿™é‡Œç®€åŒ–ä¸ºè¿”å› null\n        return null;\n    }\n\n\n}\n\nclass Program\n{\n    static void Main(string[] args)\n    {\n        UserBll cache = new UserBll();\n\n        // ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼Œç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼Œä½†æ˜¯æŸ¥è¯¢ç»“æœä¸ºç©º\n        string result1 = cache.QueryUser(\"key1\");\n        Console.WriteLine(\"Result 1: \" + result1); // Output: Result 1: (null)\n\n        // ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼Œç¼“å­˜ä¸­å·²å­˜åœ¨ç©ºå¯¹è±¡ç¼“å­˜ï¼Œç›´æ¥è¿”å›ç©ºå€¼\n        string result2 = cache.QueryUser(\"key1\");\n        Console.WriteLine(\"Result 2: \" + result2); // Output: Result 2: (null)\n\n        // ç¬¬ä¸‰æ¬¡æŸ¥è¯¢ï¼Œæ¨¡æ‹Ÿæ•°æ®åº“ä¸­å­˜åœ¨å¯¹åº”å€¼çš„æƒ…å†µ\n        string result3 = cache.QueryUser(\"key2\");\n        Console.WriteLine(\"Result 3: \" + result3); // Output: Result 3: <value from database>\n    }\n}\n\n\n```\nä¸Šè¿°ä»£ç ä¸­ï¼Œå½“ç”¨æˆ·è¯·æ±‚ä¸€ä¸ªkeyæ—¶ï¼Œrediså’Œæ•°æ®åº“éƒ½ä¸å­˜åœ¨ã€‚æˆ‘ä»¬ç›´æ¥å°†keyå¯¹åº”çš„nullå€¼ç¼“å­˜åˆ°redisä¸­ï¼Œè¿™æ ·ä¸‹æ¬¡ç”¨æˆ·é‡å¤è¯·æ±‚è¿™ä¸ªkeyçš„æ—¶å€™ï¼Œrediså°±å¯ä»¥å‘½ä¸­ï¼ˆhit nullï¼‰ï¼Œåªæ˜¯ä¸ä¼šè¯¢é—®æ•°æ®åº“\n- ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ˜“äºç»´æŠ¤\n- ç¼ºç‚¹ï¼šé¢å¤–çš„å†…å­˜æ¶ˆè€—ï¼ˆå¯ä»¥é€šè¿‡æ·»åŠ TTLæ¥è§£å†³ï¼‰\n\nåŒæ—¶å¯èƒ½ä¼šé€ æˆçŸ­æš‚çš„ä¸ä¸€è‡´ï¼ˆæ§åˆ¶TTLæ—¶é—´å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£ï¼‰ã€‚å½“nullè¢«ç¼“å­˜æ—¶ï¼Œæˆ‘ä»¬åªæ˜¯åœ¨æ•°æ®åº“ä¸­è®¾ç½®å€¼ï¼Œè€Œç”¨æˆ·queryä¸ºç©ºï¼Œä½†æ•°æ®åº“ä¸­å®é™…å­˜åœ¨ï¼Œä¼šé€ æˆä¸ä¸€è‡´ï¼ˆå¯ä»¥é€šè¿‡æ’å…¥æ•°æ®æ—¶è‡ªåŠ¨è¦†ç›–ä¹‹å‰çš„ç©ºæ•°æ®æ¥è§£å†³ï¼‰\n\n# ç¼“å­˜é›ªå´©\nç¼“å­˜é›ªå´©æŒ‡çš„æ˜¯åœ¨ç¼“å­˜å¤±æ•ˆçš„ç¬é—´ï¼Œå¤§é‡çš„è¯·æ±‚åŒæ—¶æ¶Œå…¥æ•°æ®åº“æˆ–å…¶ä»–æ•°æ®æºï¼Œå¯¼è‡´æ•°æ®åº“è´Ÿè½½å‰§å¢ï¼Œç”šè‡³é€ æˆæ•°æ®åº“å®•æœºçš„æƒ…å†µã€‚\n\n![Cache Avalanche](/images/redis-interview/cache-avalanche.png)\n\n## ç¼“å­˜é›ªå´©çš„åŸå› \nç¼“å­˜é›ªå´©é€šå¸¸æ˜¯ç”±äºç¼“å­˜ä¸­çš„å¤§é‡æ•°æ®åŒæ—¶å¤±æ•ˆè€Œå¼•èµ·çš„ã€‚å½“å¤šä¸ªç¼“å­˜é”®å…·æœ‰ç›¸åŒçš„å¤±æ•ˆæ—¶é—´ï¼Œå¹¶ä¸”è¿™äº›ç¼“å­˜é”®åˆåœ¨åŒä¸€æ—¶é—´å¤±æ•ˆæ—¶ï¼Œå°±ä¼šå¯¼è‡´å¤§é‡è¯·æ±‚ç›´æ¥å‡»ç©¿ç¼“å­˜ï¼ŒåŒæ—¶æ¶Œå…¥æ•°æ®æºï¼Œé€ æˆç¼“å­˜é›ªå´©\n\n## ç¼“å­˜é›ªå´©çš„è§£å†³æ–¹æ¡ˆ\n### 1. è®¾ç½®éšæœºè¿‡æœŸæ—¶é—´\né€šè¿‡ç»™ç¼“å­˜é”®è®¾ç½®éšæœºçš„è¿‡æœŸæ—¶é—´ï¼Œå¯ä»¥æœ‰æ•ˆåœ°åˆ†æ•£ç¼“å­˜å¤±æ•ˆçš„æ—¶é—´ç‚¹ï¼Œé™ä½å¤§é‡ç¼“å­˜åŒæ—¶å¤±æ•ˆçš„å¯èƒ½æ€§ï¼Œä»è€Œå‡è½»äº†ç¼“å­˜é›ªå´©çš„é£é™©ã€‚\n\n### 2. ä½¿ç”¨å¤šçº§ç¼“å­˜ç­–ç•¥\né‡‡ç”¨å¤šçº§ç¼“å­˜æ¶æ„ï¼ŒåŒ…æ‹¬æœ¬åœ°ç¼“å­˜ã€åˆ†å¸ƒå¼ç¼“å­˜å’ŒæŒä¹…åŒ–å­˜å‚¨ï¼Œå½“ä¸»ç¼“å­˜å¤±æ•ˆæ—¶ï¼Œå¯ä»¥ä»å¤‡ç”¨ç¼“å­˜ä¸­è·å–æ•°æ®ï¼Œé™ä½å¯¹æ•°æ®åº“çš„ç›´æ¥è®¿é—®ã€‚\n\n### 3. é™æµå’Œé™çº§\nåœ¨ç¼“å­˜å¤±æ•ˆæœŸé—´ï¼Œå¯ä»¥å¯¹è¯·æ±‚è¿›è¡Œé™æµï¼Œé™ä½è¯·æ±‚çš„å¹¶å‘æ•°é‡ï¼Œä»è€Œå‡è½»äº†æ•°æ®åº“çš„å‹åŠ›ã€‚åŒæ—¶ï¼Œå¯ä»¥å¯¹éƒ¨åˆ†éå…³é”®è¯·æ±‚è¿›è¡Œé™çº§å¤„ç†ï¼Œæš‚æ—¶å±è”½ä¸€äº›éå¿…è¦çš„æœåŠ¡ï¼Œä¿è¯æ ¸å¿ƒæœåŠ¡çš„ç¨³å®šæ€§ã€‚\n\n### 4. é¢„çƒ­ç¼“å­˜\nåœ¨ç³»ç»Ÿå¯åŠ¨æˆ–ä½å³°æœŸï¼Œé¢„å…ˆåŠ è½½ç¼“å­˜æ•°æ®ï¼Œæå‰å°†å¸¸ç”¨æ•°æ®ç¼“å­˜èµ·æ¥ï¼Œé¿å…åœ¨é«˜å³°æœŸé—´å¤§é‡è¯·æ±‚ç›´æ¥å‡»ç©¿ç¼“å­˜ã€‚\n\n# ç¼“å­˜å‡»ç©¿\nç¼“å­˜å‡»ç©¿æ˜¯æŒ‡æŸä¸ªçƒ­ç‚¹keyçªç„¶å¤±æ•ˆæˆ–è€…æœªå‘½ä¸­ï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œé€ æˆæ•°æ®åº“å‹åŠ›å‰§å¢çš„ç°è±¡ã€‚è¿™ç§æƒ…å†µé€šå¸¸å‘ç”Ÿåœ¨å…·æœ‰é«˜å¹¶å‘è®¿é—®é‡çš„ç³»ç»Ÿä¸­ï¼Œç‰¹åˆ«æ˜¯åœ¨ç¼“å­˜ç³»ç»Ÿä¸­ä½¿ç”¨äº†è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´æˆ–è€…çƒ­ç‚¹æ•°æ®çš„è®¿é—®é¢‘ç‡çªç„¶å¢åŠ æ—¶ã€‚\n\n![ç¼“å­˜å‡»ç©¿](/images/redis-interview/cache-breakdown.png)\n\n1. è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸï¼š å¯¹äºä¸€äº›çƒ­ç‚¹æ•°æ®ï¼Œå¯ä»¥è®¾ç½®æ°¸ä¸è¿‡æœŸï¼Œæˆ–è€…è®¾ç½®è¾ƒé•¿çš„è¿‡æœŸæ—¶é—´ï¼Œä¿è¯å…¶ä¸ä¼šåœ¨çŸ­æ—¶é—´å†…å¤±æ•ˆï¼Œä»è€Œé¿å…äº†ç¼“å­˜å‡»ç©¿çš„å‘ç”Ÿã€‚\n2. åŠ é”æœºåˆ¶ï¼š åœ¨ç¼“å­˜å¤±æ•ˆæ—¶ï¼Œå¯ä»¥é€šè¿‡åŠ é”æœºåˆ¶ç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè¿›å…¥æ•°æ®åº“æŸ¥è¯¢æ•°æ®ï¼Œå¹¶å°†æŸ¥è¯¢ç»“æœæ›´æ–°åˆ°ç¼“å­˜ä¸­ï¼Œé¿å…äº†å¤šä¸ªçº¿ç¨‹åŒæ—¶æŸ¥è¯¢æ•°æ®åº“çš„æƒ…å†µã€‚\n3. ä½¿ç”¨äº’æ–¥é”å’Œåˆ†å¸ƒå¼é”ï¼š ä½¿ç”¨äº’æ–¥é”æˆ–è€…åˆ†å¸ƒå¼é”æ¥ä¿è¯åœ¨æŸ¥è¯¢æ•°æ®åº“çš„è¿‡ç¨‹ä¸­ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿæ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼Œå…¶ä»–çº¿ç¨‹éœ€è¦ç­‰å¾…é”é‡Šæ”¾åå†è¿›è¡ŒæŸ¥è¯¢ï¼Œé¿å…äº†å¹¶å‘è®¿é—®æ•°æ®åº“çš„æƒ…å†µã€‚\n4. ä½¿ç”¨ç¼“å­˜é¢„çƒ­ï¼š åœ¨ç³»ç»Ÿå¯åŠ¨æˆ–è€…ä½å³°æœŸï¼Œå¯ä»¥é¢„å…ˆå°†çƒ­ç‚¹æ•°æ®åŠ è½½åˆ°ç¼“å­˜ä¸­ï¼Œæå‰å‡å°‘äº†ç¼“å­˜å¤±æ•ˆæ—¶çš„å¹¶å‘è¯·æ±‚é‡ï¼Œä»è€Œé¿å…äº†ç¼“å­˜å‡»ç©¿çš„å‘ç”Ÿã€‚\n\nä¸‹é¢æ˜¯ä¸€ä¸ªç”¨C#å®ç°çš„ç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨äº’æ–¥é”æ¥è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜ï¼š\n```C#\nusing System;\nusing System.Collections.Generic;\nusing System.Threading;\n\npublic class Cache\n{\n    private Dictionary<string, string> cache = new Dictionary<string, string>();\n    private Mutex mutex = new Mutex();\n\n    public string Get(string key)\n    {\n        // å…ˆå°è¯•ä»ç¼“å­˜ä¸­è·å–æ•°æ®\n        string value;\n        if (cache.TryGetValue(key, out value))\n        {\n            return value;\n        }\n\n        // å¦‚æœç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼ŒåŠ é”æŸ¥è¯¢æ•°æ®åº“\n        mutex.WaitOne();\n        try\n        {\n            // å†æ¬¡æ£€æŸ¥ç¼“å­˜ï¼Œé˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶æŸ¥è¯¢æ•°æ®åº“\n            if (cache.TryGetValue(key, out value))\n            {\n                return value;\n            }\n\n            // æ¨¡æ‹Ÿä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®\n            value = QueryFromDatabase(key);\n\n            // å°†æŸ¥è¯¢ç»“æœæ›´æ–°åˆ°ç¼“å­˜ä¸­\n            cache[key] = value;\n        }\n        finally\n        {\n            mutex.ReleaseMutex();\n        }\n\n        return value;\n    }\n\n    private string QueryFromDatabase(string key)\n    {\n        // æ¨¡æ‹Ÿä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®çš„è¿‡ç¨‹\n        Thread.Sleep(100); // æ¨¡æ‹Ÿè€—æ—¶æŸ¥è¯¢æ“ä½œ\n        return \"value for \" + key;\n    }\n}\n\nclass Program\n{\n    static void Main(string[] args)\n    {\n        Cache cache = new Cache();\n\n        // å¹¶å‘æŸ¥è¯¢\n        List<Thread> threads = new List<Thread>();\n        for (int i = 0; i < 10; i++)\n        {\n            Thread thread = new Thread(() =>\n            {\n                string value = cache.Get(\"key\");\n                Console.WriteLine(Thread.CurrentThread.Name + \": \" + value);\n            });\n            thread.Name = \"Thread \" + i;\n            threads.Add(thread);\n        }\n\n        foreach (Thread thread in threads)\n        {\n            thread.Start();\n        }\n\n        foreach (Thread thread in threads)\n        {\n            thread.Join();\n        }\n    }\n}\n\n```\n\n# ç›¸å…³æ–‡ç« æ¨è\n<div id=\"References\"></div>\n\n+ [Rediså®˜æ–¹æ–‡æ¡£](http://redis.io/documentation)\n+ [Redisæ•™ç¨‹](https://www.runoob.com/redis/redis-tutorial.html)\n\n\nä»Šå¤©å°±ä¸æ€»ç»“äº†ï¼Œæœªå®Œå¾…ç»­ğŸ˜ª...\n\n\næ›´å¤šä¸€æ‰‹è®¯æ¯ï¼Œå¯å…³æ³¨å…¬ä¼—å·ï¼š[ITProHub](https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg)\n\n![ITProHub](https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg)","source":"_posts/redis-interview-1.md","raw":"---\ntitle: Redisæˆé•¿è®° - Redisçš„é™·é˜±ï¼ˆä¸€ï¼‰\ndate: 2024-04-18 15:09:28\ntags: redis é¢è¯• æ±‚èŒ\n---\nç›¸ä¿¡å¾ˆå¤šè€é“åœ¨æ±‚èŒè¿‡ç¨‹ä¸­éƒ½çœ‹åˆ°è¿‡ç±»ä¼¼ä¸‹é¢è¿™æ ·çš„ä»»èŒè¦æ±‚\n\n<img src=\"/images/redis-interview/recruitment.png\" width=\"50%\">\n\nä½ ç”³è¯·çš„å²—ä½ä¸Šé¢å†™ç€â€ç†Ÿæ‚‰Redisâ€ï¼Œé‚£ä¹ˆä½ å·²ç»å‡†å¤‡å¥½å›ç­”é¢è¯•å®˜å¯èƒ½ä¼šé—®åˆ°çš„é—®é¢˜äº†ä¹ˆï¼Ÿ\nåé¢æˆ‘å°†å¼€å¯ä¸€ä¸ªé’ˆå¯¹Redisçš„ç³»åˆ—åˆ†äº«ï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆšåˆšå¼€å§‹å­¦ä¹ Redisçš„æœ‹å‹ä»¬ã€‚\n\nåœ¨å¼€å§‹é˜…è¯»æœ¬ç¯‡æ–‡ç« ä¹‹å‰ï¼Œé»˜è®¤ä½ å·²ç»å…·å¤‡åŸºç¡€çš„RedisçŸ¥è¯†ï¼Œå¦‚æœä½ æ²¡æœ‰ï¼Œå¯ä»¥å…ˆé˜…è¯»æ–‡æœ«[ç›¸å…³æ–‡ç« æ¨è](#References)\n\n\nå½“ä½¿ç”¨ Redis ä½œä¸ºç¼“å­˜æˆ–æ•°æ®å­˜å‚¨æ—¶ï¼Œè™½ç„¶å®ƒæä¾›äº†é«˜æ€§èƒ½å’Œçµæ´»æ€§ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸€äº›é™·é˜±éœ€è¦æ³¨æ„ã€‚ä¹‹å‰çœ‹åšå®¢çš„æ—¶å€™çœ‹åˆ°è¿‡è¿™æ ·ä¸€å¥è¯â€Experts arenâ€™t the only people who know what to do. Theyâ€™re the people who know what not to do.â€œ ä¸“å®¶å¹¶ä¸æ˜¯å”¯ä¸€çŸ¥é“å¦‚ä½•åšçš„äººï¼Œä»–ä»¬åªæ˜¯çŸ¥é“å¦‚ä½•é¿å…ä¸€äº›é™·é˜±ã€‚\n\nä¸‹é¢è®²è¯‰çš„æ˜¯ä¸€äº›å¸¸è§çš„ Redis é™·é˜±ï¼Œæˆ–è€…è¯´å®¹æ˜“å¿½ç•¥çš„é—®é¢˜ã€‚å†…å®¹è¾ƒå¤šï¼Œå¯èƒ½ä¼šåˆ†å¤šç¯‡æ–‡ç« ï¼Œå°½æƒ…æœŸå¾…ã€‚\nåŒæ—¶ç”±äºè¦è®²çš„å†…å®¹å®åœ¨æ˜¯å¤ªå¤šï¼Œæ‰€ä»¥æœ¬æ–‡æ›´å¤šçš„åªæ˜¯èµ·åˆ°â€æŠ›ç –â€œçš„ä½œç”¨ï¼Œæ›´å¤šçš„è¯¦ç»†çš„å†…å®¹è¿˜éœ€è¦è€é“ä»¬è‡ªå·±å†æ·±å±‚æ¬¡çš„å»å­¦ä¹ ã€‚\n\n# ç¼“å­˜ç©¿é€\nç¼“å­˜ç©¿é€æŒ‡çš„æ˜¯æ¶æ„è¯·æ±‚æˆ–è€…å¤§é‡ä¸å­˜åœ¨çš„ key å¯¼è‡´ç¼“å­˜æ— æ³•å‘½ä¸­ï¼Œä»è€Œç»•è¿‡ç¼“å­˜ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›è¿‡å¤§ï¼Œç”šè‡³å®•æœºçš„æƒ…å†µã€‚\n\n![ç¼“å­˜ç©¿é€](/images/redis-interview/cache-penetration.png)\n\n## ç¼“å­˜ç©¿é€çš„åŸå› \nç¼“å­˜ç©¿é€é€šå¸¸å‘ç”Ÿåœ¨ä»¥ä¸‹æƒ…å†µä¸‹ï¼š\n\n1. æ¶æ„è¯·æ±‚ï¼šæ”»å‡»è€…å‘é€å¤§é‡ä¸å­˜åœ¨äºç¼“å­˜ä¸­çš„ keyï¼Œå¯¼è‡´ç¼“å­˜æ— æ³•å‘½ä¸­ï¼Œç›´æ¥è®¿é—®æ•°æ®åº“ã€‚\n2. å¤§é‡å¹¶å‘æŸ¥è¯¢ï¼šå½“å¹¶å‘æŸ¥è¯¢é‡å¾ˆå¤§æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°å¤§é‡ä¸å­˜åœ¨äºç¼“å­˜ä¸­çš„ keyï¼Œä»è€Œå¯¼è‡´ç¼“å­˜ç©¿é€ã€‚\n\n## ç¼“å­˜ç©¿é€çš„å½±å“\n+ æ•°æ®åº“å‹åŠ›è¿‡å¤§ï¼šå¤§é‡æ— æ•ˆè¯·æ±‚ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›è¿‡å¤§ï¼Œç”šè‡³å¯¼è‡´æ•°æ®åº“å®•æœºã€‚\n+ ç³»ç»Ÿæ€§èƒ½ä¸‹é™ï¼šæ•°æ®åº“å‹åŠ›å¢å¤§ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå“åº”å˜æ…¢ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚\n\n## ç¼“å­˜ç©¿é€çš„è§£å†³æ–¹æ³•\n1. ç©ºå¯¹è±¡ç¼“å­˜ï¼šå½“æŸ¥è¯¢ç»“æœä¸ºç©ºæ—¶ï¼Œä¹Ÿå°†è¯¥ç©ºç»“æœç¼“å­˜èµ·æ¥ï¼Œä½†è®¾ç½®ä¸€ä¸ªè¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢æ”»å‡»è€…åˆ©ç”¨ç¼“å­˜ç©¿é€é—®é¢˜ã€‚\n2. å¸ƒéš†è¿‡æ»¤å™¨ï¼šåœ¨ç¼“å­˜å±‚ä¹‹å‰å¢åŠ å¸ƒéš†è¿‡æ»¤å™¨ï¼Œç”¨äºå¿«é€Ÿè¿‡æ»¤æ‰ä¸å­˜åœ¨äºç¼“å­˜ä¸­çš„ keyï¼Œä»è€Œé¿å…ç¼“å­˜ç©¿é€ã€‚\n3. çƒ­ç‚¹æ•°æ®é¢„çƒ­ï¼šå°†çƒ­ç‚¹æ•°æ®æå‰åŠ è½½åˆ°ç¼“å­˜ä¸­ï¼Œæé«˜å‘½ä¸­ç‡ï¼Œå‡å°‘ç¼“å­˜ç©¿é€çš„å‘ç”Ÿã€‚\n4. é™æµæ§åˆ¶ï¼šå¯¹äºé¢‘ç¹æŸ¥è¯¢çš„æ¥å£ï¼Œå¯ä»¥è¿›è¡Œé™æµæ§åˆ¶ï¼Œé˜²æ­¢æ”»å‡»è€…å‘èµ·å¤§é‡æ— æ•ˆè¯·æ±‚ã€‚\n5. ä½¿ç”¨ç¼“å­˜é”ï¼šåœ¨æŸ¥è¯¢æ•°æ®åº“æ—¶ï¼Œä½¿ç”¨ç¼“å­˜é”è¿›è¡Œä¸²è¡ŒåŒ–å¤„ç†ï¼Œé˜²æ­¢å¤§é‡å¹¶å‘æŸ¥è¯¢å¯¼è‡´ç¼“å­˜ç©¿é€ã€‚\n\nä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ C# ç©ºå¯¹è±¡ç¼“å­˜çš„ç¤ºä¾‹ä»£ç ï¼š\n\n```C#\npublic class UserBll\n{\n    public static readonly int CACHE_NULL_TTL = 10;\n    public static readonly int CACHE_TTL = 20;\n    /** \n     * ç¼“å­˜ç©¿é€* \n     * @param id \n     * @ return \n     */\n    public WebUserInfo QueryUser(string key)\n    {\n        var redis = Redis.GetDatabase(0);\n        // 1.ä»redisä¸­æŸ¥è¯¢storeç¼“å­˜\n        String value = redis.StringGet(key);\n        WebUserInfo user = null;\n        // 2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨\n        if( value.HasValue() ) {\n            user = value.FromJson<WebUserInfo>();\n            // 3.å­˜åœ¨ï¼Œç›´æ¥è¿”å›\n            return user;\n        }\n        // åˆ¤æ–­å‘½ä¸­æ˜¯å¦ä¸ºç©ºå€¼\n        if ( value == null) {\n            // è¿”å›é”™è¯¯ä¿¡æ¯\n            return null;\n        }\n        // 4.ä¸å­˜åœ¨ï¼Œæ ¹æ®idæŸ¥è¯¢æ•°æ®åº“\n        user = DatabaseQuery(key);\n        // 5. ä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯\n        if( user == null ) {\n            // å‘rediså†™å…¥ç©ºå€¼ï¼ˆç¼“å­˜ç©¿é€ï¼‰\n            redis.StringSet(key, \"\", new TimeSpan(0, CACHE_NULL_TTL, 0));\n            return null;\n        }\n        // 6.å­˜åœ¨ï¼Œå†™å…¥redis\n        redis.StringSet(key, user.ToJson(), new TimeSpan(0, CACHE_TTL, 0));\n        // 7. è¿”å›\n        return user;\n}\n\n\n    public WebUserInfo DatabaseQuery(string key)\n    {\n        // æ¨¡æ‹Ÿä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®\n        // å®é™…æƒ…å†µä¸‹ï¼Œè¿™é‡Œå¯ä»¥æ˜¯è®¿é—®æ•°æ®åº“ã€è°ƒç”¨å¤–éƒ¨ API ç­‰æ“ä½œ\n        // è¿™é‡Œç®€åŒ–ä¸ºè¿”å› null\n        return null;\n    }\n\n\n}\n\nclass Program\n{\n    static void Main(string[] args)\n    {\n        UserBll cache = new UserBll();\n\n        // ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼Œç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼Œä½†æ˜¯æŸ¥è¯¢ç»“æœä¸ºç©º\n        string result1 = cache.QueryUser(\"key1\");\n        Console.WriteLine(\"Result 1: \" + result1); // Output: Result 1: (null)\n\n        // ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼Œç¼“å­˜ä¸­å·²å­˜åœ¨ç©ºå¯¹è±¡ç¼“å­˜ï¼Œç›´æ¥è¿”å›ç©ºå€¼\n        string result2 = cache.QueryUser(\"key1\");\n        Console.WriteLine(\"Result 2: \" + result2); // Output: Result 2: (null)\n\n        // ç¬¬ä¸‰æ¬¡æŸ¥è¯¢ï¼Œæ¨¡æ‹Ÿæ•°æ®åº“ä¸­å­˜åœ¨å¯¹åº”å€¼çš„æƒ…å†µ\n        string result3 = cache.QueryUser(\"key2\");\n        Console.WriteLine(\"Result 3: \" + result3); // Output: Result 3: <value from database>\n    }\n}\n\n\n```\nä¸Šè¿°ä»£ç ä¸­ï¼Œå½“ç”¨æˆ·è¯·æ±‚ä¸€ä¸ªkeyæ—¶ï¼Œrediså’Œæ•°æ®åº“éƒ½ä¸å­˜åœ¨ã€‚æˆ‘ä»¬ç›´æ¥å°†keyå¯¹åº”çš„nullå€¼ç¼“å­˜åˆ°redisä¸­ï¼Œè¿™æ ·ä¸‹æ¬¡ç”¨æˆ·é‡å¤è¯·æ±‚è¿™ä¸ªkeyçš„æ—¶å€™ï¼Œrediså°±å¯ä»¥å‘½ä¸­ï¼ˆhit nullï¼‰ï¼Œåªæ˜¯ä¸ä¼šè¯¢é—®æ•°æ®åº“\n- ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ˜“äºç»´æŠ¤\n- ç¼ºç‚¹ï¼šé¢å¤–çš„å†…å­˜æ¶ˆè€—ï¼ˆå¯ä»¥é€šè¿‡æ·»åŠ TTLæ¥è§£å†³ï¼‰\n\nåŒæ—¶å¯èƒ½ä¼šé€ æˆçŸ­æš‚çš„ä¸ä¸€è‡´ï¼ˆæ§åˆ¶TTLæ—¶é—´å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£ï¼‰ã€‚å½“nullè¢«ç¼“å­˜æ—¶ï¼Œæˆ‘ä»¬åªæ˜¯åœ¨æ•°æ®åº“ä¸­è®¾ç½®å€¼ï¼Œè€Œç”¨æˆ·queryä¸ºç©ºï¼Œä½†æ•°æ®åº“ä¸­å®é™…å­˜åœ¨ï¼Œä¼šé€ æˆä¸ä¸€è‡´ï¼ˆå¯ä»¥é€šè¿‡æ’å…¥æ•°æ®æ—¶è‡ªåŠ¨è¦†ç›–ä¹‹å‰çš„ç©ºæ•°æ®æ¥è§£å†³ï¼‰\n\n# ç¼“å­˜é›ªå´©\nç¼“å­˜é›ªå´©æŒ‡çš„æ˜¯åœ¨ç¼“å­˜å¤±æ•ˆçš„ç¬é—´ï¼Œå¤§é‡çš„è¯·æ±‚åŒæ—¶æ¶Œå…¥æ•°æ®åº“æˆ–å…¶ä»–æ•°æ®æºï¼Œå¯¼è‡´æ•°æ®åº“è´Ÿè½½å‰§å¢ï¼Œç”šè‡³é€ æˆæ•°æ®åº“å®•æœºçš„æƒ…å†µã€‚\n\n![Cache Avalanche](/images/redis-interview/cache-avalanche.png)\n\n## ç¼“å­˜é›ªå´©çš„åŸå› \nç¼“å­˜é›ªå´©é€šå¸¸æ˜¯ç”±äºç¼“å­˜ä¸­çš„å¤§é‡æ•°æ®åŒæ—¶å¤±æ•ˆè€Œå¼•èµ·çš„ã€‚å½“å¤šä¸ªç¼“å­˜é”®å…·æœ‰ç›¸åŒçš„å¤±æ•ˆæ—¶é—´ï¼Œå¹¶ä¸”è¿™äº›ç¼“å­˜é”®åˆåœ¨åŒä¸€æ—¶é—´å¤±æ•ˆæ—¶ï¼Œå°±ä¼šå¯¼è‡´å¤§é‡è¯·æ±‚ç›´æ¥å‡»ç©¿ç¼“å­˜ï¼ŒåŒæ—¶æ¶Œå…¥æ•°æ®æºï¼Œé€ æˆç¼“å­˜é›ªå´©\n\n## ç¼“å­˜é›ªå´©çš„è§£å†³æ–¹æ¡ˆ\n### 1. è®¾ç½®éšæœºè¿‡æœŸæ—¶é—´\né€šè¿‡ç»™ç¼“å­˜é”®è®¾ç½®éšæœºçš„è¿‡æœŸæ—¶é—´ï¼Œå¯ä»¥æœ‰æ•ˆåœ°åˆ†æ•£ç¼“å­˜å¤±æ•ˆçš„æ—¶é—´ç‚¹ï¼Œé™ä½å¤§é‡ç¼“å­˜åŒæ—¶å¤±æ•ˆçš„å¯èƒ½æ€§ï¼Œä»è€Œå‡è½»äº†ç¼“å­˜é›ªå´©çš„é£é™©ã€‚\n\n### 2. ä½¿ç”¨å¤šçº§ç¼“å­˜ç­–ç•¥\né‡‡ç”¨å¤šçº§ç¼“å­˜æ¶æ„ï¼ŒåŒ…æ‹¬æœ¬åœ°ç¼“å­˜ã€åˆ†å¸ƒå¼ç¼“å­˜å’ŒæŒä¹…åŒ–å­˜å‚¨ï¼Œå½“ä¸»ç¼“å­˜å¤±æ•ˆæ—¶ï¼Œå¯ä»¥ä»å¤‡ç”¨ç¼“å­˜ä¸­è·å–æ•°æ®ï¼Œé™ä½å¯¹æ•°æ®åº“çš„ç›´æ¥è®¿é—®ã€‚\n\n### 3. é™æµå’Œé™çº§\nåœ¨ç¼“å­˜å¤±æ•ˆæœŸé—´ï¼Œå¯ä»¥å¯¹è¯·æ±‚è¿›è¡Œé™æµï¼Œé™ä½è¯·æ±‚çš„å¹¶å‘æ•°é‡ï¼Œä»è€Œå‡è½»äº†æ•°æ®åº“çš„å‹åŠ›ã€‚åŒæ—¶ï¼Œå¯ä»¥å¯¹éƒ¨åˆ†éå…³é”®è¯·æ±‚è¿›è¡Œé™çº§å¤„ç†ï¼Œæš‚æ—¶å±è”½ä¸€äº›éå¿…è¦çš„æœåŠ¡ï¼Œä¿è¯æ ¸å¿ƒæœåŠ¡çš„ç¨³å®šæ€§ã€‚\n\n### 4. é¢„çƒ­ç¼“å­˜\nåœ¨ç³»ç»Ÿå¯åŠ¨æˆ–ä½å³°æœŸï¼Œé¢„å…ˆåŠ è½½ç¼“å­˜æ•°æ®ï¼Œæå‰å°†å¸¸ç”¨æ•°æ®ç¼“å­˜èµ·æ¥ï¼Œé¿å…åœ¨é«˜å³°æœŸé—´å¤§é‡è¯·æ±‚ç›´æ¥å‡»ç©¿ç¼“å­˜ã€‚\n\n# ç¼“å­˜å‡»ç©¿\nç¼“å­˜å‡»ç©¿æ˜¯æŒ‡æŸä¸ªçƒ­ç‚¹keyçªç„¶å¤±æ•ˆæˆ–è€…æœªå‘½ä¸­ï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œé€ æˆæ•°æ®åº“å‹åŠ›å‰§å¢çš„ç°è±¡ã€‚è¿™ç§æƒ…å†µé€šå¸¸å‘ç”Ÿåœ¨å…·æœ‰é«˜å¹¶å‘è®¿é—®é‡çš„ç³»ç»Ÿä¸­ï¼Œç‰¹åˆ«æ˜¯åœ¨ç¼“å­˜ç³»ç»Ÿä¸­ä½¿ç”¨äº†è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´æˆ–è€…çƒ­ç‚¹æ•°æ®çš„è®¿é—®é¢‘ç‡çªç„¶å¢åŠ æ—¶ã€‚\n\n![ç¼“å­˜å‡»ç©¿](/images/redis-interview/cache-breakdown.png)\n\n1. è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸï¼š å¯¹äºä¸€äº›çƒ­ç‚¹æ•°æ®ï¼Œå¯ä»¥è®¾ç½®æ°¸ä¸è¿‡æœŸï¼Œæˆ–è€…è®¾ç½®è¾ƒé•¿çš„è¿‡æœŸæ—¶é—´ï¼Œä¿è¯å…¶ä¸ä¼šåœ¨çŸ­æ—¶é—´å†…å¤±æ•ˆï¼Œä»è€Œé¿å…äº†ç¼“å­˜å‡»ç©¿çš„å‘ç”Ÿã€‚\n2. åŠ é”æœºåˆ¶ï¼š åœ¨ç¼“å­˜å¤±æ•ˆæ—¶ï¼Œå¯ä»¥é€šè¿‡åŠ é”æœºåˆ¶ç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè¿›å…¥æ•°æ®åº“æŸ¥è¯¢æ•°æ®ï¼Œå¹¶å°†æŸ¥è¯¢ç»“æœæ›´æ–°åˆ°ç¼“å­˜ä¸­ï¼Œé¿å…äº†å¤šä¸ªçº¿ç¨‹åŒæ—¶æŸ¥è¯¢æ•°æ®åº“çš„æƒ…å†µã€‚\n3. ä½¿ç”¨äº’æ–¥é”å’Œåˆ†å¸ƒå¼é”ï¼š ä½¿ç”¨äº’æ–¥é”æˆ–è€…åˆ†å¸ƒå¼é”æ¥ä¿è¯åœ¨æŸ¥è¯¢æ•°æ®åº“çš„è¿‡ç¨‹ä¸­ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿæ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼Œå…¶ä»–çº¿ç¨‹éœ€è¦ç­‰å¾…é”é‡Šæ”¾åå†è¿›è¡ŒæŸ¥è¯¢ï¼Œé¿å…äº†å¹¶å‘è®¿é—®æ•°æ®åº“çš„æƒ…å†µã€‚\n4. ä½¿ç”¨ç¼“å­˜é¢„çƒ­ï¼š åœ¨ç³»ç»Ÿå¯åŠ¨æˆ–è€…ä½å³°æœŸï¼Œå¯ä»¥é¢„å…ˆå°†çƒ­ç‚¹æ•°æ®åŠ è½½åˆ°ç¼“å­˜ä¸­ï¼Œæå‰å‡å°‘äº†ç¼“å­˜å¤±æ•ˆæ—¶çš„å¹¶å‘è¯·æ±‚é‡ï¼Œä»è€Œé¿å…äº†ç¼“å­˜å‡»ç©¿çš„å‘ç”Ÿã€‚\n\nä¸‹é¢æ˜¯ä¸€ä¸ªç”¨C#å®ç°çš„ç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨äº’æ–¥é”æ¥è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜ï¼š\n```C#\nusing System;\nusing System.Collections.Generic;\nusing System.Threading;\n\npublic class Cache\n{\n    private Dictionary<string, string> cache = new Dictionary<string, string>();\n    private Mutex mutex = new Mutex();\n\n    public string Get(string key)\n    {\n        // å…ˆå°è¯•ä»ç¼“å­˜ä¸­è·å–æ•°æ®\n        string value;\n        if (cache.TryGetValue(key, out value))\n        {\n            return value;\n        }\n\n        // å¦‚æœç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼ŒåŠ é”æŸ¥è¯¢æ•°æ®åº“\n        mutex.WaitOne();\n        try\n        {\n            // å†æ¬¡æ£€æŸ¥ç¼“å­˜ï¼Œé˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶æŸ¥è¯¢æ•°æ®åº“\n            if (cache.TryGetValue(key, out value))\n            {\n                return value;\n            }\n\n            // æ¨¡æ‹Ÿä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®\n            value = QueryFromDatabase(key);\n\n            // å°†æŸ¥è¯¢ç»“æœæ›´æ–°åˆ°ç¼“å­˜ä¸­\n            cache[key] = value;\n        }\n        finally\n        {\n            mutex.ReleaseMutex();\n        }\n\n        return value;\n    }\n\n    private string QueryFromDatabase(string key)\n    {\n        // æ¨¡æ‹Ÿä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®çš„è¿‡ç¨‹\n        Thread.Sleep(100); // æ¨¡æ‹Ÿè€—æ—¶æŸ¥è¯¢æ“ä½œ\n        return \"value for \" + key;\n    }\n}\n\nclass Program\n{\n    static void Main(string[] args)\n    {\n        Cache cache = new Cache();\n\n        // å¹¶å‘æŸ¥è¯¢\n        List<Thread> threads = new List<Thread>();\n        for (int i = 0; i < 10; i++)\n        {\n            Thread thread = new Thread(() =>\n            {\n                string value = cache.Get(\"key\");\n                Console.WriteLine(Thread.CurrentThread.Name + \": \" + value);\n            });\n            thread.Name = \"Thread \" + i;\n            threads.Add(thread);\n        }\n\n        foreach (Thread thread in threads)\n        {\n            thread.Start();\n        }\n\n        foreach (Thread thread in threads)\n        {\n            thread.Join();\n        }\n    }\n}\n\n```\n\n# ç›¸å…³æ–‡ç« æ¨è\n<div id=\"References\"></div>\n\n+ [Rediså®˜æ–¹æ–‡æ¡£](http://redis.io/documentation)\n+ [Redisæ•™ç¨‹](https://www.runoob.com/redis/redis-tutorial.html)\n\n\nä»Šå¤©å°±ä¸æ€»ç»“äº†ï¼Œæœªå®Œå¾…ç»­ğŸ˜ª...\n\n\næ›´å¤šä¸€æ‰‹è®¯æ¯ï¼Œå¯å…³æ³¨å…¬ä¼—å·ï¼š[ITProHub](https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg)\n\n![ITProHub](https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg)","slug":"redis-interview-1","published":1,"updated":"2024-04-26T03:31:26.087Z","_id":"clv5zlgr50003fcp11585dpte","comments":1,"layout":"post","photos":[],"link":"","content":"<p>ç›¸ä¿¡å¾ˆå¤šè€é“åœ¨æ±‚èŒè¿‡ç¨‹ä¸­éƒ½çœ‹åˆ°è¿‡ç±»ä¼¼ä¸‹é¢è¿™æ ·çš„ä»»èŒè¦æ±‚</p>\n<img src=\"/images/redis-interview/recruitment.png\" width=\"50%\">\n\n<p>ä½ ç”³è¯·çš„å²—ä½ä¸Šé¢å†™ç€â€ç†Ÿæ‚‰Redisâ€ï¼Œé‚£ä¹ˆä½ å·²ç»å‡†å¤‡å¥½å›ç­”é¢è¯•å®˜å¯èƒ½ä¼šé—®åˆ°çš„é—®é¢˜äº†ä¹ˆï¼Ÿ<br>åé¢æˆ‘å°†å¼€å¯ä¸€ä¸ªé’ˆå¯¹Redisçš„ç³»åˆ—åˆ†äº«ï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆšåˆšå¼€å§‹å­¦ä¹ Redisçš„æœ‹å‹ä»¬ã€‚</p>\n<p>åœ¨å¼€å§‹é˜…è¯»æœ¬ç¯‡æ–‡ç« ä¹‹å‰ï¼Œé»˜è®¤ä½ å·²ç»å…·å¤‡åŸºç¡€çš„RedisçŸ¥è¯†ï¼Œå¦‚æœä½ æ²¡æœ‰ï¼Œå¯ä»¥å…ˆé˜…è¯»æ–‡æœ«<a href=\"#References\">ç›¸å…³æ–‡ç« æ¨è</a></p>\n<p>å½“ä½¿ç”¨ Redis ä½œä¸ºç¼“å­˜æˆ–æ•°æ®å­˜å‚¨æ—¶ï¼Œè™½ç„¶å®ƒæä¾›äº†é«˜æ€§èƒ½å’Œçµæ´»æ€§ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸€äº›é™·é˜±éœ€è¦æ³¨æ„ã€‚ä¹‹å‰çœ‹åšå®¢çš„æ—¶å€™çœ‹åˆ°è¿‡è¿™æ ·ä¸€å¥è¯â€Experts arenâ€™t the only people who know what to do. Theyâ€™re the people who know what not to do.â€œ ä¸“å®¶å¹¶ä¸æ˜¯å”¯ä¸€çŸ¥é“å¦‚ä½•åšçš„äººï¼Œä»–ä»¬åªæ˜¯çŸ¥é“å¦‚ä½•é¿å…ä¸€äº›é™·é˜±ã€‚</p>\n<p>ä¸‹é¢è®²è¯‰çš„æ˜¯ä¸€äº›å¸¸è§çš„ Redis é™·é˜±ï¼Œæˆ–è€…è¯´å®¹æ˜“å¿½ç•¥çš„é—®é¢˜ã€‚å†…å®¹è¾ƒå¤šï¼Œå¯èƒ½ä¼šåˆ†å¤šç¯‡æ–‡ç« ï¼Œå°½æƒ…æœŸå¾…ã€‚<br>åŒæ—¶ç”±äºè¦è®²çš„å†…å®¹å®åœ¨æ˜¯å¤ªå¤šï¼Œæ‰€ä»¥æœ¬æ–‡æ›´å¤šçš„åªæ˜¯èµ·åˆ°â€æŠ›ç –â€œçš„ä½œç”¨ï¼Œæ›´å¤šçš„è¯¦ç»†çš„å†…å®¹è¿˜éœ€è¦è€é“ä»¬è‡ªå·±å†æ·±å±‚æ¬¡çš„å»å­¦ä¹ ã€‚</p>\n<h1 id=\"ç¼“å­˜ç©¿é€\"><a href=\"#ç¼“å­˜ç©¿é€\" class=\"headerlink\" title=\"ç¼“å­˜ç©¿é€\"></a>ç¼“å­˜ç©¿é€</h1><p>ç¼“å­˜ç©¿é€æŒ‡çš„æ˜¯æ¶æ„è¯·æ±‚æˆ–è€…å¤§é‡ä¸å­˜åœ¨çš„ key å¯¼è‡´ç¼“å­˜æ— æ³•å‘½ä¸­ï¼Œä»è€Œç»•è¿‡ç¼“å­˜ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›è¿‡å¤§ï¼Œç”šè‡³å®•æœºçš„æƒ…å†µã€‚</p>\n<p><img src=\"/images/redis-interview/cache-penetration.png\" alt=\"ç¼“å­˜ç©¿é€\"></p>\n<h2 id=\"ç¼“å­˜ç©¿é€çš„åŸå› \"><a href=\"#ç¼“å­˜ç©¿é€çš„åŸå› \" class=\"headerlink\" title=\"ç¼“å­˜ç©¿é€çš„åŸå› \"></a>ç¼“å­˜ç©¿é€çš„åŸå› </h2><p>ç¼“å­˜ç©¿é€é€šå¸¸å‘ç”Ÿåœ¨ä»¥ä¸‹æƒ…å†µä¸‹ï¼š</p>\n<ol>\n<li>æ¶æ„è¯·æ±‚ï¼šæ”»å‡»è€…å‘é€å¤§é‡ä¸å­˜åœ¨äºç¼“å­˜ä¸­çš„ keyï¼Œå¯¼è‡´ç¼“å­˜æ— æ³•å‘½ä¸­ï¼Œç›´æ¥è®¿é—®æ•°æ®åº“ã€‚</li>\n<li>å¤§é‡å¹¶å‘æŸ¥è¯¢ï¼šå½“å¹¶å‘æŸ¥è¯¢é‡å¾ˆå¤§æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°å¤§é‡ä¸å­˜åœ¨äºç¼“å­˜ä¸­çš„ keyï¼Œä»è€Œå¯¼è‡´ç¼“å­˜ç©¿é€ã€‚</li>\n</ol>\n<h2 id=\"ç¼“å­˜ç©¿é€çš„å½±å“\"><a href=\"#ç¼“å­˜ç©¿é€çš„å½±å“\" class=\"headerlink\" title=\"ç¼“å­˜ç©¿é€çš„å½±å“\"></a>ç¼“å­˜ç©¿é€çš„å½±å“</h2><ul>\n<li>æ•°æ®åº“å‹åŠ›è¿‡å¤§ï¼šå¤§é‡æ— æ•ˆè¯·æ±‚ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›è¿‡å¤§ï¼Œç”šè‡³å¯¼è‡´æ•°æ®åº“å®•æœºã€‚</li>\n<li>ç³»ç»Ÿæ€§èƒ½ä¸‹é™ï¼šæ•°æ®åº“å‹åŠ›å¢å¤§ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå“åº”å˜æ…¢ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚</li>\n</ul>\n<h2 id=\"ç¼“å­˜ç©¿é€çš„è§£å†³æ–¹æ³•\"><a href=\"#ç¼“å­˜ç©¿é€çš„è§£å†³æ–¹æ³•\" class=\"headerlink\" title=\"ç¼“å­˜ç©¿é€çš„è§£å†³æ–¹æ³•\"></a>ç¼“å­˜ç©¿é€çš„è§£å†³æ–¹æ³•</h2><ol>\n<li>ç©ºå¯¹è±¡ç¼“å­˜ï¼šå½“æŸ¥è¯¢ç»“æœä¸ºç©ºæ—¶ï¼Œä¹Ÿå°†è¯¥ç©ºç»“æœç¼“å­˜èµ·æ¥ï¼Œä½†è®¾ç½®ä¸€ä¸ªè¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢æ”»å‡»è€…åˆ©ç”¨ç¼“å­˜ç©¿é€é—®é¢˜ã€‚</li>\n<li>å¸ƒéš†è¿‡æ»¤å™¨ï¼šåœ¨ç¼“å­˜å±‚ä¹‹å‰å¢åŠ å¸ƒéš†è¿‡æ»¤å™¨ï¼Œç”¨äºå¿«é€Ÿè¿‡æ»¤æ‰ä¸å­˜åœ¨äºç¼“å­˜ä¸­çš„ keyï¼Œä»è€Œé¿å…ç¼“å­˜ç©¿é€ã€‚</li>\n<li>çƒ­ç‚¹æ•°æ®é¢„çƒ­ï¼šå°†çƒ­ç‚¹æ•°æ®æå‰åŠ è½½åˆ°ç¼“å­˜ä¸­ï¼Œæé«˜å‘½ä¸­ç‡ï¼Œå‡å°‘ç¼“å­˜ç©¿é€çš„å‘ç”Ÿã€‚</li>\n<li>é™æµæ§åˆ¶ï¼šå¯¹äºé¢‘ç¹æŸ¥è¯¢çš„æ¥å£ï¼Œå¯ä»¥è¿›è¡Œé™æµæ§åˆ¶ï¼Œé˜²æ­¢æ”»å‡»è€…å‘èµ·å¤§é‡æ— æ•ˆè¯·æ±‚ã€‚</li>\n<li>ä½¿ç”¨ç¼“å­˜é”ï¼šåœ¨æŸ¥è¯¢æ•°æ®åº“æ—¶ï¼Œä½¿ç”¨ç¼“å­˜é”è¿›è¡Œä¸²è¡ŒåŒ–å¤„ç†ï¼Œé˜²æ­¢å¤§é‡å¹¶å‘æŸ¥è¯¢å¯¼è‡´ç¼“å­˜ç©¿é€ã€‚</li>\n</ol>\n<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ C# ç©ºå¯¹è±¡ç¼“å­˜çš„ç¤ºä¾‹ä»£ç ï¼š</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">UserBll</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">readonly</span> <span class=\"built_in\">int</span> CACHE_NULL_TTL = <span class=\"number\">10</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">readonly</span> <span class=\"built_in\">int</span> CACHE_TTL = <span class=\"number\">20</span>;</span><br><span class=\"line\">    <span class=\"comment\">/** </span></span><br><span class=\"line\"><span class=\"comment\">     * ç¼“å­˜ç©¿é€* </span></span><br><span class=\"line\"><span class=\"comment\">     * @param id </span></span><br><span class=\"line\"><span class=\"comment\">     * @ return </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> WebUserInfo <span class=\"title\">QueryUser</span>(<span class=\"params\"><span class=\"built_in\">string</span> key</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> redis = Redis.GetDatabase(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 1.ä»redisä¸­æŸ¥è¯¢storeç¼“å­˜</span></span><br><span class=\"line\">        String <span class=\"keyword\">value</span> = redis.StringGet(key);</span><br><span class=\"line\">        WebUserInfo user = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>( <span class=\"keyword\">value</span>.HasValue() ) &#123;</span><br><span class=\"line\">            user = <span class=\"keyword\">value</span>.FromJson&lt;WebUserInfo&gt;();</span><br><span class=\"line\">            <span class=\"comment\">// 3.å­˜åœ¨ï¼Œç›´æ¥è¿”å›</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> user;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// åˆ¤æ–­å‘½ä¸­æ˜¯å¦ä¸ºç©ºå€¼</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> ( <span class=\"keyword\">value</span> == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// è¿”å›é”™è¯¯ä¿¡æ¯</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 4.ä¸å­˜åœ¨ï¼Œæ ¹æ®idæŸ¥è¯¢æ•°æ®åº“</span></span><br><span class=\"line\">        user = DatabaseQuery(key);</span><br><span class=\"line\">        <span class=\"comment\">// 5. ä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>( user == <span class=\"literal\">null</span> ) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å‘rediså†™å…¥ç©ºå€¼ï¼ˆç¼“å­˜ç©¿é€ï¼‰</span></span><br><span class=\"line\">            redis.StringSet(key, <span class=\"string\">&quot;&quot;</span>, <span class=\"keyword\">new</span> TimeSpan(<span class=\"number\">0</span>, CACHE_NULL_TTL, <span class=\"number\">0</span>));</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 6.å­˜åœ¨ï¼Œå†™å…¥redis</span></span><br><span class=\"line\">        redis.StringSet(key, user.ToJson(), <span class=\"keyword\">new</span> TimeSpan(<span class=\"number\">0</span>, CACHE_TTL, <span class=\"number\">0</span>));</span><br><span class=\"line\">        <span class=\"comment\">// 7. è¿”å›</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> user;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> WebUserInfo <span class=\"title\">DatabaseQuery</span>(<span class=\"params\"><span class=\"built_in\">string</span> key</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"comment\">// æ¨¡æ‹Ÿä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®</span></span><br><span class=\"line\">        <span class=\"comment\">// å®é™…æƒ…å†µä¸‹ï¼Œè¿™é‡Œå¯ä»¥æ˜¯è®¿é—®æ•°æ®åº“ã€è°ƒç”¨å¤–éƒ¨ API ç­‰æ“ä½œ</span></span><br><span class=\"line\">        <span class=\"comment\">// è¿™é‡Œç®€åŒ–ä¸ºè¿”å› null</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title\">Program</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">Main</span>(<span class=\"params\"><span class=\"built_in\">string</span>[] args</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        UserBll cache = <span class=\"keyword\">new</span> UserBll();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼Œç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼Œä½†æ˜¯æŸ¥è¯¢ç»“æœä¸ºç©º</span></span><br><span class=\"line\">        <span class=\"built_in\">string</span> result1 = cache.QueryUser(<span class=\"string\">&quot;key1&quot;</span>);</span><br><span class=\"line\">        Console.WriteLine(<span class=\"string\">&quot;Result 1: &quot;</span> + result1); <span class=\"comment\">// Output: Result 1: (null)</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼Œç¼“å­˜ä¸­å·²å­˜åœ¨ç©ºå¯¹è±¡ç¼“å­˜ï¼Œç›´æ¥è¿”å›ç©ºå€¼</span></span><br><span class=\"line\">        <span class=\"built_in\">string</span> result2 = cache.QueryUser(<span class=\"string\">&quot;key1&quot;</span>);</span><br><span class=\"line\">        Console.WriteLine(<span class=\"string\">&quot;Result 2: &quot;</span> + result2); <span class=\"comment\">// Output: Result 2: (null)</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// ç¬¬ä¸‰æ¬¡æŸ¥è¯¢ï¼Œæ¨¡æ‹Ÿæ•°æ®åº“ä¸­å­˜åœ¨å¯¹åº”å€¼çš„æƒ…å†µ</span></span><br><span class=\"line\">        <span class=\"built_in\">string</span> result3 = cache.QueryUser(<span class=\"string\">&quot;key2&quot;</span>);</span><br><span class=\"line\">        Console.WriteLine(<span class=\"string\">&quot;Result 3: &quot;</span> + result3); <span class=\"comment\">// Output: Result 3: &lt;value from database&gt;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>ä¸Šè¿°ä»£ç ä¸­ï¼Œå½“ç”¨æˆ·è¯·æ±‚ä¸€ä¸ªkeyæ—¶ï¼Œrediså’Œæ•°æ®åº“éƒ½ä¸å­˜åœ¨ã€‚æˆ‘ä»¬ç›´æ¥å°†keyå¯¹åº”çš„nullå€¼ç¼“å­˜åˆ°redisä¸­ï¼Œè¿™æ ·ä¸‹æ¬¡ç”¨æˆ·é‡å¤è¯·æ±‚è¿™ä¸ªkeyçš„æ—¶å€™ï¼Œrediså°±å¯ä»¥å‘½ä¸­ï¼ˆhit nullï¼‰ï¼Œåªæ˜¯ä¸ä¼šè¯¢é—®æ•°æ®åº“</p>\n<ul>\n<li>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ˜“äºç»´æŠ¤</li>\n<li>ç¼ºç‚¹ï¼šé¢å¤–çš„å†…å­˜æ¶ˆè€—ï¼ˆå¯ä»¥é€šè¿‡æ·»åŠ TTLæ¥è§£å†³ï¼‰</li>\n</ul>\n<p>åŒæ—¶å¯èƒ½ä¼šé€ æˆçŸ­æš‚çš„ä¸ä¸€è‡´ï¼ˆæ§åˆ¶TTLæ—¶é—´å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£ï¼‰ã€‚å½“nullè¢«ç¼“å­˜æ—¶ï¼Œæˆ‘ä»¬åªæ˜¯åœ¨æ•°æ®åº“ä¸­è®¾ç½®å€¼ï¼Œè€Œç”¨æˆ·queryä¸ºç©ºï¼Œä½†æ•°æ®åº“ä¸­å®é™…å­˜åœ¨ï¼Œä¼šé€ æˆä¸ä¸€è‡´ï¼ˆå¯ä»¥é€šè¿‡æ’å…¥æ•°æ®æ—¶è‡ªåŠ¨è¦†ç›–ä¹‹å‰çš„ç©ºæ•°æ®æ¥è§£å†³ï¼‰</p>\n<h1 id=\"ç¼“å­˜é›ªå´©\"><a href=\"#ç¼“å­˜é›ªå´©\" class=\"headerlink\" title=\"ç¼“å­˜é›ªå´©\"></a>ç¼“å­˜é›ªå´©</h1><p>ç¼“å­˜é›ªå´©æŒ‡çš„æ˜¯åœ¨ç¼“å­˜å¤±æ•ˆçš„ç¬é—´ï¼Œå¤§é‡çš„è¯·æ±‚åŒæ—¶æ¶Œå…¥æ•°æ®åº“æˆ–å…¶ä»–æ•°æ®æºï¼Œå¯¼è‡´æ•°æ®åº“è´Ÿè½½å‰§å¢ï¼Œç”šè‡³é€ æˆæ•°æ®åº“å®•æœºçš„æƒ…å†µã€‚</p>\n<p><img src=\"/images/redis-interview/cache-avalanche.png\" alt=\"Cache Avalanche\"></p>\n<h2 id=\"ç¼“å­˜é›ªå´©çš„åŸå› \"><a href=\"#ç¼“å­˜é›ªå´©çš„åŸå› \" class=\"headerlink\" title=\"ç¼“å­˜é›ªå´©çš„åŸå› \"></a>ç¼“å­˜é›ªå´©çš„åŸå› </h2><p>ç¼“å­˜é›ªå´©é€šå¸¸æ˜¯ç”±äºç¼“å­˜ä¸­çš„å¤§é‡æ•°æ®åŒæ—¶å¤±æ•ˆè€Œå¼•èµ·çš„ã€‚å½“å¤šä¸ªç¼“å­˜é”®å…·æœ‰ç›¸åŒçš„å¤±æ•ˆæ—¶é—´ï¼Œå¹¶ä¸”è¿™äº›ç¼“å­˜é”®åˆåœ¨åŒä¸€æ—¶é—´å¤±æ•ˆæ—¶ï¼Œå°±ä¼šå¯¼è‡´å¤§é‡è¯·æ±‚ç›´æ¥å‡»ç©¿ç¼“å­˜ï¼ŒåŒæ—¶æ¶Œå…¥æ•°æ®æºï¼Œé€ æˆç¼“å­˜é›ªå´©</p>\n<h2 id=\"ç¼“å­˜é›ªå´©çš„è§£å†³æ–¹æ¡ˆ\"><a href=\"#ç¼“å­˜é›ªå´©çš„è§£å†³æ–¹æ¡ˆ\" class=\"headerlink\" title=\"ç¼“å­˜é›ªå´©çš„è§£å†³æ–¹æ¡ˆ\"></a>ç¼“å­˜é›ªå´©çš„è§£å†³æ–¹æ¡ˆ</h2><h3 id=\"1-è®¾ç½®éšæœºè¿‡æœŸæ—¶é—´\"><a href=\"#1-è®¾ç½®éšæœºè¿‡æœŸæ—¶é—´\" class=\"headerlink\" title=\"1. è®¾ç½®éšæœºè¿‡æœŸæ—¶é—´\"></a>1. è®¾ç½®éšæœºè¿‡æœŸæ—¶é—´</h3><p>é€šè¿‡ç»™ç¼“å­˜é”®è®¾ç½®éšæœºçš„è¿‡æœŸæ—¶é—´ï¼Œå¯ä»¥æœ‰æ•ˆåœ°åˆ†æ•£ç¼“å­˜å¤±æ•ˆçš„æ—¶é—´ç‚¹ï¼Œé™ä½å¤§é‡ç¼“å­˜åŒæ—¶å¤±æ•ˆçš„å¯èƒ½æ€§ï¼Œä»è€Œå‡è½»äº†ç¼“å­˜é›ªå´©çš„é£é™©ã€‚</p>\n<h3 id=\"2-ä½¿ç”¨å¤šçº§ç¼“å­˜ç­–ç•¥\"><a href=\"#2-ä½¿ç”¨å¤šçº§ç¼“å­˜ç­–ç•¥\" class=\"headerlink\" title=\"2. ä½¿ç”¨å¤šçº§ç¼“å­˜ç­–ç•¥\"></a>2. ä½¿ç”¨å¤šçº§ç¼“å­˜ç­–ç•¥</h3><p>é‡‡ç”¨å¤šçº§ç¼“å­˜æ¶æ„ï¼ŒåŒ…æ‹¬æœ¬åœ°ç¼“å­˜ã€åˆ†å¸ƒå¼ç¼“å­˜å’ŒæŒä¹…åŒ–å­˜å‚¨ï¼Œå½“ä¸»ç¼“å­˜å¤±æ•ˆæ—¶ï¼Œå¯ä»¥ä»å¤‡ç”¨ç¼“å­˜ä¸­è·å–æ•°æ®ï¼Œé™ä½å¯¹æ•°æ®åº“çš„ç›´æ¥è®¿é—®ã€‚</p>\n<h3 id=\"3-é™æµå’Œé™çº§\"><a href=\"#3-é™æµå’Œé™çº§\" class=\"headerlink\" title=\"3. é™æµå’Œé™çº§\"></a>3. é™æµå’Œé™çº§</h3><p>åœ¨ç¼“å­˜å¤±æ•ˆæœŸé—´ï¼Œå¯ä»¥å¯¹è¯·æ±‚è¿›è¡Œé™æµï¼Œé™ä½è¯·æ±‚çš„å¹¶å‘æ•°é‡ï¼Œä»è€Œå‡è½»äº†æ•°æ®åº“çš„å‹åŠ›ã€‚åŒæ—¶ï¼Œå¯ä»¥å¯¹éƒ¨åˆ†éå…³é”®è¯·æ±‚è¿›è¡Œé™çº§å¤„ç†ï¼Œæš‚æ—¶å±è”½ä¸€äº›éå¿…è¦çš„æœåŠ¡ï¼Œä¿è¯æ ¸å¿ƒæœåŠ¡çš„ç¨³å®šæ€§ã€‚</p>\n<h3 id=\"4-é¢„çƒ­ç¼“å­˜\"><a href=\"#4-é¢„çƒ­ç¼“å­˜\" class=\"headerlink\" title=\"4. é¢„çƒ­ç¼“å­˜\"></a>4. é¢„çƒ­ç¼“å­˜</h3><p>åœ¨ç³»ç»Ÿå¯åŠ¨æˆ–ä½å³°æœŸï¼Œé¢„å…ˆåŠ è½½ç¼“å­˜æ•°æ®ï¼Œæå‰å°†å¸¸ç”¨æ•°æ®ç¼“å­˜èµ·æ¥ï¼Œé¿å…åœ¨é«˜å³°æœŸé—´å¤§é‡è¯·æ±‚ç›´æ¥å‡»ç©¿ç¼“å­˜ã€‚</p>\n<h1 id=\"ç¼“å­˜å‡»ç©¿\"><a href=\"#ç¼“å­˜å‡»ç©¿\" class=\"headerlink\" title=\"ç¼“å­˜å‡»ç©¿\"></a>ç¼“å­˜å‡»ç©¿</h1><p>ç¼“å­˜å‡»ç©¿æ˜¯æŒ‡æŸä¸ªçƒ­ç‚¹keyçªç„¶å¤±æ•ˆæˆ–è€…æœªå‘½ä¸­ï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œé€ æˆæ•°æ®åº“å‹åŠ›å‰§å¢çš„ç°è±¡ã€‚è¿™ç§æƒ…å†µé€šå¸¸å‘ç”Ÿåœ¨å…·æœ‰é«˜å¹¶å‘è®¿é—®é‡çš„ç³»ç»Ÿä¸­ï¼Œç‰¹åˆ«æ˜¯åœ¨ç¼“å­˜ç³»ç»Ÿä¸­ä½¿ç”¨äº†è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´æˆ–è€…çƒ­ç‚¹æ•°æ®çš„è®¿é—®é¢‘ç‡çªç„¶å¢åŠ æ—¶ã€‚</p>\n<p><img src=\"/images/redis-interview/cache-breakdown.png\" alt=\"ç¼“å­˜å‡»ç©¿\"></p>\n<ol>\n<li>è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸï¼š å¯¹äºä¸€äº›çƒ­ç‚¹æ•°æ®ï¼Œå¯ä»¥è®¾ç½®æ°¸ä¸è¿‡æœŸï¼Œæˆ–è€…è®¾ç½®è¾ƒé•¿çš„è¿‡æœŸæ—¶é—´ï¼Œä¿è¯å…¶ä¸ä¼šåœ¨çŸ­æ—¶é—´å†…å¤±æ•ˆï¼Œä»è€Œé¿å…äº†ç¼“å­˜å‡»ç©¿çš„å‘ç”Ÿã€‚</li>\n<li>åŠ é”æœºåˆ¶ï¼š åœ¨ç¼“å­˜å¤±æ•ˆæ—¶ï¼Œå¯ä»¥é€šè¿‡åŠ é”æœºåˆ¶ç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè¿›å…¥æ•°æ®åº“æŸ¥è¯¢æ•°æ®ï¼Œå¹¶å°†æŸ¥è¯¢ç»“æœæ›´æ–°åˆ°ç¼“å­˜ä¸­ï¼Œé¿å…äº†å¤šä¸ªçº¿ç¨‹åŒæ—¶æŸ¥è¯¢æ•°æ®åº“çš„æƒ…å†µã€‚</li>\n<li>ä½¿ç”¨äº’æ–¥é”å’Œåˆ†å¸ƒå¼é”ï¼š ä½¿ç”¨äº’æ–¥é”æˆ–è€…åˆ†å¸ƒå¼é”æ¥ä¿è¯åœ¨æŸ¥è¯¢æ•°æ®åº“çš„è¿‡ç¨‹ä¸­ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿæ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼Œå…¶ä»–çº¿ç¨‹éœ€è¦ç­‰å¾…é”é‡Šæ”¾åå†è¿›è¡ŒæŸ¥è¯¢ï¼Œé¿å…äº†å¹¶å‘è®¿é—®æ•°æ®åº“çš„æƒ…å†µã€‚</li>\n<li>ä½¿ç”¨ç¼“å­˜é¢„çƒ­ï¼š åœ¨ç³»ç»Ÿå¯åŠ¨æˆ–è€…ä½å³°æœŸï¼Œå¯ä»¥é¢„å…ˆå°†çƒ­ç‚¹æ•°æ®åŠ è½½åˆ°ç¼“å­˜ä¸­ï¼Œæå‰å‡å°‘äº†ç¼“å­˜å¤±æ•ˆæ—¶çš„å¹¶å‘è¯·æ±‚é‡ï¼Œä»è€Œé¿å…äº†ç¼“å­˜å‡»ç©¿çš„å‘ç”Ÿã€‚</li>\n</ol>\n<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç”¨C#å®ç°çš„ç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨äº’æ–¥é”æ¥è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜ï¼š</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">using</span> System;</span><br><span class=\"line\"><span class=\"keyword\">using</span> System.Collections.Generic;</span><br><span class=\"line\"><span class=\"keyword\">using</span> System.Threading;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">Cache</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Dictionary&lt;<span class=\"built_in\">string</span>, <span class=\"built_in\">string</span>&gt; cache = <span class=\"keyword\">new</span> Dictionary&lt;<span class=\"built_in\">string</span>, <span class=\"built_in\">string</span>&gt;();</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Mutex mutex = <span class=\"keyword\">new</span> Mutex();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"built_in\">string</span> <span class=\"title\">Get</span>(<span class=\"params\"><span class=\"built_in\">string</span> key</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"comment\">// å…ˆå°è¯•ä»ç¼“å­˜ä¸­è·å–æ•°æ®</span></span><br><span class=\"line\">        <span class=\"built_in\">string</span> <span class=\"keyword\">value</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (cache.TryGetValue(key, <span class=\"keyword\">out</span> <span class=\"keyword\">value</span>))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">value</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// å¦‚æœç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼ŒåŠ é”æŸ¥è¯¢æ•°æ®åº“</span></span><br><span class=\"line\">        mutex.WaitOne();</span><br><span class=\"line\">        <span class=\"keyword\">try</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å†æ¬¡æ£€æŸ¥ç¼“å­˜ï¼Œé˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶æŸ¥è¯¢æ•°æ®åº“</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (cache.TryGetValue(key, <span class=\"keyword\">out</span> <span class=\"keyword\">value</span>))</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">value</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// æ¨¡æ‹Ÿä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®</span></span><br><span class=\"line\">            <span class=\"keyword\">value</span> = QueryFromDatabase(key);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// å°†æŸ¥è¯¢ç»“æœæ›´æ–°åˆ°ç¼“å­˜ä¸­</span></span><br><span class=\"line\">            cache[key] = <span class=\"keyword\">value</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">finally</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            mutex.ReleaseMutex();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">value</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"built_in\">string</span> <span class=\"title\">QueryFromDatabase</span>(<span class=\"params\"><span class=\"built_in\">string</span> key</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"comment\">// æ¨¡æ‹Ÿä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®çš„è¿‡ç¨‹</span></span><br><span class=\"line\">        Thread.Sleep(<span class=\"number\">100</span>); <span class=\"comment\">// æ¨¡æ‹Ÿè€—æ—¶æŸ¥è¯¢æ“ä½œ</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;value for &quot;</span> + key;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title\">Program</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">Main</span>(<span class=\"params\"><span class=\"built_in\">string</span>[] args</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        Cache cache = <span class=\"keyword\">new</span> Cache();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// å¹¶å‘æŸ¥è¯¢</span></span><br><span class=\"line\">        List&lt;Thread&gt; threads = <span class=\"keyword\">new</span> List&lt;Thread&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"built_in\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            Thread thread = <span class=\"keyword\">new</span> Thread(() =&gt;</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"built_in\">string</span> <span class=\"keyword\">value</span> = cache.Get(<span class=\"string\">&quot;key&quot;</span>);</span><br><span class=\"line\">                Console.WriteLine(Thread.CurrentThread.Name + <span class=\"string\">&quot;: &quot;</span> + <span class=\"keyword\">value</span>);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            thread.Name = <span class=\"string\">&quot;Thread &quot;</span> + i;</span><br><span class=\"line\">            threads.Add(thread);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (Thread thread <span class=\"keyword\">in</span> threads)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            thread.Start();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (Thread thread <span class=\"keyword\">in</span> threads)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            thread.Join();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"ç›¸å…³æ–‡ç« æ¨è\"><a href=\"#ç›¸å…³æ–‡ç« æ¨è\" class=\"headerlink\" title=\"ç›¸å…³æ–‡ç« æ¨è\"></a>ç›¸å…³æ–‡ç« æ¨è</h1><div id=\"References\"></div>\n\n<ul>\n<li><a href=\"http://redis.io/documentation\">Rediså®˜æ–¹æ–‡æ¡£</a></li>\n<li><a href=\"https://www.runoob.com/redis/redis-tutorial.html\">Redisæ•™ç¨‹</a></li>\n</ul>\n<p>ä»Šå¤©å°±ä¸æ€»ç»“äº†ï¼Œæœªå®Œå¾…ç»­ğŸ˜ªâ€¦</p>\n<p>æ›´å¤šä¸€æ‰‹è®¯æ¯ï¼Œå¯å…³æ³¨å…¬ä¼—å·ï¼š<a href=\"https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg\">ITProHub</a></p>\n<p><img src=\"https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg\" alt=\"ITProHub\"></p>\n","site":{"data":{}},"excerpt":"","more":"<p>ç›¸ä¿¡å¾ˆå¤šè€é“åœ¨æ±‚èŒè¿‡ç¨‹ä¸­éƒ½çœ‹åˆ°è¿‡ç±»ä¼¼ä¸‹é¢è¿™æ ·çš„ä»»èŒè¦æ±‚</p>\n<img src=\"/images/redis-interview/recruitment.png\" width=\"50%\">\n\n<p>ä½ ç”³è¯·çš„å²—ä½ä¸Šé¢å†™ç€â€ç†Ÿæ‚‰Redisâ€ï¼Œé‚£ä¹ˆä½ å·²ç»å‡†å¤‡å¥½å›ç­”é¢è¯•å®˜å¯èƒ½ä¼šé—®åˆ°çš„é—®é¢˜äº†ä¹ˆï¼Ÿ<br>åé¢æˆ‘å°†å¼€å¯ä¸€ä¸ªé’ˆå¯¹Redisçš„ç³»åˆ—åˆ†äº«ï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆšåˆšå¼€å§‹å­¦ä¹ Redisçš„æœ‹å‹ä»¬ã€‚</p>\n<p>åœ¨å¼€å§‹é˜…è¯»æœ¬ç¯‡æ–‡ç« ä¹‹å‰ï¼Œé»˜è®¤ä½ å·²ç»å…·å¤‡åŸºç¡€çš„RedisçŸ¥è¯†ï¼Œå¦‚æœä½ æ²¡æœ‰ï¼Œå¯ä»¥å…ˆé˜…è¯»æ–‡æœ«<a href=\"#References\">ç›¸å…³æ–‡ç« æ¨è</a></p>\n<p>å½“ä½¿ç”¨ Redis ä½œä¸ºç¼“å­˜æˆ–æ•°æ®å­˜å‚¨æ—¶ï¼Œè™½ç„¶å®ƒæä¾›äº†é«˜æ€§èƒ½å’Œçµæ´»æ€§ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸€äº›é™·é˜±éœ€è¦æ³¨æ„ã€‚ä¹‹å‰çœ‹åšå®¢çš„æ—¶å€™çœ‹åˆ°è¿‡è¿™æ ·ä¸€å¥è¯â€Experts arenâ€™t the only people who know what to do. Theyâ€™re the people who know what not to do.â€œ ä¸“å®¶å¹¶ä¸æ˜¯å”¯ä¸€çŸ¥é“å¦‚ä½•åšçš„äººï¼Œä»–ä»¬åªæ˜¯çŸ¥é“å¦‚ä½•é¿å…ä¸€äº›é™·é˜±ã€‚</p>\n<p>ä¸‹é¢è®²è¯‰çš„æ˜¯ä¸€äº›å¸¸è§çš„ Redis é™·é˜±ï¼Œæˆ–è€…è¯´å®¹æ˜“å¿½ç•¥çš„é—®é¢˜ã€‚å†…å®¹è¾ƒå¤šï¼Œå¯èƒ½ä¼šåˆ†å¤šç¯‡æ–‡ç« ï¼Œå°½æƒ…æœŸå¾…ã€‚<br>åŒæ—¶ç”±äºè¦è®²çš„å†…å®¹å®åœ¨æ˜¯å¤ªå¤šï¼Œæ‰€ä»¥æœ¬æ–‡æ›´å¤šçš„åªæ˜¯èµ·åˆ°â€æŠ›ç –â€œçš„ä½œç”¨ï¼Œæ›´å¤šçš„è¯¦ç»†çš„å†…å®¹è¿˜éœ€è¦è€é“ä»¬è‡ªå·±å†æ·±å±‚æ¬¡çš„å»å­¦ä¹ ã€‚</p>\n<h1 id=\"ç¼“å­˜ç©¿é€\"><a href=\"#ç¼“å­˜ç©¿é€\" class=\"headerlink\" title=\"ç¼“å­˜ç©¿é€\"></a>ç¼“å­˜ç©¿é€</h1><p>ç¼“å­˜ç©¿é€æŒ‡çš„æ˜¯æ¶æ„è¯·æ±‚æˆ–è€…å¤§é‡ä¸å­˜åœ¨çš„ key å¯¼è‡´ç¼“å­˜æ— æ³•å‘½ä¸­ï¼Œä»è€Œç»•è¿‡ç¼“å­˜ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›è¿‡å¤§ï¼Œç”šè‡³å®•æœºçš„æƒ…å†µã€‚</p>\n<p><img src=\"/images/redis-interview/cache-penetration.png\" alt=\"ç¼“å­˜ç©¿é€\"></p>\n<h2 id=\"ç¼“å­˜ç©¿é€çš„åŸå› \"><a href=\"#ç¼“å­˜ç©¿é€çš„åŸå› \" class=\"headerlink\" title=\"ç¼“å­˜ç©¿é€çš„åŸå› \"></a>ç¼“å­˜ç©¿é€çš„åŸå› </h2><p>ç¼“å­˜ç©¿é€é€šå¸¸å‘ç”Ÿåœ¨ä»¥ä¸‹æƒ…å†µä¸‹ï¼š</p>\n<ol>\n<li>æ¶æ„è¯·æ±‚ï¼šæ”»å‡»è€…å‘é€å¤§é‡ä¸å­˜åœ¨äºç¼“å­˜ä¸­çš„ keyï¼Œå¯¼è‡´ç¼“å­˜æ— æ³•å‘½ä¸­ï¼Œç›´æ¥è®¿é—®æ•°æ®åº“ã€‚</li>\n<li>å¤§é‡å¹¶å‘æŸ¥è¯¢ï¼šå½“å¹¶å‘æŸ¥è¯¢é‡å¾ˆå¤§æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°å¤§é‡ä¸å­˜åœ¨äºç¼“å­˜ä¸­çš„ keyï¼Œä»è€Œå¯¼è‡´ç¼“å­˜ç©¿é€ã€‚</li>\n</ol>\n<h2 id=\"ç¼“å­˜ç©¿é€çš„å½±å“\"><a href=\"#ç¼“å­˜ç©¿é€çš„å½±å“\" class=\"headerlink\" title=\"ç¼“å­˜ç©¿é€çš„å½±å“\"></a>ç¼“å­˜ç©¿é€çš„å½±å“</h2><ul>\n<li>æ•°æ®åº“å‹åŠ›è¿‡å¤§ï¼šå¤§é‡æ— æ•ˆè¯·æ±‚ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›è¿‡å¤§ï¼Œç”šè‡³å¯¼è‡´æ•°æ®åº“å®•æœºã€‚</li>\n<li>ç³»ç»Ÿæ€§èƒ½ä¸‹é™ï¼šæ•°æ®åº“å‹åŠ›å¢å¤§ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå“åº”å˜æ…¢ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚</li>\n</ul>\n<h2 id=\"ç¼“å­˜ç©¿é€çš„è§£å†³æ–¹æ³•\"><a href=\"#ç¼“å­˜ç©¿é€çš„è§£å†³æ–¹æ³•\" class=\"headerlink\" title=\"ç¼“å­˜ç©¿é€çš„è§£å†³æ–¹æ³•\"></a>ç¼“å­˜ç©¿é€çš„è§£å†³æ–¹æ³•</h2><ol>\n<li>ç©ºå¯¹è±¡ç¼“å­˜ï¼šå½“æŸ¥è¯¢ç»“æœä¸ºç©ºæ—¶ï¼Œä¹Ÿå°†è¯¥ç©ºç»“æœç¼“å­˜èµ·æ¥ï¼Œä½†è®¾ç½®ä¸€ä¸ªè¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢æ”»å‡»è€…åˆ©ç”¨ç¼“å­˜ç©¿é€é—®é¢˜ã€‚</li>\n<li>å¸ƒéš†è¿‡æ»¤å™¨ï¼šåœ¨ç¼“å­˜å±‚ä¹‹å‰å¢åŠ å¸ƒéš†è¿‡æ»¤å™¨ï¼Œç”¨äºå¿«é€Ÿè¿‡æ»¤æ‰ä¸å­˜åœ¨äºç¼“å­˜ä¸­çš„ keyï¼Œä»è€Œé¿å…ç¼“å­˜ç©¿é€ã€‚</li>\n<li>çƒ­ç‚¹æ•°æ®é¢„çƒ­ï¼šå°†çƒ­ç‚¹æ•°æ®æå‰åŠ è½½åˆ°ç¼“å­˜ä¸­ï¼Œæé«˜å‘½ä¸­ç‡ï¼Œå‡å°‘ç¼“å­˜ç©¿é€çš„å‘ç”Ÿã€‚</li>\n<li>é™æµæ§åˆ¶ï¼šå¯¹äºé¢‘ç¹æŸ¥è¯¢çš„æ¥å£ï¼Œå¯ä»¥è¿›è¡Œé™æµæ§åˆ¶ï¼Œé˜²æ­¢æ”»å‡»è€…å‘èµ·å¤§é‡æ— æ•ˆè¯·æ±‚ã€‚</li>\n<li>ä½¿ç”¨ç¼“å­˜é”ï¼šåœ¨æŸ¥è¯¢æ•°æ®åº“æ—¶ï¼Œä½¿ç”¨ç¼“å­˜é”è¿›è¡Œä¸²è¡ŒåŒ–å¤„ç†ï¼Œé˜²æ­¢å¤§é‡å¹¶å‘æŸ¥è¯¢å¯¼è‡´ç¼“å­˜ç©¿é€ã€‚</li>\n</ol>\n<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ C# ç©ºå¯¹è±¡ç¼“å­˜çš„ç¤ºä¾‹ä»£ç ï¼š</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">UserBll</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">readonly</span> <span class=\"built_in\">int</span> CACHE_NULL_TTL = <span class=\"number\">10</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">readonly</span> <span class=\"built_in\">int</span> CACHE_TTL = <span class=\"number\">20</span>;</span><br><span class=\"line\">    <span class=\"comment\">/** </span></span><br><span class=\"line\"><span class=\"comment\">     * ç¼“å­˜ç©¿é€* </span></span><br><span class=\"line\"><span class=\"comment\">     * @param id </span></span><br><span class=\"line\"><span class=\"comment\">     * @ return </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> WebUserInfo <span class=\"title\">QueryUser</span>(<span class=\"params\"><span class=\"built_in\">string</span> key</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> redis = Redis.GetDatabase(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 1.ä»redisä¸­æŸ¥è¯¢storeç¼“å­˜</span></span><br><span class=\"line\">        String <span class=\"keyword\">value</span> = redis.StringGet(key);</span><br><span class=\"line\">        WebUserInfo user = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>( <span class=\"keyword\">value</span>.HasValue() ) &#123;</span><br><span class=\"line\">            user = <span class=\"keyword\">value</span>.FromJson&lt;WebUserInfo&gt;();</span><br><span class=\"line\">            <span class=\"comment\">// 3.å­˜åœ¨ï¼Œç›´æ¥è¿”å›</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> user;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// åˆ¤æ–­å‘½ä¸­æ˜¯å¦ä¸ºç©ºå€¼</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> ( <span class=\"keyword\">value</span> == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// è¿”å›é”™è¯¯ä¿¡æ¯</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 4.ä¸å­˜åœ¨ï¼Œæ ¹æ®idæŸ¥è¯¢æ•°æ®åº“</span></span><br><span class=\"line\">        user = DatabaseQuery(key);</span><br><span class=\"line\">        <span class=\"comment\">// 5. ä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>( user == <span class=\"literal\">null</span> ) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å‘rediså†™å…¥ç©ºå€¼ï¼ˆç¼“å­˜ç©¿é€ï¼‰</span></span><br><span class=\"line\">            redis.StringSet(key, <span class=\"string\">&quot;&quot;</span>, <span class=\"keyword\">new</span> TimeSpan(<span class=\"number\">0</span>, CACHE_NULL_TTL, <span class=\"number\">0</span>));</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 6.å­˜åœ¨ï¼Œå†™å…¥redis</span></span><br><span class=\"line\">        redis.StringSet(key, user.ToJson(), <span class=\"keyword\">new</span> TimeSpan(<span class=\"number\">0</span>, CACHE_TTL, <span class=\"number\">0</span>));</span><br><span class=\"line\">        <span class=\"comment\">// 7. è¿”å›</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> user;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> WebUserInfo <span class=\"title\">DatabaseQuery</span>(<span class=\"params\"><span class=\"built_in\">string</span> key</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"comment\">// æ¨¡æ‹Ÿä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®</span></span><br><span class=\"line\">        <span class=\"comment\">// å®é™…æƒ…å†µä¸‹ï¼Œè¿™é‡Œå¯ä»¥æ˜¯è®¿é—®æ•°æ®åº“ã€è°ƒç”¨å¤–éƒ¨ API ç­‰æ“ä½œ</span></span><br><span class=\"line\">        <span class=\"comment\">// è¿™é‡Œç®€åŒ–ä¸ºè¿”å› null</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title\">Program</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">Main</span>(<span class=\"params\"><span class=\"built_in\">string</span>[] args</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        UserBll cache = <span class=\"keyword\">new</span> UserBll();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼Œç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼Œä½†æ˜¯æŸ¥è¯¢ç»“æœä¸ºç©º</span></span><br><span class=\"line\">        <span class=\"built_in\">string</span> result1 = cache.QueryUser(<span class=\"string\">&quot;key1&quot;</span>);</span><br><span class=\"line\">        Console.WriteLine(<span class=\"string\">&quot;Result 1: &quot;</span> + result1); <span class=\"comment\">// Output: Result 1: (null)</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼Œç¼“å­˜ä¸­å·²å­˜åœ¨ç©ºå¯¹è±¡ç¼“å­˜ï¼Œç›´æ¥è¿”å›ç©ºå€¼</span></span><br><span class=\"line\">        <span class=\"built_in\">string</span> result2 = cache.QueryUser(<span class=\"string\">&quot;key1&quot;</span>);</span><br><span class=\"line\">        Console.WriteLine(<span class=\"string\">&quot;Result 2: &quot;</span> + result2); <span class=\"comment\">// Output: Result 2: (null)</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// ç¬¬ä¸‰æ¬¡æŸ¥è¯¢ï¼Œæ¨¡æ‹Ÿæ•°æ®åº“ä¸­å­˜åœ¨å¯¹åº”å€¼çš„æƒ…å†µ</span></span><br><span class=\"line\">        <span class=\"built_in\">string</span> result3 = cache.QueryUser(<span class=\"string\">&quot;key2&quot;</span>);</span><br><span class=\"line\">        Console.WriteLine(<span class=\"string\">&quot;Result 3: &quot;</span> + result3); <span class=\"comment\">// Output: Result 3: &lt;value from database&gt;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>ä¸Šè¿°ä»£ç ä¸­ï¼Œå½“ç”¨æˆ·è¯·æ±‚ä¸€ä¸ªkeyæ—¶ï¼Œrediså’Œæ•°æ®åº“éƒ½ä¸å­˜åœ¨ã€‚æˆ‘ä»¬ç›´æ¥å°†keyå¯¹åº”çš„nullå€¼ç¼“å­˜åˆ°redisä¸­ï¼Œè¿™æ ·ä¸‹æ¬¡ç”¨æˆ·é‡å¤è¯·æ±‚è¿™ä¸ªkeyçš„æ—¶å€™ï¼Œrediså°±å¯ä»¥å‘½ä¸­ï¼ˆhit nullï¼‰ï¼Œåªæ˜¯ä¸ä¼šè¯¢é—®æ•°æ®åº“</p>\n<ul>\n<li>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ˜“äºç»´æŠ¤</li>\n<li>ç¼ºç‚¹ï¼šé¢å¤–çš„å†…å­˜æ¶ˆè€—ï¼ˆå¯ä»¥é€šè¿‡æ·»åŠ TTLæ¥è§£å†³ï¼‰</li>\n</ul>\n<p>åŒæ—¶å¯èƒ½ä¼šé€ æˆçŸ­æš‚çš„ä¸ä¸€è‡´ï¼ˆæ§åˆ¶TTLæ—¶é—´å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£ï¼‰ã€‚å½“nullè¢«ç¼“å­˜æ—¶ï¼Œæˆ‘ä»¬åªæ˜¯åœ¨æ•°æ®åº“ä¸­è®¾ç½®å€¼ï¼Œè€Œç”¨æˆ·queryä¸ºç©ºï¼Œä½†æ•°æ®åº“ä¸­å®é™…å­˜åœ¨ï¼Œä¼šé€ æˆä¸ä¸€è‡´ï¼ˆå¯ä»¥é€šè¿‡æ’å…¥æ•°æ®æ—¶è‡ªåŠ¨è¦†ç›–ä¹‹å‰çš„ç©ºæ•°æ®æ¥è§£å†³ï¼‰</p>\n<h1 id=\"ç¼“å­˜é›ªå´©\"><a href=\"#ç¼“å­˜é›ªå´©\" class=\"headerlink\" title=\"ç¼“å­˜é›ªå´©\"></a>ç¼“å­˜é›ªå´©</h1><p>ç¼“å­˜é›ªå´©æŒ‡çš„æ˜¯åœ¨ç¼“å­˜å¤±æ•ˆçš„ç¬é—´ï¼Œå¤§é‡çš„è¯·æ±‚åŒæ—¶æ¶Œå…¥æ•°æ®åº“æˆ–å…¶ä»–æ•°æ®æºï¼Œå¯¼è‡´æ•°æ®åº“è´Ÿè½½å‰§å¢ï¼Œç”šè‡³é€ æˆæ•°æ®åº“å®•æœºçš„æƒ…å†µã€‚</p>\n<p><img src=\"/images/redis-interview/cache-avalanche.png\" alt=\"Cache Avalanche\"></p>\n<h2 id=\"ç¼“å­˜é›ªå´©çš„åŸå› \"><a href=\"#ç¼“å­˜é›ªå´©çš„åŸå› \" class=\"headerlink\" title=\"ç¼“å­˜é›ªå´©çš„åŸå› \"></a>ç¼“å­˜é›ªå´©çš„åŸå› </h2><p>ç¼“å­˜é›ªå´©é€šå¸¸æ˜¯ç”±äºç¼“å­˜ä¸­çš„å¤§é‡æ•°æ®åŒæ—¶å¤±æ•ˆè€Œå¼•èµ·çš„ã€‚å½“å¤šä¸ªç¼“å­˜é”®å…·æœ‰ç›¸åŒçš„å¤±æ•ˆæ—¶é—´ï¼Œå¹¶ä¸”è¿™äº›ç¼“å­˜é”®åˆåœ¨åŒä¸€æ—¶é—´å¤±æ•ˆæ—¶ï¼Œå°±ä¼šå¯¼è‡´å¤§é‡è¯·æ±‚ç›´æ¥å‡»ç©¿ç¼“å­˜ï¼ŒåŒæ—¶æ¶Œå…¥æ•°æ®æºï¼Œé€ æˆç¼“å­˜é›ªå´©</p>\n<h2 id=\"ç¼“å­˜é›ªå´©çš„è§£å†³æ–¹æ¡ˆ\"><a href=\"#ç¼“å­˜é›ªå´©çš„è§£å†³æ–¹æ¡ˆ\" class=\"headerlink\" title=\"ç¼“å­˜é›ªå´©çš„è§£å†³æ–¹æ¡ˆ\"></a>ç¼“å­˜é›ªå´©çš„è§£å†³æ–¹æ¡ˆ</h2><h3 id=\"1-è®¾ç½®éšæœºè¿‡æœŸæ—¶é—´\"><a href=\"#1-è®¾ç½®éšæœºè¿‡æœŸæ—¶é—´\" class=\"headerlink\" title=\"1. è®¾ç½®éšæœºè¿‡æœŸæ—¶é—´\"></a>1. è®¾ç½®éšæœºè¿‡æœŸæ—¶é—´</h3><p>é€šè¿‡ç»™ç¼“å­˜é”®è®¾ç½®éšæœºçš„è¿‡æœŸæ—¶é—´ï¼Œå¯ä»¥æœ‰æ•ˆåœ°åˆ†æ•£ç¼“å­˜å¤±æ•ˆçš„æ—¶é—´ç‚¹ï¼Œé™ä½å¤§é‡ç¼“å­˜åŒæ—¶å¤±æ•ˆçš„å¯èƒ½æ€§ï¼Œä»è€Œå‡è½»äº†ç¼“å­˜é›ªå´©çš„é£é™©ã€‚</p>\n<h3 id=\"2-ä½¿ç”¨å¤šçº§ç¼“å­˜ç­–ç•¥\"><a href=\"#2-ä½¿ç”¨å¤šçº§ç¼“å­˜ç­–ç•¥\" class=\"headerlink\" title=\"2. ä½¿ç”¨å¤šçº§ç¼“å­˜ç­–ç•¥\"></a>2. ä½¿ç”¨å¤šçº§ç¼“å­˜ç­–ç•¥</h3><p>é‡‡ç”¨å¤šçº§ç¼“å­˜æ¶æ„ï¼ŒåŒ…æ‹¬æœ¬åœ°ç¼“å­˜ã€åˆ†å¸ƒå¼ç¼“å­˜å’ŒæŒä¹…åŒ–å­˜å‚¨ï¼Œå½“ä¸»ç¼“å­˜å¤±æ•ˆæ—¶ï¼Œå¯ä»¥ä»å¤‡ç”¨ç¼“å­˜ä¸­è·å–æ•°æ®ï¼Œé™ä½å¯¹æ•°æ®åº“çš„ç›´æ¥è®¿é—®ã€‚</p>\n<h3 id=\"3-é™æµå’Œé™çº§\"><a href=\"#3-é™æµå’Œé™çº§\" class=\"headerlink\" title=\"3. é™æµå’Œé™çº§\"></a>3. é™æµå’Œé™çº§</h3><p>åœ¨ç¼“å­˜å¤±æ•ˆæœŸé—´ï¼Œå¯ä»¥å¯¹è¯·æ±‚è¿›è¡Œé™æµï¼Œé™ä½è¯·æ±‚çš„å¹¶å‘æ•°é‡ï¼Œä»è€Œå‡è½»äº†æ•°æ®åº“çš„å‹åŠ›ã€‚åŒæ—¶ï¼Œå¯ä»¥å¯¹éƒ¨åˆ†éå…³é”®è¯·æ±‚è¿›è¡Œé™çº§å¤„ç†ï¼Œæš‚æ—¶å±è”½ä¸€äº›éå¿…è¦çš„æœåŠ¡ï¼Œä¿è¯æ ¸å¿ƒæœåŠ¡çš„ç¨³å®šæ€§ã€‚</p>\n<h3 id=\"4-é¢„çƒ­ç¼“å­˜\"><a href=\"#4-é¢„çƒ­ç¼“å­˜\" class=\"headerlink\" title=\"4. é¢„çƒ­ç¼“å­˜\"></a>4. é¢„çƒ­ç¼“å­˜</h3><p>åœ¨ç³»ç»Ÿå¯åŠ¨æˆ–ä½å³°æœŸï¼Œé¢„å…ˆåŠ è½½ç¼“å­˜æ•°æ®ï¼Œæå‰å°†å¸¸ç”¨æ•°æ®ç¼“å­˜èµ·æ¥ï¼Œé¿å…åœ¨é«˜å³°æœŸé—´å¤§é‡è¯·æ±‚ç›´æ¥å‡»ç©¿ç¼“å­˜ã€‚</p>\n<h1 id=\"ç¼“å­˜å‡»ç©¿\"><a href=\"#ç¼“å­˜å‡»ç©¿\" class=\"headerlink\" title=\"ç¼“å­˜å‡»ç©¿\"></a>ç¼“å­˜å‡»ç©¿</h1><p>ç¼“å­˜å‡»ç©¿æ˜¯æŒ‡æŸä¸ªçƒ­ç‚¹keyçªç„¶å¤±æ•ˆæˆ–è€…æœªå‘½ä¸­ï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œé€ æˆæ•°æ®åº“å‹åŠ›å‰§å¢çš„ç°è±¡ã€‚è¿™ç§æƒ…å†µé€šå¸¸å‘ç”Ÿåœ¨å…·æœ‰é«˜å¹¶å‘è®¿é—®é‡çš„ç³»ç»Ÿä¸­ï¼Œç‰¹åˆ«æ˜¯åœ¨ç¼“å­˜ç³»ç»Ÿä¸­ä½¿ç”¨äº†è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´æˆ–è€…çƒ­ç‚¹æ•°æ®çš„è®¿é—®é¢‘ç‡çªç„¶å¢åŠ æ—¶ã€‚</p>\n<p><img src=\"/images/redis-interview/cache-breakdown.png\" alt=\"ç¼“å­˜å‡»ç©¿\"></p>\n<ol>\n<li>è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸï¼š å¯¹äºä¸€äº›çƒ­ç‚¹æ•°æ®ï¼Œå¯ä»¥è®¾ç½®æ°¸ä¸è¿‡æœŸï¼Œæˆ–è€…è®¾ç½®è¾ƒé•¿çš„è¿‡æœŸæ—¶é—´ï¼Œä¿è¯å…¶ä¸ä¼šåœ¨çŸ­æ—¶é—´å†…å¤±æ•ˆï¼Œä»è€Œé¿å…äº†ç¼“å­˜å‡»ç©¿çš„å‘ç”Ÿã€‚</li>\n<li>åŠ é”æœºåˆ¶ï¼š åœ¨ç¼“å­˜å¤±æ•ˆæ—¶ï¼Œå¯ä»¥é€šè¿‡åŠ é”æœºåˆ¶ç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè¿›å…¥æ•°æ®åº“æŸ¥è¯¢æ•°æ®ï¼Œå¹¶å°†æŸ¥è¯¢ç»“æœæ›´æ–°åˆ°ç¼“å­˜ä¸­ï¼Œé¿å…äº†å¤šä¸ªçº¿ç¨‹åŒæ—¶æŸ¥è¯¢æ•°æ®åº“çš„æƒ…å†µã€‚</li>\n<li>ä½¿ç”¨äº’æ–¥é”å’Œåˆ†å¸ƒå¼é”ï¼š ä½¿ç”¨äº’æ–¥é”æˆ–è€…åˆ†å¸ƒå¼é”æ¥ä¿è¯åœ¨æŸ¥è¯¢æ•°æ®åº“çš„è¿‡ç¨‹ä¸­ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿæ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼Œå…¶ä»–çº¿ç¨‹éœ€è¦ç­‰å¾…é”é‡Šæ”¾åå†è¿›è¡ŒæŸ¥è¯¢ï¼Œé¿å…äº†å¹¶å‘è®¿é—®æ•°æ®åº“çš„æƒ…å†µã€‚</li>\n<li>ä½¿ç”¨ç¼“å­˜é¢„çƒ­ï¼š åœ¨ç³»ç»Ÿå¯åŠ¨æˆ–è€…ä½å³°æœŸï¼Œå¯ä»¥é¢„å…ˆå°†çƒ­ç‚¹æ•°æ®åŠ è½½åˆ°ç¼“å­˜ä¸­ï¼Œæå‰å‡å°‘äº†ç¼“å­˜å¤±æ•ˆæ—¶çš„å¹¶å‘è¯·æ±‚é‡ï¼Œä»è€Œé¿å…äº†ç¼“å­˜å‡»ç©¿çš„å‘ç”Ÿã€‚</li>\n</ol>\n<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç”¨C#å®ç°çš„ç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨äº’æ–¥é”æ¥è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜ï¼š</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">using</span> System;</span><br><span class=\"line\"><span class=\"keyword\">using</span> System.Collections.Generic;</span><br><span class=\"line\"><span class=\"keyword\">using</span> System.Threading;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">Cache</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Dictionary&lt;<span class=\"built_in\">string</span>, <span class=\"built_in\">string</span>&gt; cache = <span class=\"keyword\">new</span> Dictionary&lt;<span class=\"built_in\">string</span>, <span class=\"built_in\">string</span>&gt;();</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Mutex mutex = <span class=\"keyword\">new</span> Mutex();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"built_in\">string</span> <span class=\"title\">Get</span>(<span class=\"params\"><span class=\"built_in\">string</span> key</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"comment\">// å…ˆå°è¯•ä»ç¼“å­˜ä¸­è·å–æ•°æ®</span></span><br><span class=\"line\">        <span class=\"built_in\">string</span> <span class=\"keyword\">value</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (cache.TryGetValue(key, <span class=\"keyword\">out</span> <span class=\"keyword\">value</span>))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">value</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// å¦‚æœç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼ŒåŠ é”æŸ¥è¯¢æ•°æ®åº“</span></span><br><span class=\"line\">        mutex.WaitOne();</span><br><span class=\"line\">        <span class=\"keyword\">try</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å†æ¬¡æ£€æŸ¥ç¼“å­˜ï¼Œé˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶æŸ¥è¯¢æ•°æ®åº“</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (cache.TryGetValue(key, <span class=\"keyword\">out</span> <span class=\"keyword\">value</span>))</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">value</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// æ¨¡æ‹Ÿä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®</span></span><br><span class=\"line\">            <span class=\"keyword\">value</span> = QueryFromDatabase(key);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// å°†æŸ¥è¯¢ç»“æœæ›´æ–°åˆ°ç¼“å­˜ä¸­</span></span><br><span class=\"line\">            cache[key] = <span class=\"keyword\">value</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">finally</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            mutex.ReleaseMutex();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">value</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"built_in\">string</span> <span class=\"title\">QueryFromDatabase</span>(<span class=\"params\"><span class=\"built_in\">string</span> key</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"comment\">// æ¨¡æ‹Ÿä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®çš„è¿‡ç¨‹</span></span><br><span class=\"line\">        Thread.Sleep(<span class=\"number\">100</span>); <span class=\"comment\">// æ¨¡æ‹Ÿè€—æ—¶æŸ¥è¯¢æ“ä½œ</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;value for &quot;</span> + key;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title\">Program</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">Main</span>(<span class=\"params\"><span class=\"built_in\">string</span>[] args</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        Cache cache = <span class=\"keyword\">new</span> Cache();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// å¹¶å‘æŸ¥è¯¢</span></span><br><span class=\"line\">        List&lt;Thread&gt; threads = <span class=\"keyword\">new</span> List&lt;Thread&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"built_in\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            Thread thread = <span class=\"keyword\">new</span> Thread(() =&gt;</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"built_in\">string</span> <span class=\"keyword\">value</span> = cache.Get(<span class=\"string\">&quot;key&quot;</span>);</span><br><span class=\"line\">                Console.WriteLine(Thread.CurrentThread.Name + <span class=\"string\">&quot;: &quot;</span> + <span class=\"keyword\">value</span>);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            thread.Name = <span class=\"string\">&quot;Thread &quot;</span> + i;</span><br><span class=\"line\">            threads.Add(thread);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (Thread thread <span class=\"keyword\">in</span> threads)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            thread.Start();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (Thread thread <span class=\"keyword\">in</span> threads)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            thread.Join();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"ç›¸å…³æ–‡ç« æ¨è\"><a href=\"#ç›¸å…³æ–‡ç« æ¨è\" class=\"headerlink\" title=\"ç›¸å…³æ–‡ç« æ¨è\"></a>ç›¸å…³æ–‡ç« æ¨è</h1><div id=\"References\"></div>\n\n<ul>\n<li><a href=\"http://redis.io/documentation\">Rediså®˜æ–¹æ–‡æ¡£</a></li>\n<li><a href=\"https://www.runoob.com/redis/redis-tutorial.html\">Redisæ•™ç¨‹</a></li>\n</ul>\n<p>ä»Šå¤©å°±ä¸æ€»ç»“äº†ï¼Œæœªå®Œå¾…ç»­ğŸ˜ªâ€¦</p>\n<p>æ›´å¤šä¸€æ‰‹è®¯æ¯ï¼Œå¯å…³æ³¨å…¬ä¼—å·ï¼š<a href=\"https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg\">ITProHub</a></p>\n<p><img src=\"https://myom-dev.oss-cn-hangzhou.aliyuncs.com/WechatPublicPlatformQrCode.jpg\" alt=\"ITProHub\"></p>\n"},{"title":"Dumpåˆ†æå…¥é—¨æŒ‡å—","date":"2024-04-28T06:18:14.000Z","_content":"\næƒ³è±¡ä¸€ä¸‹ï¼Œçªç„¶æœ‰ä¸€å¤©éƒ¨ç½²åœ¨æœåŠ¡å™¨ä¸Šçš„åº”ç”¨çªç„¶æŒ‚äº†ï¼æ²¡æœ‰ä¸€ç‚¹ç‚¹é˜²å¤‡ï¼Œä¹Ÿæ²¡æœ‰ä¸€ä¸é¡¾è™‘ï¼Œä½ å°±è¿™æ ·å‡ºç°ã€‚ã€‚ã€‚\næŒ‚å°±æŒ‚äº†å§ï¼ŒæœåŠ¡è¿˜æ²¡æœ‰è¾“å‡ºä»»åŠ¡çš„é”™è¯¯ä¿¡æ¯ã€‚è¿™ä¸ªæ—¶å€™æœ‰æ²¡æœ‰ä»€ä¹ˆé€”å¾„å¯ä»¥è®©æˆ‘æ‰¾åˆ°å´©æºƒçš„åŸå› å‘¢ï¼Ÿ\n\n![crash](./images/dump/crash.jpeg)\n\nåœ¨è½¯ä»¶å¼€å‘å’Œè¿ç»´è¿‡ç¨‹ä¸­ï¼ŒDump æ–‡ä»¶æ˜¯ä¸€ç§éå¸¸é‡è¦çš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®šä½å’Œè§£å†³å„ç§é—®é¢˜ï¼ŒåŒ…æ‹¬åº”ç”¨ç¨‹åºå´©æºƒã€æ€§èƒ½é—®é¢˜ã€å†…å­˜æ³„æ¼ç­‰ã€‚æœ¬æ–‡å°†ä»‹ç» Dump æ–‡ä»¶çš„åŸºæœ¬æ¦‚å¿µã€å¸¸è§ç±»å‹ä»¥åŠå¦‚ä½•è¿›è¡Œåˆ†æå’Œåˆ©ç”¨ï¼Œå¸®åŠ©è¯»è€…æ›´å¥½åœ°ç†è§£å’Œåˆ©ç”¨ Dump æ–‡ä»¶è¿›è¡Œæ•…éšœæ’æŸ¥å’Œæ€§èƒ½ä¼˜åŒ–ã€‚\n\n\n# Dump æ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ\nDump æ–‡ä»¶æ˜¯åœ¨åº”ç”¨ç¨‹åºå‘ç”Ÿå´©æºƒæˆ–å¼‚å¸¸æƒ…å†µæ—¶ç”Ÿæˆçš„ä¸€ç§å†…å­˜è½¬å‚¨æ–‡ä»¶ï¼Œè®°å½•äº†åº”ç”¨ç¨‹åºåœ¨å´©æºƒæ—¶çš„å†…å­˜çŠ¶æ€ã€çº¿ç¨‹å †æ ˆã€å˜é‡å€¼ç­‰ä¿¡æ¯ã€‚Dump æ–‡ä»¶é€šå¸¸ä»¥ .dmp æˆ– .core ç­‰æ‰©å±•åä¿å­˜ï¼Œå¯ä»¥è¢«ç”¨äºåç»­çš„æ•…éšœæ’æŸ¥å’Œåˆ†æã€‚\n\n## å¸¸è§çš„ Dump æ–‡ä»¶ç±»å‹\n+ å®Œå…¨å†…å­˜è½¬å‚¨ï¼ˆFull Memory Dumpï¼‰ï¼š å®Œå…¨å†…å­˜è½¬å‚¨è®°å½•äº†æ•´ä¸ªè¿›ç¨‹çš„å†…å­˜çŠ¶æ€ï¼ŒåŒ…æ‹¬ä»£ç ã€æ•°æ®ã€å †æ ˆã€å¯„å­˜å™¨ç­‰ä¿¡æ¯ã€‚è¿™ç§ç±»å‹çš„ Dump æ–‡ä»¶é€šå¸¸ç”¨äºåˆ†æåº”ç”¨ç¨‹åºå´©æºƒçš„æ ¹æœ¬åŸå› ã€‚\n+ è¿·ä½ å†…å­˜è½¬å‚¨ï¼ˆMini Dumpï¼‰ï¼š è¿·ä½ å†…å­˜è½¬å‚¨åªè®°å½•äº†åº”ç”¨ç¨‹åºå´©æºƒæ—¶çš„å…³é”®ä¿¡æ¯ï¼Œå¦‚çº¿ç¨‹å †æ ˆã€å¼‚å¸¸ä¿¡æ¯ç­‰ï¼Œä½“ç§¯ç›¸å¯¹è¾ƒå°ã€‚è¿™ç§ç±»å‹çš„ Dump æ–‡ä»¶é€šå¸¸ç”¨äºå¿«é€Ÿå®šä½é—®é¢˜ï¼Œä½†å¯èƒ½ä¸¢å¤±ä¸€äº›è¯¦ç»†ä¿¡æ¯ã€‚\n+ æ ¸å¿ƒè½¬å‚¨ï¼ˆCore Dumpï¼‰ï¼š æ ¸å¿ƒè½¬å‚¨æ˜¯åœ¨ Unix/Linux ç³»ç»Ÿä¸‹äº§ç”Ÿçš„ä¸€ç§å†…å­˜è½¬å‚¨æ–‡ä»¶ï¼Œè®°å½•äº†åº”ç”¨ç¨‹åºå´©æºƒæ—¶çš„å†…å­˜çŠ¶æ€ã€‚æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶é€šå¸¸ç”¨äºåˆ†æåº”ç”¨ç¨‹åºå´©æºƒçš„åŸå› å’Œå†…å­˜ä½¿ç”¨æƒ…å†µã€‚\n\n# Dump æ–‡ä»¶åˆ†æçš„åŸºæœ¬æ­¥éª¤\n1. æ”¶é›† Dump æ–‡ä»¶ï¼š é¦–å…ˆéœ€è¦æ”¶é›†åˆ°åº”ç”¨ç¨‹åºå´©æºƒæ—¶ç”Ÿæˆçš„ Dump æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡æ“ä½œç³»ç»Ÿã€ç›‘æ§å·¥å…·æˆ–è€…åº”ç”¨ç¨‹åºè‡ªèº«è®¾ç½®æ¥è·å–ã€‚\n2. é€‰æ‹©åˆé€‚çš„å·¥å…·ï¼š æ ¹æ® Dump æ–‡ä»¶çš„ç±»å‹å’Œé—®é¢˜çš„æ€§è´¨ï¼Œé€‰æ‹©åˆé€‚çš„å·¥å…·è¿›è¡Œåˆ†æã€‚å¸¸ç”¨çš„å·¥å…·åŒ…æ‹¬ WinDbgã€GDBã€Visual Studio ç­‰ã€‚\n3. åˆ†ædumpæ–‡ä»¶\n    + æŸ¥çœ‹çº¿ç¨‹å †æ ˆï¼š åˆ†æçº¿ç¨‹å †æ ˆä¿¡æ¯ï¼Œå®šä½åˆ°å¼‚å¸¸å‘ç”Ÿæ—¶çš„ä»£ç ä½ç½®ï¼Œäº†è§£ç¨‹åºçš„æ‰§è¡Œæµç¨‹å’Œè°ƒç”¨å…³ç³»ã€‚\n    + æ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µï¼š åˆ†æå†…å­˜ä½¿ç”¨æƒ…å†µï¼ŒæŸ¥æ‰¾å¯èƒ½å­˜åœ¨çš„å†…å­˜æ³„æ¼æˆ–è€…è¿‡åº¦ä½¿ç”¨å†…å­˜çš„æƒ…å†µï¼Œä¼˜åŒ–å†…å­˜ç®¡ç†å’Œèµ„æºé‡Šæ”¾ã€‚\n    + åˆ†æå¼‚å¸¸ä¿¡æ¯ï¼š æŸ¥çœ‹å¼‚å¸¸ä¿¡æ¯ï¼Œäº†è§£å¼‚å¸¸çš„ç±»å‹ã€ä½ç½®å’ŒåŸå› ï¼Œä¸ºæ•…éšœæ’æŸ¥æä¾›é‡è¦çº¿ç´¢ã€‚\n    + è¯Šæ–­æ€§èƒ½é—®é¢˜ï¼š åˆ†ææ€§èƒ½æŒ‡æ ‡å’Œæ€§èƒ½ç“¶é¢ˆï¼Œæ‰¾å‡ºå½±å“æœåŠ¡æ€§èƒ½çš„åŸå› ï¼Œè¿›è¡Œæ€§èƒ½ä¼˜åŒ–å’Œè°ƒæ•´ã€‚\n4. è¯Šæ–­å’Œè§£å†³é—®é¢˜ï¼š æ ¹æ®åˆ†æç»“æœï¼Œè¯Šæ–­å‡ºé—®é¢˜çš„æ ¹æœ¬åŸå› ï¼Œå¹¶é‡‡å–ç›¸åº”çš„æªæ–½è¿›è¡Œä¿®å¤æˆ–ä¼˜åŒ–ã€‚\n\n# Dump æ–‡ä»¶åˆ†æçš„å®æˆ˜æ¼”ç»ƒ\nä¸Šé¢è¯´äº†é‚£ä¹ˆå¤šç†è®ºï¼Œä¸‹é¢æˆ‘ä»¬æ¥å®é™…æ“ä½œä¸€ä¸‹ã€‚\n\né¦–å…ˆç®€å•ä»‹ç»ä¸€ä¸‹ä½œä¸ºç¤ºä¾‹çš„é¡¹ç›®èƒŒæ™¯ï¼Œ\n1. ç¨‹åºæ€§è´¨ï¼šåŸºäº .NET çš„ Web åº”ç”¨ç¨‹åºï¼›\n2. è¿è¡Œç¯å¢ƒï¼šè¿è¡Œåœ¨docker å®¹å™¨ä¸­ï¼›\n3. æ”¶é›†å·¥å…·ï¼šcreatedumpæ˜¯éšç€ .NET Core runtime ä¸€èµ·å‘å¸ƒçš„ä¸€ä¸ªåˆ›å»º dump çš„ä¸€ä¸ªå·¥å…·ï¼›\n3. é—®é¢˜è¡¨ç°ï¼šå†…å­˜æ³„æ¼ï¼›\n\n## æ”¶é›†dumpæ–‡ä»¶\n### è¿›å…¥å®¹å™¨\n```\ndocker exec -it wpp bash\n```\n### è¿›å…¥.netè¿è¡Œæ—¶ç›®å½•\n```\nroot@4aa6a7d51e1e:/# \nroot@4aa6a7d51e1e:/# find / -name createdump\n/usr/share/dotnet/shared/Microsoft.NETCore.App/8.0.0/createdump\nroot@4aa6a7d51e1e:/# cd /usr/share/dotnet/shared/Microsoft.NETCore.App/8.0.0           \nroot@4aa6a7d51e1e:/usr/share/dotnet/shared/Microsoft.NETCore.App/8.0.0# \n\n```\n### è¿è¡ŒcreatedumpæŠ“åŒ…\n```\ncreatedump [options] pid\n-f, --name - dump path and file name. The default is '/tmp/coredump.%p'. These specifiers are substituted with following values:\n   %p  PID of dumped process.\n   %e  The process executable filename.\n   %h  Hostname return by gethostname().\n   %t  Time of dump, expressed as seconds since the Epoch, 1970-01-01 00:00:00 +0000 (UTC).\n-n, --normal - create minidump.\n-h, --withheap - create minidump with heap (default).\n-t, --triage - create triage minidump.\n-u, --full - create full core dump.\n-d, --diag - enable diagnostic messages.\n```\ntopä¸€ä¸‹æŸ¥çœ‹è¿›ç¨‹id\n```\n PID  PPID USER     STAT   VSZ %VSZ %CPU COMMAND\n    1     0 root     S     261g7842%   0% dotnet SubscriptionAccount.dll\n11480     0 root     S     4188   0%   0% bash\n11845 11480 root     R     3268   0%   0% top\n\n```\næ‰§è¡Œå‘½ä»¤\n```\n./createdump -f /tmp/wpp_dump -u 1\n```\n> å¦‚æœæç¤ºæ²¡æœ‰æƒé™ï¼Œéœ€è¦åœ¨dockerè¿è¡Œæ—¶å¢åŠ ä¸€ä¸ªå‚æ•° --privileged=true ï¼Œä»¥ä¾¿å®¹å™¨ä»¥ç‰¹æƒæ–¹å¼è¿è¡Œã€‚\n\n### å°†dumpæ–‡ä»¶æ‹·è´å‡ºæ¥\n```\nsudo docker cp wpp:/tmp/wpp_dump /tmp/wpp_dump\n```\n## WinDbg åˆ†ædumpæ–‡ä»¶\né¡¹ç›®èƒŒæ™¯é‡Œé¢æˆ‘ä»¬ä¹Ÿè®²åˆ°äº†ï¼Œè¿™æ¬¡æˆ‘ä»¬åˆ†æçš„æ˜¯å†…å­˜æ³„æ¼çš„é—®é¢˜ã€‚æ‰€ä»¥æˆ‘ä»¬åˆ†æçš„ç¬¬ä¸€æ­¥æ˜¯æ‰¾åˆ°å“ªäº›å†…å­˜å ç”¨æ¯”è¾ƒå¤§çš„å˜é‡\n\né¦–å…ˆï¼Œæˆ‘ä»¬æ‰¾åˆ°å†…å­˜å ç”¨æœ€å¤§ç±»å‹ï¼Œè¿™é‡Œæˆ‘ä»¬å†…å­˜å ç”¨è¾ƒå¤§çš„System.Byte[]\nç„¶åç©¿é€æ‰¾åˆ°ç±»å‹å¯¹åº”çš„å˜é‡çš„å†…å­˜å ç”¨æƒ…å†µ\n![å†…å­˜å ç”¨](/images/dump/windbg_1.png)\n![å˜é‡å†…å­˜](/images/dump/windbg_2.png)\né€šè¿‡ä¸Šé¢çš„å‘½ä»¤ï¼Œæˆ‘ä»¬æ‰¾åˆ°å†…å­˜å ç”¨æœ€é«˜çš„å‡ ä¸ªå˜é‡ï¼Œç„¶åç©¿é€åˆ°å…·ä½“è¿™ä¸ªå¤§å˜é‡é‡Œé¢è£…çš„æ˜¯å•¥\n![å˜é‡å†…å®¹](/images/dump/windbg_3.png)\né€šè¿‡å˜é‡çš„å†…å®¹ï¼Œæ‰¾åˆ°å…·ä½“ä»£ç çš„ä½ç½®äº†å°±ä¸æ˜¯ä»€ä¹ˆéš¾äº‹äº†ã€‚\n![bugä½ç½®](/images/dump/windbg_4.png)\n\n\n\n# ç»“è¯­\né€šè¿‡æœ¬æ–‡çš„ä»‹ç»ï¼Œç›¸ä¿¡è¯»è€…å¯¹ Dump æ–‡ä»¶çš„åŸºæœ¬æ¦‚å¿µå’Œåˆ†ææ–¹æ³•æœ‰äº†æ›´æ·±å…¥çš„äº†è§£ã€‚Dump æ–‡ä»¶æ˜¯æ•…éšœæ’æŸ¥å’Œæ€§èƒ½ä¼˜åŒ–çš„é‡è¦å·¥å…·ï¼ŒæŒæ¡å¥½ Dump æ–‡ä»¶çš„åˆ†ææŠ€å·§èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ›´å¿«åœ°å®šä½å’Œè§£å†³å„ç§é—®é¢˜ï¼Œæé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚","source":"_posts/dump.md","raw":"---\ntitle: Dumpåˆ†æå…¥é—¨æŒ‡å—\ndate: 2024-04-28 14:18:14\ntags: dump æ€§èƒ½ å¼‚å¸¸\n---\n\næƒ³è±¡ä¸€ä¸‹ï¼Œçªç„¶æœ‰ä¸€å¤©éƒ¨ç½²åœ¨æœåŠ¡å™¨ä¸Šçš„åº”ç”¨çªç„¶æŒ‚äº†ï¼æ²¡æœ‰ä¸€ç‚¹ç‚¹é˜²å¤‡ï¼Œä¹Ÿæ²¡æœ‰ä¸€ä¸é¡¾è™‘ï¼Œä½ å°±è¿™æ ·å‡ºç°ã€‚ã€‚ã€‚\næŒ‚å°±æŒ‚äº†å§ï¼ŒæœåŠ¡è¿˜æ²¡æœ‰è¾“å‡ºä»»åŠ¡çš„é”™è¯¯ä¿¡æ¯ã€‚è¿™ä¸ªæ—¶å€™æœ‰æ²¡æœ‰ä»€ä¹ˆé€”å¾„å¯ä»¥è®©æˆ‘æ‰¾åˆ°å´©æºƒçš„åŸå› å‘¢ï¼Ÿ\n\n![crash](./images/dump/crash.jpeg)\n\nåœ¨è½¯ä»¶å¼€å‘å’Œè¿ç»´è¿‡ç¨‹ä¸­ï¼ŒDump æ–‡ä»¶æ˜¯ä¸€ç§éå¸¸é‡è¦çš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®šä½å’Œè§£å†³å„ç§é—®é¢˜ï¼ŒåŒ…æ‹¬åº”ç”¨ç¨‹åºå´©æºƒã€æ€§èƒ½é—®é¢˜ã€å†…å­˜æ³„æ¼ç­‰ã€‚æœ¬æ–‡å°†ä»‹ç» Dump æ–‡ä»¶çš„åŸºæœ¬æ¦‚å¿µã€å¸¸è§ç±»å‹ä»¥åŠå¦‚ä½•è¿›è¡Œåˆ†æå’Œåˆ©ç”¨ï¼Œå¸®åŠ©è¯»è€…æ›´å¥½åœ°ç†è§£å’Œåˆ©ç”¨ Dump æ–‡ä»¶è¿›è¡Œæ•…éšœæ’æŸ¥å’Œæ€§èƒ½ä¼˜åŒ–ã€‚\n\n\n# Dump æ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ\nDump æ–‡ä»¶æ˜¯åœ¨åº”ç”¨ç¨‹åºå‘ç”Ÿå´©æºƒæˆ–å¼‚å¸¸æƒ…å†µæ—¶ç”Ÿæˆçš„ä¸€ç§å†…å­˜è½¬å‚¨æ–‡ä»¶ï¼Œè®°å½•äº†åº”ç”¨ç¨‹åºåœ¨å´©æºƒæ—¶çš„å†…å­˜çŠ¶æ€ã€çº¿ç¨‹å †æ ˆã€å˜é‡å€¼ç­‰ä¿¡æ¯ã€‚Dump æ–‡ä»¶é€šå¸¸ä»¥ .dmp æˆ– .core ç­‰æ‰©å±•åä¿å­˜ï¼Œå¯ä»¥è¢«ç”¨äºåç»­çš„æ•…éšœæ’æŸ¥å’Œåˆ†æã€‚\n\n## å¸¸è§çš„ Dump æ–‡ä»¶ç±»å‹\n+ å®Œå…¨å†…å­˜è½¬å‚¨ï¼ˆFull Memory Dumpï¼‰ï¼š å®Œå…¨å†…å­˜è½¬å‚¨è®°å½•äº†æ•´ä¸ªè¿›ç¨‹çš„å†…å­˜çŠ¶æ€ï¼ŒåŒ…æ‹¬ä»£ç ã€æ•°æ®ã€å †æ ˆã€å¯„å­˜å™¨ç­‰ä¿¡æ¯ã€‚è¿™ç§ç±»å‹çš„ Dump æ–‡ä»¶é€šå¸¸ç”¨äºåˆ†æåº”ç”¨ç¨‹åºå´©æºƒçš„æ ¹æœ¬åŸå› ã€‚\n+ è¿·ä½ å†…å­˜è½¬å‚¨ï¼ˆMini Dumpï¼‰ï¼š è¿·ä½ å†…å­˜è½¬å‚¨åªè®°å½•äº†åº”ç”¨ç¨‹åºå´©æºƒæ—¶çš„å…³é”®ä¿¡æ¯ï¼Œå¦‚çº¿ç¨‹å †æ ˆã€å¼‚å¸¸ä¿¡æ¯ç­‰ï¼Œä½“ç§¯ç›¸å¯¹è¾ƒå°ã€‚è¿™ç§ç±»å‹çš„ Dump æ–‡ä»¶é€šå¸¸ç”¨äºå¿«é€Ÿå®šä½é—®é¢˜ï¼Œä½†å¯èƒ½ä¸¢å¤±ä¸€äº›è¯¦ç»†ä¿¡æ¯ã€‚\n+ æ ¸å¿ƒè½¬å‚¨ï¼ˆCore Dumpï¼‰ï¼š æ ¸å¿ƒè½¬å‚¨æ˜¯åœ¨ Unix/Linux ç³»ç»Ÿä¸‹äº§ç”Ÿçš„ä¸€ç§å†…å­˜è½¬å‚¨æ–‡ä»¶ï¼Œè®°å½•äº†åº”ç”¨ç¨‹åºå´©æºƒæ—¶çš„å†…å­˜çŠ¶æ€ã€‚æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶é€šå¸¸ç”¨äºåˆ†æåº”ç”¨ç¨‹åºå´©æºƒçš„åŸå› å’Œå†…å­˜ä½¿ç”¨æƒ…å†µã€‚\n\n# Dump æ–‡ä»¶åˆ†æçš„åŸºæœ¬æ­¥éª¤\n1. æ”¶é›† Dump æ–‡ä»¶ï¼š é¦–å…ˆéœ€è¦æ”¶é›†åˆ°åº”ç”¨ç¨‹åºå´©æºƒæ—¶ç”Ÿæˆçš„ Dump æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡æ“ä½œç³»ç»Ÿã€ç›‘æ§å·¥å…·æˆ–è€…åº”ç”¨ç¨‹åºè‡ªèº«è®¾ç½®æ¥è·å–ã€‚\n2. é€‰æ‹©åˆé€‚çš„å·¥å…·ï¼š æ ¹æ® Dump æ–‡ä»¶çš„ç±»å‹å’Œé—®é¢˜çš„æ€§è´¨ï¼Œé€‰æ‹©åˆé€‚çš„å·¥å…·è¿›è¡Œåˆ†æã€‚å¸¸ç”¨çš„å·¥å…·åŒ…æ‹¬ WinDbgã€GDBã€Visual Studio ç­‰ã€‚\n3. åˆ†ædumpæ–‡ä»¶\n    + æŸ¥çœ‹çº¿ç¨‹å †æ ˆï¼š åˆ†æçº¿ç¨‹å †æ ˆä¿¡æ¯ï¼Œå®šä½åˆ°å¼‚å¸¸å‘ç”Ÿæ—¶çš„ä»£ç ä½ç½®ï¼Œäº†è§£ç¨‹åºçš„æ‰§è¡Œæµç¨‹å’Œè°ƒç”¨å…³ç³»ã€‚\n    + æ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µï¼š åˆ†æå†…å­˜ä½¿ç”¨æƒ…å†µï¼ŒæŸ¥æ‰¾å¯èƒ½å­˜åœ¨çš„å†…å­˜æ³„æ¼æˆ–è€…è¿‡åº¦ä½¿ç”¨å†…å­˜çš„æƒ…å†µï¼Œä¼˜åŒ–å†…å­˜ç®¡ç†å’Œèµ„æºé‡Šæ”¾ã€‚\n    + åˆ†æå¼‚å¸¸ä¿¡æ¯ï¼š æŸ¥çœ‹å¼‚å¸¸ä¿¡æ¯ï¼Œäº†è§£å¼‚å¸¸çš„ç±»å‹ã€ä½ç½®å’ŒåŸå› ï¼Œä¸ºæ•…éšœæ’æŸ¥æä¾›é‡è¦çº¿ç´¢ã€‚\n    + è¯Šæ–­æ€§èƒ½é—®é¢˜ï¼š åˆ†ææ€§èƒ½æŒ‡æ ‡å’Œæ€§èƒ½ç“¶é¢ˆï¼Œæ‰¾å‡ºå½±å“æœåŠ¡æ€§èƒ½çš„åŸå› ï¼Œè¿›è¡Œæ€§èƒ½ä¼˜åŒ–å’Œè°ƒæ•´ã€‚\n4. è¯Šæ–­å’Œè§£å†³é—®é¢˜ï¼š æ ¹æ®åˆ†æç»“æœï¼Œè¯Šæ–­å‡ºé—®é¢˜çš„æ ¹æœ¬åŸå› ï¼Œå¹¶é‡‡å–ç›¸åº”çš„æªæ–½è¿›è¡Œä¿®å¤æˆ–ä¼˜åŒ–ã€‚\n\n# Dump æ–‡ä»¶åˆ†æçš„å®æˆ˜æ¼”ç»ƒ\nä¸Šé¢è¯´äº†é‚£ä¹ˆå¤šç†è®ºï¼Œä¸‹é¢æˆ‘ä»¬æ¥å®é™…æ“ä½œä¸€ä¸‹ã€‚\n\né¦–å…ˆç®€å•ä»‹ç»ä¸€ä¸‹ä½œä¸ºç¤ºä¾‹çš„é¡¹ç›®èƒŒæ™¯ï¼Œ\n1. ç¨‹åºæ€§è´¨ï¼šåŸºäº .NET çš„ Web åº”ç”¨ç¨‹åºï¼›\n2. è¿è¡Œç¯å¢ƒï¼šè¿è¡Œåœ¨docker å®¹å™¨ä¸­ï¼›\n3. æ”¶é›†å·¥å…·ï¼šcreatedumpæ˜¯éšç€ .NET Core runtime ä¸€èµ·å‘å¸ƒçš„ä¸€ä¸ªåˆ›å»º dump çš„ä¸€ä¸ªå·¥å…·ï¼›\n3. é—®é¢˜è¡¨ç°ï¼šå†…å­˜æ³„æ¼ï¼›\n\n## æ”¶é›†dumpæ–‡ä»¶\n### è¿›å…¥å®¹å™¨\n```\ndocker exec -it wpp bash\n```\n### è¿›å…¥.netè¿è¡Œæ—¶ç›®å½•\n```\nroot@4aa6a7d51e1e:/# \nroot@4aa6a7d51e1e:/# find / -name createdump\n/usr/share/dotnet/shared/Microsoft.NETCore.App/8.0.0/createdump\nroot@4aa6a7d51e1e:/# cd /usr/share/dotnet/shared/Microsoft.NETCore.App/8.0.0           \nroot@4aa6a7d51e1e:/usr/share/dotnet/shared/Microsoft.NETCore.App/8.0.0# \n\n```\n### è¿è¡ŒcreatedumpæŠ“åŒ…\n```\ncreatedump [options] pid\n-f, --name - dump path and file name. The default is '/tmp/coredump.%p'. These specifiers are substituted with following values:\n   %p  PID of dumped process.\n   %e  The process executable filename.\n   %h  Hostname return by gethostname().\n   %t  Time of dump, expressed as seconds since the Epoch, 1970-01-01 00:00:00 +0000 (UTC).\n-n, --normal - create minidump.\n-h, --withheap - create minidump with heap (default).\n-t, --triage - create triage minidump.\n-u, --full - create full core dump.\n-d, --diag - enable diagnostic messages.\n```\ntopä¸€ä¸‹æŸ¥çœ‹è¿›ç¨‹id\n```\n PID  PPID USER     STAT   VSZ %VSZ %CPU COMMAND\n    1     0 root     S     261g7842%   0% dotnet SubscriptionAccount.dll\n11480     0 root     S     4188   0%   0% bash\n11845 11480 root     R     3268   0%   0% top\n\n```\næ‰§è¡Œå‘½ä»¤\n```\n./createdump -f /tmp/wpp_dump -u 1\n```\n> å¦‚æœæç¤ºæ²¡æœ‰æƒé™ï¼Œéœ€è¦åœ¨dockerè¿è¡Œæ—¶å¢åŠ ä¸€ä¸ªå‚æ•° --privileged=true ï¼Œä»¥ä¾¿å®¹å™¨ä»¥ç‰¹æƒæ–¹å¼è¿è¡Œã€‚\n\n### å°†dumpæ–‡ä»¶æ‹·è´å‡ºæ¥\n```\nsudo docker cp wpp:/tmp/wpp_dump /tmp/wpp_dump\n```\n## WinDbg åˆ†ædumpæ–‡ä»¶\né¡¹ç›®èƒŒæ™¯é‡Œé¢æˆ‘ä»¬ä¹Ÿè®²åˆ°äº†ï¼Œè¿™æ¬¡æˆ‘ä»¬åˆ†æçš„æ˜¯å†…å­˜æ³„æ¼çš„é—®é¢˜ã€‚æ‰€ä»¥æˆ‘ä»¬åˆ†æçš„ç¬¬ä¸€æ­¥æ˜¯æ‰¾åˆ°å“ªäº›å†…å­˜å ç”¨æ¯”è¾ƒå¤§çš„å˜é‡\n\né¦–å…ˆï¼Œæˆ‘ä»¬æ‰¾åˆ°å†…å­˜å ç”¨æœ€å¤§ç±»å‹ï¼Œè¿™é‡Œæˆ‘ä»¬å†…å­˜å ç”¨è¾ƒå¤§çš„System.Byte[]\nç„¶åç©¿é€æ‰¾åˆ°ç±»å‹å¯¹åº”çš„å˜é‡çš„å†…å­˜å ç”¨æƒ…å†µ\n![å†…å­˜å ç”¨](/images/dump/windbg_1.png)\n![å˜é‡å†…å­˜](/images/dump/windbg_2.png)\né€šè¿‡ä¸Šé¢çš„å‘½ä»¤ï¼Œæˆ‘ä»¬æ‰¾åˆ°å†…å­˜å ç”¨æœ€é«˜çš„å‡ ä¸ªå˜é‡ï¼Œç„¶åç©¿é€åˆ°å…·ä½“è¿™ä¸ªå¤§å˜é‡é‡Œé¢è£…çš„æ˜¯å•¥\n![å˜é‡å†…å®¹](/images/dump/windbg_3.png)\né€šè¿‡å˜é‡çš„å†…å®¹ï¼Œæ‰¾åˆ°å…·ä½“ä»£ç çš„ä½ç½®äº†å°±ä¸æ˜¯ä»€ä¹ˆéš¾äº‹äº†ã€‚\n![bugä½ç½®](/images/dump/windbg_4.png)\n\n\n\n# ç»“è¯­\né€šè¿‡æœ¬æ–‡çš„ä»‹ç»ï¼Œç›¸ä¿¡è¯»è€…å¯¹ Dump æ–‡ä»¶çš„åŸºæœ¬æ¦‚å¿µå’Œåˆ†ææ–¹æ³•æœ‰äº†æ›´æ·±å…¥çš„äº†è§£ã€‚Dump æ–‡ä»¶æ˜¯æ•…éšœæ’æŸ¥å’Œæ€§èƒ½ä¼˜åŒ–çš„é‡è¦å·¥å…·ï¼ŒæŒæ¡å¥½ Dump æ–‡ä»¶çš„åˆ†ææŠ€å·§èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ›´å¿«åœ°å®šä½å’Œè§£å†³å„ç§é—®é¢˜ï¼Œæé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚","slug":"dump","published":1,"updated":"2024-05-07T08:06:26.636Z","_id":"clvj8jhdc0000pop171ud7xg2","comments":1,"layout":"post","photos":[],"link":"","content":"<p>æƒ³è±¡ä¸€ä¸‹ï¼Œçªç„¶æœ‰ä¸€å¤©éƒ¨ç½²åœ¨æœåŠ¡å™¨ä¸Šçš„åº”ç”¨çªç„¶æŒ‚äº†ï¼æ²¡æœ‰ä¸€ç‚¹ç‚¹é˜²å¤‡ï¼Œä¹Ÿæ²¡æœ‰ä¸€ä¸é¡¾è™‘ï¼Œä½ å°±è¿™æ ·å‡ºç°ã€‚ã€‚ã€‚<br>æŒ‚å°±æŒ‚äº†å§ï¼ŒæœåŠ¡è¿˜æ²¡æœ‰è¾“å‡ºä»»åŠ¡çš„é”™è¯¯ä¿¡æ¯ã€‚è¿™ä¸ªæ—¶å€™æœ‰æ²¡æœ‰ä»€ä¹ˆé€”å¾„å¯ä»¥è®©æˆ‘æ‰¾åˆ°å´©æºƒçš„åŸå› å‘¢ï¼Ÿ</p>\n<p><img src=\"/./images/dump/crash.jpeg\" alt=\"crash\"></p>\n<p>åœ¨è½¯ä»¶å¼€å‘å’Œè¿ç»´è¿‡ç¨‹ä¸­ï¼ŒDump æ–‡ä»¶æ˜¯ä¸€ç§éå¸¸é‡è¦çš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®šä½å’Œè§£å†³å„ç§é—®é¢˜ï¼ŒåŒ…æ‹¬åº”ç”¨ç¨‹åºå´©æºƒã€æ€§èƒ½é—®é¢˜ã€å†…å­˜æ³„æ¼ç­‰ã€‚æœ¬æ–‡å°†ä»‹ç» Dump æ–‡ä»¶çš„åŸºæœ¬æ¦‚å¿µã€å¸¸è§ç±»å‹ä»¥åŠå¦‚ä½•è¿›è¡Œåˆ†æå’Œåˆ©ç”¨ï¼Œå¸®åŠ©è¯»è€…æ›´å¥½åœ°ç†è§£å’Œåˆ©ç”¨ Dump æ–‡ä»¶è¿›è¡Œæ•…éšœæ’æŸ¥å’Œæ€§èƒ½ä¼˜åŒ–ã€‚</p>\n<h1 id=\"Dump-æ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ\"><a href=\"#Dump-æ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ\" class=\"headerlink\" title=\"Dump æ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ\"></a>Dump æ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ</h1><p>Dump æ–‡ä»¶æ˜¯åœ¨åº”ç”¨ç¨‹åºå‘ç”Ÿå´©æºƒæˆ–å¼‚å¸¸æƒ…å†µæ—¶ç”Ÿæˆçš„ä¸€ç§å†…å­˜è½¬å‚¨æ–‡ä»¶ï¼Œè®°å½•äº†åº”ç”¨ç¨‹åºåœ¨å´©æºƒæ—¶çš„å†…å­˜çŠ¶æ€ã€çº¿ç¨‹å †æ ˆã€å˜é‡å€¼ç­‰ä¿¡æ¯ã€‚Dump æ–‡ä»¶é€šå¸¸ä»¥ .dmp æˆ– .core ç­‰æ‰©å±•åä¿å­˜ï¼Œå¯ä»¥è¢«ç”¨äºåç»­çš„æ•…éšœæ’æŸ¥å’Œåˆ†æã€‚</p>\n<h2 id=\"å¸¸è§çš„-Dump-æ–‡ä»¶ç±»å‹\"><a href=\"#å¸¸è§çš„-Dump-æ–‡ä»¶ç±»å‹\" class=\"headerlink\" title=\"å¸¸è§çš„ Dump æ–‡ä»¶ç±»å‹\"></a>å¸¸è§çš„ Dump æ–‡ä»¶ç±»å‹</h2><ul>\n<li>å®Œå…¨å†…å­˜è½¬å‚¨ï¼ˆFull Memory Dumpï¼‰ï¼š å®Œå…¨å†…å­˜è½¬å‚¨è®°å½•äº†æ•´ä¸ªè¿›ç¨‹çš„å†…å­˜çŠ¶æ€ï¼ŒåŒ…æ‹¬ä»£ç ã€æ•°æ®ã€å †æ ˆã€å¯„å­˜å™¨ç­‰ä¿¡æ¯ã€‚è¿™ç§ç±»å‹çš„ Dump æ–‡ä»¶é€šå¸¸ç”¨äºåˆ†æåº”ç”¨ç¨‹åºå´©æºƒçš„æ ¹æœ¬åŸå› ã€‚</li>\n<li>è¿·ä½ å†…å­˜è½¬å‚¨ï¼ˆMini Dumpï¼‰ï¼š è¿·ä½ å†…å­˜è½¬å‚¨åªè®°å½•äº†åº”ç”¨ç¨‹åºå´©æºƒæ—¶çš„å…³é”®ä¿¡æ¯ï¼Œå¦‚çº¿ç¨‹å †æ ˆã€å¼‚å¸¸ä¿¡æ¯ç­‰ï¼Œä½“ç§¯ç›¸å¯¹è¾ƒå°ã€‚è¿™ç§ç±»å‹çš„ Dump æ–‡ä»¶é€šå¸¸ç”¨äºå¿«é€Ÿå®šä½é—®é¢˜ï¼Œä½†å¯èƒ½ä¸¢å¤±ä¸€äº›è¯¦ç»†ä¿¡æ¯ã€‚</li>\n<li>æ ¸å¿ƒè½¬å‚¨ï¼ˆCore Dumpï¼‰ï¼š æ ¸å¿ƒè½¬å‚¨æ˜¯åœ¨ Unix&#x2F;Linux ç³»ç»Ÿä¸‹äº§ç”Ÿçš„ä¸€ç§å†…å­˜è½¬å‚¨æ–‡ä»¶ï¼Œè®°å½•äº†åº”ç”¨ç¨‹åºå´©æºƒæ—¶çš„å†…å­˜çŠ¶æ€ã€‚æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶é€šå¸¸ç”¨äºåˆ†æåº”ç”¨ç¨‹åºå´©æºƒçš„åŸå› å’Œå†…å­˜ä½¿ç”¨æƒ…å†µã€‚</li>\n</ul>\n<h1 id=\"Dump-æ–‡ä»¶åˆ†æçš„åŸºæœ¬æ­¥éª¤\"><a href=\"#Dump-æ–‡ä»¶åˆ†æçš„åŸºæœ¬æ­¥éª¤\" class=\"headerlink\" title=\"Dump æ–‡ä»¶åˆ†æçš„åŸºæœ¬æ­¥éª¤\"></a>Dump æ–‡ä»¶åˆ†æçš„åŸºæœ¬æ­¥éª¤</h1><ol>\n<li>æ”¶é›† Dump æ–‡ä»¶ï¼š é¦–å…ˆéœ€è¦æ”¶é›†åˆ°åº”ç”¨ç¨‹åºå´©æºƒæ—¶ç”Ÿæˆçš„ Dump æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡æ“ä½œç³»ç»Ÿã€ç›‘æ§å·¥å…·æˆ–è€…åº”ç”¨ç¨‹åºè‡ªèº«è®¾ç½®æ¥è·å–ã€‚</li>\n<li>é€‰æ‹©åˆé€‚çš„å·¥å…·ï¼š æ ¹æ® Dump æ–‡ä»¶çš„ç±»å‹å’Œé—®é¢˜çš„æ€§è´¨ï¼Œé€‰æ‹©åˆé€‚çš„å·¥å…·è¿›è¡Œåˆ†æã€‚å¸¸ç”¨çš„å·¥å…·åŒ…æ‹¬ WinDbgã€GDBã€Visual Studio ç­‰ã€‚</li>\n<li>åˆ†ædumpæ–‡ä»¶<ul>\n<li>æŸ¥çœ‹çº¿ç¨‹å †æ ˆï¼š åˆ†æçº¿ç¨‹å †æ ˆä¿¡æ¯ï¼Œå®šä½åˆ°å¼‚å¸¸å‘ç”Ÿæ—¶çš„ä»£ç ä½ç½®ï¼Œäº†è§£ç¨‹åºçš„æ‰§è¡Œæµç¨‹å’Œè°ƒç”¨å…³ç³»ã€‚</li>\n<li>æ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µï¼š åˆ†æå†…å­˜ä½¿ç”¨æƒ…å†µï¼ŒæŸ¥æ‰¾å¯èƒ½å­˜åœ¨çš„å†…å­˜æ³„æ¼æˆ–è€…è¿‡åº¦ä½¿ç”¨å†…å­˜çš„æƒ…å†µï¼Œä¼˜åŒ–å†…å­˜ç®¡ç†å’Œèµ„æºé‡Šæ”¾ã€‚</li>\n<li>åˆ†æå¼‚å¸¸ä¿¡æ¯ï¼š æŸ¥çœ‹å¼‚å¸¸ä¿¡æ¯ï¼Œäº†è§£å¼‚å¸¸çš„ç±»å‹ã€ä½ç½®å’ŒåŸå› ï¼Œä¸ºæ•…éšœæ’æŸ¥æä¾›é‡è¦çº¿ç´¢ã€‚</li>\n<li>è¯Šæ–­æ€§èƒ½é—®é¢˜ï¼š åˆ†ææ€§èƒ½æŒ‡æ ‡å’Œæ€§èƒ½ç“¶é¢ˆï¼Œæ‰¾å‡ºå½±å“æœåŠ¡æ€§èƒ½çš„åŸå› ï¼Œè¿›è¡Œæ€§èƒ½ä¼˜åŒ–å’Œè°ƒæ•´ã€‚</li>\n</ul>\n</li>\n<li>è¯Šæ–­å’Œè§£å†³é—®é¢˜ï¼š æ ¹æ®åˆ†æç»“æœï¼Œè¯Šæ–­å‡ºé—®é¢˜çš„æ ¹æœ¬åŸå› ï¼Œå¹¶é‡‡å–ç›¸åº”çš„æªæ–½è¿›è¡Œä¿®å¤æˆ–ä¼˜åŒ–ã€‚</li>\n</ol>\n<h1 id=\"Dump-æ–‡ä»¶åˆ†æçš„å®æˆ˜æ¼”ç»ƒ\"><a href=\"#Dump-æ–‡ä»¶åˆ†æçš„å®æˆ˜æ¼”ç»ƒ\" class=\"headerlink\" title=\"Dump æ–‡ä»¶åˆ†æçš„å®æˆ˜æ¼”ç»ƒ\"></a>Dump æ–‡ä»¶åˆ†æçš„å®æˆ˜æ¼”ç»ƒ</h1><p>ä¸Šé¢è¯´äº†é‚£ä¹ˆå¤šç†è®ºï¼Œä¸‹é¢æˆ‘ä»¬æ¥å®é™…æ“ä½œä¸€ä¸‹ã€‚</p>\n<p>é¦–å…ˆç®€å•ä»‹ç»ä¸€ä¸‹ä½œä¸ºç¤ºä¾‹çš„é¡¹ç›®èƒŒæ™¯ï¼Œ</p>\n<ol>\n<li>ç¨‹åºæ€§è´¨ï¼šåŸºäº .NET çš„ Web åº”ç”¨ç¨‹åºï¼›</li>\n<li>è¿è¡Œç¯å¢ƒï¼šè¿è¡Œåœ¨docker å®¹å™¨ä¸­ï¼›</li>\n<li>æ”¶é›†å·¥å…·ï¼šcreatedumpæ˜¯éšç€ .NET Core runtime ä¸€èµ·å‘å¸ƒçš„ä¸€ä¸ªåˆ›å»º dump çš„ä¸€ä¸ªå·¥å…·ï¼›</li>\n<li>é—®é¢˜è¡¨ç°ï¼šå†…å­˜æ³„æ¼ï¼›</li>\n</ol>\n<h2 id=\"æ”¶é›†dumpæ–‡ä»¶\"><a href=\"#æ”¶é›†dumpæ–‡ä»¶\" class=\"headerlink\" title=\"æ”¶é›†dumpæ–‡ä»¶\"></a>æ”¶é›†dumpæ–‡ä»¶</h2><h3 id=\"è¿›å…¥å®¹å™¨\"><a href=\"#è¿›å…¥å®¹å™¨\" class=\"headerlink\" title=\"è¿›å…¥å®¹å™¨\"></a>è¿›å…¥å®¹å™¨</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker exec -it wpp bash</span><br></pre></td></tr></table></figure>\n<h3 id=\"è¿›å…¥-netè¿è¡Œæ—¶ç›®å½•\"><a href=\"#è¿›å…¥-netè¿è¡Œæ—¶ç›®å½•\" class=\"headerlink\" title=\"è¿›å…¥.netè¿è¡Œæ—¶ç›®å½•\"></a>è¿›å…¥.netè¿è¡Œæ—¶ç›®å½•</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@4aa6a7d51e1e:/# </span><br><span class=\"line\">root@4aa6a7d51e1e:/# find / -name createdump</span><br><span class=\"line\">/usr/share/dotnet/shared/Microsoft.NETCore.App/8.0.0/createdump</span><br><span class=\"line\">root@4aa6a7d51e1e:/# cd /usr/share/dotnet/shared/Microsoft.NETCore.App/8.0.0           </span><br><span class=\"line\">root@4aa6a7d51e1e:/usr/share/dotnet/shared/Microsoft.NETCore.App/8.0.0# </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"è¿è¡ŒcreatedumpæŠ“åŒ…\"><a href=\"#è¿è¡ŒcreatedumpæŠ“åŒ…\" class=\"headerlink\" title=\"è¿è¡ŒcreatedumpæŠ“åŒ…\"></a>è¿è¡ŒcreatedumpæŠ“åŒ…</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">createdump [options] pid</span><br><span class=\"line\">-f, --name - dump path and file name. The default is &#x27;/tmp/coredump.%p&#x27;. These specifiers are substituted with following values:</span><br><span class=\"line\">   %p  PID of dumped process.</span><br><span class=\"line\">   %e  The process executable filename.</span><br><span class=\"line\">   %h  Hostname return by gethostname().</span><br><span class=\"line\">   %t  Time of dump, expressed as seconds since the Epoch, 1970-01-01 00:00:00 +0000 (UTC).</span><br><span class=\"line\">-n, --normal - create minidump.</span><br><span class=\"line\">-h, --withheap - create minidump with heap (default).</span><br><span class=\"line\">-t, --triage - create triage minidump.</span><br><span class=\"line\">-u, --full - create full core dump.</span><br><span class=\"line\">-d, --diag - enable diagnostic messages.</span><br></pre></td></tr></table></figure>\n<p>topä¸€ä¸‹æŸ¥çœ‹è¿›ç¨‹id</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> PID  PPID USER     STAT   VSZ %VSZ %CPU COMMAND</span><br><span class=\"line\">    1     0 root     S     261g7842%   0% dotnet SubscriptionAccount.dll</span><br><span class=\"line\">11480     0 root     S     4188   0%   0% bash</span><br><span class=\"line\">11845 11480 root     R     3268   0%   0% top</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>æ‰§è¡Œå‘½ä»¤</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./createdump -f /tmp/wpp_dump -u 1</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>å¦‚æœæç¤ºæ²¡æœ‰æƒé™ï¼Œéœ€è¦åœ¨dockerè¿è¡Œæ—¶å¢åŠ ä¸€ä¸ªå‚æ•° â€“privileged&#x3D;true ï¼Œä»¥ä¾¿å®¹å™¨ä»¥ç‰¹æƒæ–¹å¼è¿è¡Œã€‚</p>\n</blockquote>\n<h3 id=\"å°†dumpæ–‡ä»¶æ‹·è´å‡ºæ¥\"><a href=\"#å°†dumpæ–‡ä»¶æ‹·è´å‡ºæ¥\" class=\"headerlink\" title=\"å°†dumpæ–‡ä»¶æ‹·è´å‡ºæ¥\"></a>å°†dumpæ–‡ä»¶æ‹·è´å‡ºæ¥</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker cp wpp:/tmp/wpp_dump /tmp/wpp_dump</span><br></pre></td></tr></table></figure>\n<h2 id=\"WinDbg-åˆ†ædumpæ–‡ä»¶\"><a href=\"#WinDbg-åˆ†ædumpæ–‡ä»¶\" class=\"headerlink\" title=\"WinDbg åˆ†ædumpæ–‡ä»¶\"></a>WinDbg åˆ†ædumpæ–‡ä»¶</h2><p>é¡¹ç›®èƒŒæ™¯é‡Œé¢æˆ‘ä»¬ä¹Ÿè®²åˆ°äº†ï¼Œè¿™æ¬¡æˆ‘ä»¬åˆ†æçš„æ˜¯å†…å­˜æ³„æ¼çš„é—®é¢˜ã€‚æ‰€ä»¥æˆ‘ä»¬åˆ†æçš„ç¬¬ä¸€æ­¥æ˜¯æ‰¾åˆ°å“ªäº›å†…å­˜å ç”¨æ¯”è¾ƒå¤§çš„å˜é‡</p>\n<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ‰¾åˆ°å†…å­˜å ç”¨æœ€å¤§ç±»å‹ï¼Œè¿™é‡Œæˆ‘ä»¬å†…å­˜å ç”¨è¾ƒå¤§çš„System.Byte[]<br>ç„¶åç©¿é€æ‰¾åˆ°ç±»å‹å¯¹åº”çš„å˜é‡çš„å†…å­˜å ç”¨æƒ…å†µ<br><img src=\"/images/dump/windbg_1.png\" alt=\"å†…å­˜å ç”¨\"><br><img src=\"/images/dump/windbg_2.png\" alt=\"å˜é‡å†…å­˜\"><br>é€šè¿‡ä¸Šé¢çš„å‘½ä»¤ï¼Œæˆ‘ä»¬æ‰¾åˆ°å†…å­˜å ç”¨æœ€é«˜çš„å‡ ä¸ªå˜é‡ï¼Œç„¶åç©¿é€åˆ°å…·ä½“è¿™ä¸ªå¤§å˜é‡é‡Œé¢è£…çš„æ˜¯å•¥<br><img src=\"/images/dump/windbg_3.png\" alt=\"å˜é‡å†…å®¹\"><br>é€šè¿‡å˜é‡çš„å†…å®¹ï¼Œæ‰¾åˆ°å…·ä½“ä»£ç çš„ä½ç½®äº†å°±ä¸æ˜¯ä»€ä¹ˆéš¾äº‹äº†ã€‚<br><img src=\"/images/dump/windbg_4.png\" alt=\"bugä½ç½®\"></p>\n<h1 id=\"ç»“è¯­\"><a href=\"#ç»“è¯­\" class=\"headerlink\" title=\"ç»“è¯­\"></a>ç»“è¯­</h1><p>é€šè¿‡æœ¬æ–‡çš„ä»‹ç»ï¼Œç›¸ä¿¡è¯»è€…å¯¹ Dump æ–‡ä»¶çš„åŸºæœ¬æ¦‚å¿µå’Œåˆ†ææ–¹æ³•æœ‰äº†æ›´æ·±å…¥çš„äº†è§£ã€‚Dump æ–‡ä»¶æ˜¯æ•…éšœæ’æŸ¥å’Œæ€§èƒ½ä¼˜åŒ–çš„é‡è¦å·¥å…·ï¼ŒæŒæ¡å¥½ Dump æ–‡ä»¶çš„åˆ†ææŠ€å·§èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ›´å¿«åœ°å®šä½å’Œè§£å†³å„ç§é—®é¢˜ï¼Œæé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚</p>\n","site":{"data":{}},"excerpt":"","more":"<p>æƒ³è±¡ä¸€ä¸‹ï¼Œçªç„¶æœ‰ä¸€å¤©éƒ¨ç½²åœ¨æœåŠ¡å™¨ä¸Šçš„åº”ç”¨çªç„¶æŒ‚äº†ï¼æ²¡æœ‰ä¸€ç‚¹ç‚¹é˜²å¤‡ï¼Œä¹Ÿæ²¡æœ‰ä¸€ä¸é¡¾è™‘ï¼Œä½ å°±è¿™æ ·å‡ºç°ã€‚ã€‚ã€‚<br>æŒ‚å°±æŒ‚äº†å§ï¼ŒæœåŠ¡è¿˜æ²¡æœ‰è¾“å‡ºä»»åŠ¡çš„é”™è¯¯ä¿¡æ¯ã€‚è¿™ä¸ªæ—¶å€™æœ‰æ²¡æœ‰ä»€ä¹ˆé€”å¾„å¯ä»¥è®©æˆ‘æ‰¾åˆ°å´©æºƒçš„åŸå› å‘¢ï¼Ÿ</p>\n<p><img src=\"/./images/dump/crash.jpeg\" alt=\"crash\"></p>\n<p>åœ¨è½¯ä»¶å¼€å‘å’Œè¿ç»´è¿‡ç¨‹ä¸­ï¼ŒDump æ–‡ä»¶æ˜¯ä¸€ç§éå¸¸é‡è¦çš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®šä½å’Œè§£å†³å„ç§é—®é¢˜ï¼ŒåŒ…æ‹¬åº”ç”¨ç¨‹åºå´©æºƒã€æ€§èƒ½é—®é¢˜ã€å†…å­˜æ³„æ¼ç­‰ã€‚æœ¬æ–‡å°†ä»‹ç» Dump æ–‡ä»¶çš„åŸºæœ¬æ¦‚å¿µã€å¸¸è§ç±»å‹ä»¥åŠå¦‚ä½•è¿›è¡Œåˆ†æå’Œåˆ©ç”¨ï¼Œå¸®åŠ©è¯»è€…æ›´å¥½åœ°ç†è§£å’Œåˆ©ç”¨ Dump æ–‡ä»¶è¿›è¡Œæ•…éšœæ’æŸ¥å’Œæ€§èƒ½ä¼˜åŒ–ã€‚</p>\n<h1 id=\"Dump-æ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ\"><a href=\"#Dump-æ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ\" class=\"headerlink\" title=\"Dump æ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ\"></a>Dump æ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ</h1><p>Dump æ–‡ä»¶æ˜¯åœ¨åº”ç”¨ç¨‹åºå‘ç”Ÿå´©æºƒæˆ–å¼‚å¸¸æƒ…å†µæ—¶ç”Ÿæˆçš„ä¸€ç§å†…å­˜è½¬å‚¨æ–‡ä»¶ï¼Œè®°å½•äº†åº”ç”¨ç¨‹åºåœ¨å´©æºƒæ—¶çš„å†…å­˜çŠ¶æ€ã€çº¿ç¨‹å †æ ˆã€å˜é‡å€¼ç­‰ä¿¡æ¯ã€‚Dump æ–‡ä»¶é€šå¸¸ä»¥ .dmp æˆ– .core ç­‰æ‰©å±•åä¿å­˜ï¼Œå¯ä»¥è¢«ç”¨äºåç»­çš„æ•…éšœæ’æŸ¥å’Œåˆ†æã€‚</p>\n<h2 id=\"å¸¸è§çš„-Dump-æ–‡ä»¶ç±»å‹\"><a href=\"#å¸¸è§çš„-Dump-æ–‡ä»¶ç±»å‹\" class=\"headerlink\" title=\"å¸¸è§çš„ Dump æ–‡ä»¶ç±»å‹\"></a>å¸¸è§çš„ Dump æ–‡ä»¶ç±»å‹</h2><ul>\n<li>å®Œå…¨å†…å­˜è½¬å‚¨ï¼ˆFull Memory Dumpï¼‰ï¼š å®Œå…¨å†…å­˜è½¬å‚¨è®°å½•äº†æ•´ä¸ªè¿›ç¨‹çš„å†…å­˜çŠ¶æ€ï¼ŒåŒ…æ‹¬ä»£ç ã€æ•°æ®ã€å †æ ˆã€å¯„å­˜å™¨ç­‰ä¿¡æ¯ã€‚è¿™ç§ç±»å‹çš„ Dump æ–‡ä»¶é€šå¸¸ç”¨äºåˆ†æåº”ç”¨ç¨‹åºå´©æºƒçš„æ ¹æœ¬åŸå› ã€‚</li>\n<li>è¿·ä½ å†…å­˜è½¬å‚¨ï¼ˆMini Dumpï¼‰ï¼š è¿·ä½ å†…å­˜è½¬å‚¨åªè®°å½•äº†åº”ç”¨ç¨‹åºå´©æºƒæ—¶çš„å…³é”®ä¿¡æ¯ï¼Œå¦‚çº¿ç¨‹å †æ ˆã€å¼‚å¸¸ä¿¡æ¯ç­‰ï¼Œä½“ç§¯ç›¸å¯¹è¾ƒå°ã€‚è¿™ç§ç±»å‹çš„ Dump æ–‡ä»¶é€šå¸¸ç”¨äºå¿«é€Ÿå®šä½é—®é¢˜ï¼Œä½†å¯èƒ½ä¸¢å¤±ä¸€äº›è¯¦ç»†ä¿¡æ¯ã€‚</li>\n<li>æ ¸å¿ƒè½¬å‚¨ï¼ˆCore Dumpï¼‰ï¼š æ ¸å¿ƒè½¬å‚¨æ˜¯åœ¨ Unix&#x2F;Linux ç³»ç»Ÿä¸‹äº§ç”Ÿçš„ä¸€ç§å†…å­˜è½¬å‚¨æ–‡ä»¶ï¼Œè®°å½•äº†åº”ç”¨ç¨‹åºå´©æºƒæ—¶çš„å†…å­˜çŠ¶æ€ã€‚æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶é€šå¸¸ç”¨äºåˆ†æåº”ç”¨ç¨‹åºå´©æºƒçš„åŸå› å’Œå†…å­˜ä½¿ç”¨æƒ…å†µã€‚</li>\n</ul>\n<h1 id=\"Dump-æ–‡ä»¶åˆ†æçš„åŸºæœ¬æ­¥éª¤\"><a href=\"#Dump-æ–‡ä»¶åˆ†æçš„åŸºæœ¬æ­¥éª¤\" class=\"headerlink\" title=\"Dump æ–‡ä»¶åˆ†æçš„åŸºæœ¬æ­¥éª¤\"></a>Dump æ–‡ä»¶åˆ†æçš„åŸºæœ¬æ­¥éª¤</h1><ol>\n<li>æ”¶é›† Dump æ–‡ä»¶ï¼š é¦–å…ˆéœ€è¦æ”¶é›†åˆ°åº”ç”¨ç¨‹åºå´©æºƒæ—¶ç”Ÿæˆçš„ Dump æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡æ“ä½œç³»ç»Ÿã€ç›‘æ§å·¥å…·æˆ–è€…åº”ç”¨ç¨‹åºè‡ªèº«è®¾ç½®æ¥è·å–ã€‚</li>\n<li>é€‰æ‹©åˆé€‚çš„å·¥å…·ï¼š æ ¹æ® Dump æ–‡ä»¶çš„ç±»å‹å’Œé—®é¢˜çš„æ€§è´¨ï¼Œé€‰æ‹©åˆé€‚çš„å·¥å…·è¿›è¡Œåˆ†æã€‚å¸¸ç”¨çš„å·¥å…·åŒ…æ‹¬ WinDbgã€GDBã€Visual Studio ç­‰ã€‚</li>\n<li>åˆ†ædumpæ–‡ä»¶<ul>\n<li>æŸ¥çœ‹çº¿ç¨‹å †æ ˆï¼š åˆ†æçº¿ç¨‹å †æ ˆä¿¡æ¯ï¼Œå®šä½åˆ°å¼‚å¸¸å‘ç”Ÿæ—¶çš„ä»£ç ä½ç½®ï¼Œäº†è§£ç¨‹åºçš„æ‰§è¡Œæµç¨‹å’Œè°ƒç”¨å…³ç³»ã€‚</li>\n<li>æ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µï¼š åˆ†æå†…å­˜ä½¿ç”¨æƒ…å†µï¼ŒæŸ¥æ‰¾å¯èƒ½å­˜åœ¨çš„å†…å­˜æ³„æ¼æˆ–è€…è¿‡åº¦ä½¿ç”¨å†…å­˜çš„æƒ…å†µï¼Œä¼˜åŒ–å†…å­˜ç®¡ç†å’Œèµ„æºé‡Šæ”¾ã€‚</li>\n<li>åˆ†æå¼‚å¸¸ä¿¡æ¯ï¼š æŸ¥çœ‹å¼‚å¸¸ä¿¡æ¯ï¼Œäº†è§£å¼‚å¸¸çš„ç±»å‹ã€ä½ç½®å’ŒåŸå› ï¼Œä¸ºæ•…éšœæ’æŸ¥æä¾›é‡è¦çº¿ç´¢ã€‚</li>\n<li>è¯Šæ–­æ€§èƒ½é—®é¢˜ï¼š åˆ†ææ€§èƒ½æŒ‡æ ‡å’Œæ€§èƒ½ç“¶é¢ˆï¼Œæ‰¾å‡ºå½±å“æœåŠ¡æ€§èƒ½çš„åŸå› ï¼Œè¿›è¡Œæ€§èƒ½ä¼˜åŒ–å’Œè°ƒæ•´ã€‚</li>\n</ul>\n</li>\n<li>è¯Šæ–­å’Œè§£å†³é—®é¢˜ï¼š æ ¹æ®åˆ†æç»“æœï¼Œè¯Šæ–­å‡ºé—®é¢˜çš„æ ¹æœ¬åŸå› ï¼Œå¹¶é‡‡å–ç›¸åº”çš„æªæ–½è¿›è¡Œä¿®å¤æˆ–ä¼˜åŒ–ã€‚</li>\n</ol>\n<h1 id=\"Dump-æ–‡ä»¶åˆ†æçš„å®æˆ˜æ¼”ç»ƒ\"><a href=\"#Dump-æ–‡ä»¶åˆ†æçš„å®æˆ˜æ¼”ç»ƒ\" class=\"headerlink\" title=\"Dump æ–‡ä»¶åˆ†æçš„å®æˆ˜æ¼”ç»ƒ\"></a>Dump æ–‡ä»¶åˆ†æçš„å®æˆ˜æ¼”ç»ƒ</h1><p>ä¸Šé¢è¯´äº†é‚£ä¹ˆå¤šç†è®ºï¼Œä¸‹é¢æˆ‘ä»¬æ¥å®é™…æ“ä½œä¸€ä¸‹ã€‚</p>\n<p>é¦–å…ˆç®€å•ä»‹ç»ä¸€ä¸‹ä½œä¸ºç¤ºä¾‹çš„é¡¹ç›®èƒŒæ™¯ï¼Œ</p>\n<ol>\n<li>ç¨‹åºæ€§è´¨ï¼šåŸºäº .NET çš„ Web åº”ç”¨ç¨‹åºï¼›</li>\n<li>è¿è¡Œç¯å¢ƒï¼šè¿è¡Œåœ¨docker å®¹å™¨ä¸­ï¼›</li>\n<li>æ”¶é›†å·¥å…·ï¼šcreatedumpæ˜¯éšç€ .NET Core runtime ä¸€èµ·å‘å¸ƒçš„ä¸€ä¸ªåˆ›å»º dump çš„ä¸€ä¸ªå·¥å…·ï¼›</li>\n<li>é—®é¢˜è¡¨ç°ï¼šå†…å­˜æ³„æ¼ï¼›</li>\n</ol>\n<h2 id=\"æ”¶é›†dumpæ–‡ä»¶\"><a href=\"#æ”¶é›†dumpæ–‡ä»¶\" class=\"headerlink\" title=\"æ”¶é›†dumpæ–‡ä»¶\"></a>æ”¶é›†dumpæ–‡ä»¶</h2><h3 id=\"è¿›å…¥å®¹å™¨\"><a href=\"#è¿›å…¥å®¹å™¨\" class=\"headerlink\" title=\"è¿›å…¥å®¹å™¨\"></a>è¿›å…¥å®¹å™¨</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker exec -it wpp bash</span><br></pre></td></tr></table></figure>\n<h3 id=\"è¿›å…¥-netè¿è¡Œæ—¶ç›®å½•\"><a href=\"#è¿›å…¥-netè¿è¡Œæ—¶ç›®å½•\" class=\"headerlink\" title=\"è¿›å…¥.netè¿è¡Œæ—¶ç›®å½•\"></a>è¿›å…¥.netè¿è¡Œæ—¶ç›®å½•</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@4aa6a7d51e1e:/# </span><br><span class=\"line\">root@4aa6a7d51e1e:/# find / -name createdump</span><br><span class=\"line\">/usr/share/dotnet/shared/Microsoft.NETCore.App/8.0.0/createdump</span><br><span class=\"line\">root@4aa6a7d51e1e:/# cd /usr/share/dotnet/shared/Microsoft.NETCore.App/8.0.0           </span><br><span class=\"line\">root@4aa6a7d51e1e:/usr/share/dotnet/shared/Microsoft.NETCore.App/8.0.0# </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"è¿è¡ŒcreatedumpæŠ“åŒ…\"><a href=\"#è¿è¡ŒcreatedumpæŠ“åŒ…\" class=\"headerlink\" title=\"è¿è¡ŒcreatedumpæŠ“åŒ…\"></a>è¿è¡ŒcreatedumpæŠ“åŒ…</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">createdump [options] pid</span><br><span class=\"line\">-f, --name - dump path and file name. The default is &#x27;/tmp/coredump.%p&#x27;. These specifiers are substituted with following values:</span><br><span class=\"line\">   %p  PID of dumped process.</span><br><span class=\"line\">   %e  The process executable filename.</span><br><span class=\"line\">   %h  Hostname return by gethostname().</span><br><span class=\"line\">   %t  Time of dump, expressed as seconds since the Epoch, 1970-01-01 00:00:00 +0000 (UTC).</span><br><span class=\"line\">-n, --normal - create minidump.</span><br><span class=\"line\">-h, --withheap - create minidump with heap (default).</span><br><span class=\"line\">-t, --triage - create triage minidump.</span><br><span class=\"line\">-u, --full - create full core dump.</span><br><span class=\"line\">-d, --diag - enable diagnostic messages.</span><br></pre></td></tr></table></figure>\n<p>topä¸€ä¸‹æŸ¥çœ‹è¿›ç¨‹id</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> PID  PPID USER     STAT   VSZ %VSZ %CPU COMMAND</span><br><span class=\"line\">    1     0 root     S     261g7842%   0% dotnet SubscriptionAccount.dll</span><br><span class=\"line\">11480     0 root     S     4188   0%   0% bash</span><br><span class=\"line\">11845 11480 root     R     3268   0%   0% top</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>æ‰§è¡Œå‘½ä»¤</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./createdump -f /tmp/wpp_dump -u 1</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>å¦‚æœæç¤ºæ²¡æœ‰æƒé™ï¼Œéœ€è¦åœ¨dockerè¿è¡Œæ—¶å¢åŠ ä¸€ä¸ªå‚æ•° â€“privileged&#x3D;true ï¼Œä»¥ä¾¿å®¹å™¨ä»¥ç‰¹æƒæ–¹å¼è¿è¡Œã€‚</p>\n</blockquote>\n<h3 id=\"å°†dumpæ–‡ä»¶æ‹·è´å‡ºæ¥\"><a href=\"#å°†dumpæ–‡ä»¶æ‹·è´å‡ºæ¥\" class=\"headerlink\" title=\"å°†dumpæ–‡ä»¶æ‹·è´å‡ºæ¥\"></a>å°†dumpæ–‡ä»¶æ‹·è´å‡ºæ¥</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker cp wpp:/tmp/wpp_dump /tmp/wpp_dump</span><br></pre></td></tr></table></figure>\n<h2 id=\"WinDbg-åˆ†ædumpæ–‡ä»¶\"><a href=\"#WinDbg-åˆ†ædumpæ–‡ä»¶\" class=\"headerlink\" title=\"WinDbg åˆ†ædumpæ–‡ä»¶\"></a>WinDbg åˆ†ædumpæ–‡ä»¶</h2><p>é¡¹ç›®èƒŒæ™¯é‡Œé¢æˆ‘ä»¬ä¹Ÿè®²åˆ°äº†ï¼Œè¿™æ¬¡æˆ‘ä»¬åˆ†æçš„æ˜¯å†…å­˜æ³„æ¼çš„é—®é¢˜ã€‚æ‰€ä»¥æˆ‘ä»¬åˆ†æçš„ç¬¬ä¸€æ­¥æ˜¯æ‰¾åˆ°å“ªäº›å†…å­˜å ç”¨æ¯”è¾ƒå¤§çš„å˜é‡</p>\n<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ‰¾åˆ°å†…å­˜å ç”¨æœ€å¤§ç±»å‹ï¼Œè¿™é‡Œæˆ‘ä»¬å†…å­˜å ç”¨è¾ƒå¤§çš„System.Byte[]<br>ç„¶åç©¿é€æ‰¾åˆ°ç±»å‹å¯¹åº”çš„å˜é‡çš„å†…å­˜å ç”¨æƒ…å†µ<br><img src=\"/images/dump/windbg_1.png\" alt=\"å†…å­˜å ç”¨\"><br><img src=\"/images/dump/windbg_2.png\" alt=\"å˜é‡å†…å­˜\"><br>é€šè¿‡ä¸Šé¢çš„å‘½ä»¤ï¼Œæˆ‘ä»¬æ‰¾åˆ°å†…å­˜å ç”¨æœ€é«˜çš„å‡ ä¸ªå˜é‡ï¼Œç„¶åç©¿é€åˆ°å…·ä½“è¿™ä¸ªå¤§å˜é‡é‡Œé¢è£…çš„æ˜¯å•¥<br><img src=\"/images/dump/windbg_3.png\" alt=\"å˜é‡å†…å®¹\"><br>é€šè¿‡å˜é‡çš„å†…å®¹ï¼Œæ‰¾åˆ°å…·ä½“ä»£ç çš„ä½ç½®äº†å°±ä¸æ˜¯ä»€ä¹ˆéš¾äº‹äº†ã€‚<br><img src=\"/images/dump/windbg_4.png\" alt=\"bugä½ç½®\"></p>\n<h1 id=\"ç»“è¯­\"><a href=\"#ç»“è¯­\" class=\"headerlink\" title=\"ç»“è¯­\"></a>ç»“è¯­</h1><p>é€šè¿‡æœ¬æ–‡çš„ä»‹ç»ï¼Œç›¸ä¿¡è¯»è€…å¯¹ Dump æ–‡ä»¶çš„åŸºæœ¬æ¦‚å¿µå’Œåˆ†ææ–¹æ³•æœ‰äº†æ›´æ·±å…¥çš„äº†è§£ã€‚Dump æ–‡ä»¶æ˜¯æ•…éšœæ’æŸ¥å’Œæ€§èƒ½ä¼˜åŒ–çš„é‡è¦å·¥å…·ï¼ŒæŒæ¡å¥½ Dump æ–‡ä»¶çš„åˆ†ææŠ€å·§èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ›´å¿«åœ°å®šä½å’Œè§£å†³å„ç§é—®é¢˜ï¼Œæé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚</p>\n"}],"PostAsset":[],"PostCategory":[],"PostTag":[{"post_id":"cltzedeaa0000d0p1ajbjc7gt","tag_id":"clu6lbm020000qgp12xagd7wt","_id":"clu6lbm030001qgp1fqm351zz"},{"post_id":"cluc17m5x0000qsp19fjj1lmy","tag_id":"cluc17m5z0001qsp12a5n6e97","_id":"cluc17m600002qsp19wrd4b20"},{"post_id":"clup9vupa0000okp14bz96eiy","tag_id":"clup9vupr0001okp1b20obw5k","_id":"clup9vups0002okp1f72rhs2r"},{"post_id":"cluuzgyxx000088p1frvnfrom","tag_id":"clv0mvgiy0002x4p19oeo5n65","_id":"clv0mvgiy0003x4p186o50a2h"},{"post_id":"clv5zlgr50003fcp11585dpte","tag_id":"clv4x0del0001fcp16qpg9jfq","_id":"clv5zlgr70004fcp1a7h78bur"},{"post_id":"clvj8jhdc0000pop171ud7xg2","tag_id":"clvxfh3ap0000zkp1cdrwco6s","_id":"clvxfh3as0001zkp12iuz6c4w"}],"Tag":[{"name":"http åè®® httpåè®®","_id":"cltzedeah0001d0p1gd2rdzoo"},{"name":"http httpåè®® Connection","_id":"clu6lbm020000qgp12xagd7wt"},{"name":"ç»„ç»‡ å†…è€—","_id":"cluc17m5z0001qsp12a5n6e97"},{"name":"Garnet ç¼“å­˜ å¾®è½¯","_id":"clup9vupr0001okp1b20obw5k"},{"name":"https http ssl tlc","_id":"clv0mvfpx0000x4p1cun49e2q"},{"name":"https http ssl tls","_id":"clv0mvgiy0002x4p19oeo5n65"},{"name":"redis é¢è¯• æ±‚èŒ","_id":"clv4x0del0001fcp16qpg9jfq"},{"name":"dump","_id":"clvj8jhdt0001pop1f18veod2"},{"name":"dump æ€§èƒ½ å¼‚å¸¸","_id":"clvxfh3ap0000zkp1cdrwco6s"}]}}
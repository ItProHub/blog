---
title: 并发不是并行！
date: 2025-01-07 16:05:45
tags:
---


在现代计算机科学中，我们经常听到“并发”和“并行”这两个术语。虽然它们在某些场景中可能显得相似，但本质上有很大的区别。理解这两个概念不仅有助于我们深入掌握计算机的工作原理，也能帮助我们在实际开发中作出更好的设计决策。

本文将深入探讨并发和并行的定义、区别以及它们在实际应用中的不同场景。

# 什么是并发（Concurrency）？
并发是指在同一时间段内处理多个任务的能力。并发并不要求任务必须同时进行，而是任务能够在某个时间段内交替执行，系统能够有效地管理多个任务，让它们看起来像是并行执行。

## 并发的特点：

- 任务交替执行：在并发的系统中，多个任务可能会交替执行，但并不一定是同时发生的。
- 资源共享：并发任务通常共享有限的计算资源，任务之间的执行顺序不一定是固定的。
- 通常发生在单核处理器上：在单核处理器上，通过时间分片的方式来切换任务，使得每个任务在一定的时间片内得到执行，从而给人一种任务同时进行的感觉。

## 并发的例子：
想象一下你正在使用一个多任务的操作系统，你可能在写文档、回复邮件、浏览网页以及播放音乐。操作系统会将CPU时间分配给这些任务，每个任务在不同的时间片段内执行，看起来它们在同时进行，实际上它们是交替进行的。这就是并发。

```C#
class ConcurrencyExample
{
    static void Main(string[] args)
    {
        Console.WriteLine("并发示例：");

        // 创建两个任务，并行执行
        var task1 = Task.Run(() => DoWork("任务 1"));
        var task2 = Task.Run(() => DoWork("任务 2"));

        // 等待任务完成
        Task.WhenAll(task1, task2).Wait();

        Console.WriteLine("所有任务完成");
    }

    static void DoWork(string taskName)
    {
        Console.WriteLine($"{taskName} 开始");

        // 模拟I/O密集型操作，如网络请求或文件读写
        for( int i = 0; i < 5; i++ ) {
            Console.WriteLine($"{taskName} 正在处理: {i + 1}");
            Thread.Sleep(1000);  // 模拟I/O操作
        }

        Console.WriteLine($"{taskName} 完成");
    }
}
```

![并发示例](./images/parallelism/concurrency-result.png)

# 什么是并行（Parallelism）？
并行是指多个任务在同一时刻并行执行。为了实现并行，通常需要多核处理器或者多个处理单元。这些任务被分配到不同的处理器核心上，能够真正的在同一时刻同时运行。

## 并行的特点：
- 任务同时执行：多个任务在同一时刻并行进行，不存在时间片的切换。
- 需要多个处理单元：并行执行通常要求计算资源（如多个CPU核心、多个计算机节点等）支持。
- 任务独立性：任务之间通常是相互独立的，能够并行执行而不会互相干扰。

## 并行的例子：
以图像处理为例，假设你有一张大图片需要进行处理（例如滤镜、色彩调整等）。如果你的计算机有多个处理器核心，你可以将这张图片分成多个小块，每个核心同时处理不同的图像块，最终合并结果。这样，整个图像处理过程就实现了并行。

```C#
class ParallelismExample
{
    static void Main(string[] args)
    {
        Console.WriteLine("并行示例：");

        // 使用 Parallel.For 并行执行多个任务
        Parallel.For(0, 5, i => {
            DoWork(i);
        });

        Console.WriteLine("所有任务完成");
    }

    static void DoWork(int taskId)
    {
        Console.WriteLine($"任务 {taskId} 开始");

        // 模拟计算密集型操作
        for( int i = 0; i < 5; i++ ) {
            Console.WriteLine($"任务 {taskId} 正在处理: {i + 1}");
        }

        Console.WriteLine($"任务 {taskId} 完成");
    }
}
```
![并发示例](./images/parallelism/parallelism-result.png)

# 并发和并行的区别
尽管并发和并行都涉及多个任务的执行，但它们的实现方式和应用场景有很大的区别。可以通过下面两张图来对比并发和并行的区别：

__并发__
![并发](./images/parallelism/concurrency-vs-parallelism-1.png)
__并行__
![并行](./images/parallelism/concurrency-vs-parallelism-2.png)



|特性|	并发（Concurrency）|	并行（Parallelism）|
|--|--|--|
|定义|	多个任务在同一时间段内交替执行，可能并不同时发生|	多个任务在同一时刻同时执行|
|任务执行 |	任务交替执行，可能共享资源|	任务同时执行，通常有多个处理单元|
|资源需求|	单核或多核都可以实现|	需要多核或多个计算单元支持|
|适用场景|	I/O密集型任务，如文件读取、网络请求等|	计算密集型任务，如图像处理、科学计算等|
|实现方式|	通过时间分片调度任务|	通过多核或多计算节点同时执行多个任务|


# 并发与并行的结合应用
在现代计算机系统中，并发和并行往往是结合使用的。操作系统可以通过并发来管理多个任务的调度，而硬件资源则可以通过并行来加速任务的执行。

例如，在现代的Web服务器中，可能会有多个用户请求同时到达，操作系统通过并发管理多个请求的处理。对于每个请求，服务器可能会在多个处理器核心上并行执行数据处理任务，以加速响应速度。

![并发与并行结合](./images/parallelism/concurrency-vs-parallelism-3.png)

# 在编程中的并发与并行
在编程中，处理并发和并行常常依赖于不同的技术和框架。下面列举几种常见的实现方式：

## 并发编程：
- 线程（Thread）：操作系统通过多线程实现并发，多个线程可以并发执行任务。
- 事件驱动（Event-driven）：例如Node.js就是通过单线程事件循环的方式处理并发请求，不需要多个线程即可实现高效的并发。
- 协程（Coroutine）：协程是一种比线程更轻量级的并发模型，多个协程可以在单线程中交替执行。

## 并行编程：
- 多线程：在多核系统中，程序可以使用多个线程来并行执行计算任务。
- 分布式计算：如MapReduce、Spark等，通过多个计算节点来处理大规模的数据集，实现并行计算。

# 并发与并行的实际应用
## 并发应用：
- Web服务器：例如Nginx和Node.js都利用并发来处理大量的并发请求，尤其是在I/O密集型的场景下，能够有效提高吞吐量。
- 聊天应用：比如即时通讯软件，每个用户的消息处理都是并发的，操作系统会根据空闲的CPU资源调度不同的消息处理线程。

## 并行应用：
- 科学计算：如天气预测、物理模拟等计算密集型任务可以通过并行计算加速处理过程。
- 大数据分析：通过分布式计算框架如Hadoop、Spark等进行数据处理，能够在多个节点上并行处理海量数据。

# 总结
- 并发是处理多个任务的能力，任务交替进行，不一定在同一时刻执行，适用于I/O密集型应用。
- 并行是同时处理多个任务的能力，任务在同一时刻执行，适用于计算密集型应用。
- 在实际开发中，理解并发与并行的区别有助于我们选择合适的工具和技术，设计出更高效、可扩展的系统。

无论是在操作系统设计、Web开发还是高性能计算领域，并发和并行都起着至关重要的作用。希望本文能够帮助大家清晰地理解这两个概念，并能够在实际开发中灵活应用。

----

欢迎在评论区分享您的见解和经验，讨论如何在实际项目中有效利用并发和并行。
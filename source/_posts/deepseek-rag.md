---
title: DeepSeek + RAGï¼š è®©å¤§æ¨¡å‹æ›´æ™ºèƒ½ã€æ›´ç²¾å‡†
date: 2025-03-14 16:10:51
tags:
---


åœ¨å¤§æ¨¡å‹åº”ç”¨ä¸­ï¼Œ**å¦‚ä½•ä¿è¯ç­”æ¡ˆçš„å‡†ç¡®æ€§å’Œå®æ—¶æ€§** ä¸€ç›´æ˜¯ä¸€ä¸ªéš¾é¢˜ã€‚å°½ç®¡ LLMï¼ˆLarge Language Modelsï¼‰å…·æœ‰å¼ºå¤§çš„ç”Ÿæˆèƒ½åŠ›ï¼Œä½†å®ƒä»¬çš„çŸ¥è¯†å­˜åœ¨ **æ—¶é—´å±€é™æ€§**ï¼Œå¹¶ä¸”å®¹æ˜“äº§ç”Ÿâ€œå¹»è§‰â€ï¼ˆhallucinationï¼‰ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œ**RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰** æ–¹æ¡ˆåº”è¿è€Œç”Ÿï¼Œåœ¨ RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ä¸­ï¼Œæ£€ç´¢æœºåˆ¶è´Ÿè´£è·å–ç›¸å…³ä¿¡æ¯ï¼Œè€Œ LLM è´Ÿè´£ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆã€‚**DeepSeek** ä½œä¸ºå›½å†…é¢†å…ˆçš„å¤§æ¨¡å‹ä¹‹ä¸€ï¼Œå¯ä»¥åœ¨ RAG ä½“ç³»ä¸­ä½œä¸ºç”Ÿæˆéƒ¨åˆ†ï¼Œä¸ºæ£€ç´¢å¢å¼ºçš„ä¸Šä¸‹æ–‡æä¾›è‡ªç„¶ã€å‡†ç¡®çš„å›ç­”ã€‚æœ¬æ–‡å°†å¸¦ä½ äº†è§£ DeepSeek ä¸ RAG çš„ç»“åˆï¼Œå¹¶æä¾›ä»£ç ç¤ºä¾‹ã€‚

---

## ** ä»€ä¹ˆæ˜¯ RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ï¼Ÿ**

**RAGï¼ˆRetrieval-Augmented Generationï¼‰** æ˜¯ä¸€ç§å°† **ä¿¡æ¯æ£€ç´¢ï¼ˆRetrievalï¼‰** ä¸ **å¤§æ¨¡å‹ç”Ÿæˆï¼ˆGenerationï¼‰** ç»“åˆçš„æŠ€æœ¯ï¼Œä¸»è¦åˆ†ä¸º **ä¸¤æ­¥ï¼š**

1. **æ£€ç´¢ï¼ˆRetrieveï¼‰**: åœ¨å¤–éƒ¨çŸ¥è¯†åº“ï¼ˆå¦‚æ–‡æ¡£æ•°æ®åº“ã€å‘é‡æ•°æ®åº“ï¼‰ä¸­æ‰¾åˆ°ä¸ç”¨æˆ·é—®é¢˜ç›¸å…³çš„ä¿¡æ¯ã€‚
2. **ç”Ÿæˆï¼ˆGenerateï¼‰**: å°†æ£€ç´¢åˆ°çš„å†…å®¹ä½œä¸ºä¸Šä¸‹æ–‡è¾“å…¥ç»™å¤§æ¨¡å‹ï¼Œæé«˜å›ç­”çš„å‡†ç¡®æ€§ã€‚

**ä¼˜ç‚¹ï¼š**
- è®© LLM èƒ½å¤Ÿåˆ©ç”¨**æœ€æ–°çš„**å¤–éƒ¨çŸ¥è¯†ï¼Œä¸å†å±€é™äºè®­ç»ƒæ•°æ®ã€‚
- é™ä½ LLM **èƒ¡ç¼–ä¹±é€ ï¼ˆå¹»è§‰ï¼‰** çš„æ¦‚ç‡ã€‚
- æä¾›**å¯éªŒè¯çš„ç­”æ¡ˆæ¥æº**ï¼Œæé«˜å¯é æ€§ã€‚

![hallucination](./images/deepseek-rag/hallucination.png)

---

## ** ä¸ºä»€ä¹ˆé€‰æ‹© DeepSeek ä½œä¸º RAG æ¨¡å‹ï¼Ÿ**

[DeepSeek](https://deepseek.com/) æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å›½äº§ LLMï¼Œå…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š
- **æ”¯æŒä¸­æ–‡ä¼˜åŒ–**ï¼Œç›¸æ¯” GPT-4/Claudeï¼Œåœ¨ä¸­æ–‡åœºæ™¯ä¸‹è¡¨ç°æ›´ä½³ã€‚
- **æ›´å¼€æ”¾çš„ API**ï¼Œå¯ä»¥å…è´¹è¯•ç”¨ï¼Œå¹¶ä¸”æä¾›äº†æœ¬åœ°éƒ¨ç½²ç‰ˆæœ¬ã€‚
- **æ¨¡å‹èƒ½åŠ›å¼º**ï¼Œæ”¯æŒ **ä»£ç ã€æ•°å­¦æ¨ç†ã€çŸ¥è¯†é—®ç­”ç­‰ä»»åŠ¡**ï¼Œé€‚åˆ RAG åœºæ™¯ã€‚

æ­¤å¤–ï¼ŒDeepSeek æä¾› **DeepSeek-VLï¼ˆè§†è§‰+æ–‡æœ¬ï¼‰** ä»¥åŠ **DeepSeek-Coderï¼ˆä»£ç ç”Ÿæˆï¼‰** ç‰ˆæœ¬ï¼Œä½¿å…¶åœ¨ **æŠ€æœ¯æ–‡æ¡£é—®ç­”ã€ä»£ç è¾…åŠ©ã€é‡‘èåˆ†æç­‰é¢†åŸŸ** è¡¨ç°ä¼˜å¼‚ã€‚å½“ç„¶æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼ŒDeepSeek æ˜¯ **å¼€æº** çš„ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥åœ¨æœ¬åœ°éƒ¨ç½²å®ƒï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œå®šåˆ¶ã€‚è°èƒ½æ‹’ç»ç™½å«–å‘¢ï¼Ÿ![DeepSeek](./images/deepseek-rag/baipiao.jpg)

---

## ** å¦‚ä½•å®ç° DeepSeek + RAGï¼Ÿ**

æˆ‘ä»¬å¯ä»¥ç»“åˆ **DeepSeek + Qdrant å‘é‡æ•°æ®åº“** æ¥å®ç°ä¸€ä¸ªç®€å•çš„ RAG ç³»ç»Ÿï¼š

å‰ç½®æ¡ä»¶ï¼š
- æœ¬åœ°éƒ¨ç½²ollamaã€‚
- ollamaè¿è¡ŒDeepSeekã€‚
- ä¸€ä¸ª Qdrant å®ä¾‹ã€‚

> å¯¹äºéƒ¨ç½²ä»¥ä¸Šç¯å¢ƒéƒ¨ç½²æœ‰ç–‘é—®çš„è€é“å¯ä»¥å‚è€ƒè€å¤«ä¹‹å‰çš„ä»‹ç»
>
> [ã€ŠDeepSeek æœ¬åœ°éƒ¨ç½²+webç«¯è®¿é—® æŒ‡å—ã€‹](https://mp.weixin.qq.com/s/EmNzMrH1L52IWcEdROWehQ)
> 
> [ã€ŠQdrantï¼šå¼€å¯é«˜æ•ˆç›¸ä¼¼æ€§æœç´¢çš„å…ˆé”‹ã€‹](https://mp.weixin.qq.com/s/vrwbpo3cUrSKN1OX9LjgOw)

### **æ¶æ„**

1. **æ•°æ®é¢„å¤„ç†**ï¼š
   - å°†æ–‡æ¡£ï¼ˆå¦‚ PDFã€ç½‘é¡µï¼‰åˆ†å‰²æˆå°æ®µï¼Œå¹¶å‘é‡åŒ–å­˜å‚¨ã€‚
2. **ç”¨æˆ·è¾“å…¥æŸ¥è¯¢**ï¼š
   - è®¡ç®—è¾“å…¥é—®é¢˜çš„å‘é‡ï¼Œå¹¶æ£€ç´¢ç›¸ä¼¼çš„æ–‡æ¡£ç‰‡æ®µã€‚
3. **DeepSeek ç”Ÿæˆå›ç­”**ï¼š
   - å°†æ£€ç´¢åˆ°çš„æ–‡æ¡£ç‰‡æ®µå’Œç”¨æˆ·é—®é¢˜ä¸€èµ·è¾“å…¥ DeepSeekï¼Œç”Ÿæˆæœ€ç»ˆç­”æ¡ˆã€‚

![æ¶æ„](./images/deepseek-rag/RAG-system-architecture.png)

### **ä»£ç å®ç°**

è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ `Qdrant` ä½œä¸ºå‘é‡æ•°æ®åº“ï¼Œå¹¶ç»“åˆ `DeepSeek` è¿›è¡Œ RAG ä»»åŠ¡ã€‚

#### **å®‰è£…ä¾èµ–**

```bash
pip install qdrant-client openai tiktoken
```

#### **1ï¸âƒ£ æ•°æ®é¢„å¤„ç†ï¼ˆæ–‡æœ¬å‘é‡åŒ– + å­˜å…¥ Qdrantï¼‰**

```python
import Qdrant
import numpy as np
from openai import OpenAI

# é…ç½®å‚æ•°
COLLECTION_NAME = "deepseek_rag"
QDRANT_URL = "http://localhost:6333"

# è¿æ¥ Qdrant
client = QdrantClient(QDRANT_URL)
ollamaClient = ollama.Client(host="http://127.0.0.1:11434")

# å‡è®¾æˆ‘ä»¬æœ‰ä¸€äº›æ–‡æœ¬éœ€è¦å­˜å…¥ Qdrant
docs = [
        "DeepSeek æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¤§æ¨¡å‹ï¼Œæ”¯æŒä»£ç ç”Ÿæˆå’Œä¸­æ–‡ä¼˜åŒ–ã€‚",
        "RAG æ˜¯ç»“åˆæ£€ç´¢ä¸ç”Ÿæˆçš„æŠ€æœ¯ï¼Œèƒ½å¤Ÿæå‡å¤§æ¨¡å‹å›ç­”çš„å‡†ç¡®æ€§ã€‚",
        "Qdrant æ˜¯ä¸€ä¸ªé«˜æ•ˆçš„å‘é‡æ•°æ®åº“ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡æ£€ç´¢ã€‚",
        "ITProHubæ˜¯ä¸€ä¸ªè‡´åŠ›äºä¿¡æ¯æŠ€æœ¯é¢†åŸŸï¼Œä¸ºä¸“ä¸šäººå£«ã€å­¦ä¹ è€…å’ŒæŠ€æœ¯çˆ±å¥½è€…æä¾›ä¸°å¯Œçš„èµ„æºã€æŠ€èƒ½åŸ¹è®­çš„ç¤¾åŒºäº¤æµå¹³å°ã€‚",
]

# å‘é‡åŒ–
doc_vectors = []
for doc in docs:
     """ ä½¿ç”¨æœ¬åœ° Ollama è®¡ç®—æ–‡æœ¬åµŒå…¥å‘é‡ """
    response = ollamaClient.embeddings(model="mxbai-embed-large", prompt=text)
    vector = response.embeddingresponse.data[0].embedding
    doc_vectors.append(vector)

# å­˜å…¥ Qdrant
points = [
    PointStruct(id=i, vector=vectors[i], payload={"text": docs[i]})
    for i in range(len(docs))
]
client.upsert(collection_name=COLLECTION_NAME, points=points)
print(f"ğŸ“¥ å·²å­˜å…¥ {len(docs)} ç¯‡æ–‡æ¡£")
```

#### **2ï¸âƒ£ ç”¨æˆ·æŸ¥è¯¢ + å‘é‡æ£€ç´¢**

```python
def retrieve_similar_docs(query, top_k=2):
    """ ä» Qdrant ä¸­æ£€ç´¢ä¸æŸ¥è¯¢æœ€ç›¸ä¼¼çš„æ–‡æ¡£ """
    query_vector = get_embedding(query)
    search_result = client.search(
        collection_name=COLLECTION_NAME, query_vector=query_vector, limit=top_k
    )
    return [hit.payload["text"] for hit in search_result]

# ç¤ºä¾‹æŸ¥è¯¢
query = "ä½ çŸ¥é“ITProHubä¹ˆï¼Ÿ"
retrieved_docs = retrieve_similar_docs(query)
print("æ£€ç´¢åˆ°çš„ç›¸å…³æ–‡æ¡£ï¼š", retrieved_docs)
```

#### **3ï¸âƒ£ DeepSeek ç”Ÿæˆç­”æ¡ˆ**

```python
def generate_answer(query, retrieved_docs):
    """ ä½¿ç”¨ DeepSeek ç»“åˆæ£€ç´¢å†…å®¹ç”Ÿæˆç­”æ¡ˆ """
    context = "\n".join(retrieved_docs)
    prompt = f"æ ¹æ®ä»¥ä¸‹ä¿¡æ¯å›ç­”ç”¨æˆ·é—®é¢˜ï¼š\n{context}\n\nç”¨æˆ·é—®é¢˜ï¼š{query}"

    response = ollamaClient.chat(
        model="deepseek-r1:1.5b",
        messages=[{"role": "user", "content": prompt}],
    )
    return response["message"]["content"]

# ç”Ÿæˆç­”æ¡ˆ
final_answer = generate_answer(query, retrieved_docs)
print("DeepSeek ç”Ÿæˆçš„ç­”æ¡ˆï¼š", final_answer)
```

#### ** 4ï¸âƒ£ çœ‹çœ‹æ•ˆæœ**

1. åŸå§‹æœç´¢ç»“æœ
æå‡ºé—®é¢˜ï¼š"ä½ çŸ¥é“ITProHub?" æ˜¾ç„¶åœ¨åŸå§‹æ¨¡å‹çš„æ•°æ®é‡Œé¢æ˜¯æ²¡æœ‰å…³äºæœ¬å…¬ä¼—å·çš„ä»»ä½•ä¿¡æ¯çš„ï¼Œæ‰€ä»¥ä½ å¯ä»¥çœ‹åˆ°deepseeké’ˆå¯¹è¿™ä¸ªé—®é¢˜å¼€å§‹èƒ¡è¨€ä¹±è¯­äº†
![æ•ˆæœ](./images/deepseek-rag/raw-result.png)
å¯ä»¥çœ‹åˆ°é’ˆå¯¹ `ITProHub` è¿™ä¸ªé—®é¢˜ï¼ŒåŸå§‹çš„æ¨¡å‹å¹¶ä¸çŸ¥é“æ˜¯å•¥ã€‚
2. æ¥å…¥RAGä¹‹åçš„æ•ˆæœ
æ¥å…¥RAGä¹‹åï¼Œæ¨¡å‹å¯ä»¥æ ¹æ®æ£€ç´¢åˆ°çš„å†…å®¹ï¼Œç”Ÿæˆæ›´å‡†ç¡®çš„ç­”æ¡ˆã€‚
![æ•ˆæœ](./images/deepseek-rag/rag-result.png)
---

## **4. å…¸å‹åº”ç”¨åœºæ™¯**

1. **ä¼ä¸šçŸ¥è¯†åº“é—®ç­”**ï¼ˆå®¢æˆ·æ”¯æŒã€å†…éƒ¨æ–‡æ¡£æœç´¢ï¼‰
2. **AIOps**ï¼ˆé€šè¿‡ RAGï¼Œç»“åˆå®æ—¶è¿ç»´æ•°æ®ï¼Œå¿«é€Ÿå®šä½å’Œåˆ†ææ•…éšœåŸå› ï¼‰
3. **ä»£ç è¾…åŠ©**ï¼ˆè‡ªåŠ¨è¡¥å…¨ã€ä»£ç æ–‡æ¡£è§£æï¼‰
4. **å­¦æœ¯ç ”ç©¶**ï¼ˆæŸ¥è¯¢ç‰¹å®šæ–‡çŒ®ï¼Œç”Ÿæˆæ‘˜è¦ï¼‰

---

## **5. æ€»ç»“**

RAG ä½œä¸ºä¸€ç§ **ç»“åˆå¤–éƒ¨çŸ¥è¯†å’Œå¤§æ¨¡å‹çš„å¢å¼ºæŠ€æœ¯**ï¼Œæå¤§æé«˜äº†å›ç­”çš„**å‡†ç¡®æ€§å’Œå¯è§£é‡Šæ€§**ã€‚DeepSeek ä½œä¸ºå›½äº§ LLMï¼Œåœ¨ **ä¸­æ–‡ä¼˜åŒ–ã€API å…¼å®¹æ€§ã€ä»£ç ç”Ÿæˆèƒ½åŠ›** æ–¹é¢æœ‰ç‹¬ç‰¹ä¼˜åŠ¿ï¼Œé€‚åˆä½œä¸º RAG ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ã€‚

**æœªæ¥ï¼Œæˆ‘ä»¬å¯ä»¥æ¢ç´¢æ›´å¤šä¼˜åŒ–æ–¹æ¡ˆï¼Œæ¯”å¦‚ï¼š**
- **ç»“åˆ LlamaIndex / LangChain** è¿›è¡Œæ›´å¤æ‚çš„æ£€ç´¢ã€‚
- **ä½¿ç”¨ Milvus / Weaviate** ç­‰æ›´å¼ºå¤§çš„å‘é‡æ•°æ®åº“ã€‚
- **æœ¬åœ°åŒ–éƒ¨ç½² DeepSeek**ï¼Œæå‡æ•°æ®å®‰å…¨æ€§ã€‚

å¦‚æœä½ å¯¹ RAG å’Œ DeepSeek æ„Ÿå…´è¶£ï¼Œå¯ä»¥å°è¯•åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­è½åœ°åº”ç”¨ï¼Œè®© AI å˜å¾—æ›´æ™ºèƒ½ã€æ›´å¯é ï¼ğŸš€
å®Œæ•´ç¤ºä¾‹ä»£ç å¯è®¿é—®è€å¤«çš„[GitHub](https://github.com/ItProHub/rag)

